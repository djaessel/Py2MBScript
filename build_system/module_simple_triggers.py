from __future__ import division
from past.utils import old_div
from header_common import *
from header_operations import *
from header_parties import *
from header_items import *
from header_skills import *
from header_triggers import *
from header_troops import *
from header_music import *

from module_constants import *

simple_triggers = [

(ti_on_party_encounter, [
]),

(ti_simulate_battle, [
]),

(1.0, [
(try_begin),
    (eq,"$training_ground_position_changed",0),
    (assign,"$training_ground_position_changed",1),
    (set_fixed_point_multiplier, 100),
    (position_set_x,0,7050),
    (position_set_y,0,7200),
    (party_set_position,"p_training_ground_3",0),
(try_end),
(try_begin),
    (gt,"$auto_besiege_town",0),
    (gt,"$g_player_besiege_town",0),
    (ge,"$g_siege_method",1),
    (store_current_hours,":cur_hours_001"),
    (try_begin),
        (eq,"$g_siege_force_wait",0),
        (ge,":cur_hours_001","$g_siege_method_finish_hours"),
        (neg|is_currently_night),
        (rest_for_hours,0,0,0),
    (try_end),
(try_end),
]),

(0.0, [
(try_begin),
    (eq,"$bug_fix_version",0),
    (disable_party,"p_test_scene"),
    (party_set_slot,"p_town_1",27,0),
    (faction_set_note_available, "fac_player_faction", 0),
    (faction_set_note_available, "fac_no_faction", 0),
    (try_begin),
        (neg|check_quest_active,"qst_kidnapped_girl"),
        (party_remove_members,"p_main_party","trp_kidnapped_girl",1),
    (try_end),
    (try_for_range, ":trp_001", "trp_knight_1_1", "trp_kingdom_1_pretender"),
        (try_begin),
            (troop_slot_eq,":trp_001",2,0),
            (store_troop_faction,":troop_faction_002",":trp_001"),
            (try_begin),
                (is_between,":troop_faction_002","fac_kingdom_1","fac_kingdoms_end"),
                (troop_set_slot,":trp_001",2,2),
            (try_end),
        (try_end),
    (try_end),
    (call_script, "script_initialize_item_info"),
    (assign,"$bug_fix_version",1),
(try_end),
(try_begin),
    (eq,"$g_player_is_captive",1),
    (gt,"$capturer_party",0),
    (party_is_active,"$capturer_party"),
    (party_relocate_near_party,"p_main_party","$capturer_party",0),
(try_end),
]),

(0.0, [
(try_begin),
    (gt,"$g_last_rest_center",0),
    (party_get_battle_opponent, ":party_battle_opponent_001", "$g_last_rest_center"),
    (try_begin),
        (gt,":party_battle_opponent_001",0),
        (store_faction_of_party, ":party_faction_002", "$g_last_rest_center"),
        (store_relation,":faction_relation_003",":party_faction_002","fac_player_supporters_faction"),
        (store_faction_of_party, ":party_faction_004", ":party_battle_opponent_001"),
        (store_relation,":faction_relation_005",":party_faction_004","fac_player_supporters_faction"),
        (try_begin),
            (ge,":faction_relation_003",0),
            (lt,":faction_relation_005",0),
            (start_encounter,"$g_last_rest_center"),
            (rest_for_hours,0,0,0),
        (else_try),
            (store_current_hours,":cur_hours_006"),
            (assign,":var007",0),
            (try_begin),
                (neq,"$g_check_autos_at_hour",0),
                (ge,":cur_hours_006","$g_check_autos_at_hour"),
                (assign,":var007",1),
                (assign,"$g_check_autos_at_hour",0),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (this_or_next|eq,":var007",1),
        (map_free),
        (try_begin),
            (ge,"$auto_menu",1),
            (jump_to_menu,"$auto_menu"),
            (assign,"$auto_menu",-1),
        (else_try),
            (ge,"$auto_enter_town",1),
            (start_encounter,"$auto_enter_town"),
        (else_try),
            (ge,"$auto_besiege_town",1),
            (start_encounter,"$auto_besiege_town"),
        (else_try),
            (ge,"$g_camp_mode",1),
            (assign,"$g_camp_mode",0),
            (assign,"$g_infinite_camping",0),
            (assign,"$g_player_icon_state",0),
            (rest_for_hours,0,0,0),
            (display_message, "@@Breaking camp..."),
        (try_end),
    (try_end),
(try_end),
]),

(0.0, [
(try_begin),
    (neg|troop_slot_ge,"trp_notification_menu_types",0,1),
    (troop_get_slot,":troop_slot_001","trp_notification_menu_types",0),
    (troop_get_slot,"$g_notification_menu_var1","trp_notification_menu_var1",0),
    (troop_get_slot,"$g_notification_menu_var2","trp_notification_menu_var2",0),
    (jump_to_menu,":troop_slot_001"),
    (assign,":var002",2),
    (try_for_range, ":slot_no_003", 1, ":var002"),
        (try_begin),
            (neg|troop_slot_ge,"trp_notification_menu_types",":slot_no_003",1),
            (val_add, ":var002", 1),
        (try_end),
    (try_end),
    (store_sub, ":slot_no_004", ":slot_no_003", 1),
    (troop_get_slot,":troop_slot_005","trp_notification_menu_types",":slot_no_003"),
    (troop_set_slot,"trp_notification_menu_types",":slot_no_004",":troop_slot_005"),
    (troop_get_slot,":troop_slot_005","trp_notification_menu_var1",":slot_no_003"),
    (troop_set_slot,"trp_notification_menu_var1",":slot_no_004",":troop_slot_005"),
    (troop_get_slot,":troop_slot_005","trp_notification_menu_var2",":slot_no_003"),
    (troop_set_slot,"trp_notification_menu_var2",":slot_no_004",":troop_slot_005"),
(try_end),
]),

(1.0, [
(try_begin),
    (map_free),
    (call_script, "script_music_set_situation_with_culture", 65536),
(try_end),
]),

(0.0, [
(try_begin),
    (eq,"$caravan_escort_state",1),
    (party_is_active,"$caravan_escort_party_id"),
    (store_distance_to_party_from_party,":distance_parties_001","$caravan_escort_destination_town","$caravan_escort_destination_town"),
    (try_begin),
        (lt,":distance_parties_001",2),
        (store_distance_to_party_from_party,":distance_parties_002","p_main_party","p_main_party"),
        (try_begin),
            (lt,":distance_parties_002",5),
            (assign,"$talk_context",2),
            (assign,"$g_encountered_party","$caravan_escort_party_id"),
            (party_stack_get_troop_id,      ":troop_id_003","$caravan_escort_party_id",0),
            (party_stack_get_troop_dna,     ":party_stack_troop_dna_004","$caravan_escort_party_id",0),
            (start_map_conversation,":troop_id_003"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (gt,"$g_reset_mission_participation",1),
    (try_for_range, ":trp_005", "trp_npc1", "trp_heroes_end"),
        (troop_set_slot,":trp_005",149,0),
    (try_end),
(try_end),
]),

(24.0, [
(try_for_range, ":fac_001", "fac_kingdom_1", "fac_kingdoms_end"),
    (faction_get_slot,":faction_slot_002",":fac_001",99),
    (store_sub, ":var003", 140, "$player_right_to_rule"),
    (val_div, ":var003", 14),
    (val_max,":var003",1),
    (store_div, ":var___x1", ":faction_slot_002", ":var003"),
    (assign,":var004",":var___x1"),
    (val_sub, ":faction_slot_002", ":var004"),
    (faction_set_slot,":fac_001",99,":faction_slot_002"),
(try_end),
]),

(4.0, [
(try_for_range, ":trp_001", "trp_knight_1_1_wife", "trp_heroes_end"),
    (try_begin),
        (neg|troop_slot_ge,":trp_001",8,0),
        (call_script, "script_get_kingdom_lady_social_determinants", ":trp_001"),
        (assign,":var002",reg1),
        (troop_set_slot,":trp_001",12,":var002"),
    (try_end),
(try_end),
]),

(2.0, [
(try_begin),
    (eq,"$cheat_mode",1),
    (assign,":var001",0),
    (try_for_parties, ":cur_party"),
        (try_begin),
            (gt,":cur_party","p_spawn_points_end"),
            (party_stack_get_troop_id,      ":troop_id_003",":cur_party",0),
            (try_begin),
                (is_between,":troop_id_003","trp_npc1","trp_knight_1_1_wife"),
                (troop_get_slot,":troop_slot_004",":troop_id_003",10),
                (try_begin),
                    (neq,":cur_party",":troop_slot_004"),
                    (assign,reg4,":cur_party"),
                    (assign,reg5,":troop_slot_004"),
                    (str_store_troop_name,s3,":troop_id_003"),
                    (display_message, "@@{!}{s3} commander of party"),
                    (str_store_string,s65,"str_party_with_commander_mismatch__check_log_for_details_"),
                    (try_begin),
                        (eq,":var001",0),
                        (call_script, "script_add_notification_menu", "mnu_debug_alert_from_s65", 0, 0),
                        (assign,":var001",1),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(24.0, [
(try_begin),
    (neg|check_quest_active,"qst_visit_lady"),
    (neg|troop_slot_ge,"trp_player",8,1),
    (neg|troop_slot_ge,"trp_player",30,"trp_npc1"),
    (assign,":var001",-1),
    (assign,":var002",120),
    (try_for_range, ":trp_003", "trp_knight_1_1_wife", "trp_heroes_end"),
        (try_begin),
            (troop_slot_ge,":trp_003",5,2),
            (neg|troop_slot_eq,":trp_003",5,4),
            (troop_slot_eq,":trp_003",37,0),
            (troop_slot_eq,":trp_003",30,-1),
            (troop_get_slot,":troop_slot_004",":trp_003",12),
            (try_begin),
                (is_between,":troop_slot_004","p_town_1","p_village_1"),
                (call_script, "script_troop_get_relation_with_troop", "trp_player", ":trp_003"),
                (try_begin),
                    (gt,reg0,1),
                    (store_current_hours,":cur_hours_005"),
                    (troop_get_slot,":troop_slot_006",":trp_003",4),
                    (val_sub, ":cur_hours_005", ":troop_slot_006"),
                    (try_begin),
                        (gt,":cur_hours_005",":var002"),
                        (assign,":var002",":cur_hours_005"),
                        (assign,":var001",":trp_003"),
                        (assign,":var007",":troop_slot_004"),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (gt,":var001",0),
        (call_script, "script_add_notification_menu", "mnu_notification_lady_requests_visit", ":var001", ":var007"),
    (try_end),
(try_end),
]),

(1.0, [
(try_begin),
    (ge,"$g_player_raiding_village",1),
    (try_begin),
        (neq,"$g_player_is_captive",0),
        (assign,"$g_player_raiding_village",0),
    (else_try),
        (map_free),
        (assign,"$g_player_raiding_village",0),
    (else_try),
        (this_or_next|party_slot_eq,"$g_player_raiding_village",35,2),
        (party_slot_eq,"$g_player_raiding_village",35,4),
        (start_encounter,"$g_player_raiding_village"),
        (rest_for_hours,0),
        (assign,"$g_player_raiding_village",0),
        (assign,"$g_player_raid_complete",1),
    (else_try),
        (party_slot_eq,"$g_player_raiding_village",35,1),
        (rest_for_hours,3,5,1),
    (else_try),
        (rest_for_hours,0,0,0),
        (assign,"$g_player_raiding_village",0),
        (assign,"$g_player_raid_complete",0),
    (try_end),
(try_end),
]),

(168.0, [
(assign,"$g_presentation_lines_to_display_begin",0),
(assign,"$g_presentation_lines_to_display_end",15),
(assign,"$g_apply_budget_report_to_gold",1),
(try_begin),
    (eq,"$g_infinite_camping",0),
    (start_presentation, "prsnt_budget_report"),
(try_end),
]),

(24.0, [
(try_begin),
    (le,"$auto_menu",0),
    (gt,"$players_kingdom",0),
    (neq,"$players_kingdom","fac_player_supporters_faction"),
    (eq,"$player_has_homage",0),
    (troop_get_slot,":troop_slot_001","trp_player",30),
    (assign,":var002",0),
    (try_begin),
        (is_between,":troop_slot_001","trp_npc1","trp_knight_1_1_wife"),
        (store_troop_faction,":troop_faction_003",":troop_slot_001"),
        (try_begin),
            (eq,":troop_faction_003","$players_kingdom"),
            (assign,":var002",1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,":var002",0),
    (store_current_day,":cur_day_004"),
    (try_begin),
        (gt,":cur_day_004","$mercenary_service_next_renew_day"),
        (jump_to_menu,"mnu_oath_fulfilled"),
    (try_end),
(try_end),
]),

(180.0, [
(val_sub, "$g_player_luck", 1),
(val_max,"$g_player_luck",0),
]),

(72.0, [
(assign,"$lady_flirtation_location",0),
]),

(4.0, [
(assign,"$g_time_to_spare",1),
(try_begin),
    (troop_slot_ge,"trp_player",30,"trp_npc1"),
    (assign,"$g_player_banner_granted",1),
(try_end),
]),

(24.0, [
(try_begin),
    (eq,"$g_player_banner_granted",1),
    (troop_slot_eq,"trp_player",13,0),
    (le,"$auto_menu",0),
    (start_presentation, "prsnt_banner_selection"),
(try_end),
]),

(24.0, [
(call_script, "script_get_player_party_morale_values"),
(assign,":var001",reg0),
(party_get_morale, ":party_morale_002","p_main_party"),
(store_sub, ":var003", ":var001", ":party_morale_002"),
(store_div, ":var___x1", ":var003", 5),
(assign,":var004",":var___x1"),
(store_mul, ":var005", ":var004", 5),
(try_begin),
    (neq,":var005",":var003"),
    (try_begin),
        (gt,":var003",0),
        (val_add, ":var004", 1),
    (else_try),
        (val_sub, ":var004", 1),
    (try_end),
(try_end),
(val_add, ":party_morale_002", ":var004"),
(party_set_morale, "p_main_party", ":party_morale_002"),
]),

(168.0, [
(try_for_range, ":p_001", "p_town_1", "p_salt_mine"),
    (party_get_num_prisoner_stacks, ":party_num_prisoners_stacks_002",":p_001"),
    (try_for_range, ":var003", 0, ":party_num_prisoners_stacks_002"),
        (party_prisoner_stack_get_troop_id,":party_prisoner_troop_id_004",":p_001",":var003"),
        (try_begin),
            (neg|troop_is_hero,":party_prisoner_troop_id_004"),
            (party_prisoner_stack_get_size, ":party_prisoner_stack_size_005",":p_001",":var003"),
            (store_random_in_range,":random_x_006",0,40),
            (val_mul, ":party_prisoner_stack_size_005", ":random_x_006"),
            (val_div, ":party_prisoner_stack_size_005", 100),
            (party_remove_members,":p_001",":party_prisoner_troop_id_004",":party_prisoner_stack_size_005"),
        (try_end),
    (try_end),
(try_end),
]),

(168.0, [
(try_for_range, ":trp_001", "trp_npc1", "trp_knight_1_1_wife"),
    (troop_get_slot,":troop_slot_002",":trp_001",21),
    (val_mul, ":troop_slot_002", 101),
    (val_div, ":troop_slot_002", 100),
    (troop_set_slot,":trp_001",21,":troop_slot_002"),
    (call_script, "script_calculate_hero_weekly_net_income_and_add_to_wealth", ":trp_001"),
(try_end),
(try_for_range, ":p_003", "p_town_1", "p_village_1"),
    (try_begin),
        (neg|party_slot_eq,":p_003",7,"trp_player"),
        (party_slot_ge,":p_003",7,1),
        (party_get_slot,":party_slot_004",":p_003",49),
        (party_get_slot,":party_slot_005",":p_003",50),
        (store_mul, ":var006", ":party_slot_005", 15),
        (val_add, ":var006", 700),
        (try_begin),
            (party_slot_eq,":p_003",0,3),
            (val_mul, ":var006", 3),
            (val_div, ":var006", 2),
        (try_end),
    (try_end),
    (val_add, ":party_slot_004", ":var006"),
    (call_script, "script_calculate_weekly_party_wage", ":p_003"),
    (val_sub, ":party_slot_004", reg0),
    (val_max,":party_slot_004",0),
    (party_set_slot,":p_003",49,":party_slot_004"),
(try_end),
]),

(24.0, [
(try_for_range, ":trp_001", "trp_npc1", "trp_knight_1_1_wife"),
    (try_begin),
        (troop_slot_eq,":trp_001",2,2),
        (troop_get_slot,":troop_slot_002",":trp_001",10),
        (try_begin),
            (ge,":troop_slot_002",1),
            (party_is_active,":troop_slot_002"),
            (party_get_attached_to, ":party_attached_003", ":troop_slot_002"),
            (try_begin),
                (is_between,":party_attached_003","p_town_1","p_salt_mine"),
                (party_slot_eq,":party_attached_003",54,-1),
                (store_faction_of_party, ":party_faction_004", ":troop_slot_002"),
                (try_begin),
                    (this_or_next|eq,":party_faction_004","$players_kingdom"),
                    (eq,":party_faction_004","fac_player_supporters_faction"),
                    (assign,":random_x_005",1),
                    (store_random_in_range,":random_x_006",0,2),
                    (val_add, ":random_x_005", ":random_x_006"),
                (else_try),
                    (game_get_reduce_campaign_ai, ":campaign_ai"),
                    (try_begin),
                        (eq,":campaign_ai",0),
                        (assign,":random_x_005",2),
                    (else_try),
                        (eq,":campaign_ai",1),
                        (assign,":random_x_005",1),
                        (store_random_in_range,":random_x_006",0,2),
                        (val_add, ":random_x_005", ":random_x_006"),
                    (else_try),
                        (eq,":campaign_ai",2),
                        (assign,":random_x_005",1),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (faction_slot_eq,":party_faction_004",8,":trp_001"),
        (val_add, ":random_x_005", 1),
    (try_end),
    (try_for_range, ":var008", 0, ":random_x_005"),
        (call_script, "script_hire_men_to_kingdom_hero_party", ":trp_001"),
    (try_end),
(try_end),
(try_for_range, ":p_009", "p_town_1", "p_village_1"),
    (try_begin),
        (neg|party_slot_eq,":p_009",7,"trp_player"),
        (party_slot_ge,":p_009",7,1),
        (party_slot_eq,":p_009",54,-1),
        (store_faction_of_party, ":party_faction_010", ":p_009"),
        (try_begin),
            (this_or_next|eq,":party_faction_010","$players_kingdom"),
            (eq,":party_faction_010","fac_player_supporters_faction"),
            (assign,":var011",450),
        (else_try),
            (game_get_reduce_campaign_ai, ":campaign_ai"),
            (assign,":var011",450),
            (try_begin),
                (eq,":campaign_ai",0),
                (assign,":var011",300),
                (store_random_in_range,":random_x_005",0,2),
                (val_add, ":random_x_005", 1),
            (else_try),
                (eq,":campaign_ai",1),
                (assign,":var011",450),
                (assign,":random_x_005",1),
            (else_try),
                (eq,":campaign_ai",2),
                (assign,":var011",600),
                (store_random_in_range,":random_x_005",0,2),
            (try_end),
        (try_end),
    (try_end),
    (try_for_range, ":var008", 0, ":random_x_005"),
        (party_get_slot,":party_slot_012",":p_009",49),
        (assign,":var013",":party_slot_012"),
        (val_div, ":var013", 2),
        (try_begin),
            (gt,":var013",":var011"),
            (call_script, "script_cf_reinforce_party", ":p_009"),
            (val_sub, ":party_slot_012", ":var011"),
            (party_set_slot,":p_009",49,":party_slot_012"),
        (try_end),
    (try_end),
(try_end),
(try_for_range, ":p_009", "p_town_1", "p_salt_mine"),
    (store_random_in_range,":random_x_014",0,30),
    (try_begin),
        (le,":random_x_014",10),
        (call_script, "script_get_center_ideal_prosperity", ":p_009"),
        (assign,":var015",reg0),
        (party_get_slot,":party_slot_016",":p_009",50),
        (try_begin),
            (eq,":random_x_014",0),
            (try_begin),
                (eq,1,1),
                (store_random_in_range,":random_x_014",0,2),
                (try_begin),
                    (eq,":random_x_014",0),
                    (neg|is_between,":p_009","p_castle_1","p_village_1"),
                    (call_script, "script_change_center_prosperity", ":p_009", -10),
                    (val_add, "$newglob_total_prosperity_from_convergence", -10),
                (else_try),
                    (call_script, "script_change_center_prosperity", ":p_009", 10),
                    (val_add, "$newglob_total_prosperity_from_convergence", 10),
                (try_end),
            (try_end),
        (try_end),
    (else_try),
        (gt,":party_slot_016",":var015"),
        (call_script, "script_change_center_prosperity", ":p_009", -1),
        (val_add, "$newglob_total_prosperity_from_convergence", -1),
    (else_try),
        (lt,":party_slot_016",":var015"),
        (call_script, "script_change_center_prosperity", ":p_009", 1),
        (val_add, "$newglob_total_prosperity_from_convergence", 1),
    (try_end),
(try_end),
]),

(360.0, [
]),

(6.0, [
(store_current_day,":cur_day_001"),
(try_begin),
    (neq,":cur_day_001","$g_last_half_payment_check_day"),
    (assign,"$g_last_half_payment_check_day",":cur_day_001"),
    (try_begin),
        (eq,"$g_half_payment_checkpoint",1),
        (val_add, "$g_cur_week_half_daily_wage_payments", 1),
    (try_end),
    (assign,"$g_half_payment_checkpoint",1),
(try_end),
(assign,":var002",0),
(try_begin),
    (neg|map_free),
    (ge,"$g_last_rest_center",0),
    (this_or_next|party_slot_eq,"$g_last_rest_center",130,1),
    (is_between,"$g_last_rest_center","p_town_1","p_village_1"),
    (assign,":var002",1),
(try_end),
(try_begin),
    (eq,":var002",0),
    (assign,"$g_half_payment_checkpoint",0),
(try_end),
]),

(24.0, [
(call_script, "script_randomly_start_war_peace_new", 1),
(try_begin),
    (eq,1,1),
    (store_random_in_range,":random_x_001","p_village_1","p_salt_mine"),
    (store_random_in_range,":random_x_002","p_village_1","p_salt_mine"),
    (store_faction_of_party, ":party_faction_003", ":random_x_001"),
    (store_faction_of_party, ":party_faction_004", ":random_x_002"),
    (try_begin),
        (neq,":random_x_001",":random_x_002"),
        (neq,":party_faction_003",":party_faction_004"),
        (call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", ":party_faction_004", ":party_faction_003"),
        (try_begin),
            (eq,reg0,0),
            (try_begin),
                (party_slot_eq,":random_x_001",61,":party_faction_004"),
                (call_script, "script_add_notification_menu", "mnu_notification_border_incident", ":random_x_001", -1),
            (else_try),
                (party_slot_eq,":random_x_001",62,":party_faction_004"),
                (call_script, "script_add_notification_menu", "mnu_notification_border_incident", ":random_x_001", -1),
            (else_try),
                (set_fixed_point_multiplier, 1),
                (store_distance_to_party_from_party,":distance_parties_005",":random_x_001",":random_x_001"),
                (try_begin),
                    (lt,":distance_parties_005",25),
                    (call_script, "script_add_notification_menu", "mnu_notification_border_incident", ":random_x_001", ":random_x_002"),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_for_range, ":fac_006", "fac_player_supporters_faction", "fac_kingdoms_end"),
    (try_begin),
        (faction_slot_eq,":fac_006",21,0),
        (try_for_range, ":fac_007", "fac_player_supporters_faction", "fac_kingdoms_end"),
            (try_begin),
                (neq,":fac_006",":fac_007"),
                (faction_slot_eq,":fac_007",21,0),
                (store_add, ":slot_no_008", ":fac_007", 120),
                (store_sub, ":slot_no_008", ":slot_no_008", "fac_player_supporters_faction"),
                (faction_get_slot,":faction_slot_009",":fac_006",":slot_no_008"),
                (try_begin),
                    (ge,":faction_slot_009",1),
                    (try_begin),
                        (eq,":faction_slot_009",1),
                        (call_script, "script_update_faction_notes", ":fac_006"),
                        (try_begin),
                            (lt,":fac_006",":fac_007"),
                            (call_script, "script_add_notification_menu", "mnu_notification_truce_expired", ":fac_006", ":fac_007"),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
            (val_sub, ":faction_slot_009", 1),
            (faction_set_slot,":fac_006",":slot_no_008",":faction_slot_009"),
        (try_end),
        (store_add, ":slot_no_010", ":fac_007", 130),
        (store_sub, ":slot_no_010", ":slot_no_010", "fac_player_supporters_faction"),
        (faction_get_slot,":faction_slot_011",":fac_006",":slot_no_010"),
        (try_begin),
            (ge,":faction_slot_011",1),
            (try_begin),
                (eq,1,1),
                (store_relation,":faction_relation_012",":fac_006",":fac_007"),
                (try_begin),
                    (lt,":faction_relation_012",0),
                    (faction_set_slot,":fac_006",":slot_no_010",0),
                (else_try),
                    (eq,":faction_slot_011",1),
                    (call_script, "script_add_notification_menu", "mnu_notification_casus_belli_expired", ":fac_006", ":fac_007"),
                    (faction_set_slot,":fac_006",":slot_no_010",0),
                (else_try),
                    (val_sub, ":faction_slot_011", 1),
                    (faction_set_slot,":fac_006",":slot_no_010",":faction_slot_011"),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (eq,1,1),
            (store_relation,":faction_relation_012",":fac_006",":fac_007"),
            (try_begin),
                (lt,":faction_relation_012",0),
                (store_add, ":slot_no_013", ":fac_007", 140),
                (store_sub, ":slot_no_013", ":slot_no_013", "fac_player_supporters_faction"),
                (faction_get_slot,":faction_slot_014",":fac_006",":slot_no_013"),
                (val_add, ":faction_slot_014", 1),
                (faction_set_slot,":fac_006",":slot_no_013",":faction_slot_014"),
            (try_end),
        (try_end),
    (try_end),
    (call_script, "script_update_faction_notes", ":fac_006"),
(try_end),
]),

(48.0, [
(try_for_range, ":trp_001", "trp_npc1", "trp_knight_1_1_wife"),
    (try_begin),
        (troop_slot_eq,":trp_001",2,2),
        (troop_get_slot,":troop_slot_002",":trp_001",10),
        (try_begin),
            (gt,":troop_slot_002","p_salt_mine"),
            (party_is_active,":troop_slot_002"),
            (store_skill_level,":skill_lvl_003",17,":trp_001"),
            (val_add, ":skill_lvl_003", 5),
            (store_mul, ":var004", ":skill_lvl_003", 1000),
            (assign,":var005",30),
            (try_begin),
                (eq,1,1),
                (store_troop_faction,":troop_faction_006",":trp_001"),
                (try_begin),
                    (neq,":troop_faction_006","$players_kingdom"),
                    (game_get_reduce_campaign_ai, ":campaign_ai"),
                    (try_begin),
                        (eq,":campaign_ai",0),
                        (assign,":var005",35),
                        (val_mul, ":var004", 3),
                        (val_div, ":var004", 2),
                    (else_try),
                        (eq,":campaign_ai",2),
                        (assign,":var005",25),
                        (val_div, ":var004", 2),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (store_random_in_range,":random_x_008",0,100),
    (try_begin),
        (le,":random_x_008",":var005"),
        (party_upgrade_with_xp, ":troop_slot_002", ":var004"),
    (try_end),
(try_end),
(try_for_range, ":p_009", "p_town_1", "p_village_1"),
    (party_get_slot,":party_slot_010",":p_009",7),
    (try_begin),
        (neq,":party_slot_010","trp_player"),
        (assign,":var004",3000),
        (assign,":var005",30),
        (try_begin),
            (eq,1,1),
            (assign,":troop_faction_011",-1),
            (try_begin),
                (ge,":party_slot_010",0),
                (store_troop_faction,":troop_faction_011",":party_slot_010"),
            (try_end),
        (try_end),
        (try_begin),
            (neq,":troop_faction_011","$players_kingdom"),
            (game_get_reduce_campaign_ai, ":campaign_ai"),
            (try_begin),
                (eq,":campaign_ai",0),
                (assign,":var005",35),
                (val_mul, ":var004", 3),
                (val_div, ":var004", 2),
            (else_try),
                (eq,":campaign_ai",2),
                (assign,":var005",25),
                (val_div, ":var004", 2),
            (try_end),
        (try_end),
    (try_end),
    (store_random_in_range,":random_x_008",0,100),
    (try_begin),
        (le,":random_x_008",":var005"),
        (party_upgrade_with_xp, ":p_009", ":var004"),
    (try_end),
(try_end),
]),

(24.0, [
(call_script, "script_process_sieges"),
]),

(2.0, [
(call_script, "script_process_village_raids"),
]),

(7.0, [
(call_script, "script_init_ai_calculation"),
(try_for_range, ":trp_001", "trp_npc1", "trp_knight_1_1_wife"),
    (try_begin),
        (troop_slot_eq,":trp_001",2,2),
        (call_script, "script_calculate_troop_ai", ":trp_001"),
    (try_end),
(try_end),
]),

(24.0, [
]),

(24.0, [
(try_for_range, ":trp_001", "trp_npc1", "trp_knight_1_1_wife"),
    (troop_get_slot,":troop_slot_002",":trp_001",51),
    (val_sub, ":troop_slot_002", 5),
    (val_max,":troop_slot_002",0),
    (troop_set_slot,":trp_001",51,":troop_slot_002"),
(try_end),
(store_random_in_range,":random_x_003",1,3),
(val_min,":random_x_003",2),
(try_for_range, ":trp_004", "trp_npc1", "trp_knight_1_1_wife"),
    (troop_get_slot,":troop_slot_005",":trp_004",150),
    (try_begin),
        (ge,":troop_slot_005",1),
        (val_sub, ":troop_slot_005", ":random_x_003"),
        (val_max,":troop_slot_005",0),
        (troop_set_slot,":trp_004",150,":troop_slot_005"),
    (try_end),
(try_end),
(troop_get_slot,":troop_slot_005","trp_player",150),
(val_sub, ":troop_slot_005", ":random_x_003"),
(val_max,":troop_slot_005",0),
(troop_set_slot,"trp_player",150,":troop_slot_005"),
]),

(8.0, [
(try_begin),
    (call_script,"script_cf_random_political_event"),
    (call_script,"script_cf_random_political_event"),
(try_end),
]),

(0.5, [
(val_add, "$g_lord_long_term_count", 1),
(try_begin),
    (neg|is_between,"$g_lord_long_term_count","trp_kingdom_heroes_including_player_begin","trp_knight_1_1_wife"),
    (assign,"$g_lord_long_term_count","trp_kingdom_heroes_including_player_begin"),
(try_end),
(assign,":troop_id_001","$g_lord_long_term_count"),
(try_begin),
    (eq,":troop_id_001","trp_kingdom_heroes_including_player_begin"),
    (assign,":troop_id_001","trp_player"),
(try_end),
(try_begin),
    (eq,"$cheat_mode",1),
    (str_store_troop_name,s9,":troop_id_001"),
    (display_message, "@@{!}DEBUG -- Doing political calculations for {s9}"),
(try_end),
(try_begin),
    (troop_slot_eq,":troop_id_001",2,2),
    (neq,":troop_id_001","trp_player"),
    (assign,":var002",-1),
    (try_for_range, ":p_003", "p_town_1", "p_salt_mine"),
        (try_begin),
            (party_slot_eq,":p_003",7,":troop_id_001"),
            (assign,":var002",":p_003"),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var002",-1),
        (store_troop_faction,":troop_faction_004",":troop_id_001"),
        (faction_get_slot,":faction_slot_005",":troop_faction_004",11),
        (troop_get_slot,":troop_slot_006",":troop_id_001",52),
        (try_begin),
            (neq,":faction_slot_005",":troop_id_001"),
            (try_begin),
                (this_or_next|eq,":troop_slot_006",5),
                (this_or_next|eq,":troop_slot_006",4),
                (this_or_next|eq,":troop_slot_006",3),
                (eq,":troop_slot_006",2),
                (call_script, "script_troop_change_relation_with_troop", ":troop_id_001", ":faction_slot_005", -4),
                (val_add, "$total_no_fief_changes", -4),
            (else_try),
                (eq,":troop_slot_006",1),
                (call_script, "script_troop_change_relation_with_troop", ":troop_id_001", ":faction_slot_005", -2),
                (val_add, "$total_no_fief_changes", -2),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (this_or_next|troop_slot_eq,":troop_id_001",2,2),
    (eq,":troop_id_001","trp_player"),
    (try_begin),
        (eq,":troop_id_001","trp_player"),
        (assign,":troop_faction_007","$players_kingdom"),
    (else_try),
        (store_troop_faction,":troop_faction_007",":troop_id_001"),
    (try_end),
    (faction_get_slot,":faction_slot_005",":troop_faction_007",11),
    (try_begin),
        (neq,":troop_id_001",":faction_slot_005"),
        (neg|is_between,":troop_id_001","trp_kingdom_1_lord","trp_knight_1_1"),
        (neg|is_between,":troop_id_001","trp_kingdom_1_pretender","trp_knight_1_1_wife"),
        (assign,":var008",0),
        (try_for_range, ":p_009", "p_town_1", "p_village_1"),
            (store_faction_of_party, ":party_faction_010", ":p_009"),
            (try_begin),
                (eq,":party_faction_010",":troop_faction_007"),
                (val_add, ":var008", 1),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (this_or_next|eq,":troop_faction_007","fac_player_supporters_faction"),
        (eq,":troop_faction_007","$players_kingdom"),
        (val_add, ":var008", 1),
    (try_end),
    (call_script, "script_troop_get_relation_with_troop", ":troop_id_001", ":faction_slot_005"),
    (try_begin),
        (this_or_next|gt,reg0,-50),
        (eq,":var008",0),
        (call_script, "script_cf_troop_can_intrigue", ":troop_id_001", 0),
        (store_random_in_range,":random_x_011",0,2),
        (try_begin),
            (this_or_next|eq,":var008",0),
            (neq,":random_x_011",0),
            (neq,":troop_id_001","trp_player"),
            (try_begin),
                (neq,":var008",0),
                (assign,"$g_give_advantage_to_original_faction",1),
            (try_end),
        (try_end),
        (store_troop_faction,":troop_faction_012",":troop_id_001"),
        (call_script, "script_lord_find_alternative_faction", ":troop_id_001"),
        (assign,":var013",reg0),
        (assign,"$g_give_advantage_to_original_faction",0),
        (try_begin),
            (neq,":var013",":troop_faction_012"),
            (is_between,":var013","fac_player_supporters_faction","fac_kingdoms_end"),
            (str_store_troop_name_link,s1,":troop_id_001"),
            (str_store_faction_name_link,s2,":var013"),
            (str_store_faction_name_link,s3,":troop_faction_007"),
            (call_script, "script_change_troop_faction", ":troop_id_001", ":var013"),
            (try_begin),
                (ge,"$cheat_mode",1),
                (str_store_troop_name,s4,":troop_id_001"),
                (display_message, "@@{!}DEBUG - {s4} faction changed in defection"),
            (try_end),
            (troop_get_type,reg4,":troop_id_001"),
            (str_store_string,s4,"str_lord_defects_ordinary"),
            (display_log_message,"@{!}{s4}"),
            (try_begin),
                (eq,"$cheat_mode",1),
                (this_or_next|eq,":var013","$players_kingdom"),
                (eq,":troop_faction_007","$players_kingdom"),
                (call_script, "script_add_notification_menu", "mnu_notification_lord_defects", ":troop_id_001", ":troop_faction_007"),
            (try_end),
        (try_end),
    (else_try),
        (neq,":faction_slot_005","trp_player"),
        (call_script, "script_troop_get_relation_with_troop", ":troop_id_001", ":faction_slot_005"),
        (try_begin),
            (le,reg0,-50),
            (call_script, "script_indict_lord_for_treason", ":troop_id_001", ":troop_faction_007"),
        (try_end),
    (try_end),
(else_try),
    (neq,":troop_id_001","trp_player"),
    (store_troop_faction,":troop_faction_007",":troop_id_001"),
    (try_begin),
        (faction_slot_ge,":troop_faction_007",64,1),
        (neg|troop_slot_ge,":troop_id_001",154,1),
        (this_or_next|troop_slot_eq,":troop_id_001",154,-1),
        (neq,"$players_kingdom",":troop_faction_007"),
        (troop_slot_eq,":troop_id_001",2,2),
        (call_script, "script_npc_decision_checklist_take_stand_on_issue", ":troop_id_001"),
        (troop_set_slot,":troop_id_001",154,reg0),
    (try_end),
(try_end),
(try_for_range, ":trp_014", "trp_npc1", "trp_knight_1_1_wife"),
    (call_script, "script_troop_get_relation_with_troop", ":troop_id_001", ":trp_014"),
    (try_begin),
        (lt,reg0,0),
        (assign,":var015",reg0),
        (store_sub, ":var016", 0, ":var015"),
        (store_random_in_range,":random_x_017",0,300),
        (try_begin),
            (lt,":random_x_017",":var016"),
            (call_script, "script_troop_change_relation_with_troop", ":troop_id_001", ":trp_014", 1),
            (val_add, "$total_relation_changes_through_convergence", 1),
        (try_end),
    (try_end),
(try_end),
]),

(2.0, [
]),

(1.0, [
(call_script, "script_process_alarms"),
(call_script, "script_allow_vassals_to_join_indoor_battle"),
(call_script, "script_process_kingdom_parties_ai"),
]),

(3.0, [
(store_current_hours,":cur_hours_001"),
(try_for_range, ":p_002", "p_town_1", "p_village_1"),
    (party_get_slot,":party_slot_003",":p_002",54),
    (try_begin),
        (gt,":party_slot_003",0),
        (party_is_active,":party_slot_003"),
        (store_faction_of_party, ":party_faction_004", ":party_slot_003"),
        (try_begin),
            (party_slot_ge,":p_002",54,1),
            (party_get_slot,":party_slot_005",":p_002",64),
            (store_sub, ":party_slot_005", ":cur_hours_001", ":party_slot_005"),
            (assign,":var006",0),
            (assign,":var007",0),
            (assign,":var008",0),
            (assign,":var009",0),
            (try_for_range, ":trp_010", "trp_npc1", "trp_knight_1_1_wife"),
                (try_begin),
                    (troop_slot_eq,":trp_010",2,2),
                    (neg|troop_slot_ge,":trp_010",8,0),
                    (troop_get_slot,":troop_slot_011",":trp_010",10),
                    (try_begin),
                        (gt,":troop_slot_011",0),
                        (party_is_active,":troop_slot_011"),
                        (store_troop_faction,":troop_faction_012",":trp_010"),
                        (try_begin),
                            (eq,":troop_faction_012",":party_faction_004"),
                            (assign,":var013",0),
                            (try_begin),
                                (party_slot_eq,":troop_slot_011",4,1),
                                (party_slot_eq,":troop_slot_011",5,":p_002"),
                                (assign,":var013",1),
                            (else_try),
                                (party_slot_eq,":troop_slot_011",4,11),
                                (party_get_slot,":party_slot_014",":troop_slot_011",5),
                                (try_begin),
                                    (gt,":party_slot_014",0),
                                    (party_is_active,":party_slot_014"),
                                    (party_slot_eq,":party_slot_014",4,1),
                                    (party_slot_eq,":party_slot_014",5,":p_002"),
                                    (assign,":var013",1),
                                (try_end),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (eq,":var013",1),
            (party_get_battle_opponent, ":party_battle_opponent_015", ":troop_slot_011"),
            (try_begin),
                (this_or_next|ge,":party_battle_opponent_015",0),
                (eq,":party_battle_opponent_015",":p_002"),
                (try_begin),
                    (faction_slot_eq,":party_faction_004",8,":trp_010"),
                    (assign,":var009",1),
                (try_end),
            (try_end),
        (try_end),
        (call_script, "script_party_calculate_regular_strength", ":troop_slot_011"),
        (val_add, ":var008", reg0),
    (try_end),
    (try_begin),
        (gt,":var008",0),
        (party_collect_attachments_to_party, ":p_002", "p_collective_enemy"),
        (call_script, "script_party_calculate_regular_strength", "p_collective_enemy"),
        (assign,":var016",reg0),
        (try_begin),
            (eq,"$auto_enter_town",":p_002"),
            (eq,"$g_player_is_captive",0),
            (call_script, "script_party_calculate_regular_strength", "p_main_party"),
            (val_add, ":var016", reg0),
            (val_mul, ":var008", 2),
        (try_end),
        (party_get_slot,":party_slot_017",":p_002",65),
        (val_add, ":party_slot_017", 100),
        (val_mul, ":var016", ":party_slot_017"),
        (val_div, ":var016", 100),
        (val_max,":var016",1),
        (try_begin),
            (eq,":var009",1),
            (eq,":party_faction_004","$players_kingdom"),
            (check_quest_active,"qst_follow_army"),
            (val_mul, ":var008", 2),
        (try_end),
        (store_mul, ":var018", ":var008", 100),
        (val_div, ":var018", ":var016"),
        (store_sub, ":var019", ":var018", 250),
        (try_begin),
            (gt,":var019",-100),
            (store_div, ":var___x1", ":party_slot_005", 2),
            (assign,":var020",":var___x1"),
            (val_add, ":var019", ":var020"),
        (try_end),
        (val_div, ":var019", 5),
        (val_max,":var019",0),
        (store_sub, ":var021", 175, ":var018"),
        (val_max,":var021",0),
        (try_begin),
            (eq,1,1),
            (store_random_in_range,":random_x_022",0,100),
            (try_begin),
                (lt,":random_x_022",":var019"),
                (gt,":party_slot_005",24),
                (assign,":var006",1),
            (else_try),
                (store_random_in_range,":random_x_022",0,100),
                (try_begin),
                    (lt,":random_x_022",":var021"),
                    (assign,":var007",1),
                (try_end),
            (try_end),
        (try_end),
    (else_try),
        (assign,":var007",1),
    (try_end),
    (try_begin),
        (eq,":var006",1),
        (call_script, "script_begin_assault_on_center", ":p_002"),
    (else_try),
        (eq,":var007",1),
        (try_for_range, ":trp_010", "trp_npc1", "trp_knight_1_1_wife"),
            (try_begin),
                (troop_slot_eq,":trp_010",2,2),
                (neg|troop_slot_ge,":trp_010",8,0),
                (troop_get_slot,":troop_slot_011",":trp_010",10),
                (try_begin),
                    (gt,":troop_slot_011",0),
                    (party_is_active,":troop_slot_011"),
                    (party_slot_eq,":troop_slot_011",4,1),
                    (party_slot_eq,":troop_slot_011",5,":p_002"),
                    (party_slot_eq,":troop_slot_011",8,1),
                    (call_script, "script_party_set_ai_state", ":troop_slot_011", -1, -1),
                    (call_script, "script_party_set_ai_state", ":troop_slot_011", 1, ":p_002"),
                    (party_set_slot,":p_002",64,":cur_hours_001"),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(6.0, [
(assign,"$g_recalculate_ais",1),
]),

(0.0, [
(try_begin),
    (ge,"$cheat_mode",1),
    (try_for_range, ":trp_001", "trp_kingdom_1_lord", "trp_knight_1_1"),
        (store_add, ":var002", ":trp_001", "fac_kingdom_1"),
        (store_sub, ":var002", ":var002", "trp_kingdom_1_lord"),
        (store_troop_faction,":troop_faction_003",":trp_001"),
        (try_begin),
            (neq,":var002",":troop_faction_003"),
            (neq,":troop_faction_003","fac_commoners"),
            (ge,"$cheat_mode",2),
            (neq,":trp_001","trp_kingdom_2_lord"),
            (str_store_troop_name,s4,":trp_001"),
            (str_store_faction_name,s5,":troop_faction_003"),
            (str_store_faction_name,s6,":var002"),
            (str_store_string,s65,"@{!}DEBUG - {s4} is in {s5}, should be in {s6}, disabling political cheat mode"),
            (rest_for_hours,0,0,0),
            (jump_to_menu,"mnu_debug_alert_from_s65"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,"$g_recalculate_ais",1),
    (assign,"$g_recalculate_ais",0),
    (call_script, "script_recalculate_ais"),
(try_end),
]),

(24.0, [
(try_for_range, ":fac_001", "fac_player_supporters_faction", "fac_kingdoms_end"),
    (call_script, "script_faction_recalculate_strength", ":fac_001"),
(try_end),
(try_for_range, ":trp_002", "trp_npc1", "trp_knight_1_1_wife"),
    (store_troop_faction,":troop_faction_003",":trp_002"),
    (try_begin),
        (neg|faction_slot_eq,":troop_faction_003",4,0),
        (neg|faction_slot_eq,":troop_faction_003",4,6),
        (neg|faction_slot_eq,":troop_faction_003",4,1),
        (troop_get_slot,":troop_slot_004",":trp_002",10),
        (try_begin),
            (party_is_active,":troop_slot_004"),
            (val_add, "$total_vassal_days_on_campaign", 1),
            (try_begin),
                (party_slot_eq,":troop_slot_004",4,11),
                (val_add, "$total_vassal_days_responding_to_campaign", 1),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(36.0, [
(try_for_range, ":trp_001", "trp_npc1", "trp_heroes_end"),
    (troop_set_slot,":trp_001",20,0),
(try_end),
(try_for_range, ":trp_001", "trp_village_1_elder", "trp_merchants_end"),
    (troop_set_slot,":trp_001",20,0),
(try_end),
]),

(168.0, [
(try_for_range, ":p_001", "p_village_1", "p_salt_mine"),
    (call_script, "script_refresh_village_merchant_inventory", ":p_001"),
(try_end),
]),

(48.0, [
(try_for_range, ":p_001", "p_village_1", "p_salt_mine"),
    (call_script, "script_refresh_village_defenders", ":p_001"),
    (party_set_slot,":p_001",46,0),
(try_end),
]),

(168.0, [
(try_for_range, ":p_001", "p_town_1", "p_salt_mine"),
    (try_begin),
        (neg|is_between,":p_001","p_castle_1","p_village_1"),
        (party_get_slot,":party_slot_002",":p_001",205),
        (party_get_slot,":party_slot_003",":p_001",206),
        (party_get_slot,":party_slot_004",":p_001",208),
        (val_max,":party_slot_004",1),
        (store_mul, ":var005", ":party_slot_002", 400),
        (store_mul, ":var006", ":party_slot_003", 200),
        (val_add, ":var005", ":var006"),
        (val_div, ":var005", ":party_slot_004"),
        (store_random_in_range,":random_x_007",0,100),
        (try_begin),
            (eq,":random_x_007",0),
            (val_min,":party_slot_002",10),
        (else_try),
            (gt,":var005",100),
            (val_mul, ":party_slot_003", 90),
            (val_div, ":party_slot_003", 100),
            (val_mul, ":party_slot_002", 90),
            (val_div, ":party_slot_002", 100),
        (else_try),
            (lt,":var005",30),
            (val_mul, ":party_slot_002", 120),
            (val_div, ":party_slot_002", 100),
            (val_add, ":party_slot_002", 1),
            (val_mul, ":party_slot_003", 120),
            (val_div, ":party_slot_003", 100),
            (val_add, ":party_slot_003", 1),
        (else_try),
            (lt,":var005",60),
            (val_mul, ":party_slot_002", 110),
            (val_div, ":party_slot_002", 100),
            (val_add, ":party_slot_002", 1),
            (val_mul, ":party_slot_003", 110),
            (val_div, ":party_slot_003", 100),
            (val_add, ":party_slot_003", 1),
        (else_try),
            (lt,":var005",100),
            (lt,":random_x_007",50),
            (val_mul, ":party_slot_002", 105),
            (val_div, ":party_slot_002", 100),
            (try_begin),
                (le,":party_slot_002",20),
                (val_add, ":party_slot_002", 1),
            (try_end),
        (try_end),
        (val_mul, ":party_slot_003", 105),
        (val_div, ":party_slot_003", 100),
        (try_begin),
            (le,":party_slot_003",20),
            (val_add, ":party_slot_003", 1),
        (try_end),
    (try_end),
    (party_set_slot,":p_001",205,":party_slot_002"),
    (party_set_slot,":p_001",206,":party_slot_003"),
(try_end),
]),

(168.0, [
(try_for_range, ":p_001", "p_town_1", "p_salt_mine"),
    (try_begin),
        (party_slot_ge,":p_001",7,0),
        (party_get_slot,":party_slot_002",":p_001",47),
        (assign,":var003",0),
        (try_begin),
            (party_slot_eq,":p_001",0,4),
            (try_begin),
                (party_slot_eq,":p_001",35,0),
                (assign,":var003",1200),
            (try_end),
        (else_try),
            (party_slot_eq,":p_001",0,2),
            (assign,":var003",1200),
        (else_try),
            (party_slot_eq,":p_001",0,3),
            (assign,":var003",2400),
        (try_end),
        (party_get_slot,":party_slot_004",":p_001",50),
        (store_add, ":var005", 20, ":party_slot_004"),
        (val_mul, ":var003", ":var005"),
        (val_div, ":var003", 120),
        (try_begin),
            (party_slot_eq,":p_001",7,"trp_player"),
            (game_get_reduce_campaign_ai, ":campaign_ai"),
            (try_begin),
                (eq,":campaign_ai",0),
                (val_mul, ":var003", 3),
                (val_div, ":var003", 4),
            (else_try),
                (eq,":campaign_ai",1),
            (else_try),
                (eq,":campaign_ai",2),
                (val_mul, ":var003", 4),
                (val_div, ":var003", 3),
            (try_end),
        (try_end),
        (val_add, ":party_slot_002", ":var003"),
        (party_set_slot,":p_001",47,":party_slot_002"),
    (try_end),
    (try_begin),
        (is_between,":p_001","p_village_1","p_salt_mine"),
        (party_get_slot,":party_slot_007",":p_001",120),
        (try_begin),
            (party_slot_ge,":party_slot_007",7,0),
            (is_between,":party_slot_007","p_castle_1","p_village_1"),
            (party_get_slot,":party_slot_002",":party_slot_007",47),
            (val_add, ":party_slot_002", ":var003"),
            (party_set_slot,":party_slot_007",47,":party_slot_002"),
        (try_end),
    (try_end),
(try_end),
]),

(32.0, [
(try_begin),
    (eq,"$players_kingdom",0),
    (le,"$g_invite_faction",0),
    (eq,"$g_player_is_captive",0),
    (troop_get_type,":troop_type_001","trp_player"),
    (try_begin),
        (eq,":troop_type_001",1),
        (eq,"$npc_with_sisterly_advice",0),
        (try_for_range, ":trp_002", "trp_npc1", "trp_kingdom_1_lord"),
            (try_begin),
                (main_party_has_troop,":trp_002"),
                (troop_get_type,":troop_type_003",":trp_002"),
                (try_begin),
                    (eq,":troop_type_003",1),
                    (troop_slot_ge,"trp_player",7,150),
                    (troop_slot_ge,":trp_002",139,1),
                    (assign,"$npc_with_sisterly_advice",":trp_002"),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(else_try),
    (store_random_in_range,":random_x_004","fac_kingdom_1","fac_kingdoms_end"),
    (assign,":var005",999999),
    (try_for_range, ":p_006", "p_town_1", "p_village_1"),
        (store_faction_of_party, ":party_faction_007", ":p_006"),
        (try_begin),
            (eq,":party_faction_007",":random_x_004"),
            (store_distance_to_party_from_party,":distance_parties_008","p_main_party","p_main_party"),
            (val_min,":var005",":distance_parties_008"),
        (try_end),
    (try_end),
    (try_begin),
        (lt,":var005",30),
        (store_relation,":faction_relation_009",":random_x_004","fac_player_supporters_faction"),
        (faction_get_slot,":faction_slot_010",":random_x_004",11),
        (call_script, "script_troop_get_player_relation", ":faction_slot_010"),
        (assign,":var011",reg0),
        (call_script, "script_get_number_of_hero_centers", "trp_player"),
        (assign,":var012",reg0),
        (try_begin),
            (eq,"$g_infinite_camping",0),
            (assign,":party_size_wo_prisoners_013",0),
            (try_begin),
                (ge,"p_main_party",0),
                (store_party_size_wo_prisoners,":party_size_wo_prisoners_013","p_main_party"),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var012",0),
        (troop_get_slot,":troop_slot_014","trp_player",7),
        (try_begin),
            (ge,":troop_slot_014",160),
            (ge,":faction_relation_009",0),
            (ge,":var011",0),
            (ge,":party_size_wo_prisoners_013",45),
            (store_random_in_range,":random_x_015",0,100),
            (try_begin),
                (lt,":random_x_015",50),
                (call_script, "script_get_poorest_village_of_faction", ":random_x_004"),
                (assign,"$g_invite_offered_center",reg0),
                (try_begin),
                    (ge,"$g_invite_offered_center",0),
                    (assign,"$g_invite_faction",":random_x_004"),
                    (jump_to_menu,"mnu_invite_player_to_faction"),
                (else_try),
                    (gt,":var012",0),
                    (neq,"$players_oath_renounced_against_kingdom",":random_x_004"),
                    (ge,":faction_relation_009",-40),
                    (ge,":var011",-20),
                    (ge,":party_size_wo_prisoners_013",30),
                    (store_random_in_range,":random_x_015",0,100),
                    (try_begin),
                        (lt,":random_x_015",20),
                        (assign,"$g_invite_faction",":random_x_004"),
                        (assign,"$g_invite_offered_center",-1),
                        (jump_to_menu,"mnu_invite_player_to_faction_without_center"),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(168.0, [
(try_for_range, ":trp_001", "trp_npc1", "trp_knight_1_1_wife"),
    (store_random_in_range,":random_x_002",0,9999),
    (troop_set_slot,":trp_001",49,":random_x_002"),
(try_end),
]),

(0.1, [
(try_for_range, ":trp_001", "trp_npc1", "trp_heroes_end"),
    (try_begin),
        (troop_slot_eq,":trp_001",2,2),
        (troop_get_slot,":troop_slot_002",":trp_001",10),
        (try_begin),
            (ge,":troop_slot_002",1),
            (party_is_active,":troop_slot_002"),
            (party_get_attached_to, ":party_attached_003", ":troop_slot_002"),
            (try_begin),
                (lt,":party_attached_003",1),
                (party_get_cur_town, ":party_cur_town_004", ":troop_slot_002"),
                (try_begin),
                    (is_between,":party_cur_town_004","p_town_1","p_salt_mine"),
                    (call_script, "script_get_relation_between_parties", ":party_cur_town_004", ":troop_slot_002"),
                    (try_begin),
                        (ge,reg0,0),
                        (party_attach_to_party, ":troop_slot_002", ":party_cur_town_004"),
                    (else_try),
                        (party_set_ai_behavior,":troop_slot_002",0),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (this_or_next|party_slot_eq,":party_cur_town_004",0,3),
        (party_slot_eq,":party_cur_town_004",0,2),
        (store_faction_of_party, ":party_faction_005", ":troop_slot_002"),
        (store_faction_of_party, ":party_faction_006", ":party_cur_town_004"),
        (try_begin),
            (eq,":party_faction_005",":party_faction_006"),
            (party_get_num_prisoner_stacks, ":party_num_prisoners_stacks_007",":troop_slot_002"),
            (try_begin),
                (gt,":party_num_prisoners_stacks_007",0),
                (assign,"$g_move_heroes",1),
                (call_script, "script_party_prisoners_add_party_prisoners", ":party_cur_town_004", ":troop_slot_002"),
                (assign,"$g_move_heroes",1),
                (call_script, "script_party_remove_all_prisoners", ":troop_slot_002"),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_for_parties, ":cur_party"),
    (try_begin),
        (gt,":cur_party","p_spawn_points_end"),
        (party_get_template_id,":party_template_id_009",":cur_party"),
        (try_begin),
            (ge,":party_template_id_009","pt_steppe_bandit_lair"),
            (store_distance_to_party_from_party,":distance_parties_010","p_main_party","p_main_party"),
            (try_begin),
                (lt,":distance_parties_010",3),
                (party_set_flags, ":cur_party", 256, 0),
                (party_set_flags, ":cur_party", 16384, 1),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(48.0, [
(call_script, "script_randomly_make_prisoner_heroes_escape_from_party", "p_main_party", 50),
(try_for_range, ":p_001", "p_town_1", "p_village_1"),
    (assign,":var002",30),
    (try_begin),
        (party_slot_eq,":p_001",135,1),
        (assign,":var002",5),
    (try_end),
    (call_script, "script_randomly_make_prisoner_heroes_escape_from_party", ":p_001", ":var002"),
(try_end),
]),

(48.0, [
(try_for_range, ":trp_001", "trp_npc1", "trp_knight_1_1_wife"),
    (try_begin),
        (troop_slot_eq,":trp_001",2,2),
        (str_store_troop_name,s1,":trp_001"),
        (try_begin),
            (neg|troop_slot_ge,":trp_001",8,0),
            (neg|troop_slot_ge,":trp_001",10,1),
            (store_troop_faction,":troop_faction_002",":trp_001"),
            (try_begin),
                (eq,":troop_faction_002","fac_outlaws"),
            (else_try),
                (try_begin),
                    (eq,"$cheat_mode",2),
                    (str_store_troop_name,s4,":trp_001"),
                    (display_message, "str_debug__attempting_to_spawn_s4"),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (call_script, "script_cf_select_random_walled_center_with_faction_and_owner_priority_no_siege", ":troop_faction_002", ":trp_001"),
            (assign,":var003",reg0),
            (try_begin),
                (eq,"$cheat_mode",2),
                (str_store_party_name,s7,":var003"),
                (str_store_troop_name,s0,":trp_001"),
                (display_message, "str_debug__s0_is_spawning_around_party__s7"),
            (try_end),
        (try_end),
        (call_script, "script_create_kingdom_hero_party", ":trp_001", ":var003"),
        (try_begin),
            (eq,"$g_there_is_no_avaliable_centers",0),
            (party_attach_to_party, "$pout_party", ":var003"),
        (try_end),
        (troop_get_slot,":troop_slot_004",":trp_001",10),
        (call_script, "script_party_set_ai_state", ":troop_slot_004", 7, ":var003"),
    (else_try),
        (neg|faction_slot_eq,":troop_faction_002",21,0),
        (try_begin),
            (is_between,":trp_001","trp_kingdom_1_lord","trp_knight_1_1"),
            (troop_set_slot,":trp_001",55,"fac_commoners"),
        (else_try),
            (store_random_in_range,":random_x_005",0,100),
            (try_begin),
                (lt,":random_x_005",10),
                (call_script, "script_cf_get_random_active_faction_except_player_faction_and_faction", ":troop_faction_002"),
                (troop_set_slot,":trp_001",55,reg0),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(24.0, [
(try_for_range, ":p_001", "p_village_1", "p_salt_mine"),
    (try_begin),
        (party_slot_eq,":p_001",35,0),
        (party_get_slot,":party_slot_002",":p_001",122),
        (try_begin),
            (this_or_next|eq,":party_slot_002",0),
            (neg|party_is_active,":party_slot_002"),
            (store_random_in_range,":random_x_003",0,100),
            (try_begin),
                (lt,":random_x_003",60),
                (call_script, "script_create_village_farmer_party", ":p_001"),
                (party_set_slot,":p_001",122,reg0),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(72.0, [
(call_script, "script_update_trade_good_prices"),
(try_for_range, ":p_001", "p_town_1", "p_salt_mine"),
    (party_get_slot,":party_slot_002",":p_001",51),
    (try_begin),
        (gt,":party_slot_002",1000),
        (val_mul, ":party_slot_002", 95),
        (val_div, ":party_slot_002", 100),
        (val_max,":party_slot_002",1000),
    (else_try),
        (lt,":party_slot_002",1000),
        (val_mul, ":party_slot_002", 105),
        (val_div, ":party_slot_002", 100),
        (val_min,":party_slot_002",1000),
    (try_end),
    (party_set_slot,":p_001",51,":party_slot_002"),
(try_end),
]),

(8.0, [
(try_for_parties, ":cur_party"),
    (try_begin),
        (party_slot_eq,":cur_party",0,11),
        (party_is_in_any_town,":cur_party"),
        (store_faction_of_party, ":party_faction_002", ":cur_party"),
        (faction_get_slot,":faction_slot_003",":party_faction_002",82),
        (try_begin),
            (le,":faction_slot_003",0),
            (remove_party,":cur_party"),
        (else_try),
            (party_get_cur_town, ":party_cur_town_004", ":cur_party"),
            (store_random_in_range,":random_x_005",0,100),
            (try_begin),
                (party_slot_eq,":party_cur_town_004",7,"trp_player"),
                (game_get_reduce_campaign_ai, ":campaign_ai"),
                (try_begin),
                    (eq,":campaign_ai",0),
                    (assign,":var007",35),
                (else_try),
                    (eq,":campaign_ai",1),
                    (assign,":var007",45),
                (else_try),
                    (eq,":campaign_ai",2),
                    (assign,":var007",60),
                (try_end),
            (else_try),
                (assign,":var007",45),
            (try_end),
        (try_end),
        (try_begin),
            (lt,":random_x_005",":var007"),
            (assign,":var008",1),
            (try_begin),
                (is_between,":party_cur_town_004","p_town_1","p_village_1"),
                (neg|party_slot_eq,":party_cur_town_004",54,-1),
                (assign,":var008",0),
            (try_end),
        (try_end),
        (try_begin),
            (eq,":var008",1),
            (assign,":var009",0),
            (try_begin),
                (eq,1,1),
                (party_get_slot,":party_slot_010",":cur_party",4),
                (try_begin),
                    (eq,":party_slot_010",13),
                    (party_get_slot,":party_slot_011",":cur_party",5),
                    (try_begin),
                        (eq,":party_cur_town_004",":party_slot_011"),
                        (assign,":var009",1),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
        (assign,":var012",-1),
        (try_begin),
            (eq,"$caravan_escort_party_id",":cur_party"),
            (neg|party_is_in_town,":cur_party","$caravan_escort_destination_town"),
            (assign,":var012","$caravan_escort_destination_town"),
        (else_try),
            (call_script, "script_cf_select_most_profitable_town_at_peace_with_faction_in_trade_route", ":party_cur_town_004", ":party_faction_002"),
            (assign,":var012",reg0),
        (try_end),
        (try_begin),
            (is_between,":var012","p_town_1","p_castle_1"),
            (neg|party_is_in_town,":cur_party",":var012"),
            (try_begin),
                (eq,":var009",1),
                (str_store_party_name,s7,":party_cur_town_004"),
                (call_script, "script_do_merchant_town_trade", ":cur_party", ":party_cur_town_004"),
            (try_end),
        (try_end),
        (party_set_ai_behavior,":cur_party",1),
        (party_set_ai_object,":cur_party",":cur_party"),
        (party_set_flags, ":cur_party", 65536, 0),
        (party_set_slot,":cur_party",4,13),
        (party_set_slot,":cur_party",5,":var012"),
    (try_end),
(try_end),
]),

(8.0, [
(try_for_parties, ":cur_party"),
    (try_begin),
        (party_slot_eq,":cur_party",0,15),
        (party_is_in_any_town,":cur_party"),
        (party_get_slot,":party_slot_002",":cur_party",123),
        (party_get_cur_town, ":party_cur_town_003", ":cur_party"),
        (assign,":var004",1),
        (try_begin),
            (is_between,":party_cur_town_003","p_town_1","p_village_1"),
            (neg|party_slot_eq,":party_cur_town_003",54,-1),
            (assign,":var004",0),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var004",1),
        (try_begin),
            (eq,":party_cur_town_003",":party_slot_002"),
            (call_script, "script_do_party_center_trade", ":cur_party", ":party_slot_002", 3),
            (store_faction_of_party, ":party_faction_005", ":party_cur_town_003"),
            (party_set_faction,":cur_party",":party_faction_005"),
            (party_get_slot,":party_slot_006",":party_slot_002",121),
            (party_set_slot,":cur_party",5,":party_slot_006"),
            (party_set_slot,":cur_party",4,13),
            (party_set_ai_behavior,":cur_party",1),
            (party_set_ai_object,":cur_party",":cur_party"),
        (else_try),
            (try_begin),
                (eq,1,1),
                (party_get_slot,":party_slot_007",":cur_party",5),
                (try_begin),
                    (eq,":party_cur_town_003",":party_slot_007"),
                    (call_script, "script_do_party_center_trade", ":cur_party", ":party_slot_007", 3),
                    (assign,":var008",reg0),
                    (party_get_slot,":party_slot_009",":party_slot_007",48),
                    (party_get_slot,":party_slot_010",":party_slot_007",50),
                    (assign,":var011",":var008"),
                    (val_mul, ":var011", ":party_slot_010"),
                    (val_div, ":var011", 100),
                    (val_div, ":var011", 20),
                    (val_add, ":party_slot_009", ":var011"),
                    (try_begin),
                        (ge,"$cheat_mode",3),
                        (assign,reg4,":var011"),
                        (str_store_party_name,s4,":party_slot_007"),
                        (assign,reg5,":party_slot_009"),
                        (display_message, "@@{!}New tariffs at {s4} = {reg4};;; total = {reg5}"),
                    (try_end),
                (try_end),
            (try_end),
            (party_set_slot,":party_slot_007",48,":party_slot_009"),
            (party_get_slot,":party_slot_012",":party_slot_007",53),
            (call_script, "script_center_get_food_store_limit", ":party_slot_007"),
            (assign,":var013",reg0),
            (val_add, ":party_slot_012", 1000),
            (val_min,":party_slot_012",":var013"),
            (party_set_slot,":party_slot_007",53,":party_slot_012"),
            (try_begin),
                (eq,1,1),
                (store_random_in_range,":random_x_014",0,100),
                (try_begin),
                    (lt,":random_x_014",5),
                    (call_script, "script_change_center_prosperity", ":party_slot_002", 1),
                    (val_add, "$newglob_total_prosperity_from_village_trade", 1),
                (try_end),
            (try_end),
        (try_end),
        (party_set_slot,":cur_party",5,":party_slot_002"),
        (party_set_slot,":cur_party",4,13),
        (party_set_ai_behavior,":cur_party",1),
        (party_set_ai_object,":cur_party",":cur_party"),
    (try_end),
(try_end),
]),

(2.0, [
(try_for_range, ":p_001", "p_castle_1", "p_village_1"),
    (try_begin),
        (party_slot_eq,":p_001",54,-1),
        (party_get_slot,":party_slot_002",":p_001",53),
        (val_add, ":party_slot_002", 100),
        (call_script, "script_center_get_food_store_limit", ":p_001"),
        (assign,":var003",reg0),
        (val_min,":party_slot_002",":var003"),
        (party_set_slot,":p_001",53,":party_slot_002"),
    (try_end),
(try_end),
]),

(0.5, [
(try_for_range, ":trp_001", "trp_npc1", "trp_heroes_end"),
    (try_begin),
        (troop_slot_eq,":trp_001",2,2),
        (troop_get_slot,":troop_slot_002",":trp_001",10),
        (try_begin),
            (gt,":troop_slot_002",0),
            (try_begin),
                (party_is_active,":troop_slot_002"),
                (try_begin),
                    (eq,1,1),
                    (get_party_ai_current_behavior,":cur_party_ai_behavior_003",":troop_slot_002"),
                    (try_begin),
                        (eq,":cur_party_ai_behavior_003",5),
                        (assign,":var004",1),
                        (try_begin),
                            (this_or_next|troop_slot_eq,":trp_001",52,7),
                            (troop_slot_eq,":trp_001",52,1),
                            (get_party_ai_current_object,":cur_party_ai_object_005",":troop_slot_002"),
                            (try_begin),
                                (party_is_active,":cur_party_ai_object_005"),
                                (party_get_battle_opponent, ":party_battle_opponent_006", ":cur_party_ai_object_005"),
                                (try_begin),
                                    (party_is_active,":party_battle_opponent_006"),
                                    (assign,":var004",0),
                                (try_end),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
            (try_begin),
                (eq,":var004",1),
                (store_faction_of_party, ":party_faction_007", ":troop_slot_002"),
                (party_get_slot,":party_slot_008",":troop_slot_002",30),
                (faction_get_slot,":faction_slot_009",":party_faction_007",8),
                (try_begin),
                    (neq,":faction_slot_009",":trp_001"),
                    (assign,":var004",1),
                    (try_begin),
                        (ge,":faction_slot_009",0),
                        (troop_get_slot,":troop_slot_010",":faction_slot_009",10),
                        (try_begin),
                            (party_is_active,":troop_slot_010"),
                            (eq,":party_slot_008",":troop_slot_010"),
                            (assign,":var004",0),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
            (try_begin),
                (eq,":var004",1),
                (assign,":var011",0),
                (try_for_range, ":p_012", "p_town_1", "p_village_1"),
                    (try_begin),
                        (eq,":var011",0),
                        (party_slot_eq,":p_012",54,-1),
                        (store_faction_of_party, ":party_faction_013", ":p_012"),
                        (store_relation,":faction_relation_014",":party_faction_013",":party_faction_007"),
                        (try_begin),
                            (gt,":faction_relation_014",0),
                            (store_distance_to_party_from_party,":distance_parties_015",":troop_slot_002",":troop_slot_002"),
                            (try_begin),
                                (lt,":distance_parties_015",20),
                                (party_get_position,pos1,":troop_slot_002"),
                                (party_get_position,pos2,":p_012"),
                                (try_begin),
                                    (neg|position_is_behind_position,2,1),
                                    (call_script, "script_party_set_ai_state", ":troop_slot_002", 14, ":p_012"),
                                    (assign,":var011",1),
                                (try_end),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (else_try),
        (troop_set_slot,":trp_001",10,-1),
    (try_end),
(try_end),
]),

(0.5, [
(store_current_hours,":cur_hours_001"),
(store_mod,":var002",":cur_hours_001",11),
(store_sub, ":var003", ":cur_hours_001", 5),
(party_get_num_companions,":party_num_companions_004","p_main_party"),
(party_get_num_prisoners,":party_num_prisioners_005","p_main_party"),
(val_add, ":party_num_companions_004", ":party_num_prisioners_005"),
(convert_to_fixed_point, ":party_num_companions_004"),
(store_sqrt, ":var006", ":party_num_companions_004"),
(convert_from_fixed_point, ":var006"),
(try_begin),
    (eq,":var002",0),
    (try_for_range, ":fac_007", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_get_slot,":faction_slot_008",":fac_007",30),
        (val_sub, ":faction_slot_008", 1),
        (val_max,":faction_slot_008",0),
        (faction_set_slot,":fac_007",30,":faction_slot_008"),
    (try_end),
(try_end),
(try_begin),
    (eq,"$g_player_is_captive",0),
    (try_for_range, ":p_009", "p_town_1", "p_salt_mine"),
        (store_faction_of_party, ":fac_007", ":p_009"),
        (store_relation,":faction_relation_010",":fac_007","fac_player_supporters_faction"),
        (try_begin),
            (lt,":faction_relation_010",0),
            (store_distance_to_party_from_party,":distance_parties_011","p_main_party","p_main_party"),
            (try_begin),
                (lt,":distance_parties_011",5),
                (store_mul, ":var012", ":distance_parties_011", ":distance_parties_011"),
                (store_sub, ":var013", 20, ":var012"),
                (store_sub, ":var014", 20, ":faction_relation_010"),
                (store_mul, ":var015", ":var013", ":var014"),
                (val_mul, ":var015", ":var006"),
                (store_div, ":var___x1", ":var015", 10),
                (assign,":var016",":var___x1"),
                (store_random_in_range,":random_x_017",0,1000),
                (try_begin),
                    (lt,":random_x_017",":var016"),
                    (faction_get_slot,":faction_slot_008",":fac_007",30),
                    (val_add, ":faction_slot_008", 1),
                    (val_min,":faction_slot_008",100),
                    (faction_set_slot,":fac_007",30,":faction_slot_008"),
                    (try_begin),
                        (neg|party_slot_ge,":p_009",42,":var003"),
                        (str_store_party_name_link,s1,":p_009"),
                        (display_message, "@@Your party is spotted by {s1}."),
                        (party_set_slot,":p_009",42,":cur_hours_001"),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(14.0, [
(try_begin),
    (eq,"$g_player_is_captive",0),
    (party_get_num_companion_stacks,":party_num_companions_stacks_001","p_main_party"),
    (assign,":var002",0),
    (try_for_range, ":var003", 0, ":party_num_companions_stacks_001"),
        (party_stack_get_size,          ":party_stack_size_004","p_main_party",":var003"),
        (val_add, ":var002", ":party_stack_size_004"),
    (try_end),
(try_end),
(val_div, ":var002", 3),
(try_begin),
    (eq,":var002",0),
    (val_add, ":var002", 1),
(try_end),
(try_begin),
    (eq,1,1),
    (assign,":var005",0),
    (try_for_range, ":itm_006", "itm_smoked_fish", "itm_siege_supply"),
        (try_begin),
            (call_script, "script_cf_player_has_item_without_modifier", ":itm_006", 41),
            (val_add, ":var005", 1),
        (try_end),
    (try_end),
    (try_begin),
        (ge,":var005",6),
        (unlock_achievement, 36),
    (try_end),
(try_end),
(assign,":var007",":var002"),
(assign,":var008",0),
(try_for_range, ":var009", 0, ":var007"),
    (assign,":var010",0),
    (try_for_range, ":itm_011", "itm_smoked_fish", "itm_siege_supply"),
        (item_set_slot,":itm_011",0,0),
        (try_begin),
            (call_script, "script_cf_player_has_item_without_modifier", ":itm_011", 41),
            (val_add, ":var010", 1),
        (try_end),
    (try_end),
    (try_begin),
        (gt,":var010",0),
        (store_random_in_range,":random_x_012",0,":var010"),
        (call_script, "script_consume_food", ":random_x_012"),
    (else_try),
        (eq,":var008",0),
        (assign, reg1, 16711680),
        (display_message, "@@Party has nothing to eat! {reg1}"),
        (call_script, "script_change_player_party_morale", -3),
        (assign,":var008",1),
        (try_begin),
            (eq,1,1),
            (call_script, "script_party_count_fit_regulars", "p_main_party"),
            (try_begin),
                (gt,reg0,0),
                (call_script, "script_objectionable_action", 2, "str_men_hungry"),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(24.0, [
(troop_get_inventory_capacity,":troop_inv_capacity_001","trp_player"),
(try_for_range, ":inventory_slot_no_002", 0, ":troop_inv_capacity_001"),
    (troop_get_inventory_slot,":troop_inv_slot_003","trp_player",":inventory_slot_no_002"),
    (try_begin),
        (this_or_next|eq,":troop_inv_slot_003","itm_pork"),
        (this_or_next|eq,":troop_inv_slot_003","itm_chicken"),
        (eq,":troop_inv_slot_003","itm_cattle_meat"),
        (troop_get_inventory_slot_modifier,":troop_inv_slot_modifier_004","trp_player",":inventory_slot_no_002"),
        (try_begin),
            (ge,":troop_inv_slot_modifier_004",37),
            (lt,":troop_inv_slot_modifier_004",41),
            (val_add, ":troop_inv_slot_modifier_004", 1),
            (troop_set_inventory_slot_modifier,"trp_player",":inventory_slot_no_002",":troop_inv_slot_modifier_004"),
        (else_try),
            (lt,":troop_inv_slot_modifier_004",37),
            (troop_set_inventory_slot_modifier,"trp_player",":inventory_slot_no_002",37),
        (try_end),
    (try_end),
(try_end),
]),

(72.0, [
]),

(0.0, [
(troop_get_inventory_slot,":troop_inv_slot_001","trp_player",8),
(assign,":var002",-1),
(try_begin),
    (eq,"$g_player_icon_state",0),
    (try_begin),
        (ge,":troop_inv_slot_001",0),
        (assign,":var002",1297036692682702849),
    (else_try),
        (assign,":var002",1297036692682702848),
    (try_end),
(else_try),
    (eq,"$g_player_icon_state",1),
    (assign,":var002",1297036692682702875),
(else_try),
    (eq,"$g_player_icon_state",2),
    (assign,":var002",1297036692682702876),
(try_end),
(try_begin),
    (neq,":var002","$g_player_party_icon"),
    (assign,"$g_player_party_icon",":var002"),
    (party_set_icon, "p_main_party", ":var002"),
(try_end),
]),

(2.0, [
(store_troop_gold,":troop_gold_001","trp_player"),
(store_div, ":var___x1", ":troop_gold_001", 100),
(assign,":var002",":var___x1"),
(troop_get_inventory_capacity,":troop_inv_capacity_003","trp_player"),
(try_for_range, ":inventory_slot_no_004", 0, ":troop_inv_capacity_003"),
    (troop_get_inventory_slot,":troop_inv_slot_005","trp_player",":inventory_slot_no_004"),
    (try_begin),
        (ge,":troop_inv_slot_005",0),
        (try_begin),
            (is_between,":troop_inv_slot_005","itm_spice","itm_siege_supply"),
            (store_item_value,":item_value_006",":troop_inv_slot_005"),
            (val_add, ":troop_gold_001", ":item_value_006"),
        (try_end),
    (try_end),
(try_end),
(val_clamp,":var002",0, 100),
(party_set_bandit_attraction, "p_main_party",":var002"),
]),

(3.0, [
(try_for_range, ":p_001", "p_town_1", "p_village_1"),
    (try_begin),
        (faction_slot_eq,"fac_player_supporters_faction",21,2),
        (store_faction_of_party, ":party_faction_002", ":p_001"),
        (try_begin),
            (eq,":party_faction_002","fac_player_supporters_faction"),
            (call_script, "script_activate_player_faction", "trp_player"),
        (try_end),
    (try_end),
(try_end),
]),

(6.0, [
(try_begin),
    (gt,"$g_prisoner_recruit_troop_id",0),
    (gt,"$g_prisoner_recruit_size",0),
    (gt,"$g_prisoner_recruit_last_time",0),
    (is_currently_night),
    (try_begin),
        (eq,1,1),
        (store_skill_level,":skill_lvl_001","skl_leadership","trp_player"),
        (val_mul, ":skill_lvl_001", 5),
        (store_sub, ":var002", 66, ":skill_lvl_001"),
        (try_begin),
            (gt,":var002",0),
            (assign,":var003",0),
            (try_for_range, ":var004", 0, "$g_prisoner_recruit_size"),
                (store_random_in_range,":random_x_005",0,100),
                (try_begin),
                    (lt,":random_x_005",":var002"),
                    (val_add, ":var003", 1),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (party_remove_members,"p_main_party","$g_prisoner_recruit_troop_id",":var003"),
    (assign,":var003",reg0),
    (try_begin),
        (gt,":var003",0),
        (try_begin),
            (gt,":var003",1),
            (assign,reg2,1),
        (else_try),
            (assign,reg2,0),
        (try_end),
    (try_end),
    (assign,reg1,":var003"),
    (str_store_troop_name_by_count,s1,"$g_prisoner_recruit_troop_id,var003"),
    (display_log_message,"@{reg1} {s1} {reg2?have:has} escaped from your party during the night."),
(try_end),
(assign,"$g_prisoner_recruit_troop_id",0),
(assign,"$g_prisoner_recruit_size",0),
]),

(24.0, [
(try_begin),
    (neq,"$g_ransom_offer_rejected",1),
    (call_script, "script_offer_ransom_amount_to_player_for_prisoners_in_party", "p_main_party"),
    (try_begin),
        (eq,reg0,0),
        (assign,":var001","p_village_1"),
        (try_for_range, ":var002", "p_town_1", ":var001"),
            (try_begin),
                (party_slot_eq,":var002",7,"trp_player"),
                (call_script, "script_offer_ransom_amount_to_player_for_prisoners_in_party", ":var002"),
                (try_begin),
                    (eq,reg0,1),
                    (assign,":var001",0),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(72.0, [
(assign,"$g_ransom_offer_rejected",0),
(try_for_range, ":p_001", "p_town_1", "p_village_1"),
    (party_get_slot,":party_slot_002",":p_001",7),
    (try_begin),
        (gt,":party_slot_002",0),
        (party_get_num_prisoner_stacks, ":party_num_prisoners_stacks_003",":p_001"),
        (try_for_range, ":var004", 0, ":party_num_prisoners_stacks_003"),
            (party_prisoner_stack_get_troop_id,":party_prisoner_troop_id_005",":p_001",":var004"),
            (try_begin),
                (troop_is_hero,":party_prisoner_troop_id_005"),
                (troop_slot_eq,":party_prisoner_troop_id_005",2,2),
                (store_random_in_range,":random_x_006",0,100),
                (try_begin),
                    (le,":random_x_006",10),
                    (call_script, "script_calculate_ransom_amount_for_troop", ":party_prisoner_troop_id_005"),
                    (assign,":var007",reg0),
                    (troop_get_slot,":troop_slot_008",":party_slot_002",11),
                    (val_add, ":troop_slot_008", ":var007"),
                    (troop_set_slot,":party_slot_002",11,":troop_slot_008"),
                    (party_remove_members,":p_001",":party_prisoner_troop_id_005",1),
                    (call_script, "script_remove_troop_from_prison", ":party_prisoner_troop_id_005"),
                    (store_troop_faction,":troop_faction_009",":party_slot_002"),
                    (store_troop_faction,":troop_faction_010",":party_prisoner_troop_id_005"),
                    (str_store_troop_name,s1,":party_prisoner_troop_id_005"),
                    (str_store_faction_name,s2,":troop_faction_009"),
                    (str_store_faction_name,s3,":troop_faction_010"),
                    (display_log_message,"@{s1} of {s3} has been released from captivity."),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(72.0, [
(call_script, "script_update_mercenary_units_of_towns"),
(call_script, "script_update_ransom_brokers"),
(call_script, "script_update_tavern_travellers"),
(call_script, "script_update_tavern_minstrels"),
(call_script, "script_update_booksellers"),
(call_script, "script_update_villages_infested_by_bandits"),
(try_for_range, ":p_001", "p_village_1", "p_salt_mine"),
    (call_script, "script_update_volunteer_troops_in_village", ":p_001"),
    (call_script, "script_update_npc_volunteer_troops_in_village", ":p_001"),
(try_end),
]),

(24.0, [
(call_script, "script_update_other_taverngoers"),
]),

(36.0, [
(try_for_range, ":p_001", "p_town_1", "p_salt_mine"),
    (try_begin),
        (this_or_next|party_slot_eq,":p_001",0,3),
        (party_slot_eq,":p_001",0,4),
        (call_script, "script_center_remove_walker_type_from_walkers", ":p_001", 1),
        (call_script, "script_center_remove_walker_type_from_walkers", ":p_001", 2),
        (store_random_in_range,":random_x_002",0,100),
        (try_begin),
            (lt,":random_x_002",70),
            (neg|party_slot_ge,":p_001",50,60),
            (call_script, "script_cf_center_get_free_walker", ":p_001"),
            (call_script, "script_center_set_walker_to_type", ":p_001", reg0, 1),
        (try_end),
    (try_end),
(try_end),
]),

(12.0, [
(try_for_range, ":p_001", "p_town_1", "p_salt_mine"),
    (party_get_slot,":party_slot_002",":p_001",124),
    (try_begin),
        (gt,":party_slot_002",0),
        (party_get_slot,":party_slot_003",":p_001",125),
        (store_current_hours,":cur_hours_004"),
        (try_begin),
            (ge,":cur_hours_004",":party_slot_003"),
            (party_set_slot,":p_001",":party_slot_002",1),
            (party_set_slot,":p_001",124,0),
            (call_script, "script_get_improvement_details", ":party_slot_002"),
            (try_begin),
                (party_slot_eq,":p_001",7,"trp_player"),
                (str_store_party_name,s4,":p_001"),
                (display_log_message,"@Building of {s0} in {s4} has been completed."),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (is_between,":p_001","p_village_1","p_salt_mine"),
        (eq,":party_slot_002",131),
        (call_script, "script_change_center_prosperity", ":p_001", 5),
    (try_end),
(try_end),
]),

(24.0, [
(assign,":var001",0),
(try_for_range, ":p_002", "p_town_1", "p_castle_1"),
    (party_get_slot,":party_slot_003",":p_002",156),
    (try_begin),
        (eq,":party_slot_003",1),
        (call_script, "script_fill_tournament_participants_troop", ":p_002", 0),
        (call_script, "script_sort_tournament_participant_troops"),
        (call_script, "script_get_num_tournament_participants"),
        (store_sub, ":var004", reg0, 1),
        (call_script, "script_remove_tournament_participants_randomly", ":var004"),
        (call_script, "script_sort_tournament_participant_troops"),
        (troop_get_slot,":troop_slot_005","trp_tournament_participants",0),
        (try_begin),
            (is_between,":troop_slot_005","trp_npc1","trp_knight_1_1_wife"),
            (str_store_troop_name_link,s1,":troop_slot_005"),
            (str_store_party_name_link,s2,":p_002"),
            (display_message, "@@{s1} has won the tournament at {s2}."),
            (call_script, "script_change_troop_renown", ":troop_slot_005", 20),
        (try_end),
    (try_end),
    (val_sub, ":party_slot_003", 1),
    (val_max,":party_slot_003",0),
    (party_set_slot,":p_002",156,":party_slot_003"),
    (try_begin),
        (gt,":party_slot_003",0),
        (val_add, ":var001", 1),
    (try_end),
(try_end),
(try_for_range, ":p_002", "p_town_1", "p_salt_mine"),
    (try_begin),
        (this_or_next|party_slot_eq,":p_002",0,3),
        (party_slot_eq,":p_002",0,4),
        (party_get_slot,":party_slot_006",":p_002",155),
        (try_begin),
            (le,":party_slot_006",0),
            (assign,":var007",0),
            (try_begin),
                (check_quest_active,"qst_deal_with_night_bandits"),
                (quest_slot_eq,"qst_deal_with_night_bandits",1,":p_002"),
                (neg|check_quest_succeeded,"qst_deal_with_night_bandits"),
                (assign,":var007",1),
            (else_try),
                (store_random_in_range,":random_x_008",0,100),
                (try_begin),
                    (lt,":random_x_008",3),
                    (assign,":var007",1),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (eq,":var007",1),
            (store_random_in_range,":random_x_008",0,3),
            (try_begin),
                (eq,":random_x_008",0),
                (assign,":var009","trp_bandit"),
            (else_try),
                (eq,":random_x_008",1),
                (assign,":var009","trp_mountain_bandit"),
            (else_try),
                (assign,":var009","trp_forest_bandit"),
            (try_end),
            (party_set_slot,":p_002",155,":var009"),
            (try_begin),
                (eq,"$cheat_mode",1),
                (str_store_party_name,s1,":p_002"),
                (display_message, "@@{!}{s1} is infested by bandits [[[at night]]]."),
            (try_end),
        (try_end),
    (else_try),
        (try_begin),
            (eq,1,1),
            (assign,":var010",40),
            (try_begin),
                (party_slot_eq,":p_002",0,3),
                (assign,":var010",20),
            (try_end),
            (store_random_in_range,":random_x_008",0,100),
            (try_begin),
                (lt,":random_x_008",":var010"),
                (party_set_slot,":p_002",155,0),
                (try_begin),
                    (eq,"$cheat_mode",1),
                    (str_store_party_name,s1,":p_002"),
                    (display_message, "@@{s1} is no longer infested by bandits [[[at night]]]."),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_for_range, ":fac_011", "fac_player_supporters_faction", "fac_kingdoms_end"),
    (try_begin),
        (faction_slot_eq,":fac_011",4,6),
        (faction_get_slot,":faction_slot_012",":fac_011",5),
        (try_begin),
            (is_between,":faction_slot_012","p_town_1","p_castle_1"),
            (party_slot_ge,":faction_slot_012",156,1),
            (party_set_slot,":faction_slot_012",156,2),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (lt,":var001",3),
    (store_random_in_range,":random_x_008",0,100),
    (try_begin),
        (lt,":random_x_008",30),
        (store_random_in_range,":random_x_013","p_town_1","p_castle_1"),
        (store_random_in_range,":random_x_014",12,15),
        (party_set_slot,":random_x_013",156,":random_x_014"),
        (try_begin),
            (eq,"$cheat_mode",1),
            (str_store_party_name,s1,":random_x_013"),
            (display_message, "@@{!}{s1} is holding a tournament."),
        (try_end),
    (try_end),
(try_end),
]),

(3.0, [
(assign,"$g_player_tournament_placement",0),
]),

(8.0, [
]),

(1.0, [
(try_begin),
    (neg|map_free),
    (is_currently_night),
    (is_between,"$g_last_rest_center","p_town_1","p_salt_mine"),
    (neg|party_slot_eq,"$g_last_rest_center",7,"trp_player"),
    (store_faction_of_party, ":party_faction_001", "$g_last_rest_center"),
    (try_begin),
        (neq,":party_faction_001","fac_player_supporters_faction"),
        (store_current_hours,":cur_hours_002"),
        (try_begin),
            (ge,":cur_hours_002","$g_last_rest_payment_until"),
            (store_add, "$g_last_rest_payment_until", ":cur_hours_002", 24),
            (store_troop_gold,":troop_gold_003","trp_player"),
            (party_get_num_companions,":party_num_companions_004","p_main_party"),
            (store_div, ":var___x1", ":party_num_companions_004", 4),
            (assign,":gold_005",":var___x1"),
            (val_add, ":gold_005", 1),
            (try_begin),
                (ge,":troop_gold_003",":gold_005"),
                (display_message, "@@You pay for accommodation."),
                (troop_remove_gold,"trp_player",":gold_005"),
            (else_try),
                (gt,":troop_gold_003",0),
                (troop_remove_gold,"trp_player",":troop_gold_003"),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(36.0, [
(call_script, "script_spawn_bandits"),
]),

(24.0, [
(call_script, "script_update_party_creation_random_limits"),
]),

(24.0, [
(assign,":var001",0),
(try_for_range, ":fac_002", "fac_player_supporters_faction", "fac_kingdoms_end"),
    (faction_set_slot,":fac_002",20,0),
(try_end),
(try_for_parties, ":cur_party"),
    (store_faction_of_party, ":party_faction_004", ":cur_party"),
    (try_begin),
        (is_between,":party_faction_004","fac_player_supporters_faction","fac_kingdoms_end"),
        (this_or_next|is_between,":cur_party","p_town_1","p_salt_mine"),
        (party_slot_eq,":cur_party",0,13),
        (faction_get_slot,":faction_slot_005",":party_faction_004",20),
        (val_add, ":faction_slot_005", 1),
        (faction_set_slot,":party_faction_004",20,":faction_slot_005"),
    (try_end),
(try_end),
(try_for_range, ":fac_002", "fac_player_supporters_faction", "fac_kingdoms_end"),
    (try_begin),
        (faction_slot_eq,":fac_002",21,0),
        (val_add, ":var001", 1),
        (try_begin),
            (faction_slot_eq,":fac_002",20,0),
            (assign,":var006",0),
            (try_begin),
                (eq,":fac_002","fac_player_supporters_faction"),
                (try_begin),
                    (le,"$supported_pretender",0),
                    (faction_set_slot,":fac_002",21,2),
                    (assign,":var006",1),
                (try_end),
            (try_end),
        (try_end),
    (else_try),
        (neq,"$players_kingdom",":fac_002"),
        (faction_set_slot,":fac_002",21,1),
        (try_for_parties, ":cur_party"),
            (store_faction_of_party, ":party_faction_004", ":cur_party"),
            (try_begin),
                (eq,":party_faction_004",":fac_002"),
                (party_get_slot,":party_slot_007",":cur_party",123),
                (store_faction_of_party, ":party_faction_008", ":party_slot_007"),
                (party_set_faction,":cur_party",":party_faction_008"),
            (try_end),
        (try_end),
        (assign,":troop_id_009",-1),
        (try_for_range, ":trp_010", "trp_kingdom_1_pretender", "trp_knight_1_1_wife"),
            (try_begin),
                (troop_slot_eq,":trp_010",14,":fac_002"),
                (assign,":troop_id_009",":trp_010"),
            (try_end),
        (try_end),
        (try_begin),
            (is_between,":troop_id_009","trp_kingdom_1_pretender","trp_knight_1_1_wife"),
            (neq,":troop_id_009","$supported_pretender"),
            (troop_set_slot,":troop_id_009",12,0),
        (try_end),
        (assign,":var006",1),
        (try_begin),
            (eq,"$players_oath_renounced_against_kingdom",":fac_002"),
            (assign,"$players_oath_renounced_against_kingdom",0),
            (assign,"$players_oath_renounced_given_center",0),
            (assign,"$players_oath_renounced_begin_time",0),
            (call_script, "script_add_notification_menu", "mnu_notification_oath_renounced_faction_defeated", ":fac_002", 0),
        (try_end),
        (call_script, "script_add_notification_menu", "mnu_notification_faction_defeated", ":fac_002", 0),
    (try_end),
    (try_begin),
        (eq,":var006",1),
        (val_sub, ":var001", 1),
    (try_end),
    (try_for_range, ":fac_011", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (call_script, "script_update_faction_notes", ":fac_011"),
    (try_end),
(try_end),
(try_begin),
    (eq,":var001",1),
    (neg|eq,"$g_one_faction_left_notification_shown",0),
    (assign,"$g_one_faction_left_notification_shown",1),
    (try_for_range, ":fac_002", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (try_begin),
            (faction_slot_eq,":fac_002",21,0),
            (call_script, "script_add_notification_menu", "mnu_notification_one_faction_left", ":fac_002", 0),
        (try_end),
    (try_end),
(try_end),
]),

(3.0, [
(try_begin),
    (is_between,"$g_player_court","p_town_1","p_salt_mine"),
    (store_faction_of_party, ":party_faction_001", "$g_player_court"),
    (try_begin),
        (neq,":party_faction_001","fac_player_supporters_faction"),
        (call_script, "script_add_notification_menu", "mnu_notification_court_lost", 0, 0),
    (else_try),
        (lt,"$g_player_court","p_town_1"),
        (this_or_next|faction_slot_eq,"fac_player_supporters_faction",11,"trp_player"),
        (gt,"$g_player_minister",0),
        (assign,":var002",0),
        (try_for_range, ":p_003", "p_town_1", "p_village_1"),
            (try_begin),
                (eq,":var002",0),
                (store_faction_of_party, ":party_faction_001", ":p_003"),
                (try_begin),
                    (eq,":party_faction_001","fac_player_supporters_faction"),
                    (assign,":var002",":p_003"),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (ge,":var002",1),
        (call_script, "script_add_notification_menu", "mnu_notification_court_lost", 0, 0),
    (try_end),
(try_end),
(try_for_parties, ":cur_party"),
    (try_begin),
        (gt,":cur_party","p_spawn_points_end"),
        (party_get_template_id,":party_template_id_005",":cur_party"),
        (try_begin),
            (is_between,":party_template_id_005","pt_steppe_bandits","pt_deserters"),
            (party_template_get_slot,":party_template_slot_006",":party_template_id_005",4),
            (try_begin),
                (gt,":party_template_slot_006","p_spawn_points_end"),
                (store_distance_to_party_from_party,":distance_parties_007",":cur_party",":cur_party"),
                (try_begin),
                    (gt,":distance_parties_007",30),
                    (party_set_ai_behavior,":cur_party",6),
                    (party_get_position,pos5,":party_template_slot_006"),
                    (party_set_ai_target_position,":cur_party",5),
                (else_try),
                    (get_party_ai_behavior,":party_ai_behavior_008",":cur_party"),
                    (try_begin),
                        (eq,":party_ai_behavior_008",6),
                        (try_begin),
                            (gt,":party_template_slot_006","p_spawn_points_end"),
                            (store_distance_to_party_from_party,":distance_parties_007",":cur_party",":cur_party"),
                            (try_begin),
                                (lt,":distance_parties_007",3),
                                (party_set_ai_behavior,":cur_party",3),
                                (party_template_get_slot,":party_template_slot_009",":party_template_id_005",5),
                                (party_set_ai_object,":cur_party",":cur_party"),
                                (party_set_ai_patrol_radius,":cur_party",45),
                            (else_try),
                                (lt,":party_template_slot_006","p_spawn_points_end"),
                                (party_set_ai_behavior,":cur_party",3),
                                (party_template_get_slot,":party_template_slot_009",":party_template_id_005",5),
                                (party_set_ai_object,":cur_party",":cur_party"),
                                (party_set_ai_patrol_radius,":cur_party",45),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,1,1),
    (troop_get_slot,":troop_slot_010","trp_player",34),
    (try_begin),
        (gt,":troop_slot_010",0),
        (neg|check_quest_active,"qst_wed_betrothed"),
        (neg|check_quest_active,"qst_wed_betrothed_female"),
        (str_store_troop_name,s5,":troop_slot_010"),
        (display_message, "@@Betrothal to {s5} expires"),
        (troop_set_slot,"trp_player",34,-1),
        (troop_set_slot,":troop_slot_010",34,-1),
    (try_end),
(try_end),
]),

(168.0, [
(troop_get_slot,":troop_slot_001","trp_player",7),
(store_div, ":var___x1", ":troop_slot_001", 200),
(assign,":var002",":var___x1"),
(val_sub, ":troop_slot_001", ":var002"),
(troop_set_slot,"trp_player",7,":troop_slot_001"),
]),

(1.0, [
(try_begin),
    (neg|map_free),
    (gt,"$g_player_reading_book",0),
    (player_has_item,"$g_player_reading_book"),
    (store_attribute_level,":attribute_lvl_001","trp_player",2),
    (item_get_slot,":item_slot_002","$g_player_reading_book",4),
    (try_begin),
        (le,":item_slot_002",":attribute_lvl_001"),
        (item_get_slot,":item_slot_003","$g_player_reading_book",2),
        (item_get_slot,":item_slot_004","$g_player_reading_book",3),
        (try_begin),
            (eq,":item_slot_004",0),
            (val_add, ":item_slot_003", 7),
            (item_set_slot,"$g_player_reading_book",2,":item_slot_003"),
            (try_begin),
                (ge,":item_slot_003",1000),
                (item_set_slot,"$g_player_reading_book",3,1),
                (str_store_item_name,s1,"$g_player_reading_book"),
                (str_clear, 2),
                (try_begin),
                    (eq,"$g_player_reading_book","itm_book_tactics"),
                    (troop_raise_skill,"trp_player","skl_tactics",1),
                    (str_store_string,s2,"@ Your tactics skill has increased by 1."),
                (else_try),
                    (eq,"$g_player_reading_book","itm_book_persuasion"),
                    (troop_raise_skill,"trp_player","skl_persuasion",1),
                    (str_store_string,s2,"@ Your persuasion skill has increased by 1."),
                (else_try),
                    (eq,"$g_player_reading_book","itm_book_leadership"),
                    (troop_raise_skill,"trp_player","skl_leadership",1),
                    (str_store_string,s2,"@ Your leadership skill has increased by 1."),
                (else_try),
                    (eq,"$g_player_reading_book","itm_book_intelligence"),
                    (troop_raise_attribute,"trp_player",2,1),
                    (str_store_string,s2,"@ Your intelligence has increased by 1."),
                (else_try),
                    (eq,"$g_player_reading_book","itm_book_trade"),
                    (troop_raise_skill,"trp_player","skl_trade",1),
                    (str_store_string,s2,"@ Your trade skill has increased by 1."),
                (else_try),
                    (eq,"$g_player_reading_book","itm_book_weapon_mastery"),
                    (troop_raise_skill,"trp_player","skl_weapon_master",1),
                    (str_store_string,s2,"@ Your weapon master skill has increased by 1."),
                (else_try),
                    (eq,"$g_player_reading_book","itm_book_engineering"),
                    (troop_raise_skill,"trp_player","skl_engineer",1),
                    (str_store_string,s2,"@ Your engineer skill has increased by 1."),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(unlock_achievement, 37),
(try_begin),
    (eq,"$g_infinite_camping",0),
    (dialog_box,"@You have finished reading {s1}.{s2}","@Book Read"),
(try_end),
(assign,"$g_player_reading_book",0),
]),

(12.0, [
(try_for_parties, ":cur_party"),
    (try_begin),
        (party_slot_eq,":cur_party",0,17),
        (store_distance_to_party_from_party,":distance_parties_002",":cur_party",":cur_party"),
        (try_begin),
            (gt,":distance_parties_002",30),
            (remove_party,":cur_party"),
            (try_begin),
                (check_quest_active,"qst_move_cattle_herd"),
                (neg|check_quest_concluded,"qst_move_cattle_herd"),
                (quest_slot_eq,"qst_move_cattle_herd",8,":cur_party"),
                (call_script, "script_fail_quest", "qst_move_cattle_herd"),
            (try_end),
        (try_end),
    (else_try),
        (gt,":distance_parties_002",10),
        (party_set_slot,":cur_party",7,0),
        (party_set_ai_behavior,":cur_party",0),
    (try_end),
(try_end),
]),

(720.0, [
(try_for_range, ":p_001", "p_village_1", "p_salt_mine"),
    (try_begin),
        (party_slot_eq,":p_001",7,"trp_player"),
        (party_slot_eq,":p_001",133,1),
        (party_get_slot,":party_slot_002",":p_001",26),
        (val_add, ":party_slot_002", 1),
        (val_min,":party_slot_002",100),
        (party_set_slot,":p_001",26,":party_slot_002"),
    (try_end),
(try_end),
]),

(24.0, [
(try_for_range, ":quest_id_001", 0, "qst_quests_end"),
    (try_begin),
        (check_quest_active,":quest_id_001"),
        (try_begin),
            (neg|check_quest_concluded,":quest_id_001"),
            (quest_slot_ge,":quest_id_001",23,1),
            (quest_get_slot,":quest_slot_002",":quest_id_001",23),
            (val_sub, ":quest_slot_002", 1),
            (try_begin),
                (eq,":quest_slot_002",0),
                (call_script, "script_abort_quest", ":quest_id_001", 1),
            (else_try),
                (quest_set_slot,":quest_id_001",23,":quest_slot_002"),
                (assign,reg0,":quest_slot_002"),
                (add_quest_note_from_sreg,":quest_id_001",7,"@You have {reg0} days to finish this quest.", 0),
            (try_end),
        (try_end),
    (else_try),
        (quest_slot_ge,":quest_id_001",25,1),
        (quest_get_slot,":quest_slot_003",":quest_id_001",25),
        (val_sub, ":quest_slot_003", 1),
        (quest_set_slot,":quest_id_001",25,":quest_slot_003"),
    (try_end),
(try_end),
]),

(2.0, [
(try_begin),
    (eq,"$g_infinite_camping",0),
    (is_between,"$players_kingdom","fac_player_supporters_faction","fac_kingdoms_end"),
    (eq,"$g_player_is_captive",0),
    (try_begin),
        (check_quest_active,"qst_report_to_army"),
        (faction_slot_eq,"$players_kingdom",8,-1),
        (call_script, "script_abort_quest", "qst_report_to_army", 0),
    (try_end),
(try_end),
(faction_get_slot,":faction_slot_001","$players_kingdom",5),
(try_begin),
    (neg|faction_slot_eq,"$players_kingdom",4,0),
    (neg|faction_slot_eq,"$players_kingdom",4,6),
    (assign,":var002",1),
    (try_begin),
        (this_or_next|faction_slot_eq,"$players_kingdom",4,5),
        (this_or_next|faction_slot_eq,"$players_kingdom",4,2),
        (faction_slot_eq,"$players_kingdom",4,3),
        (neg|is_between,":faction_slot_001","p_town_1","p_village_1"),
        (assign,":var002",0),
    (try_end),
(try_end),
(try_begin),
    (eq,":var002",1),
    (assign,":var003",0),
    (try_for_range, ":fac_004", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (try_begin),
            (neq,":fac_004","$players_kingdom"),
            (store_relation,":faction_relation_005",":fac_004","$players_kingdom"),
            (try_begin),
                (lt,":faction_relation_005",0),
                (assign,":var003",1),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,":var003",1),
    (neg|check_quest_active,"qst_report_to_army"),
    (neg|check_quest_active,"qst_follow_army"),
    (neg|quest_slot_ge,"qst_report_to_army",25,1),
    (faction_get_slot,":faction_slot_006","$players_kingdom",8),
    (try_begin),
        (gt,":faction_slot_006",0),
        (troop_get_slot,":troop_slot_007",":faction_slot_006",10),
        (try_begin),
            (gt,":troop_slot_007",0),
            (party_is_active,":troop_slot_007"),
            (store_distance_to_party_from_party,":distance_parties_008",":troop_slot_007",":troop_slot_007"),
            (try_begin),
                (le,":distance_parties_008",96),
                (assign,":var009",1),
                (try_for_range, ":qst_010", "qst_deliver_message", "qst_follow_army"),
                    (try_begin),
                        (check_quest_active,":qst_010"),
                        (quest_slot_eq,":qst_010",6,":faction_slot_006"),
                        (assign,":var009",0),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,":var009",1),
    (try_for_range, ":qst_010", "qst_destroy_bandit_lair", "qst_blank_quest_2"),
        (try_begin),
            (check_quest_active,":qst_010"),
            (quest_slot_eq,":qst_010",6,":faction_slot_006"),
            (assign,":var009",0),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,":var009",1),
    (try_for_range, ":qst_010", "qst_deliver_cattle_to_army", "qst_rescue_lord_by_replace"),
        (try_begin),
            (check_quest_active,":qst_010"),
            (assign,":var009",0),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,":var009",1),
    (store_character_level,":character_lvl_011","trp_player"),
    (try_begin),
        (ge,":character_lvl_011",8),
        (assign,":var012",2),
        (try_for_range, ":p_013", "p_town_1", "p_salt_mine"),
            (try_begin),
                (party_slot_eq,":p_013",7,"trp_player"),
                (try_begin),
                    (party_slot_eq,":p_013",0,3),
                    (val_add, ":var012", 3),
                (else_try),
                    (party_slot_eq,":p_013",0,2),
                    (val_add, ":var012", 1),
                (else_try),
                    (val_add, ":var012", 1),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(val_mul, ":var012", 4),
(val_min,":var012",60),
(quest_set_slot,"qst_report_to_army",6,":faction_slot_006"),
(quest_set_slot,"qst_report_to_army",2,":faction_slot_006"),
(quest_set_slot,"qst_report_to_army",10,":var012"),
(quest_set_slot,"qst_report_to_army",23,4),
(quest_set_slot,"qst_report_to_army",24,22),
(jump_to_menu,"mnu_kingdom_army_quest_report_to_army"),
]),

(3.0, [
(assign,"$g_random_army_quest",-1),
(try_begin),
    (check_quest_active,"qst_follow_army"),
    (is_between,"$players_kingdom","fac_player_supporters_faction","fac_kingdoms_end"),
    (neg|faction_slot_eq,"$players_kingdom",4,0),
    (faction_get_slot,":faction_slot_001","$players_kingdom",8),
    (try_begin),
        (neq,":faction_slot_001","trp_player"),
        (gt,":faction_slot_001",0),
        (troop_get_slot,":troop_slot_002",":faction_slot_001",10),
        (try_begin),
            (gt,":troop_slot_002",0),
            (party_is_active,":troop_slot_002"),
            (store_distance_to_party_from_party,":distance_parties_003",":troop_slot_002",":troop_slot_002"),
            (try_begin),
                (lt,":distance_parties_003",15),
                (assign,"$g_player_follow_army_warnings",0),
                (store_current_hours,":cur_hours_004"),
                (faction_get_slot,":faction_slot_005","$players_kingdom",95),
                (store_sub, ":var006", ":cur_hours_004", ":faction_slot_005"),
                (assign,":quest_id_007",-1),
                (try_begin),
                    (eq,1,1),
                    (store_random_in_range,":random_x_008",0,100),
                    (try_begin),
                        (lt,":random_x_008",30),
                        (troop_slot_eq,":faction_slot_001",20,0),
                        (try_for_range, ":var009", 0, 20),
                            (try_begin),
                                (eq,":quest_id_007",-1),
                                (store_random_in_range,":random_x_010","qst_deliver_cattle_to_army","qst_rescue_lord_by_replace"),
                                (try_begin),
                                    (neg|quest_slot_ge,":random_x_010",25,1),
                                    (try_begin),
                                        (eq,":random_x_010","qst_deliver_cattle_to_army"),
                                        (try_begin),
                                            (faction_slot_eq,"$players_kingdom",4,2),
                                            (gt,":var006",120),
                                            (store_random_in_range,":random_x_011",5,10),
                                            (assign,":quest_id_007","qst_deliver_cattle_to_army"),
                                            (quest_set_slot,":quest_id_007",10,":random_x_011"),
                                            (quest_set_slot,":quest_id_007",23,10),
                                            (quest_set_slot,":quest_id_007",24,30),
                                        (try_end),
                                    (try_end),
                                (try_end),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (else_try),
                (eq,":random_x_010","qst_join_siege_with_army"),
                (eq,1,0),
                (try_begin),
                    (faction_slot_eq,"$players_kingdom",4,2),
                    (faction_get_slot,":faction_slot_012","$players_kingdom",5),
                    (try_begin),
                        (is_between,":faction_slot_012","p_town_1","p_village_1"),
                        (party_get_battle_opponent, ":party_battle_opponent_013", ":troop_slot_002"),
                        (try_begin),
                            (eq,":party_battle_opponent_013",":faction_slot_012"),
                            (assign,":quest_id_007",":random_x_010"),
                            (quest_set_slot,":quest_id_007",1,":faction_slot_012"),
                            (quest_set_slot,":quest_id_007",23,2),
                            (quest_set_slot,":quest_id_007",24,15),
                        (try_end),
                    (try_end),
                (try_end),
            (else_try),
                (eq,":random_x_010","qst_scout_waypoints"),
                (try_begin),
                    (eq,1,1),
                    (assign,":var014",100),
                    (assign,"$qst_scout_waypoints_wp_1",-1),
                    (assign,"$qst_scout_waypoints_wp_2",-1),
                    (assign,"$qst_scout_waypoints_wp_3",-1),
                    (assign,":var015",0),
                    (try_for_range, ":var009", 0, ":var014"),
                        (try_begin),
                            (lt,"$qst_scout_waypoints_wp_1",0),
                            (call_script, "script_cf_get_random_enemy_center_within_range", ":troop_slot_002", 50),
                            (assign,"$qst_scout_waypoints_wp_1",reg0),
                        (try_end),
                        (try_begin),
                            (lt,"$qst_scout_waypoints_wp_2",0),
                            (call_script, "script_cf_get_random_enemy_center_within_range", ":troop_slot_002", 50),
                            (neq,"$qst_scout_waypoints_wp_1",reg0),
                            (assign,"$qst_scout_waypoints_wp_2",reg0),
                        (try_end),
                        (try_begin),
                            (lt,"$qst_scout_waypoints_wp_3",0),
                            (call_script, "script_cf_get_random_enemy_center_within_range", ":troop_slot_002", 50),
                            (neq,"$qst_scout_waypoints_wp_1",reg0),
                            (neq,"$qst_scout_waypoints_wp_2",reg0),
                            (assign,"$qst_scout_waypoints_wp_3",reg0),
                        (try_end),
                        (try_begin),
                            (neq,"$qst_scout_waypoints_wp_1","$qst_scout_waypoints_wp_2"),
                            (neq,"$qst_scout_waypoints_wp_1","$qst_scout_waypoints_wp_2"),
                            (neq,"$qst_scout_waypoints_wp_2","$qst_scout_waypoints_wp_3"),
                            (ge,"$qst_scout_waypoints_wp_1",0),
                            (ge,"$qst_scout_waypoints_wp_2",0),
                            (ge,"$qst_scout_waypoints_wp_3",0),
                            (assign,":var014",0),
                            (assign,":var015",1),
                        (try_end),
                    (try_end),
                    (try_begin),
                        (eq,":var015",1),
                        (assign,"$qst_scout_waypoints_wp_1_visited",0),
                        (assign,"$qst_scout_waypoints_wp_2_visited",0),
                        (assign,"$qst_scout_waypoints_wp_3_visited",0),
                        (assign,":quest_id_007","qst_scout_waypoints"),
                        (quest_set_slot,":quest_id_007",23,7),
                        (quest_set_slot,":quest_id_007",24,25),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (neq,":quest_id_007",-1),
            (quest_set_slot,":quest_id_007",11,0),
            (quest_set_slot,":quest_id_007",6,":faction_slot_001"),
            (try_begin),
                (eq,":quest_id_007","qst_join_siege_with_army"),
                (jump_to_menu,"mnu_kingdom_army_quest_join_siege_order"),
            (else_try),
                (assign,"$g_random_army_quest",":quest_id_007"),
                (quest_set_slot,"$g_random_army_quest",6,":faction_slot_001"),
                (jump_to_menu,"mnu_kingdom_army_quest_messenger"),
            (try_end),
        (try_end),
    (try_end),
(else_try),
    (val_add, "$g_player_follow_army_warnings", 1),
    (try_begin),
        (lt,"$g_player_follow_army_warnings",15),
        (try_begin),
            (eq,1,1),
            (store_mod,":var016","$g_player_follow_army_warnings",3),
            (try_begin),
                (eq,":var016",0),
                (str_store_troop_name_link,s1,":faction_slot_001"),
                (try_begin),
                    (lt,"$g_player_follow_army_warnings",8),
                (else_try),
                    (display_message, "str_marshal_warning"),
                (try_end),
            (try_end),
        (try_end),
    (else_try),
        (jump_to_menu,"mnu_kingdom_army_follow_failed"),
    (try_end),
(try_end),
]),

(0.5, [
(try_begin),
    (check_quest_active,"qst_move_cattle_herd"),
    (neg|check_quest_concluded,"qst_move_cattle_herd"),
    (quest_get_slot,":quest_slot_001","qst_move_cattle_herd",8),
    (quest_get_slot,":quest_slot_002","qst_move_cattle_herd",1),
    (store_distance_to_party_from_party,":distance_parties_003",":quest_slot_001",":quest_slot_001"),
    (try_begin),
        (lt,":distance_parties_003",3),
        (remove_party,":quest_slot_001"),
        (call_script, "script_succeed_quest", "qst_move_cattle_herd"),
    (try_end),
(try_end),
]),

(2.0, [
(try_for_range, ":trp_001", "trp_npc1", "trp_knight_1_1_wife"),
    (try_begin),
        (troop_slot_eq,":trp_001",2,2),
        (troop_get_slot,":troop_slot_002",":trp_001",10),
        (try_begin),
            (ge,":troop_slot_002",1),
            (party_is_active,":troop_slot_002"),
            (party_slot_eq,":troop_slot_002",31,1),
            (store_current_hours,":cur_hours_003"),
            (try_begin),
                (neg|party_slot_ge,":troop_slot_002",32,":cur_hours_003"),
                (party_set_slot,":troop_slot_002",30,-1),
                (party_set_slot,":troop_slot_002",31,0),
                (assign,":var004",200),
                (store_add, ":var005", ":cur_hours_003", ":var004"),
                (party_set_slot,":troop_slot_002",33,":var005"),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(0.5, [
(try_begin),
    (check_quest_active,"qst_deliver_cattle"),
    (neg|check_quest_succeeded,"qst_deliver_cattle"),
    (quest_get_slot,":quest_slot_001","qst_deliver_cattle",1),
    (quest_get_slot,":quest_slot_002","qst_deliver_cattle",10),
    (quest_get_slot,":quest_slot_003","qst_deliver_cattle",11),
    (store_sub, ":var004", ":quest_slot_002", ":quest_slot_003"),
    (call_script, "script_remove_cattles_if_herd_is_close_to_party", ":quest_slot_001", ":var004"),
    (val_add, ":quest_slot_003", reg0),
    (quest_set_slot,"qst_deliver_cattle",11,":quest_slot_003"),
    (try_begin),
        (le,":quest_slot_002",":quest_slot_003"),
        (call_script, "script_succeed_quest", "qst_deliver_cattle"),
    (try_end),
(try_end),
(try_begin),
    (check_quest_active,"qst_deliver_cattle_to_army"),
    (neg|check_quest_succeeded,"qst_deliver_cattle_to_army"),
    (quest_get_slot,":quest_slot_005","qst_deliver_cattle_to_army",6),
    (troop_get_slot,":troop_slot_006",":quest_slot_005",10),
    (try_begin),
        (gt,":troop_slot_006",0),
        (quest_get_slot,":quest_slot_002","qst_deliver_cattle_to_army",10),
        (quest_get_slot,":quest_slot_003","qst_deliver_cattle_to_army",11),
        (store_sub, ":var004", ":quest_slot_002", ":quest_slot_003"),
        (call_script, "script_remove_cattles_if_herd_is_close_to_party", ":troop_slot_006", ":var004"),
        (val_add, ":quest_slot_003", reg0),
        (quest_set_slot,"qst_deliver_cattle_to_army",11,":quest_slot_003"),
        (try_begin),
            (le,":quest_slot_002",":quest_slot_003"),
            (call_script, "script_succeed_quest", "qst_deliver_cattle_to_army"),
        (try_end),
    (else_try),
        (call_script, "script_abort_quest", "qst_deliver_cattle_to_army", 0),
    (try_end),
(try_end),
]),

(1.0, [
(try_begin),
    (neg|map_free),
    (check_quest_active,"qst_train_peasants_against_bandits"),
    (neg|check_quest_concluded,"qst_train_peasants_against_bandits"),
    (eq,"$qst_train_peasants_against_bandits_currently_training",1),
    (val_add, "$qst_train_peasants_against_bandits_num_hours_trained", 1),
    (call_script, "script_get_max_skill_of_player_party", "skl_trainer"),
    (assign,":var001",reg0),
    (store_sub, ":var002", 20, ":var001"),
    (val_mul, ":var002", 3),
    (val_div, ":var002", 5),
    (try_begin),
        (ge,"$qst_train_peasants_against_bandits_num_hours_trained",":var002"),
        (assign,"$qst_train_peasants_against_bandits_num_hours_trained",0),
        (rest_for_hours,0,0,0),
        (jump_to_menu,"mnu_train_peasants_against_bandits_ready"),
    (try_end),
(try_end),
]),

(1.0, [
(try_begin),
    (check_quest_active,"qst_scout_waypoints"),
    (neg|check_quest_succeeded,"qst_scout_waypoints"),
    (try_begin),
        (eq,"$qst_scout_waypoints_wp_1_visited",0),
        (store_distance_to_party_from_party,":distance_parties_001","$qst_scout_waypoints_wp_1","$qst_scout_waypoints_wp_1"),
        (try_begin),
            (le,":distance_parties_001",3),
            (assign,"$qst_scout_waypoints_wp_1_visited",1),
            (str_store_party_name_link,s1,"$qst_scout_waypoints_wp_1"),
            (display_message, "@@{s1} is scouted."),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,"$qst_scout_waypoints_wp_2_visited",0),
    (store_distance_to_party_from_party,":distance_parties_001","$qst_scout_waypoints_wp_2","$qst_scout_waypoints_wp_2"),
    (try_begin),
        (le,":distance_parties_001",3),
        (assign,"$qst_scout_waypoints_wp_2_visited",1),
        (str_store_party_name_link,s1,"$qst_scout_waypoints_wp_2"),
        (display_message, "@@{s1} is scouted."),
    (try_end),
(try_end),
(try_begin),
    (eq,"$qst_scout_waypoints_wp_3_visited",0),
    (store_distance_to_party_from_party,":distance_parties_001","$qst_scout_waypoints_wp_3","$qst_scout_waypoints_wp_3"),
    (try_begin),
        (le,":distance_parties_001",3),
        (assign,"$qst_scout_waypoints_wp_3_visited",1),
        (str_store_party_name_link,s1,"$qst_scout_waypoints_wp_3"),
        (display_message, "@@{s1} is scouted."),
    (try_end),
(try_end),
(try_begin),
    (eq,"$qst_scout_waypoints_wp_1_visited",1),
    (eq,"$qst_scout_waypoints_wp_2_visited",1),
    (eq,"$qst_scout_waypoints_wp_3_visited",1),
    (call_script, "script_succeed_quest", "qst_scout_waypoints"),
(try_end),
]),

(3.0, [
(try_begin),
    (neg|map_free),
    (check_quest_active,"qst_kill_local_merchant"),
    (quest_slot_eq,"qst_kill_local_merchant",11,0),
    (quest_set_slot,"qst_kill_local_merchant",11,1),
    (rest_for_hours,0,0,0),
    (assign,"$auto_enter_town","$qst_kill_local_merchant_center"),
    (assign,"$quest_auto_menu","mnu_kill_local_merchant_begin"),
(try_end),
]),

(1.0, [
(try_begin),
    (neg|map_free),
    (check_quest_active,"qst_collect_taxes"),
    (eq,"$g_player_is_captive",0),
    (eq,"$qst_collect_taxes_currently_collecting",1),
    (quest_get_slot,":quest_slot_001","qst_collect_taxes",11),
    (try_begin),
        (this_or_next|eq,":quest_slot_001",3),
        (this_or_next|eq,":quest_slot_001",2),
        (eq,":quest_slot_001",1),
        (quest_get_slot,":quest_slot_002","qst_collect_taxes",10),
        (val_sub, ":quest_slot_002", 1),
        (quest_set_slot,"qst_collect_taxes",10,":quest_slot_002"),
        (call_script, "script_get_max_skill_of_player_party", "skl_trade"),
        (try_begin),
            (lt,":quest_slot_002",0),
            (assign,":quest_slot_001",4),
            (quest_set_slot,"qst_collect_taxes",11,4),
            (rest_for_hours,0,0,0),
            (jump_to_menu,"mnu_collect_taxes_complete"),
        (else_try),
            (assign,":var003","$qst_collect_taxes_hourly_income"),
            (party_get_slot,":party_slot_004","$g_encountered_party",50),
            (store_add, ":var005", 30, ":party_slot_004"),
            (val_mul, ":var003", ":var005"),
            (val_div, ":var003", 80),
            (try_begin),
                (eq,"$qst_collect_taxes_halve_taxes",1),
                (val_div, ":var003", 2),
            (try_end),
        (try_end),
    (try_end),
    (val_max,":var003",2),
    (store_random_in_range,":random_x_006",1,":var003"),
    (quest_get_slot,":quest_slot_007","qst_collect_taxes",22),
    (val_add, ":quest_slot_007", ":random_x_006"),
    (quest_set_slot,"qst_collect_taxes",22,":quest_slot_007"),
    (call_script, "script_troop_add_gold", "trp_player", ":random_x_006"),
(try_end),
(try_begin),
    (eq,":quest_slot_001",1),
    (val_sub, "$qst_collect_taxes_menu_counter", 1),
    (try_begin),
        (le,"$qst_collect_taxes_menu_counter",0),
        (quest_set_slot,"qst_collect_taxes",11,2),
        (jump_to_menu,"mnu_collect_taxes_revolt_warning"),
    (else_try),
        (eq,":quest_slot_001",2),
        (val_sub, "$qst_collect_taxes_unrest_counter", 1),
        (try_begin),
            (le,"$qst_collect_taxes_unrest_counter",0),
            (eq,"$qst_collect_taxes_halve_taxes",0),
            (quest_set_slot,"qst_collect_taxes",11,3),
            (store_div, ":var___x1", 10000, "$qst_collect_taxes_total_hours"),
            (assign,":var008",":var___x1"),
            (val_add, ":var008", 30),
            (store_random_in_range,":random_x_009",0,1000),
            (try_begin),
                (lt,":random_x_009",":var008"),
                (jump_to_menu,"mnu_collect_taxes_revolt"),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(72.0, [
(try_begin),
    (gt,"$g_force_peace_faction_1",0),
    (gt,"$g_force_peace_faction_2",0),
    (try_begin),
        (eq,1,1),
        (store_relation,":faction_relation_001","$g_force_peace_faction_1","$g_force_peace_faction_2"),
        (try_begin),
            (lt,":faction_relation_001",0),
            (call_script, "script_diplomacy_start_peace_between_kingdoms", "$g_force_peace_faction_1", "$g_force_peace_faction_2", 1),
        (try_end),
    (try_end),
(try_end),
(assign,"$g_force_peace_faction_1",0),
(assign,"$g_force_peace_faction_2",0),
]),

(1.0, [
(str_store_string,s51,"str_no_trigger_noted"),
(try_begin),
    (gt,"$npc_to_rejoin_party",0),
    (eq,"$g_infinite_camping",0),
    (try_begin),
        (neg|main_party_has_troop,"$npc_to_rejoin_party"),
        (neq,"$g_player_is_captive",1),
        (str_store_string,s51,"str_triggered_by_npc_to_rejoin_party"),
        (assign,"$npc_map_talk_context",150),
        (start_map_conversation,"$npc_to_rejoin_party"),
    (else_try),
        (troop_set_slot,"$npc_to_rejoin_party",151,8),
        (assign,"$npc_to_rejoin_party",0),
    (try_end),
(else_try),
    (gt,"$npc_is_quitting",0),
    (eq,"$g_infinite_camping",0),
    (try_begin),
        (main_party_has_troop,"$npc_is_quitting"),
        (neq,"$g_player_is_captive",1),
        (str_store_string,s51,"str_triggered_by_npc_is_quitting"),
        (start_map_conversation,"$npc_is_quitting"),
    (else_try),
        (assign,"$npc_is_quitting",0),
    (try_end),
(else_try),
    (gt,"$npc_with_grievance",0),
    (eq,"$g_infinite_camping",0),
    (eq,"$disable_npc_complaints",0),
    (try_begin),
        (main_party_has_troop,"$npc_with_grievance"),
        (neq,"$g_player_is_captive",1),
        (str_store_string,s51,"str_triggered_by_npc_has_grievance"),
        (assign,"$npc_map_talk_context",61),
        (start_map_conversation,"$npc_with_grievance"),
    (else_try),
        (assign,"$npc_with_grievance",0),
    (try_end),
(else_try),
    (gt,"$npc_with_personality_clash",0),
    (eq,"$g_infinite_camping",0),
    (eq,"$disable_npc_complaints",0),
    (troop_get_slot,":troop_slot_001","$npc_with_personality_clash",71),
    (try_begin),
        (main_party_has_troop,"$npc_with_personality_clash"),
        (main_party_has_troop,":troop_slot_001"),
        (neq,"$g_player_is_captive",1),
        (assign,"$npc_map_talk_context",72),
        (str_store_string,s51,"str_triggered_by_npc_has_personality_clash"),
        (start_map_conversation,"$npc_with_personality_clash"),
    (else_try),
        (assign,"$npc_with_personality_clash",0),
    (try_end),
(else_try),
    (gt,"$npc_with_political_grievance",0),
    (eq,"$g_infinite_camping",0),
    (eq,"$disable_npc_complaints",0),
    (try_begin),
        (main_party_has_troop,"$npc_with_political_grievance"),
        (neq,"$g_player_is_captive",1),
        (str_store_string,s51,"str_triggered_by_npc_has_political_grievance"),
        (assign,"$npc_map_talk_context",145),
        (start_map_conversation,"$npc_with_political_grievance"),
    (else_try),
        (assign,"$npc_with_political_grievance",0),
    (try_end),
(else_try),
    (eq,"$disable_sisterly_advice",0),
    (eq,"$g_infinite_camping",0),
    (gt,"$npc_with_sisterly_advice",0),
    (try_begin),
        (main_party_has_troop,"$npc_with_sisterly_advice"),
        (neq,"$g_player_is_captive",1),
        (assign,"$npc_map_talk_context",139),
        (start_map_conversation,"$npc_with_sisterly_advice"),
    (else_try),
        (assign,"$npc_with_sisterly_advice",0),
    (try_end),
(else_try),
    (eq,"$disable_local_histories",0),
    (eq,"$g_infinite_camping",0),
    (try_for_range, ":trp_002", "trp_npc1", "trp_kingdom_1_lord"),
        (try_begin),
            (main_party_has_troop,":trp_002"),
            (troop_slot_eq,":trp_002",78,0),
            (troop_get_slot,":troop_slot_003",":trp_002",60),
            (try_begin),
                (gt,":troop_slot_003",0),
                (store_distance_to_party_from_party,":distance_parties_004",":troop_slot_003",":troop_slot_003"),
                (try_begin),
                    (lt,":distance_parties_004",7),
                    (assign,"$npc_map_talk_context",60),
                    (str_store_string,s51,"str_triggered_by_local_histories"),
                    (start_map_conversation,":trp_002"),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (check_quest_active,"qst_rebel_against_kingdom"),
    (is_between,"$supported_pretender","trp_kingdom_1_pretender","trp_knight_1_1_wife"),
    (neg|main_party_has_troop,"$supported_pretender"),
    (neg|troop_slot_eq,"$supported_pretender",2,2),
    (party_add_members,"p_main_party","$supported_pretender",1),
(try_end),
(try_begin),
    (check_quest_active,"qst_rebel_against_kingdom"),
    (is_between,"$supported_pretender","trp_kingdom_1_pretender","trp_knight_1_1_wife"),
    (main_party_has_troop,"$supported_pretender"),
    (neg|faction_slot_eq,"fac_player_supporters_faction",8,"trp_player"),
    (call_script, "script_appoint_faction_marshall", "fac_player_supporters_faction", "trp_player"),
(try_end),
]),

(4.0, [
(try_for_range, ":trp_001", "trp_npc1", "trp_knight_1_1_wife"),
    (try_begin),
        (troop_slot_ge,":trp_001",55,1),
        (store_troop_faction,":troop_faction_002",":trp_001"),
        (troop_get_slot,":troop_slot_003",":trp_001",55),
        (troop_get_slot,":troop_slot_004",":trp_001",10),
        (assign,":var005",0),
        (try_begin),
            (le,":troop_slot_004",0),
            (neg|troop_slot_ge,":trp_001",8,0),
            (assign,":var005",1),
        (else_try),
            (gt,":troop_slot_004",0),
            (party_get_attached_to, ":party_attached_006", ":troop_slot_004"),
            (try_begin),
                (lt,":party_attached_006",0),
                (party_get_cur_town, ":party_attached_006", ":troop_slot_004"),
            (try_end),
        (try_end),
        (try_begin),
            (this_or_next|is_between,":party_attached_006","p_town_1","p_salt_mine"),
            (party_slot_eq,":party_attached_006",7,":trp_001"),
            (assign,":var007","trp_knight_1_1_wife"),
            (try_for_range, ":troop_id_008", "trp_npc1", ":var007"),
                (try_begin),
                    (troop_slot_eq,":troop_id_008",2,2),
                    (troop_get_slot,":troop_slot_009",":troop_id_008",10),
                    (try_begin),
                        (party_is_active,":troop_slot_009"),
                        (store_faction_of_party, ":party_faction_010", ":troop_slot_009"),
                        (try_begin),
                            (eq,":party_faction_010",":troop_faction_002"),
                            (store_distance_to_party_from_party,":distance_parties_011",":troop_slot_004",":troop_slot_004"),
                            (try_begin),
                                (lt,":distance_parties_011",4),
                                (assign,":var007",0),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (neq,":var007",0),
            (assign,":var005",1),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var005",1),
        (try_begin),
            (ge,"$cheat_mode",1),
            (str_store_troop_name,s4,":trp_001"),
            (display_message, "@@{!}DEBUG - {s4} faction changed from slot troop change to faction"),
        (try_end),
    (try_end),
    (call_script, "script_change_troop_faction", ":trp_001", ":troop_slot_003"),
    (troop_set_slot,":trp_001",55,0),
    (try_begin),
        (is_between,":troop_slot_003","fac_player_supporters_faction","fac_kingdoms_end"),
        (str_store_troop_name_link,s1,":trp_001"),
        (str_store_faction_name_link,s2,":troop_faction_002"),
        (str_store_faction_name_link,s3,":troop_slot_003"),
        (display_message, "@@{s1} has switched from {s2} to {s3}."),
        (try_begin),
            (eq,":troop_faction_002","$players_kingdom"),
            (call_script, "script_add_notification_menu", "mnu_notification_troop_left_players_faction", ":trp_001", ":troop_slot_003"),
        (else_try),
            (eq,":troop_slot_003","$players_kingdom"),
            (call_script, "script_add_notification_menu", "mnu_notification_troop_joined_players_faction", ":trp_001", ":troop_faction_002"),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, [
(try_begin),
    (eq,"$cheat_mode",1),
    (try_for_range, ":p_001", "p_town_1", "p_salt_mine"),
        (party_get_battle_opponent, ":party_battle_opponent_002", ":p_001"),
        (try_begin),
            (gt,":party_battle_opponent_002",0),
            (str_store_party_name,s2,":p_001"),
            (str_store_party_name,s3,":party_battle_opponent_002"),
            (display_message, "@@{!}DEBUG : {s2} is besieging by {s3}"),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, [
(store_current_day,":cur_day_001"),
(try_begin),
    (gt,":cur_day_001","$g_last_report_control_day"),
    (store_time_of_day,":cur_time_of_day_002"),
    (try_begin),
        (ge,":cur_time_of_day_002",18),
        (store_random_in_range,":random_x_003",0,4),
        (try_begin),
            (this_or_next|ge,":cur_time_of_day_002",22),
            (eq,":random_x_003",0),
            (assign,"$g_last_report_control_day",":cur_day_001"),
            (store_troop_gold,":troop_gold_004","trp_player"),
            (try_begin),
                (lt,":troop_gold_004",0),
                (store_sub, ":gold_005", 0, ":troop_gold_004"),
                (call_script, "script_troop_add_gold", "trp_player", ":gold_005"),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(party_get_morale, ":party_morale_006","p_main_party"),
(try_begin),
    (eq,1,1),
    (str_store_string,s1,"str_party_morale_is_low"),
    (str_clear, 2),
    (party_get_num_companion_stacks,":party_num_companions_stacks_007","p_main_party"),
    (assign,":var008",0),
    (try_for_range, ":stack_no_009", 0, ":party_num_companions_stacks_007"),
        (party_stack_get_troop_id,      ":troop_id_010","p_main_party",":stack_no_009"),
        (try_begin),
            (neg|troop_is_hero,":troop_id_010"),
            (party_stack_get_size,          ":party_stack_size_011","p_main_party",":stack_no_009"),
            (store_troop_faction,":troop_faction_012",":troop_id_010"),
            (assign,":var013",":party_morale_006"),
            (try_begin),
                (ge,":troop_faction_012","fac_kingdom_1"),
                (lt,":troop_faction_012","fac_kingdoms_end"),
                (faction_get_slot,":faction_slot_014",":troop_faction_012",99),
                (val_div, ":faction_slot_014", 100),
                (val_add, ":var013", ":faction_slot_014"),
            (try_end),
        (try_end),
        (try_begin),
            (lt,":var013",32),
            (store_sub, ":var015", 36, ":var013"),
            (val_div, ":var015", 4),
            (assign,":var016",0),
            (try_for_range, ":var017", 0, ":party_stack_size_011"),
                (store_random_in_range,":random_x_003",0,100),
                (try_begin),
                    (lt,":random_x_003",":var015"),
                    (val_add, ":var016", 1),
                    (remove_member_from_party,":troop_id_010","p_main_party"),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (ge,":var016",1),
            (str_store_troop_name,s2,":troop_id_010"),
            (assign,reg0,":var016"),
            (try_begin),
                (ge,":var008",1),
                (str_store_string,s1,"str_s1_reg0_s2"),
            (else_try),
                (str_store_string,s3,1),
                (str_store_string,s1,"str_s3_reg0_s2"),
            (try_end),
            (val_add, ":var008", ":var016"),
        (try_end),
    (try_end),
    (try_begin),
        (ge,":var008",1),
        (try_begin),
            (ge,":var008",2),
            (str_store_string,s2,"str_have_deserted_the_party"),
        (else_try),
            (str_store_string,s2,"str_has_deserted_the_party"),
        (try_end),
        (str_store_string,s1,"str_s1_s2"),
        (try_begin),
            (eq,"$g_infinite_camping",0),
            (dialog_box,1,"str_weekly_report"),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, [
(call_script, "script_calculate_castle_prosperities_by_using_its_villages"),
(assign,":var001","fac_kingdom_6"),
(val_add, ":var001", 1),
(try_for_range, ":var002", "fac_kingdom_1", ":var001"),
    (try_for_range, ":var003", "fac_kingdom_1", ":var001"),
        (store_relation,":faction_relation_004",":var002",":var003"),
        (str_store_faction_name,s7,":var002"),
        (str_store_faction_name,s8,":var003"),
        (try_begin),
            (neq,":var002",":var003"),
            (assign,reg1,":faction_relation_004"),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, [
(try_begin),
    (eq,"$g_player_is_captive",1),
    (neg|party_is_active,"$capturer_party"),
    (rest_for_hours,0,0,0),
(try_end),
(assign,":party_id_001","$next_center_will_be_fired"),
(party_get_slot,":party_slot_002",":party_id_001",38),
(try_begin),
    (eq,":party_slot_002",0),
    (try_begin),
        (eq,1,1),
        (party_get_slot,":party_slot_003",":party_id_001",120),
        (party_get_slot,":party_slot_004",":party_slot_003",240),
        (store_current_hours,":cur_hours_005"),
        (try_begin),
            (eq,"$cheat_mode",1),
            (is_between,":party_id_001","p_town_1","p_salt_mine"),
            (is_between,":party_slot_003","p_town_1","p_salt_mine"),
            (str_store_party_name,s4,":party_id_001"),
            (str_store_party_name,s5,":party_slot_003"),
            (store_current_hours,reg3),
            (party_get_slot,reg4,":party_slot_003",240),
            (display_message, "@@{!}DEBUG - Checking fire at {s4} for {s5} - current time {reg3};;; last nearby fire {reg4}"),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":cur_hours_005",":party_slot_004"),
        (party_add_particle_system, ":party_id_001", "psys_map_village_fire"),
        (party_add_particle_system, ":party_id_001", "psys_map_village_fire_smoke"),
    (else_try),
        (store_add, ":var006", ":party_slot_004", 4),
        (try_begin),
            (eq,":var006",":cur_hours_005"),
            (party_clear_particle_systems, ":party_id_001"),
        (try_end),
    (try_end),
(try_end),
]),

(24.0, [
(val_sub, "$g_dont_give_fief_to_player_days", 1),
(val_max,"$g_dont_give_fief_to_player_days",-1),
(val_sub, "$g_dont_give_marshalship_to_player_days", 1),
(val_max,"$g_dont_give_marshalship_to_player_days",-1),
(party_set_name, "p_steppe_bandit_spawn_point", "str_the_steppes"),
(party_set_name, "p_taiga_bandit_spawn_point", "str_the_tundra"),
(party_set_name, "p_forest_bandit_spawn_point", "str_the_forests"),
(party_set_name, "p_mountain_bandit_spawn_point", "str_the_highlands"),
(party_set_name, "p_sea_raider_spawn_point_1", "str_the_coast"),
(party_set_name, "p_sea_raider_spawn_point_2", "str_the_coast"),
(party_set_name, "p_desert_bandit_spawn_point", "str_the_deserts"),
(troop_set_slot,"trp_npc11",60,"p_town_7"),
(troop_set_slot,"trp_npc8",60,"p_village_35"),
(troop_set_slot,"trp_npc15",67,"p_town_20"),
(party_set_slot,"p_village_93",225,0),
(party_set_slot,"p_village_94",225,0),
(party_set_slot,"p_village_95",225,0),
(party_set_slot,"p_village_96",225,0),
(party_set_slot,"p_village_97",225,0),
(party_set_slot,"p_village_102",225,0),
(party_set_slot,"p_village_109",225,0),
(party_set_slot,"p_village_67",214,0),
(party_set_slot,"p_village_5",214,15),
(try_begin),
    (check_quest_active,"qst_formal_marriage_proposal"),
    (check_quest_failed,"qst_formal_marriage_proposal"),
    (call_script, "script_end_quest", "qst_formal_marriage_proposal"),
(try_end),
(try_begin),
    (check_quest_active,"qst_lend_companion"),
    (quest_get_slot,":quest_slot_001","qst_lend_companion",6),
    (store_troop_faction,":troop_faction_002",":quest_slot_001"),
    (store_relation,":faction_relation_003",":troop_faction_002","$players_kingdom"),
    (try_begin),
        (this_or_next|ge,":faction_relation_003",0),
        (neg|is_between,":troop_faction_002","fac_player_supporters_faction","fac_kingdoms_end"),
        (call_script, "script_abort_quest", "qst_lend_companion", 0),
    (try_end),
(try_end),
(try_begin),
    (is_between,"$players_kingdom","fac_player_supporters_faction","fac_kingdoms_end"),
    (neq,"$players_kingdom","fac_player_supporters_faction"),
    (faction_slot_eq,"$players_kingdom",8,"trp_player"),
    (val_add, "$g_player_days_as_marshal", 1),
(else_try),
    (assign,"$g_player_days_as_marshal",0),
(try_end),
(try_for_range, ":p_004", "p_town_1", "p_castle_1"),
    (party_get_slot,":party_slot_005",":p_004",139),
    (try_begin),
        (ge,":party_slot_005",1),
        (val_sub, ":party_slot_005", 1),
        (party_set_slot,":p_004",139,":party_slot_005"),
    (try_end),
(try_end),
]),

(24.0, [
(item_set_slot,"itm_bread",1,8),
(item_set_slot,"itm_grain",1,2),
(item_set_slot,"itm_smoked_fish",1,4),
(item_set_slot,"itm_dried_meat",1,5),
(item_set_slot,"itm_cheese",1,5),
(item_set_slot,"itm_sausages",1,5),
(item_set_slot,"itm_butter",1,4),
(item_set_slot,"itm_chicken",1,8),
(item_set_slot,"itm_cattle_meat",1,7),
(item_set_slot,"itm_pork",1,6),
(item_set_slot,"itm_raw_olives",1,1),
(item_set_slot,"itm_cabbages",1,2),
(item_set_slot,"itm_raw_grapes",1,3),
(item_set_slot,"itm_apples",1,4),
(item_set_slot,"itm_raw_date_fruit",1,4),
(item_set_slot,"itm_honey",1,6),
(item_set_slot,"itm_wine",1,5),
(item_set_slot,"itm_ale",1,4),
]),

(24.0, [
]),

(24.0, [
]),

(24.0, [
]),

(24.0, [
]),

(24.0, [
]),

(24.0, [
]),

(24.0, [
]),

(24.0, [
]),

(24.0, [
]),

]

from header_common import *
from header_operations import *
from header_mission_templates import *
from header_animations import *
from header_sounds import *
from header_music import *
from header_items import *
from module_constants import *

mission_templates = [

("town_default", 0, -1,
"Default town visit",
[(0, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood,itm_pilgrim_disguise,itm_practice_staff,itm_throwing_daggers,]),
(1, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(2, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(3, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(4, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(5, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(6, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(7, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(8, mtef_scene_source, af_override_horse, 0, 1, []),
(9, mtef_scene_source, af_override_horse, 0, 1, []),
(10, mtef_scene_source, af_override_horse, 0, 1, []),
(11, mtef_scene_source, af_override_horse, 0, 1, []),
(12, mtef_scene_source, af_override_horse, 0, 1, []),
(13, mtef_scene_source, 0, 0, 1, []),
(14, mtef_scene_source, 0, 0, 1, []),
(15, mtef_scene_source, 0, 0, 1, []),
(16, mtef_visitor_source, af_override_horse, 0, 1, []),
(17, mtef_visitor_source, af_override_horse, 0, 1, []),
(18, mtef_visitor_source, af_override_horse, 0, 1, []),
(19, mtef_visitor_source, af_override_horse, 0, 1, []),
(20, mtef_visitor_source, af_override_horse, 0, 1, []),
(21, mtef_visitor_source, af_override_horse, 0, 1, []),
(22, mtef_visitor_source, af_override_horse, 0, 1, []),
(23, mtef_visitor_source, af_override_horse, 0, 1, []),
(24, mtef_visitor_source, af_override_horse, 0, 1, []),
(25, mtef_visitor_source, af_override_horse, 0, 1, []),
(26, mtef_visitor_source, af_override_horse, 0, 1, []),
(27, mtef_visitor_source, af_override_horse, 0, 1, []),
(28, mtef_visitor_source, af_override_horse, 0, 1, []),
(29, mtef_visitor_source, af_override_horse, 0, 1, []),
(30, mtef_visitor_source, af_override_horse, 0, 1, []),
(31, mtef_visitor_source, af_override_horse, 0, 1, []),
],
[
(1.0, 0.0, ti_once, [
], [
(store_current_scene,":cur_scene_001"),
(scene_set_slot,":cur_scene_001",0,1),
(try_begin),
    (eq,"$sneaked_into_town",1),
    (call_script, "script_music_set_situation_with_culture", 16384),
(else_try),
    (eq,"$talk_context",14),
    (call_script, "script_music_set_situation_with_culture", 512),
(else_try),
    (call_script, "script_music_set_situation_with_culture", 8192),
(try_end),
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(call_script, "script_change_banners_and_chest"),
(call_script, "script_initialize_tavern_variables"),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(set_trigger_result, 1),
], [
]),

(1.0, 0.0, 0.0, [
(gt,"$g_belligerent_drunk_leaving",0),
(entry_point_get_position, pos0, 0),
(agent_get_position,pos1,"$g_belligerent_drunk_leaving"),
(try_begin),
    (le,":distance_001",150),
    (get_distance_between_positions,":distance_001",0,1),
(try_end),
], [
(agent_fade_out, "$g_belligerent_drunk_leaving"),
(assign,"$g_belligerent_drunk_leaving",0),
]),

(ti_tab_pressed, 0.0, 0.0, [
(eq,"$g_main_attacker_agent",0),
(set_trigger_result, 1),
], [
]),

(2.0, 0.0, 0.0, [
(neg|conversation_screen_is_active),
(eq,"$talk_context",14),
(neg|troop_slot_eq,"trp_hired_assassin",12,"$g_encountered_party"),
(troop_slot_eq,"trp_belligerent_drunk",12,"$g_encountered_party"),
(eq,"$drunks_dont_pick_fights",0),
], [
(try_begin),
    (eq,"$g_start_belligerent_drunk_fight",0),
    (assign,"$g_start_belligerent_drunk_fight",1),
    (try_for_agents, ":cur_agent"),
        (agent_get_troop_id,":troop_id_002", ":cur_agent"),
        (try_begin),
            (eq,":troop_id_002","trp_belligerent_drunk"),
            (assign,"$g_belligerent_drunk",":cur_agent"),
        (try_end),
    (try_end),
(else_try),
    (eq,"$g_start_belligerent_drunk_fight",1),
    (agent_is_active,"$g_belligerent_drunk"),
    (agent_is_alive,"$g_belligerent_drunk"),
    (get_player_agent_no,":agent_no_003"),
    (agent_get_position,pos0,":agent_no_003"),
    (agent_get_position,pos1,"$g_belligerent_drunk"),
    (get_distance_between_positions,":distance_004",0,1),
    (position_get_z,":pos_z_005",0),
    (position_get_z,":pos_z_006",1),
    (store_sub, ":var007", ":pos_z_006", ":pos_z_005"),
    (try_begin),
        (le,":var007",0),
        (val_mul, ":var007", -1),
    (try_end),
    (store_mul, ":var008", ":var007", 3),
    (val_add, ":distance_004", ":var008"),
    (store_random_in_range,":random_x_009",0,200),
    (store_add, ":var010", 400, ":random_x_009"),
    (try_begin),
        (le,":distance_004",":var010"),
        (call_script, "script_activate_tavern_attackers"),
        (start_mission_conversation,"trp_belligerent_drunk"),
        (assign,"$g_start_belligerent_drunk_fight",2),
    (try_end),
(try_end),
]),

(2.0, 0.0, 0.0, [
(neg|conversation_screen_is_active),
(eq,"$talk_context",14),
(troop_slot_eq,"trp_hired_assassin",12,"$g_encountered_party"),
], [
(try_begin),
    (eq,"$g_start_hired_assassin_fight",0),
    (assign,"$g_start_hired_assassin_fight",1),
    (try_for_agents, ":cur_agent"),
        (agent_get_troop_id,":troop_id_002", ":cur_agent"),
        (try_begin),
            (eq,":troop_id_002","trp_hired_assassin"),
            (assign,"$g_hired_assassin",":cur_agent"),
        (try_end),
    (try_end),
(else_try),
    (eq,"$g_start_hired_assassin_fight",1),
    (agent_is_active,"$g_hired_assassin"),
    (agent_is_alive,"$g_hired_assassin"),
    (get_player_agent_no,":agent_no_003"),
    (agent_get_position,pos0,":agent_no_003"),
    (agent_get_position,pos1,"$g_hired_assassin"),
    (get_distance_between_positions,":distance_004",0,1),
    (position_get_z,":pos_z_005",0),
    (position_get_z,":pos_z_006",1),
    (store_sub, ":var007", ":pos_z_006", ":pos_z_005"),
    (try_begin),
        (le,":var007",0),
        (val_mul, ":var007", -1),
    (try_end),
    (store_mul, ":var008", ":var007", 3),
    (val_add, ":distance_004", ":var008"),
    (store_random_in_range,":random_x_009",0,200),
    (store_add, ":var010", 400, ":random_x_009"),
    (try_begin),
        (le,":distance_004",":var010"),
        (call_script, "script_activate_tavern_attackers"),
        (assign,"$g_start_hired_assassin_fight",2),
    (try_end),
(try_end),
]),

(3.0, 0.0, ti_once, [
(neg|conversation_screen_is_active),
(eq,"$talk_context",14),
(gt,"$g_main_attacker_agent",0),
(this_or_next|agent_is_alive,"$g_main_attacker_agent"),
(agent_is_wounded,"$g_main_attacker_agent"),
], [
(mission_enable_talk),
(try_for_agents, ":cur_agent"),
    (try_begin),
        (agent_is_alive,":cur_agent"),
        (agent_get_position,pos4,":cur_agent"),
        (agent_set_scripted_destination,":cur_agent",4),
    (try_end),
(try_end),
(party_get_slot,":party_slot_002","$g_encountered_party",20),
(start_mission_conversation,":party_slot_002"),
]),

(3.0, 0.0, ti_once, [
(neg|conversation_screen_is_active),
(eq,"$talk_context",14),
(gt,"$g_main_attacker_agent",0),
(main_hero_fallen),
], [
(jump_to_menu,"mnu_lost_tavern_duel"),
(finish_mission, 0),
]),

(1.0, 0.0, 0.0, [
(neg|conversation_screen_is_active),
(eq,"$talk_context",14),
(gt,"$g_main_attacker_agent",0),
(get_player_agent_no,":agent_no_001"),
(try_begin),
    (agent_is_alive,":agent_no_001"),
    (try_begin),
        (is_between,":agent_wieled_item_002","itm_darts","itm_torch"),
        (neq,":agent_wieled_item_002","itm_javelin_melee"),
        (neq,":agent_wieled_item_002","itm_throwing_spear_melee"),
        (neq,":agent_wieled_item_002","itm_jarid_melee"),
        (neq,":agent_wieled_item_002","itm_light_throwing_axes_melee"),
        (neq,":agent_wieled_item_002","itm_throwing_axes_melee"),
        (neq,":agent_wieled_item_002","itm_heavy_throwing_axes_melee"),
        (agent_get_wielded_item,":agent_wieled_item_002",":agent_no_001",0),
    (try_end),
(try_end),
], [
(party_get_slot,":agent_no_001","$g_encountered_party",20),
(start_mission_conversation,":agent_no_001"),
]),

(1.0, 0.0, 0.0, [
(gt,"$g_main_attacker_agent",0),
], [
(agent_get_wielded_item,":agent_wieled_item_001","$g_main_attacker_agent",0),
(val_max,"$g_attacker_drawn_weapon",":agent_wieled_item_001"),
(call_script, "script_neutral_behavior_in_fight"),
]),

]),
("conversation_encounter", 0, -1,
"Conversation encounter",
[(0, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(1, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(2, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(3, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(4, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(5, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(6, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(7, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(8, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(9, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(10, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(11, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(12, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(13, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(14, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(15, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(16, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(17, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(18, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(19, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(20, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(21, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(22, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(23, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(24, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(25, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(26, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(27, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(28, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(29, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(30, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
(31, mtef_visitor_source, af_override_fullhelm, 0, 1, []),
],
[]),
("town_center", 0, -1,
"Default town visit",
[(0, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood,itm_pilgrim_disguise,itm_practice_staff,itm_throwing_daggers,]),
(1, mtef_scene_source|mtef_team_0, 0, 0, 1, []),
(2, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood,itm_pilgrim_disguise,itm_practice_staff,itm_throwing_daggers,]),
(3, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood,itm_pilgrim_disguise,itm_practice_staff,itm_throwing_daggers,]),
(4, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood,itm_pilgrim_disguise,itm_practice_staff,itm_throwing_daggers,]),
(5, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood,itm_pilgrim_disguise,itm_practice_staff,itm_throwing_daggers,]),
(6, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood,itm_pilgrim_disguise,itm_practice_staff,itm_throwing_daggers,]),
(7, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood,itm_pilgrim_disguise,itm_practice_staff,itm_throwing_daggers,]),
(8, mtef_visitor_source, af_override_horse, 0, 1, []),
(9, mtef_visitor_source, af_override_horse, 0, 1, []),
(10, mtef_visitor_source, af_override_horse, 0, 1, []),
(11, mtef_visitor_source, af_override_horse, 0, 1, []),
(12, mtef_visitor_source, af_override_horse, 0, 1, []),
(13, mtef_visitor_source, 0, 0, 1, []),
(14, mtef_scene_source, 0, 0, 1, []),
(15, mtef_scene_source, 0, 0, 1, []),
(16, mtef_visitor_source, af_override_horse, 0, 1, []),
(17, mtef_visitor_source, af_override_horse, 0, 1, []),
(18, mtef_visitor_source, af_override_horse, 0, 1, []),
(19, mtef_visitor_source, af_override_horse, 0, 1, []),
(20, mtef_visitor_source, af_override_horse, 0, 1, []),
(21, mtef_visitor_source, af_override_horse, 0, 1, []),
(22, mtef_visitor_source, af_override_horse, 0, 1, []),
(23, mtef_visitor_source, af_override_horse, 0, 1, []),
(24, mtef_visitor_source, af_override_horse, 0, 1, []),
(25, mtef_visitor_source, af_override_horse, 0, 1, []),
(26, mtef_visitor_source, af_override_horse, 0, 1, []),
(27, mtef_visitor_source, af_override_horse, 0, 1, []),
(28, mtef_visitor_source, af_override_horse, 0, 1, []),
(29, mtef_visitor_source, af_override_horse, 0, 1, []),
(30, mtef_visitor_source, af_override_horse, 0, 1, []),
(31, mtef_visitor_source, af_override_horse, 0, 1, []),
(32, mtef_visitor_source, af_override_horse, 0, 1, []),
(33, mtef_visitor_source, af_override_horse, 0, 1, []),
(34, mtef_visitor_source, af_override_horse, 0, 1, []),
(35, mtef_visitor_source, af_override_horse, 0, 1, []),
(36, mtef_visitor_source, af_override_horse, 0, 1, []),
(37, mtef_visitor_source, af_override_horse, 0, 1, []),
(38, mtef_visitor_source, af_override_horse, 0, 1, []),
(39, mtef_visitor_source, af_override_horse, 0, 1, []),
(40, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(41, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(42, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(43, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(44, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(45, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(46, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(47, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
],
[
(ti_on_agent_spawn, 0.0, 0.0, [
], [
(call_script, "script_init_town_agent", ":var001"),
(try_begin),
    (this_or_next|eq,"$talk_context",18),
    (eq,"$talk_context",19),
    (agent_get_troop_id,":troop_id_002", ":var001"),
    (try_begin),
        (troop_slot_eq,":troop_id_002",161,1),
        (agent_set_team, ":var001", 0),
        (agent_ai_set_aggressiveness, ":var001", 5),
        (troop_set_slot,":troop_id_002",161,0),
        (try_begin),
            (troop_slot_eq,":troop_id_002",149,3),
            (agent_get_position,pos1,":var001"),
            (agent_set_scripted_destination,":var001",1),
        (try_end),
    (try_end),
(try_end),
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(assign,"$g_main_attacker_agent",0),
]),

(1.0, 0.0, ti_once, [
], [
(try_begin),
    (eq,"$g_mt_mode",0),
    (store_current_scene,":cur_scene_001"),
    (scene_set_slot,":cur_scene_001",0,1),
(try_end),
(call_script, "script_init_town_walker_agents"),
(try_begin),
    (eq,"$sneaked_into_town",1),
    (call_script, "script_music_set_situation_with_culture", 16384),
(else_try),
    (call_script, "script_music_set_situation_with_culture", 8192),
(try_end),
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(call_script, "script_change_banners_and_chest"),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(eq,"$g_mt_mode",0),
(set_trigger_result, 1),
(else_try),
(eq,"$g_mt_mode",1),
(display_message, "str_cant_use_inventory_disguised"),
(else_try),
(display_message, "str_cant_use_inventory_now"),
], [
]),

(ti_tab_pressed, 0.0, 0.0, [
(this_or_next|eq,"$talk_context",18),
(eq,"$talk_context",19),
(display_message, "str_cannot_leave_now"),
(else_try),
(this_or_next|eq,"$g_mt_mode",1),
(eq,"$g_mt_mode",0),
(mission_enable_talk),
(set_trigger_result, 1),
(else_try),
(display_message, "str_cannot_leave_now"),
], [
]),

(ti_on_leave_area, 0.0, 0.0, [
(eq,"$g_defending_against_siege",0),
(assign,"$g_leave_town",1),
], [
(try_begin),
    (eq,"$talk_context",19),
    (call_script, "script_deduct_casualties_from_garrison"),
    (jump_to_menu,"mnu_sneak_into_town_caught_dispersed_guards"),
(try_end),
(mission_enable_talk),
]),

(0.0, 0.0, ti_once, [
], [
(try_begin),
    (party_slot_eq,"$current_town",0,3),
    (call_script, "script_town_init_doors", 0),
    (try_begin),
        (eq,"$town_nighttime",0),
        (play_sound,"snd_town_ambiance",2),
    (try_end),
(try_end),
]),

(3.0, 0.0, 0.0, [
(call_script, "script_tick_town_walkers"),
], [
]),

(2.0, 0.0, 0.0, [
(call_script, "script_center_ambiance_sounds"),
], [
]),

(1.0, 0.0, 0.0, [
(this_or_next|eq,"$talk_context",19),
(eq,"$talk_context",18),
], [
(call_script, "script_neutral_behavior_in_fight"),
(mission_disable_talk),
]),

(1.0, 0.0, ti_once, [
(eq,"$talk_context",19),
], [
(get_player_agent_no,":agent_no_001"),
(assign,reg6,":agent_no_001"),
(call_script, "script_activate_town_guard"),
(get_player_agent_no,":agent_no_001"),
(agent_get_position,pos4,":agent_no_001"),
(try_for_range, ":trp_002", "trp_npc1", "trp_heroes_end"),
    (try_begin),
        (troop_slot_ge,":trp_002",149,2),
        (str_store_troop_name,s4,":trp_002"),
        (display_message, "str_s4_joins_prison_break"),
        (store_current_scene,":cur_scene_003"),
        (modify_visitors_at_site,":cur_scene_003"),
        (store_current_scene,":cur_scene_003"),
        (modify_visitors_at_site,":cur_scene_003"),
        (add_visitors_to_current_scene,24,":trp_002",1, 0, 0),
        (troop_set_slot,":trp_002",161,1),
    (try_end),
(try_end),
]),

(3.0, 0.0, 0.0, [
(main_hero_fallen),
], [
(try_begin),
    (this_or_next|eq,"$talk_context",19),
    (eq,"$talk_context",18),
    (call_script, "script_deduct_casualties_from_garrison"),
    (jump_to_menu,"mnu_captivity_start_castle_defeat"),
    (assign,":var001","trp_heroes_end"),
    (try_for_range, ":troop_id_002", "trp_npc1", ":var001"),
        (troop_set_slot,":troop_id_002",149,0),
    (try_end),
    (mission_enable_talk),
    (finish_mission, 0),
(else_try),
    (set_trigger_result, 1),
(try_end),
]),

(3.0, 0.0, 0.0, [
(eq,"$talk_context",19),
(neg|main_hero_fallen),
(try_begin),
    (ge,":m_timer_a_001",10),
    (all_enemies_defeated),
    (store_mission_timer_a,":m_timer_a_001"),
(try_end),
], [
(call_script, "script_deduct_casualties_from_garrison"),
(try_for_agents, ":m_timer_a_001"),
    (agent_get_troop_id,":troop_id_002", ":m_timer_a_001"),
    (try_begin),
        (troop_slot_ge,":troop_id_002",149,2),
        (try_begin),
            (agent_is_alive,":m_timer_a_001"),
            (troop_set_slot,":troop_id_002",149,4),
        (else_try),
            (troop_set_slot,":troop_id_002",149,5),
        (try_end),
    (try_end),
(try_end),
(jump_to_menu,"mnu_sneak_into_town_caught_ran_away"),
(mission_enable_talk),
(finish_mission, 0),
]),

(ti_on_agent_killed_or_wounded, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_003", ":var001"),
(agent_get_troop_id,":troop_id_004", ":var002"),
(try_begin),
    (this_or_next|eq,":troop_id_003","trp_swadian_prison_guard"),
    (this_or_next|eq,":troop_id_003","trp_vaegir_prison_guard"),
    (this_or_next|eq,":troop_id_003","trp_khergit_prison_guard"),
    (this_or_next|eq,":troop_id_003","trp_nord_prison_guard"),
    (this_or_next|eq,":troop_id_003","trp_rhodok_prison_guard"),
    (eq,":troop_id_003","trp_sarranid_prison_guard"),
    (eq,":troop_id_004","trp_player"),
    (display_message, "@@You got keys of dungeon."),
(try_end),
]),

]),
("village_center", 0, -1,
"village center",
[(0, mtef_scene_source|mtef_team_0, 0, 0, 1, []),
(1, mtef_scene_source|mtef_team_0, 0, 0, 1, []),
(2, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(3, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(4, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(5, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(6, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(7, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(8, mtef_visitor_source, af_override_horse, 0, 1, []),
(9, mtef_visitor_source, af_override_horse, 0, 1, []),
(10, mtef_visitor_source, af_override_horse, 0, 1, []),
(11, mtef_visitor_source, af_override_horse, 0, 1, []),
(12, mtef_visitor_source, af_override_horse, 0, 1, []),
(13, mtef_visitor_source, 0, 0, 1, []),
(14, mtef_visitor_source, 0, 0, 1, []),
(15, mtef_visitor_source, 0, 0, 1, []),
(16, mtef_visitor_source, af_override_horse, 0, 1, []),
(17, mtef_visitor_source, af_override_horse, 0, 1, []),
(18, mtef_visitor_source, af_override_horse, 0, 1, []),
(19, mtef_visitor_source, af_override_horse, 0, 1, []),
(20, mtef_visitor_source, af_override_horse, 0, 1, []),
(21, mtef_visitor_source, af_override_horse, 0, 1, []),
(22, mtef_visitor_source, af_override_horse, 0, 1, []),
(23, mtef_visitor_source, af_override_horse, 0, 1, []),
(24, mtef_visitor_source, af_override_horse, 0, 1, []),
(25, mtef_visitor_source, af_override_horse, 0, 1, []),
(26, mtef_visitor_source, af_override_horse, 0, 1, []),
(27, mtef_visitor_source, af_override_horse, 0, 1, []),
(28, mtef_visitor_source, af_override_horse, 0, 1, []),
(29, mtef_visitor_source, af_override_horse, 0, 1, []),
(30, mtef_visitor_source, af_override_horse, 0, 1, []),
(31, mtef_visitor_source, af_override_horse, 0, 1, []),
(32, mtef_visitor_source, af_override_horse, 0, 1, []),
(33, mtef_visitor_source, af_override_horse, 0, 1, []),
(34, mtef_visitor_source, af_override_horse, 0, 1, []),
(35, mtef_visitor_source, af_override_horse, 0, 1, []),
(36, mtef_visitor_source, af_override_horse, 0, 1, []),
(37, mtef_visitor_source, af_override_horse, 0, 1, []),
(38, mtef_visitor_source, af_override_horse, 0, 1, []),
(39, mtef_visitor_source, af_override_horse, 0, 1, []),
(40, mtef_visitor_source, af_override_horse, 0, 1, []),
(41, mtef_visitor_source, af_override_horse, 0, 1, []),
(42, mtef_visitor_source, af_override_horse, 0, 1, []),
(43, mtef_visitor_source, af_override_horse, 0, 1, []),
(44, mtef_visitor_source, af_override_horse, 0, 1, []),
(45, mtef_visitor_source, af_override_horse, 0, 1, []),
(46, mtef_visitor_source, af_override_horse, 0, 1, []),
(47, mtef_visitor_source, af_override_horse, 0, 1, []),
],
[
(1.0, 0.0, ti_once, [
], [
(store_current_scene,":cur_scene_001"),
(scene_set_slot,":cur_scene_001",0,1),
(call_script, "script_init_town_walker_agents"),
(call_script, "script_music_set_situation_with_culture", 65536),
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(call_script, "script_change_banners_and_chest"),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(set_trigger_result, 1),
], [
]),

(ti_tab_pressed, 0.0, 0.0, [
(check_quest_active,"qst_hunt_down_fugitive"),
(neg|check_quest_succeeded,"qst_hunt_down_fugitive"),
(neg|check_quest_failed,"qst_hunt_down_fugitive"),
(quest_slot_eq,"qst_hunt_down_fugitive",11,1),
(try_begin),
    (call_script, "script_cf_troop_agent_is_alive", "trp_fugitive"),
    (call_script, "script_fail_quest", "qst_hunt_down_fugitive"),
(else_try),
    (call_script, "script_succeed_quest", "qst_hunt_down_fugitive"),
(try_end),
(try_end),
], [
]),

(ti_on_leave_area, 0.0, 0.0, [
(eq,1,1),
(assign,"$g_leave_town",1),
], [
]),

(3.0, 0.0, 0.0, [
(call_script, "script_tick_town_walkers"),
], [
]),

(2.0, 0.0, 0.0, [
(call_script, "script_center_ambiance_sounds"),
], [
]),

(1.0, 0.0, ti_once, [
(check_quest_active,"qst_hunt_down_fugitive"),
(neg|check_quest_succeeded,"qst_hunt_down_fugitive"),
(neg|check_quest_failed,"qst_hunt_down_fugitive"),
(quest_slot_eq,"qst_hunt_down_fugitive",11,1),
(assign,":var001",0),
(try_begin),
    (call_script,"script_cf_troop_agent_is_alive"),
(else_try),
    (assign,":var001",1),
    (try_begin),
        (this_or_next|main_hero_fallen),
        (eq,":var001",1),
    (try_end),
(try_end),
], [
(try_begin),
    (main_hero_fallen),
    (jump_to_menu,"mnu_village_hunt_down_fugitive_defeated"),
    (call_script, "script_fail_quest", "qst_hunt_down_fugitive"),
    (finish_mission, 4),
(else_try),
    (call_script, "script_change_player_relation_with_center", "$current_town", -2),
    (call_script, "script_succeed_quest", "qst_hunt_down_fugitive"),
(try_end),
]),

]),
("bandits_at_night", 0, -1,
"Default town visit",
[(0, mtef_scene_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, [itm_pilgrim_hood,itm_pilgrim_disguise,itm_practice_staff,itm_throwing_daggers,]),
(1, mtef_scene_source|mtef_team_0, 0, 0, 1, []),
(2, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(3, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(4, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(5, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(6, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(7, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(8, mtef_scene_source, af_override_horse, 0, 1, []),
(9, mtef_visitor_source, af_override_horse, 0, 1, []),
(10, mtef_visitor_source, af_override_horse, 0, 1, []),
(11, mtef_visitor_source, af_override_horse, aif_start_alarmed, 1, []),
(12, mtef_visitor_source, af_override_horse, 0, 1, []),
(13, mtef_scene_source, 0, 0, 1, []),
(14, mtef_scene_source, 0, 0, 1, []),
(15, mtef_scene_source, 0, 0, 1, []),
(16, mtef_visitor_source, af_override_horse, 0, 1, []),
(17, mtef_visitor_source, af_override_horse, 0, 1, []),
(18, mtef_visitor_source, af_override_horse, 0, 1, []),
(19, mtef_visitor_source, af_override_horse, 0, 1, []),
(20, mtef_visitor_source, af_override_horse, 0, 1, []),
(21, mtef_visitor_source, af_override_horse, 0, 1, []),
(22, mtef_visitor_source, af_override_horse, 0, 1, []),
(23, mtef_visitor_source, af_override_horse, 0, 1, []),
(24, mtef_visitor_source, af_override_horse, 0, 1, []),
(25, mtef_visitor_source, af_override_horse, 0, 1, []),
(26, mtef_visitor_source, af_override_horse, 0, 1, []),
(27, mtef_visitor_source, af_override_horse, aif_start_alarmed, 1, []),
(28, mtef_visitor_source, af_override_horse, aif_start_alarmed, 1, []),
(29, mtef_visitor_source, af_override_horse, 0, 1, []),
(30, mtef_visitor_source, af_override_horse, 0, 1, []),
(31, mtef_visitor_source, af_override_horse, 0, 1, []),
(32, mtef_visitor_source, af_override_horse, 0, 1, []),
(33, mtef_visitor_source, af_override_horse, 0, 1, []),
(34, mtef_visitor_source, af_override_horse, 0, 1, []),
(35, mtef_visitor_source, af_override_horse, 0, 1, []),
(36, mtef_visitor_source, af_override_horse, 0, 1, []),
(37, mtef_visitor_source, af_override_horse, 0, 1, []),
(38, mtef_visitor_source, af_override_horse, 0, 1, []),
(39, mtef_visitor_source, af_override_horse, 0, 1, []),
(40, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(41, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(42, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(43, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(44, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(45, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(46, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(47, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
],
[
(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(try_begin),
    (neq,":troop_id_002","trp_player"),
    (agent_set_team, ":var001", 1),
(try_end),
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(call_script, "script_change_banners_and_chest"),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_now"),
], [
]),

(ti_tab_pressed, 0.0, 0.0, [
(display_message, "str_cannot_leave_now"),
], [
]),

(ti_on_leave_area, 0.0, 0.0, [
(eq,"$g_defending_against_siege",0),
(assign,"$g_leave_town",1),
], [
]),

(0.0, 0.0, ti_once, [
], [
(call_script, "script_music_set_situation_with_culture", 4096),
(set_party_battle_mode),
(try_begin),
    (party_slot_eq,"$current_town",0,3),
    (call_script, "script_town_init_doors", 0),
(try_end),
]),

(1.0, 4.0, ti_once, [
(ge,":m_timer_a_001",5),
(this_or_next|main_hero_fallen),
(num_active_teams_le,1),
(store_mission_timer_a,":m_timer_a_001"),
], [
(try_begin),
    (main_hero_fallen),
    (jump_to_menu,"mnu_town_bandits_failed"),
(else_try),
    (jump_to_menu,"mnu_town_bandits_succeeded"),
(try_end),
(finish_mission, ":"),
]),

]),
("village_training", mtf_arena_fight|mtf_team_fight, -1,
"village training",
[(2, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_foot|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all|af_override_everything, aif_start_alarmed, 1, [itm_practice_staff,itm_practice_boots,]),
(4, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_foot|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all|af_override_everything, aif_start_alarmed, 1, [itm_practice_staff,itm_practice_boots,]),
],
[
(ti_before_mission_start, 0.0, 0.0, [
], [
(assign,"$g_train_peasants_against_bandits_training_succeeded",0),
(call_script, "script_change_banners_and_chest"),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(question_box,"str_give_up_fight"),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (finish_mission, ":"),
(try_end),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_now"),
], [
]),

(1.0, 4.0, ti_once, [
(this_or_next|main_hero_fallen),
(num_active_teams_le,1),
], [
(try_begin),
    (neg|main_hero_fallen),
    (assign,"$g_train_peasants_against_bandits_training_succeeded",1),
(try_end),
(finish_mission, ":"),
]),

]),
("visit_town_castle", 0, -1,
"You enter the halls of the lord.",
[(0, mtef_scene_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_horse, 0, 1, []),
(1, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(2, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(3, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(4, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(5, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(6, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(7, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(8, mtef_visitor_source, af_override_horse, 0, 1, []),
(9, mtef_visitor_source, af_override_horse, 0, 1, []),
(10, mtef_scene_source, af_override_horse, 0, 1, []),
(11, mtef_scene_source, af_override_horse, 0, 1, []),
(12, mtef_visitor_source, af_override_horse, 0, 1, []),
(13, mtef_visitor_source, 0, 0, 1, []),
(14, mtef_visitor_source, 0, 0, 1, []),
(15, mtef_visitor_source, 0, 0, 1, []),
(16, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(17, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(18, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(19, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(20, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(21, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(22, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(23, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(24, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(25, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(26, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(27, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(28, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(29, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(30, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(31, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
],
[
(ti_on_agent_spawn, 0.0, 0.0, [
], [
(call_script, "script_init_town_agent", ":var001"),
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(call_script, "script_change_banners_and_chest"),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(set_trigger_result, 1),
], [
]),

(ti_tab_pressed, 0.0, 0.0, [
(neq,"$talk_context",18),
(set_trigger_result, 1),
], [
]),

(ti_on_leave_area, 0.0, 0.0, [
(eq,"$talk_context",18),
], [
(display_message, "str_leaving_area_during_prison_break"),
(set_jump_mission,"mt_sneak_caught_fight"),
]),

(0.0, 0.0, ti_once, [
], [
(try_begin),
    (eq,"$talk_context",1),
    (try_begin),
        (eq,1,1),
        (store_faction_of_party, ":party_faction_001", "$current_town"),
        (try_begin),
            (faction_slot_eq,":party_faction_001",4,6),
            (faction_slot_eq,":party_faction_001",5,"$current_town"),
            (call_script, "script_music_set_situation_with_culture", 16777216),
        (try_end),
    (try_end),
(else_try),
    (call_script, "script_music_set_situation_with_culture", 0),
(try_end),
]),

]),
("back_alley_kill_local_merchant", mtf_battle_mode, -1,
"You enter the back alley",
[(0, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(3, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
],
[
(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_now"),
], [
]),

(ti_tab_pressed, 0.0, 0.0, [
(display_message, "str_cannot_leave_now"),
], [
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(call_script, "script_change_banners_and_chest"),
]),

(0.0, 0.0, ti_once, [
], [
(call_script, "script_music_set_situation_with_culture", 4096),
]),

(0.0, 0.0, ti_once, [
(try_begin),
    (ge,":m_timer_a_001",1),
    (assign,":agent_hit_points_002",0),
    (assign,":agent_hit_points_003",0),
    (assign,":agent_hit_points_002",0),
    (assign,":var004",-1),
    (assign,":var005",-1),
    (try_for_agents, ":cur_agent"),
        (agent_get_troop_id,":troop_id_007", ":cur_agent"),
        (try_begin),
            (eq,":troop_id_007","trp_local_merchant"),
            (store_agent_hit_points,":agent_hit_points_002",":cur_agent"),
            (assign,":var004",":cur_agent"),
        (else_try),
            (eq,":troop_id_007","trp_player"),
            (store_agent_hit_points,":agent_hit_points_003",":cur_agent"),
            (assign,":var005",":cur_agent"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (ge,":var005",0),
    (ge,":var004",0),
    (agent_is_alive,":var005"),
    (agent_is_alive,":var004"),
    (is_between,":agent_hit_points_002",1,30),
    (gt,":agent_hit_points_003",50),
    (start_mission_conversation,"trp_local_merchant"),
], [
]),

(1.0, 4.0, ti_once, [
(try_begin),
    (call_script,"script_cf_troop_agent_is_alive"),
(else_try),
    (assign,":var001",1),
    (try_begin),
        (this_or_next|main_hero_fallen),
        (eq,":var001",1),
    (try_end),
], [
(try_begin),
    (main_hero_fallen),
    (call_script, "script_fail_quest", "qst_kill_local_merchant"),
(else_try),
    (call_script, "script_change_player_relation_with_center", "$current_town", -4),
    (call_script, "script_succeed_quest", "qst_kill_local_merchant"),
(try_end),
(finish_mission, ":"),
]),

]),
("back_alley_revolt", mtf_battle_mode, 8,
"You lead your men to battle.",
[(0, mtef_team_0|mtef_use_exact_number, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_horse, aif_start_alarmed, 4, [itm_quarter_staff,]),
(3, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
],
[
(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_now"),
], [
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(question_box,"str_do_you_want_to_retreat"),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (jump_to_menu,"mnu_collect_taxes_failed"),
    (finish_mission, ":"),
(try_end),
]),

(ti_tab_pressed, 0.0, 0.0, [
(display_message, "str_cannot_leave_now"),
], [
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(call_script, "script_change_banners_and_chest"),
]),

(0.0, 0.0, ti_once, [
], [
(call_script, "script_music_set_situation_with_culture", 1024),
]),

(1.0, 4.0, ti_once, [
(this_or_next|main_hero_fallen),
(num_active_teams_le,1),
], [
(try_begin),
    (main_hero_fallen),
    (jump_to_menu,"mnu_collect_taxes_failed"),
(else_try),
    (jump_to_menu,"mnu_collect_taxes_rebels_killed"),
(try_end),
(finish_mission, ":"),
]),

]),
("lead_charge", mtf_battle_mode|mtf_synch_inventory, 8,
"You lead your men to battle.",
[(1, mtef_defenders|mtef_team_0, 0, aif_start_alarmed, 12, []),
(0, mtef_defenders|mtef_team_0, 0, aif_start_alarmed, 0, []),
(4, mtef_attackers|mtef_team_1, 0, aif_start_alarmed, 12, []),
(4, mtef_attackers|mtef_team_1, 0, aif_start_alarmed, 0, []),
],
[
(ti_on_agent_spawn, 0.0, 0.0, [
], [
(call_script, "script_agent_reassign_team", ":agent_id_001"),
(assign,":var002",5000),
(agent_get_troop_id,":troop_id_003", ":agent_id_001"),
(store_character_level,":character_lvl_004",":troop_id_003"),
(val_mul, ":character_lvl_004", 35),
(val_add, ":var002", ":character_lvl_004"),
(store_random_in_range,":random_x_005",0,3000),
(val_add, ":var002", ":random_x_005"),
(agent_get_party_id,":party_id_006",":agent_id_001"),
(party_get_morale, ":party_morale_007",":party_id_006"),
(store_sub, ":var008", ":party_morale_007", 70),
(val_mul, ":var008", 30),
(val_add, ":var002", ":var008"),
(agent_set_slot,":agent_id_001",16,":var002"),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(ti_on_agent_killed_or_wounded, 0.0, 0.0, [
], [
(try_begin),
    (ge,":var001",0),
    (neg|agent_is_ally,":var001"),
    (agent_is_human,":var001"),
    (agent_get_troop_id,":troop_id_004", ":var001"),
    (party_add_members,"p_total_enemy_casualties",":troop_id_004",1),
    (try_begin),
        (eq,":var003",1),
        (party_wound_members,"p_total_enemy_casualties",":troop_id_004",1),
    (try_end),
(try_end),
(call_script, "script_apply_death_effect_on_courage_scores", ":var001", ":var002"),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_battle_won",1),
    (call_script, "script_count_mission_casualties_from_agents"),
    (finish_mission, 0),
(else_try),
    (call_script, "script_cf_check_enemies_nearby"),
    (question_box,"str_do_you_want_to_retreat"),
(else_try),
    (display_message, "str_can_not_retreat"),
(try_end),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (assign,"$pin_player_fallen",0),
    (try_begin),
        (eq,1,1),
        (store_mission_timer_a,":m_timer_a_002"),
        (try_begin),
            (gt,":m_timer_a_002",20),
            (str_store_string,s5,"str_retreat"),
            (call_script, "script_simulate_retreat", 10, 20, 1),
        (try_end),
    (try_end),
(try_end),
(call_script, "script_count_mission_casualties_from_agents"),
(finish_mission, 0),
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(team_set_relation, 0, 2, 1),
(team_set_relation, 1, 3, 1),
(call_script, "script_place_player_banner_near_inventory_bms"),
(party_clear,"p_routed_enemies"),
(assign,"$g_latest_order_1",1),
(assign,"$g_latest_order_2",1),
(assign,"$g_latest_order_3",1),
(assign,"$g_latest_order_4",1),
]),

(0.0, 0.0, ti_once, [
], [
(assign,"$g_battle_won",0),
(assign,"$defender_reinforcement_stage",0),
(assign,"$attacker_reinforcement_stage",0),
(call_script, "script_place_player_banner_near_inventory"),
(call_script, "script_combat_music_set_situation_with_culture"),
(assign,"$g_defender_reinforcement_limit",2),
]),

(30.0, 0.0, 0.0, [
], [
(call_script, "script_combat_music_set_situation_with_culture"),
]),

(2.0, 0.0, 0.0, [
], [
(call_script, "script_check_friendly_kills"),
]),

(1.0, 0.0, 5.0, [
(assign,":var001",reg0),
(assign,":var002",0),
(try_for_agents, ":cur_agent"),
    (try_begin),
        (agent_is_human,":cur_agent"),
        (agent_get_party_id,":party_id_004",":cur_agent"),
        (try_begin),
            (neq,":party_id_004","p_main_party"),
            (neg|agent_is_ally,":cur_agent"),
            (val_add, ":var002", 1),
        (try_end),
    (try_end),
(try_end),
(store_sub, ":var005", ":var001", ":var002"),
(try_begin),
    (lt,":var005",15),
    (ge,"$defender_reinforcement_stage",2),
    (eq,"$defender_reinforcement_limit_increased",0),
    (val_add, "$g_defender_reinforcement_limit", 1),
    (assign,"$defender_reinforcement_limit_increased",1),
(try_end),
(try_begin),
    (lt,"$defender_reinforcement_stage","$g_defender_reinforcement_limit"),
    (store_mission_timer_a,":m_timer_a_006"),
    (try_begin),
        (ge,":m_timer_a_006",10),
        (try_begin),
            (lt,":normalized_team_count_007",6),
            (store_normalized_team_count,":normalized_team_count_007", 0),
        (try_end),
    (try_end),
], [
(add_reinforcements_to_entry,0,7),
(assign,"$defender_reinforcement_limit_increased",0),
(val_add, "$defender_reinforcement_stage", 1),
]),

(1.0, 0.0, 5.0, [
(lt,"$attacker_reinforcement_stage",2),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (ge,":m_timer_a_001",10),
    (try_begin),
        (lt,":normalized_team_count_002",6),
        (store_normalized_team_count,":normalized_team_count_002", 1),
    (try_end),
(try_end),
], [
(add_reinforcements_to_entry,3,7),
(val_add, "$attacker_reinforcement_stage", 1),
]),

(1.0, 60.0, ti_once, [
(try_begin),
    (ge,reg1,10),
    (all_enemies_defeated),
    (neg|main_hero_fallen),
    (set_mission_result,1),
    (display_message, "str_msg_battle_won"),
    (assign,"$g_battle_won",1),
    (assign,"$g_battle_result",1),
    (call_script, "script_play_victorious_sound"),
], [
(call_script, "script_count_mission_casualties_from_agents"),
(finish_mission, 1),
]),

(10.0, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_battle_won",1),
    (display_message, "str_msg_battle_won"),
(try_end),
]),

(1.0, 4.0, ti_once, [
(main_hero_fallen),
], [
(assign,"$pin_player_fallen",1),
(str_store_string,s5,"str_retreat"),
(call_script, "script_simulate_retreat", 10, 20, 1),
(assign,"$g_battle_result",-1),
(set_mission_result,-1),
(call_script, "script_count_mission_casualties_from_agents"),
(finish_mission, 0),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
], [
(display_message, "str_use_baggage_for_inventory"),
]),

(0.0, 0.0, ti_once, [
(ge,":m_timer_a_001",2),
(store_mission_timer_a,":m_timer_a_001"),
], [
(call_script, "script_select_battle_tactic"),
(call_script, "script_battle_tactic_init"),
]),

(3.0, 0.0, 0.0, [
(call_script, "script_apply_effect_of_other_people_on_courage_scores"),
], [
]),

(3.0, 0.0, 0.0, [
(try_begin),
    (agent_is_human,":cur_agent"),
    (agent_is_alive,":cur_agent"),
    (store_mission_timer_a,":m_timer_a_002"),
    (try_begin),
        (ge,":m_timer_a_002",3),
        (call_script, "script_decide_run_away_or_not", ":cur_agent", ":m_timer_a_002"),
    (try_end),
(try_end),
], [
]),

(5.0, 0.0, 0.0, [
(try_begin),
    (ge,":m_timer_a_001",3),
    (call_script, "script_battle_tactic_apply"),
], [
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (game_key_clicked, 22),
    (neg|is_presentation_active, "prsnt_battle"),
    (start_presentation, "prsnt_battle"),
(try_end),
]),

(0.1, 0.0, 0.0, [
], [
(try_begin),
    (is_presentation_active, "prsnt_battle"),
    (call_script, "script_update_order_panel_statistics_and_map"),
(try_end),
]),

]),
("village_attack_bandits", mtf_battle_mode|mtf_synch_inventory, 8,
"You lead your men to battle.",
[(3, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(1, mtef_team_0|mtef_use_exact_number, 0, aif_start_alarmed, 7, []),
(1, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
],
[
(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_battle_won",1),
    (call_script, "script_count_mission_casualties_from_agents"),
    (finish_mission, 0),
(else_try),
    (call_script, "script_cf_check_enemies_nearby"),
    (question_box,"str_do_you_want_to_retreat"),
(else_try),
    (display_message, "str_can_not_retreat"),
(try_end),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (assign,"$pin_player_fallen",0),
    (str_store_string,s5,"str_retreat"),
    (call_script, "script_simulate_retreat", 10, 20, 1),
    (assign,"$g_battle_result",-1),
    (call_script, "script_count_mission_casualties_from_agents"),
    (finish_mission, 0),
(try_end),
]),

(0.0, 0.0, ti_once, [
], [
(assign,"$g_battle_won",0),
(assign,"$defender_reinforcement_stage",0),
(assign,"$attacker_reinforcement_stage",0),
(try_begin),
    (eq,"$g_mt_mode",2),
    (add_reinforcements_to_entry,1,6),
(else_try),
    (add_reinforcements_to_entry,1,29),
(try_end),
(call_script, "script_combat_music_set_situation_with_culture"),
]),

(30.0, 0.0, 0.0, [
], [
(call_script, "script_combat_music_set_situation_with_culture"),
]),

(2.0, 0.0, 0.0, [
], [
(call_script, "script_check_friendly_kills"),
]),

(1.0, 60.0, ti_once, [
(try_begin),
    (ge,reg1,10),
    (all_enemies_defeated),
    (neg|main_hero_fallen),
    (set_mission_result,1),
    (display_message, "str_msg_battle_won"),
    (assign,"$g_battle_won",1),
    (assign,"$g_battle_result",1),
    (call_script, "script_play_victorious_sound"),
], [
(call_script, "script_count_mission_casualties_from_agents"),
(finish_mission, 1),
]),

(10.0, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_battle_won",1),
    (display_message, "str_msg_battle_won"),
(try_end),
]),

(1.0, 4.0, ti_once, [
(main_hero_fallen),
], [
(assign,"$pin_player_fallen",1),
(str_store_string,s5,"str_retreat"),
(call_script, "script_simulate_retreat", 10, 20, 1),
(assign,"$g_battle_result",-1),
(set_mission_result,-1),
(call_script, "script_count_mission_casualties_from_agents"),
(finish_mission, 0),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
], [
(display_message, "str_use_baggage_for_inventory"),
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (game_key_clicked, 22),
    (neg|is_presentation_active, "prsnt_battle"),
    (start_presentation, "prsnt_battle"),
(try_end),
]),

(0.1, 0.0, 0.0, [
], [
(try_begin),
    (is_presentation_active, "prsnt_battle"),
    (call_script, "script_update_order_panel_statistics_and_map"),
(try_end),
]),

]),
("village_raid", mtf_battle_mode|mtf_synch_inventory, 8,
"You lead your men to battle.",
[(3, mtef_defenders|mtef_team_0, af_override_horse, aif_start_alarmed, 12, []),
(3, mtef_defenders|mtef_team_0, 0, aif_start_alarmed, 0, []),
(1, mtef_attackers|mtef_team_1, 0, aif_start_alarmed, 12, []),
(1, mtef_attackers|mtef_team_1, 0, aif_start_alarmed, 0, []),
],
[
(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_battle_won",1),
    (call_script, "script_count_mission_casualties_from_agents"),
    (finish_mission, 0),
(else_try),
    (call_script, "script_cf_check_enemies_nearby"),
    (question_box,"str_do_you_want_to_retreat"),
(else_try),
    (display_message, "str_can_not_retreat"),
(try_end),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (assign,"$pin_player_fallen",0),
    (str_store_string,s5,"str_retreat"),
    (call_script, "script_simulate_retreat", 10, 20, 1),
    (call_script, "script_count_mission_casualties_from_agents"),
    (finish_mission, 0),
(try_end),
]),

(0.0, 0.0, ti_once, [
], [
(assign,"$g_battle_won",0),
(assign,"$defender_reinforcement_stage",0),
(assign,"$attacker_reinforcement_stage",0),
(call_script, "script_combat_music_set_situation_with_culture"),
]),

(30.0, 0.0, 0.0, [
], [
(call_script, "script_combat_music_set_situation_with_culture"),
]),

(2.0, 0.0, 0.0, [
], [
(call_script, "script_check_friendly_kills"),
]),

(1.0, 0.0, 5.0, [
(lt,"$defender_reinforcement_stage",2),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (ge,":m_timer_a_001",10),
    (try_begin),
        (lt,":normalized_team_count_002",6),
        (store_normalized_team_count,":normalized_team_count_002", 0),
    (try_end),
(try_end),
], [
(add_reinforcements_to_entry,0,6),
(val_add, "$defender_reinforcement_stage", 1),
]),

(1.0, 0.0, 5.0, [
(lt,"$attacker_reinforcement_stage",2),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (ge,":m_timer_a_001",10),
    (try_begin),
        (lt,":normalized_team_count_002",6),
        (store_normalized_team_count,":normalized_team_count_002", 1),
    (try_end),
(try_end),
], [
(add_reinforcements_to_entry,3,6),
(val_add, "$attacker_reinforcement_stage", 1),
]),

(1.0, 60.0, ti_once, [
(try_begin),
    (ge,reg1,10),
    (all_enemies_defeated),
    (neg|main_hero_fallen),
    (set_mission_result,1),
    (display_message, "str_msg_battle_won"),
    (assign,"$g_battle_won",1),
    (assign,"$g_battle_result",1),
    (try_begin),
        (eq,"$g_village_raid_evil",0),
        (call_script, "script_play_victorious_sound"),
    (else_try),
        (play_track,"track_victorious_evil", 1),
    (try_end),
], [
(call_script, "script_count_mission_casualties_from_agents"),
(finish_mission, 1),
]),

(10.0, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_battle_won",1),
    (display_message, "str_msg_battle_won"),
(try_end),
]),

(1.0, 4.0, ti_once, [
(main_hero_fallen),
], [
(assign,"$pin_player_fallen",1),
(str_store_string,s5,"str_retreat"),
(call_script, "script_simulate_retreat", 10, 20, 1),
(assign,"$g_battle_result",-1),
(set_mission_result,-1),
(call_script, "script_count_mission_casualties_from_agents"),
(finish_mission, 0),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
], [
(display_message, "str_use_baggage_for_inventory"),
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (game_key_clicked, 22),
    (neg|is_presentation_active, "prsnt_battle"),
    (start_presentation, "prsnt_battle"),
(try_end),
]),

(0.1, 0.0, 0.0, [
], [
(try_begin),
    (is_presentation_active, "prsnt_battle"),
    (call_script, "script_update_order_panel_statistics_and_map"),
(try_end),
]),

]),
("besiege_inner_battle_castle", mtf_battle_mode, -1,
"You attack the walls of the castle...",
[(0, mtef_attackers|mtef_team_1|mtef_use_exact_number, af_override_horse, aif_start_alarmed, 1, []),
(6, mtef_attackers|mtef_team_1|mtef_use_exact_number, af_override_horse, aif_start_alarmed, 1, []),
(7, mtef_attackers|mtef_team_1|mtef_use_exact_number, af_override_horse, aif_start_alarmed, 1, []),
(16, mtef_defenders|mtef_team_0|mtef_use_exact_number, af_override_horse, aif_start_alarmed, 1, []),
(17, mtef_defenders|mtef_team_0|mtef_use_exact_number, af_override_horse, aif_start_alarmed, 1, []),
(18, mtef_defenders|mtef_team_0|mtef_use_exact_number, af_override_horse, aif_start_alarmed, 1, []),
(19, mtef_defenders|mtef_team_0|mtef_use_exact_number, af_override_horse, aif_start_alarmed, 1, []),
(20, mtef_defenders|mtef_team_0|mtef_use_exact_number, af_override_horse, aif_start_alarmed, 1, []),
],
[
(ti_before_mission_start, 0.0, 0.0, [
], [
(call_script, "script_change_banners_and_chest"),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_battle_won",1),
    (call_script, "script_count_mission_casualties_from_agents"),
    (finish_mission, 0),
(else_try),
    (call_script, "script_cf_check_enemies_nearby"),
    (question_box,"str_do_you_want_to_retreat"),
(else_try),
    (display_message, "str_can_not_retreat"),
(try_end),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (assign,"$pin_player_fallen",0),
    (str_store_string,s5,"str_retreat"),
    (call_script, "script_simulate_retreat", 5, 20, 0),
    (assign,"$g_battle_result",-1),
    (set_mission_result,-1),
    (call_script, "script_count_mission_casualties_from_agents"),
    (finish_mission, 0),
(try_end),
]),

(0.0, 0.0, ti_once, [
], [
(assign,"$g_battle_won",0),
(call_script, "script_music_set_situation_with_culture", 4096),
]),

(0.0, 0.0, ti_once, [
(assign,"$attacker_team",1),
(assign,"$defender_team_2",2),
], [
]),

(2.0, 0.0, 0.0, [
], [
(call_script, "script_check_friendly_kills"),
]),

(1.0, 60.0, ti_once, [
(try_begin),
    (ge,reg1,10),
    (all_enemies_defeated),
    (neg|main_hero_fallen),
    (set_mission_result,1),
    (display_message, "str_msg_battle_won"),
    (assign,"$g_battle_won",1),
    (assign,"$g_battle_result",1),
    (call_script, "script_play_victorious_sound"),
], [
(call_script, "script_count_mission_casualties_from_agents"),
(finish_mission, 1),
]),

(10.0, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_battle_won",1),
    (display_message, "str_msg_battle_won"),
(try_end),
]),

(1.0, 4.0, ti_once, [
(main_hero_fallen),
], [
(assign,"$pin_player_fallen",1),
(str_store_string,s5,"str_retreat"),
(call_script, "script_simulate_retreat", 5, 20, 0),
(assign,"$g_battle_result",-1),
(set_mission_result,-1),
(call_script, "script_count_mission_casualties_from_agents"),
(finish_mission, 0),
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (game_key_clicked, 22),
    (neg|is_presentation_active, "prsnt_battle"),
    (start_presentation, "prsnt_battle"),
(try_end),
]),

(0.1, 0.0, 0.0, [
], [
(try_begin),
    (is_presentation_active, "prsnt_battle"),
    (call_script, "script_update_order_panel_statistics_and_map"),
(try_end),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
], [
(display_message, "str_use_baggage_for_inventory"),
]),

]),
("besiege_inner_battle_town_center", mtf_battle_mode, -1,
"You attack the walls of the castle...",
[(0, mtef_attackers|mtef_team_1|mtef_use_exact_number, af_override_horse, aif_start_alarmed, 4, []),
(2, mtef_defenders|mtef_team_0|mtef_use_exact_number, af_override_horse, aif_start_alarmed, 1, []),
(23, mtef_defenders|mtef_team_0|mtef_use_exact_number, af_override_horse, aif_start_alarmed, 1, []),
(24, mtef_defenders|mtef_team_0|mtef_use_exact_number, af_override_horse, aif_start_alarmed, 1, []),
(25, mtef_defenders|mtef_team_0|mtef_use_exact_number, af_override_horse, aif_start_alarmed, 1, []),
(26, mtef_defenders|mtef_team_0|mtef_use_exact_number, af_override_horse, aif_start_alarmed, 1, []),
(27, mtef_defenders|mtef_team_0|mtef_use_exact_number, af_override_horse, aif_start_alarmed, 1, []),
(28, mtef_defenders|mtef_team_0|mtef_use_exact_number, af_override_horse, aif_start_alarmed, 1, []),
],
[
(ti_before_mission_start, 0.0, 0.0, [
], [
(call_script, "script_change_banners_and_chest"),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_battle_won",1),
    (call_script, "script_count_mission_casualties_from_agents"),
    (finish_mission, 0),
(else_try),
    (call_script, "script_cf_check_enemies_nearby"),
    (question_box,"str_do_you_want_to_retreat"),
(else_try),
    (display_message, "str_can_not_retreat"),
(try_end),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (assign,"$pin_player_fallen",0),
    (str_store_string,s5,"str_retreat"),
    (call_script, "script_simulate_retreat", 5, 20, 0),
    (assign,"$g_battle_result",-1),
    (set_mission_result,-1),
    (call_script, "script_count_mission_casualties_from_agents"),
    (finish_mission, 0),
(try_end),
]),

(0.0, 0.0, ti_once, [
], [
(assign,"$g_battle_won",0),
(call_script, "script_music_set_situation_with_culture", 4096),
]),

(0.0, 0.0, ti_once, [
(assign,"$attacker_team",1),
(assign,"$defender_team_2",2),
], [
]),

(2.0, 0.0, 0.0, [
], [
(call_script, "script_check_friendly_kills"),
]),

(1.0, 60.0, ti_once, [
(try_begin),
    (ge,reg1,10),
    (all_enemies_defeated),
    (neg|main_hero_fallen),
    (set_mission_result,1),
    (display_message, "str_msg_battle_won"),
    (assign,"$g_battle_won",1),
    (assign,"$g_battle_result",1),
    (call_script, "script_play_victorious_sound"),
], [
(call_script, "script_count_mission_casualties_from_agents"),
(finish_mission, 1),
]),

(10.0, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_battle_won",1),
    (display_message, "str_msg_battle_won"),
(try_end),
]),

(1.0, 4.0, ti_once, [
(main_hero_fallen),
], [
(assign,"$pin_player_fallen",1),
(str_store_string,s5,"str_retreat"),
(call_script, "script_simulate_retreat", 5, 20, 0),
(assign,"$g_battle_result",-1),
(set_mission_result,-1),
(call_script, "script_count_mission_casualties_from_agents"),
(finish_mission, 0),
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (game_key_clicked, 22),
    (neg|is_presentation_active, "prsnt_battle"),
    (start_presentation, "prsnt_battle"),
(try_end),
]),

(0.1, 0.0, 0.0, [
], [
(try_begin),
    (is_presentation_active, "prsnt_battle"),
    (call_script, "script_update_order_panel_statistics_and_map"),
(try_end),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
], [
(display_message, "str_use_baggage_for_inventory"),
]),

]),
("castle_attack_walls_defenders_sally", mtf_battle_mode|mtf_synch_inventory, -1,
"You attack the walls of the castle...",
[(0, mtef_attackers|mtef_team_1, af_override_horse, aif_start_alarmed, 12, []),
(0, mtef_attackers|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
(3, mtef_defenders|mtef_team_0, af_override_horse, aif_start_alarmed, 12, []),
(3, mtef_defenders|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
],
[
(ti_on_agent_spawn, 0.0, 0.0, [
], [
(call_script, "script_agent_reassign_team", ":var001"),
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(team_set_relation, 0, 2, 1),
(team_set_relation, 1, 3, 1),
(call_script, "script_change_banners_and_chest"),
(call_script, "script_remove_siege_objects"),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_battle_won",1),
    (call_script, "script_count_mission_casualties_from_agents"),
    (finish_mission, 0),
(else_try),
    (call_script, "script_cf_check_enemies_nearby"),
    (question_box,"str_do_you_want_to_retreat"),
(else_try),
    (display_message, "str_can_not_retreat"),
(try_end),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(ti_on_agent_killed_or_wounded, 0.0, 0.0, [
], [
(try_begin),
    (ge,":var001",0),
    (neg|agent_is_ally,":var001"),
    (agent_is_human,":var001"),
    (agent_get_troop_id,":troop_id_004", ":var001"),
    (str_store_troop_name,s6,":troop_id_004"),
    (assign,reg0,":var001"),
    (assign,reg1,":var002"),
    (assign,reg2,":var003"),
    (agent_get_team, reg3, ":var001"),
    (party_add_members,"p_total_enemy_casualties",":troop_id_004",1),
    (try_begin),
        (eq,":var003",1),
        (party_wound_members,"p_total_enemy_casualties",":troop_id_004",1),
    (try_end),
(try_end),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (assign,"$pin_player_fallen",0),
    (str_store_string,s5,"str_retreat"),
    (call_script, "script_simulate_retreat", 5, 20, 0),
    (call_script, "script_count_mission_casualties_from_agents"),
    (finish_mission, 0),
(try_end),
]),

(0.0, 0.0, ti_once, [
], [
(assign,"$g_battle_won",0),
(call_script, "script_combat_music_set_situation_with_culture"),
]),

(30.0, 0.0, 0.0, [
], [
(call_script, "script_combat_music_set_situation_with_culture"),
]),

(2.0, 0.0, 0.0, [
], [
(call_script, "script_check_friendly_kills"),
]),

(1.0, 60.0, ti_once, [
(try_begin),
    (ge,reg1,10),
    (all_enemies_defeated),
    (neg|main_hero_fallen),
    (set_mission_result,1),
    (display_message, "str_msg_battle_won"),
    (assign,"$g_battle_won",1),
    (assign,"$g_battle_result",1),
    (assign,"$g_siege_sallied_out_once",1),
    (assign,"$g_siege_method",1),
    (call_script, "script_play_victorious_sound"),
], [
(call_script, "script_count_mission_casualties_from_agents"),
(finish_mission, 1),
]),

(10.0, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_battle_won",1),
    (display_message, "str_msg_battle_won"),
(try_end),
]),

(1.0, 4.0, ti_once, [
(main_hero_fallen),
], [
(assign,"$pin_player_fallen",1),
(str_store_string,s5,"str_retreat"),
(call_script, "script_simulate_retreat", 5, 20, 0),
(assign,"$g_battle_result",-1),
(set_mission_result,-1),
(call_script, "script_count_mission_casualties_from_agents"),
(finish_mission, 0),
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (game_key_clicked, 22),
    (neg|is_presentation_active, "prsnt_battle"),
    (start_presentation, "prsnt_battle"),
(try_end),
]),

(0.1, 0.0, 0.0, [
], [
(try_begin),
    (is_presentation_active, "prsnt_battle"),
    (call_script, "script_update_order_panel_statistics_and_map"),
(try_end),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
], [
(display_message, "str_use_baggage_for_inventory"),
]),

]),
("castle_attack_walls_belfry", mtf_battle_mode|mtf_synch_inventory, -1,
"You attack the walls of the castle...",
[(0, mtef_attackers|mtef_team_1, af_override_horse, aif_start_alarmed, 12, []),
(0, mtef_attackers|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
(10, mtef_defenders|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
(11, mtef_defenders|mtef_team_0, af_override_horse, aif_start_alarmed, 7, []),
(15, mtef_defenders|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
(40, mtef_defenders|mtef_team_0|mtef_archers_first, af_override_horse, aif_start_alarmed, 1, []),
(41, mtef_defenders|mtef_team_0|mtef_archers_first, af_override_horse, aif_start_alarmed, 1, []),
(42, mtef_defenders|mtef_team_0|mtef_archers_first, af_override_horse, aif_start_alarmed, 1, []),
(43, mtef_defenders|mtef_team_0|mtef_archers_first, af_override_horse, aif_start_alarmed, 1, []),
(44, mtef_defenders|mtef_team_0|mtef_archers_first, af_override_horse, aif_start_alarmed, 1, []),
(45, mtef_defenders|mtef_team_0|mtef_archers_first, af_override_horse, aif_start_alarmed, 1, []),
(46, mtef_defenders|mtef_team_0|mtef_archers_first, af_override_horse, aif_start_alarmed, 1, []),
(47, mtef_defenders|mtef_team_0|mtef_archers_first, af_override_horse, aif_start_alarmed, 1, []),
],
[
(ti_before_mission_start, 0.0, 0.0, [
], [
(team_set_relation, 0, 2, 1),
(team_set_relation, 1, 3, 1),
(call_script, "script_change_banners_and_chest"),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_battle_won",1),
    (call_script, "script_count_mission_casualties_from_agents"),
    (finish_mission, 0),
(else_try),
    (call_script, "script_cf_check_enemies_nearby"),
    (question_box,"str_do_you_want_to_retreat"),
(else_try),
    (display_message, "str_can_not_retreat"),
(try_end),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (assign,"$pin_player_fallen",0),
    (get_player_agent_no,":agent_no_002"),
    (agent_get_team, ":agent_team_no_003", ":agent_no_002"),
    (try_begin),
        (neq,"$attacker_team",":agent_team_no_003"),
        (neq,"$attacker_team_2",":agent_team_no_003"),
        (str_store_string,s5,"str_siege_continues"),
        (call_script, "script_simulate_retreat", 8, 15, 0),
    (else_try),
        (str_store_string,s5,"str_retreat"),
        (call_script, "script_simulate_retreat", 5, 20, 0),
    (try_end),
(try_end),
(call_script, "script_count_mission_casualties_from_agents"),
(finish_mission, 0),
]),

(0.0, 0.0, ti_once, [
], [
(assign,"$g_battle_won",0),
(assign,"$defender_reinforcement_stage",0),
(assign,"$attacker_reinforcement_stage",0),
(call_script, "script_music_set_situation_with_culture", 262144),
]),

(30.0, 0.0, 0.0, [
], [
(call_script, "script_combat_music_set_situation_with_culture"),
]),

(0.0, 0.0, ti_once, [
(assign,"$attacker_team",1),
(assign,"$defender_team_2",2),
], [
]),

(0.0, 0.0, ti_once, [
(entry_point_get_position, pos10, 10),
(try_for_range, ":var001", 0, 9),
    (try_begin),
        (neq,":var001",1),
        (team_give_order, "$defender_team", ":var001", 0),
        (team_give_order, "$defender_team", ":var001", 7),
        (team_give_order, "$defender_team", ":var001", 7),
        (team_give_order, "$defender_team_2", ":var001", 0),
        (team_give_order, "$defender_team_2", ":var001", 7),
        (team_give_order, "$defender_team_2", ":var001", 7),
    (try_end),
(try_end),
(team_give_order, "$defender_team", 1, 11),
(team_set_order_position, "$defender_team", 9, 10),
(team_give_order, "$defender_team_2", 1, 11),
(team_set_order_position, "$defender_team_2", 9, 10),
], [
]),

(0.0, 0.0, ti_once, [
(team_give_order, "$attacker_team", 9, 8),
(team_give_order, "$attacker_team", 9, 8),
(team_give_order, "$attacker_team", 9, 8),
], [
]),

(ti_on_agent_killed_or_wounded, 0.0, 0.0, [
], [
(try_begin),
    (ge,":var001",0),
    (neg|agent_is_ally,":var001"),
    (agent_is_human,":var001"),
    (agent_get_troop_id,":troop_id_004", ":var001"),
    (str_store_troop_name,s6,":troop_id_004"),
    (assign,reg0,":var001"),
    (assign,reg1,":var002"),
    (assign,reg2,":var003"),
    (agent_get_team, reg3, ":var001"),
    (party_add_members,"p_total_enemy_casualties",":troop_id_004",1),
    (try_begin),
        (eq,":var003",1),
        (party_wound_members,"p_total_enemy_casualties",":troop_id_004",1),
    (try_end),
(try_end),
]),

(0.0, 2.0, ti_once, [
], [
(try_for_agents, ":cur_agent"),
    (agent_set_slot,":cur_agent",5,1),
(try_end),
]),

(3.0, 0.0, 5.0, [
], [
(try_begin),
    (lt,"$defender_reinforcement_stage",7),
    (store_mission_timer_a,":m_timer_a_001"),
    (try_begin),
        (ge,":m_timer_a_001",10),
        (store_normalized_team_count,":normalized_team_count_002", 0),
        (try_begin),
            (lt,":normalized_team_count_002",8),
            (add_reinforcements_to_entry,4,7),
            (val_add, "$defender_reinforcement_stage", 1),
            (try_begin),
                (gt,":m_timer_a_001",300),
                (get_player_agent_no,":agent_no_003"),
                (agent_get_team, ":agent_team_no_004", ":agent_no_003"),
                (try_begin),
                    (neq,":agent_team_no_004","$defender_team"),
                    (neq,":agent_team_no_004","$defender_team_2"),
                    (ge,"$defender_reinforcement_stage",2),
                    (set_show_messages,0),
                    (team_give_order, "$defender_team", 0, 2),
                    (team_give_order, "$defender_team_2", 0, 2),
                    (team_give_order, "$defender_team", 2, 2),
                    (team_give_order, "$defender_team_2", 2, 2),
                    (set_show_messages,1),
                    (try_begin),
                        (ge,"$defender_reinforcement_stage",4),
                        (set_show_messages,0),
                        (team_give_order, "$defender_team", 9, 2),
                        (team_give_order, "$defender_team_2", 9, 2),
                        (set_show_messages,1),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(2.0, 0.0, 0.0, [
(gt,"$defender_reinforcement_stage",0),
], [
(call_script, "script_siege_move_archers_to_archer_positions"),
]),

(1.0, 0.0, 5.0, [
(lt,"$attacker_reinforcement_stage",5),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (ge,":m_timer_a_001",10),
    (try_begin),
        (lt,":normalized_team_count_002",6),
        (store_normalized_team_count,":normalized_team_count_002", 1),
    (try_end),
(try_end),
], [
(add_reinforcements_to_entry,1,8),
(val_add, "$attacker_reinforcement_stage", 1),
]),

(5.0, 0.0, 0.0, [
], [
(try_for_agents, ":cur_agent"),
    (try_begin),
        (agent_is_human,":cur_agent"),
        (agent_is_alive,":cur_agent"),
        (agent_get_team, ":agent_team_no_002", ":cur_agent"),
        (try_begin),
            (this_or_next|eq,":agent_team_no_002","$attacker_team_2"),
            (eq,":agent_team_no_002","$attacker_team"),
            (agent_ai_set_always_attack_in_melee, ":cur_agent",1),
        (try_end),
    (try_end),
(try_end),
]),

(2.0, 0.0, 0.0, [
], [
(call_script, "script_check_friendly_kills"),
]),

(1.0, 60.0, ti_once, [
(try_begin),
    (ge,reg1,10),
    (all_enemies_defeated),
    (neg|main_hero_fallen),
    (set_mission_result,1),
    (display_message, "str_msg_battle_won"),
    (assign,"$g_battle_won",1),
    (assign,"$g_battle_result",1),
    (call_script, "script_play_victorious_sound"),
], [
(call_script, "script_count_mission_casualties_from_agents"),
(finish_mission, 1),
]),

(10.0, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_battle_won",1),
    (display_message, "str_msg_battle_won"),
(try_end),
]),

(120.0, 0.0, 0.0, [
], [
(get_player_agent_no,":agent_no_001"),
(try_for_agents, ":cur_agent"),
    (try_begin),
        (neq,":cur_agent",":agent_no_001"),
        (agent_is_alive,":cur_agent"),
        (agent_is_human,":cur_agent"),
        (agent_get_team, ":agent_team_no_003", ":cur_agent"),
        (try_begin),
            (this_or_next|eq,":agent_team_no_003","$defender_team_2"),
            (eq,":agent_team_no_003","$defender_team"),
            (agent_refill_ammo,":cur_agent"),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, 4.0, ti_once, [
(main_hero_fallen),
], [
(assign,"$pin_player_fallen",1),
(get_player_agent_no,":agent_no_001"),
(agent_get_team, ":agent_team_no_002", ":agent_no_001"),
(try_begin),
    (neq,"$attacker_team",":agent_team_no_002"),
    (neq,"$attacker_team_2",":agent_team_no_002"),
    (str_store_string,s5,"str_siege_continues"),
    (call_script, "script_simulate_retreat", 8, 15, 0),
(else_try),
    (str_store_string,s5,"str_retreat"),
    (call_script, "script_simulate_retreat", 5, 20, 0),
(try_end),
(assign,"$g_battle_result",-1),
(set_mission_result,-1),
(call_script, "script_count_mission_casualties_from_agents"),
(finish_mission, 0),
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (game_key_clicked, 22),
    (neg|is_presentation_active, "prsnt_battle"),
    (start_presentation, "prsnt_battle"),
(try_end),
]),

(0.1, 0.0, 0.0, [
], [
(try_begin),
    (is_presentation_active, "prsnt_battle"),
    (call_script, "script_update_order_panel_statistics_and_map"),
(try_end),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_now"),
], [
]),

(0.0, 0.0, ti_once, [
(call_script, "script_siege_init_ai_and_belfry"),
], [
]),

(0.0, 0.0, ti_once, [
(call_script,"script_cf_siege_move_belfry"),
], [
]),

(0.0, 2.0, ti_once, [
(call_script,"script_cf_siege_rotate_belfry_platform"),
], [
(assign,"$belfry_positioned",3),
]),

(0.0, 0.0, ti_once, [
(call_script,"script_cf_siege_assign_men_to_belfry"),
], [
]),

]),
("castle_attack_walls_ladder", mtf_battle_mode|mtf_synch_inventory, -1,
"You attack the walls of the castle...",
[(0, mtef_attackers|mtef_team_1, af_override_horse, aif_start_alarmed, 12, []),
(0, mtef_attackers|mtef_team_1, af_override_horse, aif_start_alarmed, 0, []),
(10, mtef_defenders|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
(11, mtef_defenders|mtef_team_0, af_override_horse, aif_start_alarmed, 7, []),
(15, mtef_defenders|mtef_team_0, af_override_horse, aif_start_alarmed, 0, []),
(40, mtef_defenders|mtef_team_0|mtef_archers_first, af_override_horse, aif_start_alarmed, 1, []),
(41, mtef_defenders|mtef_team_0|mtef_archers_first, af_override_horse, aif_start_alarmed, 1, []),
(42, mtef_defenders|mtef_team_0|mtef_archers_first, af_override_horse, aif_start_alarmed, 1, []),
(43, mtef_defenders|mtef_team_0|mtef_archers_first, af_override_horse, aif_start_alarmed, 1, []),
(44, mtef_defenders|mtef_team_0|mtef_archers_first, af_override_horse, aif_start_alarmed, 1, []),
(45, mtef_defenders|mtef_team_0|mtef_archers_first, af_override_horse, aif_start_alarmed, 1, []),
(46, mtef_defenders|mtef_team_0|mtef_archers_first, af_override_horse, aif_start_alarmed, 1, []),
],
[
(ti_before_mission_start, 0.0, 0.0, [
], [
(team_set_relation, 0, 2, 1),
(team_set_relation, 1, 3, 1),
(call_script, "script_change_banners_and_chest"),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_battle_won",1),
    (call_script, "script_count_mission_casualties_from_agents"),
    (finish_mission, 0),
(else_try),
    (call_script, "script_cf_check_enemies_nearby"),
    (question_box,"str_do_you_want_to_retreat"),
(else_try),
    (display_message, "str_can_not_retreat"),
(try_end),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (assign,"$pin_player_fallen",0),
    (get_player_agent_no,":agent_no_002"),
    (agent_get_team, ":agent_team_no_003", ":agent_no_002"),
    (try_begin),
        (neq,"$attacker_team",":agent_team_no_003"),
        (neq,"$attacker_team_2",":agent_team_no_003"),
        (str_store_string,s5,"str_siege_continues"),
        (call_script, "script_simulate_retreat", 8, 15, 0),
    (else_try),
        (str_store_string,s5,"str_retreat"),
        (call_script, "script_simulate_retreat", 5, 20, 0),
    (try_end),
(try_end),
(call_script, "script_count_mission_casualties_from_agents"),
(finish_mission, 0),
]),

(0.0, 0.0, ti_once, [
], [
(assign,"$g_battle_won",0),
(assign,"$defender_reinforcement_stage",0),
(assign,"$attacker_reinforcement_stage",0),
(call_script, "script_music_set_situation_with_culture", 262144),
]),

(30.0, 0.0, 0.0, [
], [
(call_script, "script_combat_music_set_situation_with_culture"),
]),

(0.0, 0.0, ti_once, [
(assign,"$attacker_team",1),
(assign,"$defender_team_2",2),
], [
]),

(0.0, 0.0, ti_once, [
(entry_point_get_position, pos10, 10),
(try_for_range, ":var001", 0, 9),
    (try_begin),
        (neq,":var001",1),
        (team_give_order, "$defender_team", ":var001", 0),
        (team_give_order, "$defender_team", ":var001", 7),
        (team_give_order, "$defender_team", ":var001", 7),
        (team_give_order, "$defender_team_2", ":var001", 0),
        (team_give_order, "$defender_team_2", ":var001", 7),
        (team_give_order, "$defender_team_2", ":var001", 7),
    (try_end),
(try_end),
(team_give_order, "$defender_team", 1, 11),
(team_set_order_position, "$defender_team", 9, 10),
(team_give_order, "$defender_team_2", 1, 11),
(team_set_order_position, "$defender_team_2", 9, 10),
], [
]),

(0.0, 2.0, ti_once, [
], [
(try_for_agents, ":cur_agent"),
    (agent_set_slot,":cur_agent",5,1),
(try_end),
]),

(3.0, 0.0, 5.0, [
], [
(try_begin),
    (lt,"$defender_reinforcement_stage",7),
    (store_mission_timer_a,":m_timer_a_001"),
    (try_begin),
        (ge,":m_timer_a_001",10),
        (store_normalized_team_count,":normalized_team_count_002", 0),
        (try_begin),
            (lt,":normalized_team_count_002",8),
            (add_reinforcements_to_entry,4,7),
            (val_add, "$defender_reinforcement_stage", 1),
            (try_begin),
                (gt,":m_timer_a_001",300),
                (get_player_agent_no,":agent_no_003"),
                (agent_get_team, ":agent_team_no_004", ":agent_no_003"),
                (try_begin),
                    (neq,":agent_team_no_004","$defender_team"),
                    (neq,":agent_team_no_004","$defender_team_2"),
                    (ge,"$defender_reinforcement_stage",2),
                    (set_show_messages,0),
                    (team_give_order, "$defender_team", 0, 2),
                    (team_give_order, "$defender_team_2", 0, 2),
                    (team_give_order, "$defender_team", 2, 2),
                    (team_give_order, "$defender_team_2", 2, 2),
                    (set_show_messages,1),
                    (try_begin),
                        (ge,"$defender_reinforcement_stage",4),
                        (set_show_messages,0),
                        (team_give_order, "$defender_team", 9, 2),
                        (team_give_order, "$defender_team_2", 9, 2),
                        (set_show_messages,1),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(2.0, 0.0, 0.0, [
(gt,"$defender_reinforcement_stage",0),
], [
(call_script, "script_siege_move_archers_to_archer_positions"),
]),

(1.0, 0.0, 5.0, [
(lt,"$attacker_reinforcement_stage",5),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (ge,":m_timer_a_001",10),
    (try_begin),
        (lt,":normalized_team_count_002",6),
        (store_normalized_team_count,":normalized_team_count_002", 1),
    (try_end),
(try_end),
], [
(add_reinforcements_to_entry,1,8),
(val_add, "$attacker_reinforcement_stage", 1),
]),

(5.0, 0.0, 0.0, [
], [
(try_for_agents, ":cur_agent"),
    (try_begin),
        (agent_is_human,":cur_agent"),
        (agent_is_alive,":cur_agent"),
        (agent_get_team, ":agent_team_no_002", ":cur_agent"),
        (try_begin),
            (this_or_next|eq,":agent_team_no_002","$attacker_team_2"),
            (eq,":agent_team_no_002","$attacker_team"),
            (agent_ai_set_always_attack_in_melee, ":cur_agent",1),
        (try_end),
    (try_end),
(try_end),
]),

(2.0, 0.0, 0.0, [
], [
(call_script, "script_check_friendly_kills"),
]),

(1.0, 60.0, ti_once, [
(try_begin),
    (ge,reg1,10),
    (all_enemies_defeated),
    (neg|main_hero_fallen),
    (set_mission_result,1),
    (display_message, "str_msg_battle_won"),
    (assign,"$g_battle_won",1),
    (assign,"$g_battle_result",1),
    (call_script, "script_play_victorious_sound"),
], [
(call_script, "script_count_mission_casualties_from_agents"),
(finish_mission, 1),
]),

(10.0, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_battle_won",1),
    (display_message, "str_msg_battle_won"),
(try_end),
]),

(120.0, 0.0, 0.0, [
], [
(get_player_agent_no,":agent_no_001"),
(try_for_agents, ":cur_agent"),
    (try_begin),
        (neq,":cur_agent",":agent_no_001"),
        (agent_is_alive,":cur_agent"),
        (agent_is_human,":cur_agent"),
        (agent_get_team, ":agent_team_no_003", ":cur_agent"),
        (try_begin),
            (this_or_next|eq,":agent_team_no_003","$defender_team_2"),
            (eq,":agent_team_no_003","$defender_team"),
            (agent_refill_ammo,":cur_agent"),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, 4.0, ti_once, [
(main_hero_fallen),
], [
(assign,"$pin_player_fallen",1),
(get_player_agent_no,":agent_no_001"),
(agent_get_team, ":agent_team_no_002", ":agent_no_001"),
(try_begin),
    (neq,"$attacker_team",":agent_team_no_002"),
    (neq,"$attacker_team_2",":agent_team_no_002"),
    (str_store_string,s5,"str_siege_continues"),
    (call_script, "script_simulate_retreat", 8, 15, 0),
(else_try),
    (str_store_string,s5,"str_retreat"),
    (call_script, "script_simulate_retreat", 5, 20, 0),
(try_end),
(assign,"$g_battle_result",-1),
(set_mission_result,-1),
(call_script, "script_count_mission_casualties_from_agents"),
(finish_mission, 0),
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (game_key_clicked, 22),
    (neg|is_presentation_active, "prsnt_battle"),
    (start_presentation, "prsnt_battle"),
(try_end),
]),

(0.1, 0.0, 0.0, [
], [
(try_begin),
    (is_presentation_active, "prsnt_battle"),
    (call_script, "script_update_order_panel_statistics_and_map"),
(try_end),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_now"),
], [
]),

(ti_on_agent_killed_or_wounded, 0.0, 0.0, [
], [
(try_begin),
    (ge,":var001",0),
    (neg|agent_is_ally,":var001"),
    (agent_is_human,":var001"),
    (agent_get_troop_id,":troop_id_004", ":var001"),
    (str_store_troop_name,s6,":troop_id_004"),
    (assign,reg0,":var001"),
    (assign,reg1,":var002"),
    (assign,reg2,":var003"),
    (agent_get_team, reg3, ":var001"),
    (party_add_members,"p_total_enemy_casualties",":troop_id_004",1),
    (try_begin),
        (eq,":var003",1),
        (party_wound_members,"p_total_enemy_casualties",":troop_id_004",1),
    (try_end),
(try_end),
]),

]),
("castle_visit", 0, -1,
"Castle visit",
[(0, mtef_scene_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_horse, 0, 1, [itm_pilgrim_hood,itm_pilgrim_disguise,itm_practice_staff,itm_throwing_daggers,]),
(1, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood,itm_pilgrim_disguise,itm_practice_staff,itm_throwing_daggers,]),
(2, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood,itm_pilgrim_disguise,itm_practice_staff,itm_throwing_daggers,]),
(3, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood,itm_pilgrim_disguise,itm_practice_staff,itm_throwing_daggers,]),
(4, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood,itm_pilgrim_disguise,itm_practice_staff,itm_throwing_daggers,]),
(5, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood,itm_pilgrim_disguise,itm_practice_staff,itm_throwing_daggers,]),
(6, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood,itm_pilgrim_disguise,itm_practice_staff,itm_throwing_daggers,]),
(7, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, [itm_pilgrim_hood,itm_pilgrim_disguise,itm_practice_staff,itm_throwing_daggers,]),
(8, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(9, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(10, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(11, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(12, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(13, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(14, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(15, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(16, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(17, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(18, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(19, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(20, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(21, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(22, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(23, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(24, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(25, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(26, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(27, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(28, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(29, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(30, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(31, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(32, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(33, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(34, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(35, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(36, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(37, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(38, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(39, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(40, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(41, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(42, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(43, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(44, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(45, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(46, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
],
[
(ti_on_agent_spawn, 0.0, 0.0, [
], [
(call_script, "script_init_town_agent", ":var001"),
(get_player_agent_no,":agent_no_002"),
(try_begin),
    (neq,":agent_no_002",":var001"),
    (agent_set_team, ":var001", 7),
(try_end),
(try_begin),
    (this_or_next|eq,"$talk_context",18),
    (eq,"$talk_context",19),
    (agent_get_troop_id,":troop_id_003", ":var001"),
    (troop_get_slot,":troop_slot_004",":troop_id_003",161),
    (try_begin),
        (eq,":troop_slot_004",1),
        (agent_set_team, ":var001", 0),
        (agent_ai_set_aggressiveness, ":var001", 5),
        (troop_set_slot,":troop_id_003",161,0),
        (try_begin),
            (troop_slot_eq,":troop_id_003",149,3),
            (agent_get_position,pos1,":var001"),
            (agent_set_scripted_destination,":var001",1),
        (try_end),
    (try_end),
(try_end),
]),

(ti_on_agent_killed_or_wounded, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_003", ":var001"),
(agent_get_troop_id,":troop_id_004", ":var002"),
(try_begin),
    (this_or_next|eq,":troop_id_003","trp_swadian_prison_guard"),
    (this_or_next|eq,":troop_id_003","trp_vaegir_prison_guard"),
    (this_or_next|eq,":troop_id_003","trp_khergit_prison_guard"),
    (this_or_next|eq,":troop_id_003","trp_nord_prison_guard"),
    (this_or_next|eq,":troop_id_003","trp_rhodok_prison_guard"),
    (eq,":troop_id_003","trp_sarranid_prison_guard"),
    (eq,":troop_id_004","trp_player"),
    (display_message, "@@You got keys of dungeon."),
(try_end),
]),

(1.0, 0.0, 0.0, [
(this_or_next|eq,"$talk_context",19),
(eq,"$talk_context",18),
], [
(call_script, "script_neutral_behavior_in_fight"),
(mission_disable_talk),
]),

(1.0, 0.0, ti_once, [
(eq,"$talk_context",19),
], [
(get_player_agent_no,":agent_no_001"),
(assign,reg6,":agent_no_001"),
(call_script, "script_activate_town_guard"),
(get_player_agent_no,":agent_no_001"),
(agent_get_position,pos4,":agent_no_001"),
(try_for_range, ":trp_002", "trp_npc1", "trp_heroes_end"),
    (try_begin),
        (troop_slot_ge,":trp_002",149,1),
        (str_store_troop_name,s4,":trp_002"),
        (display_message, "str_s4_joins_prison_break"),
        (store_current_scene,":cur_scene_003"),
        (modify_visitors_at_site,":cur_scene_003"),
        (store_current_scene,":cur_scene_003"),
        (modify_visitors_at_site,":cur_scene_003"),
        (assign,":entry_no_004",24),
        (add_visitors_to_current_scene,":entry_no_004",":trp_002",1, 0, 0),
        (troop_set_slot,":trp_002",161,1),
    (try_end),
(try_end),
]),

(ti_tab_pressed, 0.0, 0.0, [
(this_or_next|eq,"$talk_context",18),
(eq,"$talk_context",19),
(display_message, "str_cannot_leave_now"),
(else_try),
(this_or_next|eq,"$g_mt_mode",1),
(eq,"$g_mt_mode",0),
(set_trigger_result, 1),
(mission_enable_talk),
(else_try),
(display_message, "str_cannot_leave_now"),
], [
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(call_script, "script_change_banners_and_chest"),
(call_script, "script_remove_siege_objects"),
]),

(3.0, 0.0, 0.0, [
(main_hero_fallen),
], [
(try_begin),
    (this_or_next|eq,"$talk_context",19),
    (eq,"$talk_context",18),
    (call_script, "script_deduct_casualties_from_garrison"),
    (jump_to_menu,"mnu_captivity_start_castle_defeat"),
    (assign,":var001","trp_heroes_end"),
    (try_for_range, ":troop_id_002", "trp_npc1", ":var001"),
        (troop_set_slot,":troop_id_002",149,0),
    (try_end),
    (mission_enable_talk),
    (finish_mission, 0),
(else_try),
    (mission_enable_talk),
    (finish_mission, 0),
    (set_trigger_result, 1),
(try_end),
]),

(3.0, 0.0, 0.0, [
(eq,"$talk_context",19),
(neg|main_hero_fallen),
(try_begin),
    (ge,":m_timer_a_001",10),
    (all_enemies_defeated),
    (store_mission_timer_a,":m_timer_a_001"),
(try_end),
], [
(call_script, "script_deduct_casualties_from_garrison"),
(try_for_agents, ":m_timer_a_001"),
    (agent_get_troop_id,":troop_id_002", ":m_timer_a_001"),
    (try_begin),
        (troop_slot_ge,":troop_id_002",149,2),
        (try_begin),
            (agent_is_alive,":m_timer_a_001"),
            (troop_set_slot,":troop_id_002",149,4),
        (else_try),
            (troop_set_slot,":troop_id_002",149,5),
        (try_end),
    (try_end),
(try_end),
(jump_to_menu,"mnu_sneak_into_town_caught_ran_away"),
(mission_enable_talk),
(finish_mission, 0),
]),

]),
("training_ground_trainer_talk", 0, -1,
"Training.",
[(0, mtef_scene_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse, 0, 1, []),
(1, mtef_scene_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse, 0, 1, []),
(2, mtef_scene_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse, 0, 1, []),
(3, mtef_scene_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse, 0, 1, []),
(4, mtef_scene_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse, 0, 1, []),
(5, mtef_scene_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse, 0, 1, []),
(6, mtef_scene_source|mtef_team_0, 0, 0, 1, []),
],
[
(ti_before_mission_start, 0.0, 0.0, [
], [
(call_script, "script_change_banners_and_chest"),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(set_trigger_result, 1),
], [
]),

(ti_tab_pressed, 0.0, 0.0, [
(set_trigger_result, 1),
], [
]),

(0.0, 1.0, 2.0, [
(lt,"$trainer_help_message",2),
], [
(try_begin),
    (eq,"$trainer_help_message",0),
(else_try),
(try_end),
(val_add, "$trainer_help_message", 1),
]),

]),
("training_ground_trainer_training", mtf_arena_fight|mtf_team_fight, -1,
"You will fight a match in the arena.",
[(16, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_foot|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all|af_override_everything, aif_start_alarmed, 1, [itm_practice_shield,itm_practice_sword,itm_practice_boots,]),
(17, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_foot|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all|af_override_everything, aif_start_alarmed, 1, [itm_practice_staff,itm_practice_boots,]),
(18, mtef_visitor_source|mtef_team_0|mtef_team_1|mtef_team_2, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_foot|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all|af_override_everything, aif_start_alarmed, 1, [itm_practice_staff,itm_practice_boots,]),
(19, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_foot|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all|af_override_everything, aif_start_alarmed, 1, [itm_heavy_practice_sword,itm_practice_boots,]),
(20, mtef_visitor_source, 0, 0, 1, []),
],
[
(ti_before_mission_start, 0.0, 0.0, [
], [
(call_script, "script_change_banners_and_chest"),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(question_box,"str_give_up_fight"),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (set_jump_mission,"mt_training_ground_trainer_talk"),
    (modify_visitors_at_site,"$g_training_ground_melee_training_scene"),
    (reset_visitors),
    (set_jump_entry,5),
    (jump_to_scene,"$g_training_ground_melee_training_scene"),
(try_end),
]),

(1.0, 3.0, ti_once, [
(main_hero_fallen),
], [
(set_jump_mission,"mt_training_ground_trainer_talk"),
(modify_visitors_at_site,"$g_training_ground_melee_training_scene"),
(reset_visitors),
(set_jump_entry,5),
(jump_to_scene,"$g_training_ground_melee_training_scene"),
]),

(1.0, 3.0, ti_once, [
(try_begin),
    (ge,reg1,1),
    (num_active_teams_le,1),
    (neg|main_hero_fallen),
    (assign,"$training_fight_won",1),
], [
(set_jump_mission,"mt_training_ground_trainer_talk"),
(modify_visitors_at_site,"$g_training_ground_melee_training_scene"),
(reset_visitors),
(set_jump_entry,5),
(jump_to_scene,"$g_training_ground_melee_training_scene"),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_arena"),
], [
]),

]),
("training_ground_training", mtf_arena_fight|mtf_team_fight, -1,
"Training.",
[(0, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_foot|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all|af_override_everything, aif_start_alarmed, 1, [itm_practice_staff,]),
(1, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_foot|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all|af_override_everything, aif_start_alarmed, 1, [itm_practice_staff,]),
(2, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_foot|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all|af_override_everything, aif_start_alarmed, 1, [itm_practice_staff,]),
(3, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_foot|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all|af_override_everything, aif_start_alarmed, 1, [itm_practice_staff,]),
(4, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_foot|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all|af_override_everything, aif_start_alarmed, 1, [itm_practice_staff,]),
(8, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_horse, 0, 1, []),
(9, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_horse, 0, 1, []),
(10, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_horse, 0, 1, []),
(11, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_horse, 0, 1, []),
(12, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_horse, 0, 1, []),
(13, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_horse, 0, 1, []),
(14, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_horse, 0, 1, []),
(15, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_horse, 0, 1, []),
],
[
(ti_before_mission_start, 0.0, 0.0, [
], [
(assign,"$g_last_destroyed_gourds",0),
(call_script, "script_change_banners_and_chest"),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(question_box,"str_give_up_fight"),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (assign,"$g_training_ground_training_success_ratio",0),
    (jump_to_menu,"mnu_training_ground_training_result"),
    (finish_mission, ":"),
(try_end),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_now"),
], [
]),

(0.0, 0.0, ti_once, [
(eq,"$g_mt_mode",2),
(set_fixed_point_multiplier, 100),
(entry_point_get_position, pos1, 0),
(init_position,2),
(position_set_y,2,"$g_training_ground_ranged_distance"),
(position_transform_position_to_parent,3,1,2),
(copy_position,1,3),
(assign,":var001",10),
(assign,":var002",0),
(try_for_range, ":var003", 0, ":var001"),
    (store_sub, ":var004", ":var003", ":var002"),
    (scene_prop_get_instance, ":scp_instance_005", "spr_gourd", ":var004"),
    (copy_position,2,1),
    (init_position,0),
    (store_random_in_range,":random_x_006",0,360),
    (position_rotate_z,2,":random_x_006"),
    (store_random_in_range,":random_x_006",50,600),
    (position_move_x,2,":random_x_006"),
    (store_random_in_range,":random_x_006",0,360),
    (position_transform_position_to_local, 3,1,2),
    (position_rotate_z,0,":random_x_006"),
    (position_transform_position_to_parent,4,0,3),
    (position_transform_position_to_parent,2,1,4),
    (position_set_z_to_ground_level, 2),
    (position_move_z,2,150),
    (assign,":var007",1),
    (try_for_range, ":var008", 0, 10),
        (try_begin),
            (eq,":var007",1),
            (neq,":var004",":var008"),
            (scene_prop_get_instance, ":scp_instance_009", "spr_gourd", ":var008"),
            (prop_instance_get_position, pos3, ":scp_instance_009"),
            (get_distance_between_positions,":distance_010",2,3),
            (try_begin),
                (lt,":distance_010",100),
                (assign,":var007",0),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var007",0),
        (val_add, ":var001", 1),
        (val_add, ":var002", 1),
    (else_try),
        (prop_instance_set_position, ":scp_instance_005", 2),
        (prop_instance_animate_to_position, ":scp_instance_005", 2, 1),
        (scene_prop_get_instance, ":scp_instance_009", "spr_gourd_spike", ":var004"),
        (position_move_z,2,-150),
        (prop_instance_set_position, ":scp_instance_009", 2),
        (prop_instance_animate_to_position, ":scp_instance_009", 2, 1),
    (try_end),
(try_end),
(else_try),
(eq,"$g_mt_mode",3),
(assign,":var011",0),
(try_for_range, ":var003", 0, 100),
    (scene_prop_get_instance, ":scp_instance_005", "spr_gourd", ":var003"),
    (scene_prop_get_instance, ":scp_instance_009", "spr_gourd_spike", ":var003"),
    (try_begin),
        (ge,":scp_instance_005",0),
        (ge,":scp_instance_009",0),
        (val_add, ":var011", 1),
        (prop_instance_get_position, pos0, ":scp_instance_009"),
        (position_move_z,0,150),
        (prop_instance_set_position, ":scp_instance_005", 0),
        (prop_instance_animate_to_position, ":scp_instance_005", 0, 1),
    (try_end),
(try_end),
(store_sub, ":var001", ":var011", "$g_training_ground_training_num_gourds_to_destroy"),
(try_for_range, ":var003", 0, ":var001"),
    (store_random_in_range,":random_x_012",0,":var011"),
    (scene_prop_get_instance, ":scp_instance_005", "spr_gourd", ":random_x_012"),
    (prop_instance_get_position, pos0, ":scp_instance_005"),
    (position_get_z,":pos_z_013",0),
    (try_begin),
        (lt,":pos_z_013",-50000),
    (else_try),
        (position_set_z,0,-100000),
        (prop_instance_set_position, ":scp_instance_005", 0),
        (prop_instance_animate_to_position, ":scp_instance_005", 0, 1),
        (scene_prop_get_instance, ":scp_instance_009", "spr_gourd_spike", ":random_x_012"),
        (prop_instance_set_position, ":scp_instance_009", 0),
        (prop_instance_animate_to_position, ":scp_instance_009", 0, 1),
    (try_end),
(try_end),
], [
]),

(1.0, 3.0, ti_once, [
(eq,"$g_mt_mode",1),
(this_or_next|main_hero_fallen),
(num_active_teams_le,1),
], [
(try_begin),
    (neg|main_hero_fallen),
    (assign,"$g_training_ground_training_success_ratio",100),
(else_try),
    (assign,":var001",0),
    (try_for_agents, ":cur_agent"),
        (try_begin),
            (agent_is_alive,":cur_agent"),
            (agent_is_human,":cur_agent"),
            (agent_get_team, ":agent_team_no_003", ":cur_agent"),
            (try_begin),
                (eq,":agent_team_no_003",1),
                (val_add, ":var001", 1),
            (try_end),
        (try_end),
    (try_end),
    (store_sub, ":var004", "$g_training_ground_training_num_enemies", ":var001"),
    (store_mul, ":_g_training_ground_training_success_ratio", ":var004", 100),
    (val_div, "$g_training_ground_training_success_ratio", "$g_training_ground_training_num_enemies"),
(try_end),
(jump_to_menu,"mnu_training_ground_training_result"),
(finish_mission, ":"),
]),

(1.0, 3.0, ti_once, [
(eq,"$g_mt_mode",2),
(get_player_agent_no,":agent_no_001"),
(agent_get_ammo,":agent_ammo_002",":agent_no_001"),
(try_begin),
    (this_or_next|main_hero_fallen),
    (this_or_next|eq,":agent_ammo_002",0),
    (gt,":m_timer_a_003",116),
    (store_mission_timer_a,":m_timer_a_003"),
(try_end),
], [
(store_mul, ":_g_training_ground_training_success_ratio", "$scene_num_total_gourds_destroyed", 10),
(jump_to_menu,"mnu_training_ground_training_result"),
(finish_mission, ":"),
]),

(1.0, 3.0, ti_once, [
(eq,"$g_mt_mode",3),
(get_player_agent_no,":agent_no_001"),
(agent_get_horse,":agent_horse_002",":agent_no_001"),
(try_begin),
    (this_or_next|ge,":agent_horse_002",0),
    (this_or_next|main_hero_fallen),
    (this_or_next|ge,"$scene_num_total_gourds_destroyed","$g_training_ground_training_num_gourds_to_destroy"),
    (gt,":m_timer_a_003",120),
    (store_mission_timer_a,":m_timer_a_003"),
(try_end),
], [
(store_mul, ":_g_training_ground_training_success_ratio", "$scene_num_total_gourds_destroyed", 100),
(val_div, "$g_training_ground_training_success_ratio", "$g_training_ground_training_num_gourds_to_destroy"),
(jump_to_menu,"mnu_training_ground_training_result"),
(finish_mission, ":"),
]),

(0.0, 0.0, 0.0, [
(gt,"$g_last_destroyed_gourds",0),
(try_begin),
    (eq,"$g_mt_mode",2),
    (entry_point_get_position, pos1, 0),
    (position_move_y,1,100,0),
    (get_player_agent_no,":agent_no_001"),
    (agent_get_position,pos2,":agent_no_001"),
    (try_begin),
        (position_is_behind_position,2,1),
        (val_add, "$scene_num_total_gourds_destroyed", "$g_last_destroyed_gourds"),
    (else_try),
        (display_message, "@@You must stay behind the line on the ground! Point is not counted."),
    (try_end),
(try_end),
(else_try),
(val_add, "$scene_num_total_gourds_destroyed", "$g_last_destroyed_gourds"),
(try_end),
], [
]),

]),
("sneak_caught_fight", mtf_battle_mode, -1,
"You must fight your way out!",
[(0, mtef_scene_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_pilgrim_hood,itm_pilgrim_disguise,itm_practice_staff,itm_throwing_daggers,]),
(1, mtef_scene_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_pilgrim_hood,itm_pilgrim_disguise,itm_practice_staff,itm_throwing_daggers,]),
(2, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(3, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(4, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(5, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(6, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(7, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(8, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(9, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(10, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(11, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(12, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(13, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(14, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(15, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(16, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(17, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(18, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(19, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(20, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(21, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(22, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(23, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(24, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(25, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(26, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(27, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(28, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(29, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(30, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(31, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(32, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(33, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(34, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(35, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(36, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(37, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(38, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(39, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(40, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(41, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(42, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(43, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(44, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(45, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(46, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(47, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(48, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(49, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(50, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(51, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(52, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(53, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(54, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(55, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(56, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(57, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(58, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(59, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(60, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(61, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(62, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(63, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(64, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
],
[
(ti_before_mission_start, 0.0, 0.0, [
], [
(call_script, "script_change_banners_and_chest"),
]),

(ti_after_mission_start, 0.0, 0.0, [
], [
(assign,":var001",5),
(try_begin),
    (eq,1,1),
    (party_get_slot,":party_slot_002","$current_town",240),
    (store_current_hours,":cur_hours_003"),
    (store_add, ":var004", ":party_slot_002", 4),
    (try_begin),
        (is_between,":cur_hours_003",":var004",":party_slot_002"),
        (assign,":var001",2),
    (else_try),
        (this_or_next|eq,"$talk_context",18),
        (eq,"$talk_context",19),
        (assign,":var001",4),
    (try_end),
(try_end),
(try_begin),
    (this_or_next|eq,"$talk_context",18),
    (eq,"$talk_context",19),
    (entry_point_get_position, pos0, 7),
(else_try),
    (party_slot_eq,"$current_town",0,3),
    (entry_point_get_position, pos0, 0),
(else_try),
    (entry_point_get_position, pos0, 1),
(try_end),
(assign,":var005",-1),
(assign,":var006",-1),
(try_for_range, ":var007", 0, ":var001"),
    (assign,":var008",100000),
    (try_for_range, ":var009", 2, 64),
        (try_begin),
            (neq,":var006",":var009"),
            (entry_point_get_position, pos1, ":var009"),
            (get_distance_between_positions,":distance_010",0,1),
            (try_begin),
                (lt,":distance_010",":var008"),
                (gt,":distance_010",":var005"),
                (assign,":var008",":distance_010"),
                (assign,":entry_no_011",":var009"),
            (try_end),
        (try_end),
    (try_end),
    (store_faction_of_party, ":party_faction_012", "$current_town"),
    (try_begin),
        (this_or_next|eq,":var007",2),
        (eq,":var007",0),
        (faction_get_slot,":faction_slot_013",":party_faction_012",42),
    (else_try),
        (faction_get_slot,":faction_slot_013",":party_faction_012",42),
    (try_end),
    (assign,":var006",":entry_no_011"),
    (assign,":var005",":var008"),
    (add_visitors_to_current_scene,":entry_no_011",":faction_slot_013",1, 0),
(try_end),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(question_box,"str_do_you_wish_to_surrender"),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (jump_to_menu,"mnu_captivity_start_castle_defeat"),
    (finish_mission, 0),
(try_end),
]),

(1.0, 0.0, ti_once, [
], [
(play_sound,"snd_sneak_town_halt"),
(call_script, "script_music_set_situation_with_culture", 1024),
]),

(0.0, 3.0, 0.0, [
(main_hero_fallen),
], [
(jump_to_menu,"mnu_captivity_start_castle_defeat"),
(finish_mission, 0),
]),

(1.0, 0.0, 0.0, [
], [
(get_player_agent_no,":agent_no_001"),
(agent_get_position,pos0,":agent_no_001"),
(try_for_agents, ":cur_agent"),
    (try_begin),
        (neq,":cur_agent",":agent_no_001"),
        (agent_is_alive,":cur_agent"),
        (agent_get_team, ":agent_team_no_003", ":cur_agent"),
        (try_begin),
            (eq,":agent_team_no_003",1),
            (agent_get_position,pos1,":cur_agent"),
            (get_distance_between_positions,":distance_004",0,1),
            (try_begin),
                (le,":distance_004",800),
                (agent_clear_scripted_mode,":cur_agent"),
            (else_try),
                (agent_set_scripted_destination,":cur_agent",0,0),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(5.0, 1.0, ti_once, [
(num_active_teams_le,1),
(neg|main_hero_fallen),
(try_begin),
    (ge,":m_timer_a_001",5),
    (store_mission_timer_a,":m_timer_a_001"),
(try_end),
], [
(assign,"$auto_menu",-1),
(jump_to_menu,"mnu_sneak_into_town_caught_dispersed_guards"),
(finish_mission, 1),
]),

(ti_on_leave_area, 0.0, ti_once, [
], [
(assign,"$auto_menu",-1),
(jump_to_menu,"mnu_sneak_into_town_caught_ran_away"),
(finish_mission, 0),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_arena"),
], [
]),

]),
("ai_training", 0, -1,
"You start training.",
[(0, 0, 0, aif_start_alarmed, 30, []),
],
[
(ti_tab_pressed, 0.0, 0.0, [
], [
(finish_mission, 0),
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (game_key_clicked, 22),
    (neg|is_presentation_active, "prsnt_battle"),
    (start_presentation, "prsnt_battle"),
(try_end),
]),

(0.1, 0.0, 0.0, [
], [
(try_begin),
    (is_presentation_active, "prsnt_battle"),
    (call_script, "script_update_order_panel_statistics_and_map"),
(try_end),
]),

]),
("camera_test", 0, -1,
"camera Test.",
[],
[
(1.0, 0.0, 0.0, [
(entry_point_get_position, pos3, 3),
], [
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(finish_mission, 0),
]),

]),
("arena_melee_fight", mtf_arena_fight|mtf_team_fight, -1,
"You enter a melee fight in the arena.",
[(0, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_bow,itm_practice_arrows,itm_practice_horse,itm_arena_tunic_red,itm_red_tourney_helmet,]),
(1, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_heavy_practice_sword,itm_arena_tunic_red,]),
(2, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_heavy_practice_sword,itm_practice_horse,itm_arena_tunic_red,itm_red_tourney_helmet,]),
(3, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_lance,itm_practice_shield,itm_practice_horse,itm_arena_tunic_red,itm_red_tourney_helmet,]),
(4, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_bow,itm_practice_arrows,itm_practice_dagger,itm_arena_tunic_red,]),
(5, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_sword,itm_practice_shield,itm_arena_tunic_red,]),
(6, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_heavy_practice_sword,itm_practice_horse,itm_arena_tunic_red,]),
(7, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_lance,itm_practice_shield,itm_practice_horse,itm_arena_tunic_red,itm_red_tourney_helmet,]),
(8, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_bow,itm_practice_arrows,itm_practice_dagger,itm_arena_tunic_blue,]),
(9, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_lance,itm_practice_shield,itm_practice_horse,itm_arena_tunic_blue,itm_blue_tourney_helmet,]),
(10, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_heavy_practice_sword,itm_arena_tunic_blue,]),
(11, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_sword,itm_practice_shield,itm_arena_tunic_blue,itm_blue_tourney_helmet,]),
(12, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_bow,itm_practice_arrows,itm_practice_horse,itm_arena_tunic_blue,]),
(13, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_lance,itm_practice_shield,itm_practice_horse,itm_arena_tunic_blue,itm_blue_tourney_helmet,]),
(14, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_heavy_practice_sword,itm_arena_tunic_blue,]),
(15, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_sword,itm_practice_shield,itm_arena_tunic_blue,]),
(16, mtef_visitor_source|mtef_team_0|mtef_team_1|mtef_team_2, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_bow,itm_practice_arrows,itm_practice_horse,itm_arena_tunic_green,itm_green_tourney_helmet,]),
(17, mtef_visitor_source|mtef_team_0|mtef_team_1|mtef_team_2, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_heavy_practice_sword,itm_arena_tunic_green,itm_green_tourney_helmet,]),
(18, mtef_visitor_source|mtef_team_0|mtef_team_1|mtef_team_2, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_heavy_practice_sword,itm_practice_horse,itm_arena_tunic_green,itm_green_tourney_helmet,]),
(19, mtef_visitor_source|mtef_team_0|mtef_team_1|mtef_team_2, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_lance,itm_practice_shield,itm_practice_horse,itm_arena_tunic_green,itm_green_tourney_helmet,]),
(20, mtef_visitor_source|mtef_team_0|mtef_team_1|mtef_team_2, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_bow,itm_practice_arrows,itm_practice_dagger,itm_arena_tunic_green,itm_green_tourney_helmet,]),
(21, mtef_visitor_source|mtef_team_0|mtef_team_1|mtef_team_2, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_sword,itm_practice_shield,itm_arena_tunic_green,]),
(22, mtef_visitor_source|mtef_team_0|mtef_team_1|mtef_team_2, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_heavy_practice_sword,itm_practice_horse,itm_arena_tunic_green,]),
(23, mtef_visitor_source|mtef_team_0|mtef_team_1|mtef_team_2, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_lance,itm_practice_shield,itm_practice_horse,itm_arena_tunic_green,itm_green_tourney_helmet,]),
(24, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_bow,itm_practice_arrows,itm_practice_horse,itm_arena_tunic_yellow,itm_gold_tourney_helmet,]),
(25, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_heavy_practice_sword,itm_arena_tunic_yellow,itm_gold_tourney_helmet,]),
(26, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_heavy_practice_sword,itm_practice_horse,itm_arena_tunic_yellow,itm_gold_tourney_helmet,]),
(27, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_lance,itm_practice_shield,itm_practice_horse,itm_arena_tunic_yellow,itm_gold_tourney_helmet,]),
(28, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_bow,itm_practice_arrows,itm_practice_dagger,itm_arena_tunic_yellow,itm_gold_tourney_helmet,]),
(29, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_sword,itm_practice_shield,itm_arena_tunic_yellow,]),
(30, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_heavy_practice_sword,itm_practice_horse,itm_arena_tunic_yellow,]),
(31, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_lance,itm_practice_shield,itm_practice_horse,itm_arena_tunic_yellow,itm_gold_tourney_helmet,]),
(32, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_heavy_practice_sword,]),
(33, mtef_visitor_source|mtef_team_0|mtef_team_1|mtef_team_2, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_staff,]),
(34, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_sword,itm_practice_shield,]),
(35, mtef_visitor_source|mtef_team_0|mtef_team_3|mtef_team_4, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_staff,]),
(36, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_bow,itm_practice_arrows,itm_practice_dagger,]),
(37, mtef_visitor_source|mtef_team_0|mtef_team_1|mtef_team_2, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_sword,itm_practice_shield,]),
(38, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_heavy_practice_sword,]),
(39, mtef_visitor_source|mtef_team_0|mtef_team_3|mtef_team_4, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_staff,]),
(24, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_bow,itm_practice_arrows,itm_practice_horse,itm_arena_tunic_yellow,itm_gold_tourney_helmet,]),
(24, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_heavy_practice_sword,itm_arena_tunic_yellow,itm_gold_tourney_helmet,]),
(24, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_heavy_practice_sword,itm_practice_horse,itm_arena_tunic_yellow,itm_gold_tourney_helmet,]),
(24, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_lance,itm_practice_shield,itm_practice_horse,itm_arena_tunic_yellow,itm_gold_tourney_helmet,]),
(24, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_bow,itm_practice_arrows,itm_practice_dagger,itm_arena_tunic_yellow,itm_gold_tourney_helmet,]),
(24, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_sword,itm_practice_shield,itm_arena_tunic_yellow,]),
(24, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_heavy_practice_sword,itm_practice_horse,itm_arena_tunic_yellow,]),
(24, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_lance,itm_practice_shield,itm_practice_horse,itm_arena_tunic_yellow,itm_gold_tourney_helmet,]),
(24, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_bow,itm_practice_arrows,itm_practice_horse,itm_arena_tunic_yellow,itm_gold_tourney_helmet,]),
(24, mtef_visitor_source|mtef_team_3, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_bow,itm_practice_arrows,itm_practice_horse,itm_arena_tunic_yellow,itm_gold_tourney_helmet,]),
(50, mtef_scene_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_horse, 0, 1, []),
(51, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_horse, 0, 1, []),
(52, mtef_scene_source, af_override_horse, 0, 1, []),
(53, mtef_scene_source, af_override_horse, 0, 1, []),
(54, mtef_scene_source, af_override_horse, 0, 1, []),
(55, mtef_scene_source, af_override_horse, 0, 1, []),
(56, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_sword,itm_practice_shield,itm_padded_cloth,itm_segmented_helmet,]),
(57, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_practice_sword,itm_practice_shield,itm_padded_cloth,itm_segmented_helmet,]),
],
[
(ti_before_mission_start, 0.0, 0.0, [
], [
(call_script, "script_change_banners_and_chest"),
(assign,"$g_arena_training_num_agents_spawned",0),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_arena"),
], [
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_mt_mode",2),
    (set_trigger_result, 1),
(else_try),
    (question_box,"str_give_up_fight"),
(try_end),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (try_begin),
        (eq,"$g_mt_mode",3),
        (call_script, "script_end_tournament_fight", 0),
    (else_try),
        (eq,"$g_mt_mode",1),
        (get_player_agent_no,":agent_no_002"),
        (agent_get_kill_count,"$g_arena_training_kills",":agent_no_002",1),
    (try_end),
(try_end),
(finish_mission, 0),
]),

(1.0, 0.0, ti_once, [
], [
(try_begin),
    (eq,"$g_mt_mode",2),
    (call_script, "script_music_set_situation_with_culture", 65536),
    (store_current_scene,reg1),
    (scene_set_slot,reg1,0,1),
    (mission_enable_talk),
    (get_player_agent_no,":agent_no_001"),
    (assign,":var002",0),
    (try_for_agents, ":cur_agent"),
        (try_begin),
            (neq,":cur_agent",":agent_no_001"),
            (agent_get_troop_id,":troop_id_004", ":cur_agent"),
            (try_begin),
                (is_between,":troop_id_004","trp_novice_fighter","trp_tournament_master"),
                (eq,":var002",0),
                (agent_set_team, ":cur_agent", 1),
                (assign,":var002",1),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(0.0, 0.0, ti_once, [
], [
(try_begin),
    (eq,"$g_mt_mode",3),
    (play_sound,"snd_arena_ambiance",2),
    (call_script, "script_music_set_situation_with_culture", 131072),
(try_end),
]),

(1.0, 4.0, ti_once, [
(eq,"$g_mt_mode",3),
(this_or_next|main_hero_fallen),
(num_active_teams_le,1),
], [
(try_begin),
    (neg|main_hero_fallen),
    (call_script, "script_end_tournament_fight", 1),
    (call_script, "script_play_victorious_sound"),
    (finish_mission, ":"),
(else_try),
    (call_script, "script_end_tournament_fight", 0),
    (finish_mission, ":"),
(try_end),
]),

(ti_battle_window_opened, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_mt_mode",1),
    (start_presentation, "prsnt_arena_training"),
(try_end),
]),

(0.0, 0.0, ti_once, [
], [
(try_begin),
    (eq,"$g_mt_mode",1),
    (assign,"$g_arena_training_max_opponents",40),
    (assign,"$g_arena_training_num_agents_spawned",0),
    (assign,"$g_arena_training_kills",0),
    (assign,"$g_arena_training_won",0),
    (call_script, "script_music_set_situation_with_culture", 131072),
(try_end),
]),

(1.0, 4.0, ti_once, [
(eq,"$g_mt_mode",1),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (gt,":m_timer_a_001",3),
    (assign,":var002",0),
    (try_begin),
        (ge,"$g_arena_training_num_agents_spawned","$g_arena_training_max_opponents"),
        (num_active_teams_le,1),
        (assign,":var002",1),
        (try_begin),
            (this_or_next|eq,":var002",1),
            (main_hero_fallen),
        (try_end),
    (try_end),
(try_end),
], [
(get_player_agent_no,":m_timer_a_001"),
(agent_get_kill_count,"$g_arena_training_kills",":m_timer_a_001",1),
(assign,"$g_arena_training_won",0),
(try_begin),
    (neg|main_hero_fallen),
    (assign,"$g_arena_training_won",1),
(try_end),
(assign,"$g_mt_mode",2),
(set_jump_mission,"mt_arena_melee_fight"),
(party_get_slot,":party_slot_002","$current_town",16),
(modify_visitors_at_site,":party_slot_002"),
(reset_visitors),
(set_visitor,35,"trp_veteran_fighter"),
(set_visitor,36,"trp_hired_blade"),
(set_jump_entry,50),
(jump_to_scene,":party_slot_002"),
]),

(0.2, 0.0, 0.0, [
(eq,"$g_mt_mode",1),
(assign,":var001",0),
(try_for_agents, ":cur_agent"),
    (try_begin),
        (agent_is_human,":cur_agent"),
        (agent_is_alive,":cur_agent"),
        (agent_get_team, ":agent_team_no_003", ":cur_agent"),
        (try_begin),
            (is_between,":agent_team_no_003",0,7),
            (val_add, ":var001", 1),
        (try_end),
    (try_end),
(try_end),
(try_end),
(try_begin),
(lt,":var001",7),
(neg|main_hero_fallen),
(try_begin),
    (this_or_next|ge,":m_timer_a_004","$g_arena_training_next_spawn_time"),
    (this_or_next|ge,"$g_arena_training_num_agents_spawned",6),
    (num_active_teams_le,1),
    (lt,"$g_arena_training_num_agents_spawned","$g_arena_training_max_opponents"),
    (store_mission_timer_a,":m_timer_a_004"),
(try_end),
], [
(assign,":troop_id_001","$g_arena_training_num_agents_spawned"),
(store_div, ":var___x1", "$g_arena_training_num_agents_spawned", 6),
(assign,":troop_id_001",":var___x1"),
(assign,":cur_agent","$g_arena_training_num_agents_spawned"),
(val_mod, ":cur_agent", 6),
(val_add, ":troop_id_001", ":cur_agent"),
(val_min,":troop_id_001",9),
(assign,":troop_id_001 +","trp_arena_training_fighter_1"),
(assign,":agent_team_no_003",10000),
(get_player_agent_no,":m_timer_a_004"),
(agent_get_position,pos5,":m_timer_a_004"),
(try_for_range, ":var005", 0, ":agent_team_no_003"),
    (store_random_in_range,":random_x_006",32,40),
    (try_begin),
        (neq,":random_x_006","$g_player_entry_point"),
        (entry_point_get_position, pos1, ":random_x_006"),
        (get_distance_between_positions,":distance_007",5,1),
        (try_begin),
            (gt,":distance_007",1200),
            (assign,":agent_team_no_003",0),
        (try_end),
    (try_end),
(try_end),
(add_visitors_to_current_scene,":random_x_006",":troop_id_001",1),
(store_add, ":var008", "$g_arena_training_num_agents_spawned", 1),
(store_mission_timer_a,":m_timer_a_009"),
(store_add, "$g_arena_training_next_spawn_time", ":m_timer_a_009", 14),
(store_div, ":var___x1", ":var008", 3),
(assign,":var010",":var___x1"),
(val_sub, "$g_arena_training_next_spawn_time", ":var010"),
]),

(0.0, 0.0, 0.0, [
(eq,"$g_mt_mode",1),
], [
(assign,":var001",6),
(val_max,":var001",1),
(get_player_agent_no,":agent_no_002"),
(try_for_agents, ":cur_agent"),
    (try_begin),
        (agent_is_human,":cur_agent"),
        (agent_is_alive,":cur_agent"),
        (agent_slot_eq,":cur_agent",7,0),
        (agent_get_team, ":agent_team_no_004", ":cur_agent"),
        (try_begin),
            (is_between,":agent_team_no_004",0,7),
            (try_begin),
                (eq,":cur_agent",":agent_no_002"),
                (agent_set_team, ":cur_agent", 6),
            (else_try),
                (store_random_in_range,":random_x_005",0,":var001"),
                (try_for_range, ":slot_no_006", 0, 6),
                    (troop_set_slot,"trp_temp_array_a",":slot_no_006",0),
                (try_end),
            (try_end),
        (try_end),
        (try_for_agents, ":cur_agent"),
            (try_begin),
                (agent_is_human,":cur_agent"),
                (agent_is_alive,":cur_agent"),
                (neq,":cur_agent",":agent_no_002"),
                (agent_slot_eq,":cur_agent",7,1),
                (agent_get_team, ":agent_team_no_008", ":cur_agent"),
                (troop_get_slot,":troop_slot_009","trp_temp_array_a",":agent_team_no_008"),
                (val_add, ":troop_slot_009", 1),
                (troop_set_slot,"trp_temp_array_a",":agent_team_no_008",":troop_slot_009"),
            (try_end),
        (try_end),
        (assign,":var010",0),
        (troop_get_slot,":troop_slot_011","trp_temp_array_a",0),
        (try_for_range, ":slot_no_006", 1, 6),
            (try_begin),
                (troop_slot_ge,"trp_temp_array_a",":slot_no_006",":troop_slot_011"),
                (troop_get_slot,":troop_slot_011","trp_temp_array_a",":slot_no_006"),
                (assign,":var010",":slot_no_006"),
            (try_end),
        (try_end),
        (store_random_in_range,":random_x_012",5,100),
        (try_begin),
            (lt,":random_x_012","$g_arena_training_num_agents_spawned"),
            (assign,":random_x_005",":var010"),
        (try_end),
        (agent_set_team, ":cur_agent", ":random_x_005"),
    (try_end),
    (agent_set_slot,":cur_agent",7,1),
    (try_begin),
        (neq,":cur_agent",":agent_no_002"),
        (val_add, "$g_arena_training_num_agents_spawned", 1),
    (try_end),
(try_end),
]),

]),
("arena_challenge_fight", mtf_arena_fight|mtf_team_fight|mtf_commit_casualties, -1,
"You enter a melee fight in the arena.",
[(56, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(58, mtef_visitor_source|mtef_team_0|mtef_team_1|mtef_team_2, 0, aif_start_alarmed, 1, []),
],
[
(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_now"),
], [
]),

(ti_tab_pressed, 0.0, 0.0, [
(display_message, "str_cannot_leave_now"),
], [
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(call_script, "script_change_banners_and_chest"),
]),

(0.0, 0.0, ti_once, [
], [
(call_script, "script_music_set_situation_with_culture", 131072),
]),

(1.0, 4.0, ti_once, [
(this_or_next|main_hero_fallen),
(num_active_teams_le,1),
], [
(try_begin),
    (main_hero_fallen),
    (check_quest_active,"qst_duel_for_lady"),
    (quest_slot_eq,"qst_duel_for_lady",2,"$g_duel_troop"),
    (call_script, "script_fail_quest", "qst_duel_for_lady"),
(else_try),
    (check_quest_active,"qst_duel_for_lady"),
    (quest_slot_eq,"qst_duel_for_lady",2,"$g_duel_troop"),
    (call_script, "script_succeed_quest", "qst_duel_for_lady"),
(else_try),
    (main_hero_fallen),
    (check_quest_active,"qst_duel_courtship_rival"),
    (quest_slot_eq,"qst_duel_courtship_rival",2,"$g_duel_troop"),
    (call_script, "script_fail_quest", "qst_duel_courtship_rival"),
(else_try),
    (check_quest_active,"qst_duel_courtship_rival"),
    (quest_slot_eq,"qst_duel_courtship_rival",2,"$g_duel_troop"),
    (call_script, "script_succeed_quest", "qst_duel_courtship_rival"),
(else_try),
    (main_hero_fallen),
    (check_quest_active,"qst_duel_avenge_insult"),
    (quest_slot_eq,"qst_duel_avenge_insult",2,"$g_duel_troop"),
    (call_script, "script_fail_quest", "qst_duel_avenge_insult"),
(else_try),
    (check_quest_active,"qst_duel_avenge_insult"),
    (quest_slot_eq,"qst_duel_avenge_insult",2,"$g_duel_troop"),
    (call_script, "script_succeed_quest", "qst_duel_avenge_insult"),
(else_try),
    (main_hero_fallen),
    (check_quest_active,"qst_denounce_lord"),
    (quest_slot_eq,"qst_denounce_lord",2,"$g_duel_troop"),
    (call_script, "script_fail_quest", "qst_denounce_lord"),
(else_try),
    (check_quest_active,"qst_denounce_lord"),
    (quest_slot_eq,"qst_denounce_lord",2,"$g_duel_troop"),
    (call_script, "script_succeed_quest", "qst_denounce_lord"),
(else_try),
    (quest_get_slot,":quest_slot_001","qst_denounce_lord",2),
    (str_store_troop_name,s4,":quest_slot_001"),
(try_end),
(finish_mission, ":"),
]),

]),
("duel_with_lord", mtf_arena_fight|mtf_team_fight|mtf_commit_casualties, -1,
"You enter a melee fight in the arena.",
[(0, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_sword_medieval_a,itm_arena_tunic_blue,]),
(16, mtef_visitor_source|mtef_team_1, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all, aif_start_alarmed, 1, [itm_sword_medieval_a,itm_arena_tunic_blue,]),
],
[
(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_now"),
], [
]),

(ti_tab_pressed, 0.0, 0.0, [
(display_message, "str_cannot_leave_now"),
], [
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(call_script, "script_change_banners_and_chest"),
]),

(0.0, 0.0, ti_once, [
], [
(call_script, "script_music_set_situation_with_culture", 131072),
]),

(1.0, 4.0, ti_once, [
(this_or_next|main_hero_fallen),
(num_active_teams_le,1),
], [
(try_begin),
    (main_hero_fallen),
    (check_quest_active,"qst_duel_for_lady"),
    (quest_slot_eq,"qst_duel_for_lady",2,"$g_duel_troop"),
    (call_script, "script_fail_quest", "qst_duel_for_lady"),
(else_try),
    (check_quest_active,"qst_duel_for_lady"),
    (quest_slot_eq,"qst_duel_for_lady",2,"$g_duel_troop"),
    (call_script, "script_succeed_quest", "qst_duel_for_lady"),
(else_try),
    (main_hero_fallen),
    (check_quest_active,"qst_duel_courtship_rival"),
    (quest_slot_eq,"qst_duel_courtship_rival",2,"$g_duel_troop"),
    (call_script, "script_fail_quest", "qst_duel_courtship_rival"),
(else_try),
    (check_quest_active,"qst_duel_courtship_rival"),
    (quest_slot_eq,"qst_duel_courtship_rival",2,"$g_duel_troop"),
    (call_script, "script_succeed_quest", "qst_duel_courtship_rival"),
(else_try),
    (main_hero_fallen),
    (check_quest_active,"qst_duel_avenge_insult"),
    (quest_slot_eq,"qst_duel_avenge_insult",2,"$g_duel_troop"),
    (call_script, "script_fail_quest", "qst_duel_avenge_insult"),
(else_try),
    (check_quest_active,"qst_duel_avenge_insult"),
    (quest_slot_eq,"qst_duel_avenge_insult",2,"$g_duel_troop"),
    (call_script, "script_succeed_quest", "qst_duel_avenge_insult"),
(else_try),
    (main_hero_fallen),
    (check_quest_active,"qst_denounce_lord"),
    (quest_slot_eq,"qst_denounce_lord",2,"$g_duel_troop"),
    (call_script, "script_fail_quest", "qst_denounce_lord"),
(else_try),
    (check_quest_active,"qst_denounce_lord"),
    (quest_slot_eq,"qst_denounce_lord",2,"$g_duel_troop"),
    (call_script, "script_succeed_quest", "qst_denounce_lord"),
(else_try),
    (quest_get_slot,":quest_slot_001","qst_denounce_lord",2),
    (str_store_troop_name,s4,":quest_slot_001"),
(try_end),
(finish_mission, ":"),
]),

]),
("wedding", 0, -1,
"Wedding",
[(0, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_foot|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all|af_override_everything, 0, 1, [itm_tabard,itm_ankle_boots,]),
(1, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_foot|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all|af_override_everything, 0, 1, [itm_bride_dress,itm_bride_crown,itm_bride_shoes,]),
(2, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(3, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_foot|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all|af_override_everything, 0, 1, [itm_courtly_outfit,itm_blue_hose,]),
(4, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(5, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(6, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(7, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(8, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(9, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(10, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(11, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(12, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(13, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(14, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(15, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(16, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(17, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(18, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(19, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(20, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(21, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(22, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(23, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(24, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(25, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(26, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(27, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(28, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(29, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(30, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
(31, mtef_visitor_source, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_horse|af_require_civilian, 0, 1, []),
],
[
(ti_tab_pressed, 0.0, 0.0, [
], [
(show_object_details_overlay, 1),
(finish_mission, 0),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (show_object_details_overlay, 1),
    (finish_mission, 0),
(try_end),
]),

(ti_after_mission_start, 0.0, 0.0, [
], [
(assign,"$g_wedding_state",0),
(play_track,"track_wedding", 2),
(show_object_details_overlay, 0),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":agent_id_001"),
(troop_get_type,":troop_type_003",":troop_id_002"),
(set_fixed_point_multiplier, 100),
(try_begin),
    (eq,":troop_id_002","$g_wedding_bishop_troop"),
(else_try),
    (eq,":troop_id_002","$g_wedding_bride_troop"),
    (agent_set_no_dynamics, ":agent_id_001", 1),
    (init_position,1),
    (position_set_z,1,-1000),
    (agent_set_position,":agent_id_001",1),
(else_try),
    (eq,":troop_id_002","$g_wedding_brides_dad_troop"),
    (agent_set_no_dynamics, ":agent_id_001", 1),
    (init_position,1),
    (position_set_z,1,-1000),
    (agent_set_position,":agent_id_001",1),
(else_try),
    (eq,":troop_id_002","$g_wedding_groom_troop"),
    (agent_set_no_dynamics, ":agent_id_001", 1),
    (init_position,1),
    (position_move_x,1,175),
    (position_move_z,1,10),
    (position_rotate_z,1,180),
    (agent_set_position,":agent_id_001",1),
    (agent_set_animation, ":agent_id_001", "anim_wedding_groom_wait"),
(else_try),
    (try_begin),
        (eq,":troop_type_003",0),
        (store_random_in_range,":random_x_004",0,3),
        (try_begin),
            (eq,":random_x_004",0),
            (agent_set_slot,":agent_id_001",18,"anim_wedding_guest_notr"),
            (agent_set_animation, ":agent_id_001", "anim_wedding_guest_notr"),
        (else_try),
            (agent_set_slot,":agent_id_001",18,"anim_wedding_guest"),
            (agent_set_animation, ":agent_id_001", "anim_wedding_guest"),
        (try_end),
    (else_try),
        (agent_set_slot,":agent_id_001",18,"anim_wedding_guest_woman"),
        (agent_set_animation, ":agent_id_001", "anim_wedding_guest_woman"),
    (try_end),
    (store_random_in_range,":random_x_005",0,100),
    (agent_set_animation_progress, ":agent_id_001", ":random_x_005"),
(try_end),
]),

(0.0, 0.0, 0.0, [
(set_fixed_point_multiplier, 100),
(try_for_agents, ":cur_agent"),
    (agent_get_troop_id,":troop_id_003", ":cur_agent"),
    (try_begin),
        (eq,":troop_id_003","$g_wedding_groom_troop"),
    (else_try),
        (eq,":troop_id_003","$g_wedding_bride_troop"),
    (else_try),
        (eq,":troop_id_003","$g_wedding_brides_dad_troop"),
    (else_try),
        (eq,":troop_id_003","$g_wedding_bishop_troop"),
    (else_try),
        (agent_get_slot,":agent_slot_004",":cur_agent",18),
        (agent_set_animation, ":cur_agent", ":agent_slot_004"),
    (try_end),
(try_end),
(try_begin),
    (eq,"$g_wedding_state",0),
    (mission_cam_set_mode, 1, 0, 0),
    (init_position,1),
    (position_rotate_z,1,180),
    (position_rotate_x,1,5),
    (position_set_x,1,-500),
    (position_set_y,1,1000),
    (position_set_z,1,600),
    (mission_cam_set_position, 1),
    (init_position,1),
    (position_rotate_z,1,180),
    (position_rotate_x,1,-15),
    (position_set_x,1,-500),
    (position_set_y,1,1000),
    (position_set_z,1,600),
    (mission_cam_animate_to_position, 1, 4000, 0),
    (val_add, "$g_wedding_state", 1),
(else_try),
    (eq,"$g_wedding_state",1),
    (ge,":m_timer_a_001",4),
    (init_position,1),
    (position_rotate_z,1,90),
    (position_rotate_x,1,-10),
    (position_set_x,1,-580),
    (position_set_y,1,700),
    (position_set_z,1,200),
    (mission_cam_set_position, 1),
    (init_position,1),
    (position_rotate_z,1,150),
    (position_rotate_x,1,-10),
    (position_set_x,1,-580),
    (position_set_y,1,100),
    (position_set_z,1,200),
    (mission_cam_animate_to_position, 1, 6000, 1),
    (val_add, "$g_wedding_state", 1),
(else_try),
    (eq,"$g_wedding_state",2),
    (ge,":m_timer_a_001",9),
    (mission_cam_animate_to_screen_color, 4278190080, 1000),
    (val_add, "$g_wedding_state", 1),
(else_try),
    (eq,"$g_wedding_state",3),
    (ge,":m_timer_a_001",10),
    (init_position,1),
    (position_move_x,1,175),
    (position_move_z,1,10),
    (position_rotate_z,1,180),
    (try_for_agents, ":cur_agent"),
        (agent_get_troop_id,":troop_id_005", ":cur_agent"),
        (try_begin),
            (eq,":troop_id_005","$g_wedding_bride_troop"),
            (agent_set_position,":cur_agent",1),
            (agent_set_animation, ":cur_agent", "anim_wedding_bride_stairs"),
        (else_try),
            (eq,":troop_id_005","$g_wedding_brides_dad_troop"),
            (agent_set_position,":cur_agent",1),
            (agent_set_animation, ":cur_agent", "anim_wedding_dad_stairs"),
        (try_end),
    (try_end),
    (init_position,1),
    (position_rotate_z,1,-90),
    (position_set_x,1,300),
    (position_set_y,1,950),
    (position_set_z,1,420),
    (mission_cam_set_position, 1),
    (position_set_x,1,175),
    (position_set_y,1,950),
    (position_set_z,1,320),
    (mission_cam_animate_to_position, 1, 4000, 0),
    (mission_cam_animate_to_screen_color, 0, 500),
    (val_add, "$g_wedding_state", 1),
(else_try),
    (eq,"$g_wedding_state",4),
    (ge,":m_timer_a_001",14),
    (init_position,1),
    (position_rotate_z,1,-60),
    (position_rotate_x,1,10),
    (position_set_x,1,-400),
    (position_set_y,1,200),
    (position_set_z,1,115),
    (mission_cam_set_position, 1),
    (val_add, "$g_wedding_state", 1),
(else_try),
    (eq,"$g_wedding_state",5),
    (ge,":m_timer_a_001",20),
    (init_position,1),
    (position_move_x,1,175),
    (position_move_z,1,10),
    (position_rotate_z,1,180),
    (try_for_agents, ":cur_agent"),
        (agent_get_troop_id,":troop_id_005", ":cur_agent"),
        (try_begin),
            (eq,":troop_id_005","$g_wedding_bride_troop"),
            (agent_set_position,":cur_agent",1),
            (agent_set_animation, ":cur_agent", "anim_wedding_bride_walk"),
        (else_try),
            (eq,":troop_id_005","$g_wedding_brides_dad_troop"),
            (agent_set_position,":cur_agent",1),
            (agent_set_animation, ":cur_agent", "anim_wedding_dad_walk"),
        (try_end),
    (try_end),
    (init_position,1),
    (position_rotate_z,1,-140),
    (position_rotate_x,1,-15),
    (position_set_x,1,-625),
    (position_set_y,1,-530),
    (position_set_z,1,180),
    (mission_cam_set_position, 1),
    (val_add, "$g_wedding_state", 1),
(else_try),
    (eq,"$g_wedding_state",6),
    (ge,":m_timer_a_001",22),
    (init_position,1),
    (position_rotate_z,1,45),
    (position_rotate_x,1,-10),
    (position_set_x,1,-260),
    (position_set_y,1,120),
    (position_set_z,1,275),
    (mission_cam_set_position, 1),
    (position_rotate_z,1,10),
    (mission_cam_animate_to_position, 1, 2000, 0),
    (val_add, "$g_wedding_state", 1),
(else_try),
    (eq,"$g_wedding_state",7),
    (ge,":m_timer_a_001",24),
    (init_position,1),
    (position_move_x,1,175),
    (position_move_z,1,10),
    (position_rotate_z,1,180),
    (try_for_agents, ":cur_agent"),
        (agent_get_troop_id,":troop_id_005", ":cur_agent"),
        (try_begin),
            (eq,":troop_id_005","$g_wedding_bride_troop"),
            (agent_set_position,":cur_agent",1),
            (agent_set_animation, ":cur_agent", "anim_wedding_bride_last"),
        (else_try),
            (eq,":troop_id_005","$g_wedding_brides_dad_troop"),
            (agent_set_position,":cur_agent",1),
            (agent_set_animation, ":cur_agent", "anim_wedding_dad_last"),
        (else_try),
            (eq,":troop_id_005","$g_wedding_groom_troop"),
            (agent_set_position,":cur_agent",1),
            (agent_set_animation, ":cur_agent", "anim_wedding_groom_last"),
        (try_end),
    (try_end),
    (init_position,1),
    (position_rotate_z,1,-45),
    (position_rotate_x,1,-10),
    (position_set_x,1,-900),
    (position_set_y,1,-850),
    (position_set_z,1,230),
    (mission_cam_set_position, 1),
    (val_add, "$g_wedding_state", 1),
(else_try),
    (eq,"$g_wedding_state",8),
    (ge,":m_timer_a_001",31),
    (init_position,1),
    (position_set_x,1,-550),
    (position_set_y,1,-625),
    (position_set_z,1,1500),
    (particle_system_burst,"psys_wedding_rose",1,750),
    (val_add, "$g_wedding_state", 1),
(else_try),
    (eq,"$g_wedding_state",9),
    (ge,":m_timer_a_001",33),
    (init_position,1),
    (position_rotate_z,1,180),
    (position_set_x,1,-536),
    (position_set_y,1,-415),
    (position_set_z,1,135),
    (mission_cam_set_position, 1),
    (position_rotate_z,1,-8),
    (position_set_z,1,350),
    (position_rotate_x,1,35),
    (mission_cam_animate_to_position_and_aperture, 1, 10, 9000, 10),
    (val_add, "$g_wedding_state", 1),
(else_try),
    (eq,"$g_wedding_state",10),
    (ge,":m_timer_a_001",41),
    (mission_cam_set_screen_color, 16777215),
    (mission_cam_animate_to_screen_color, 4294967295, 3000),
    (val_add, "$g_wedding_state", 1),
(else_try),
    (eq,"$g_wedding_state",11),
    (ge,":m_timer_a_001",48),
    (show_object_details_overlay, 1),
    (finish_mission, 0),
], [
]),

]),
("tutorial_training_ground", mtf_arena_fight|mtf_team_fight, -1,
"You enter the training ground.",
[(0, mtef_visitor_source|mtef_team_0, 0, 0, 1, []),
(1, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(2, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(3, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(4, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(5, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(6, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(7, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(8, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(9, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(10, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(11, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(12, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(13, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(14, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(15, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(16, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(17, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(18, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(19, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(20, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(21, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(22, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(23, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(24, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(25, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(26, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(27, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(28, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(29, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(30, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(31, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(32, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3, aif_start_alarmed, 1, [itm_practice_sword,]),
(33, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3, aif_start_alarmed, 1, [itm_practice_sword,]),
(34, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3, aif_start_alarmed, 1, [itm_practice_sword,]),
(35, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3, aif_start_alarmed, 1, [itm_practice_sword,]),
(36, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(37, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(38, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(39, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(40, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(41, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3, aif_start_alarmed, 1, [itm_practice_bow,itm_practice_arrows,]),
(42, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3, aif_start_alarmed, 1, [itm_practice_bow,itm_practice_arrows,]),
(43, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(44, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(45, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(46, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(47, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(48, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(49, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(50, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(51, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(52, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(53, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(54, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(55, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(56, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(57, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(58, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(59, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(60, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(61, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3, aif_start_alarmed, 1, [itm_practice_sword,]),
(62, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3, aif_start_alarmed, 1, [itm_practice_sword,]),
(63, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3, aif_start_alarmed, 1, [itm_practice_bow,itm_practice_arrows,]),
(64, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3, aif_start_alarmed, 1, [itm_practice_bow,itm_practice_arrows,]),
],
[
(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (lt,"$g_tutorial_training_ground_state",20),
    (question_box,"str_do_you_wish_to_leave_tutorial"),
(else_try),
    (finish_mission, 0),
(try_end),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (finish_mission, 0),
(try_end),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_tutorial"),
], [
]),

(ti_battle_window_opened, 0.0, 0.0, [
], [
(start_presentation, "prsnt_tutorial_show_mouse_movement"),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_ai_set_always_attack_in_melee, ":agent_id_001",1),
(agent_set_no_death_knock_down_only, ":agent_id_001", 1),
(agent_set_invulnerable_shield, ":agent_id_001"),
(agent_get_position,pos1,":agent_id_001"),
(agent_set_slot,":agent_id_001",8,-1),
(get_player_agent_no,":agent_no_002"),
(try_begin),
    (eq,":agent_id_001",":agent_no_002"),
    (agent_set_team, ":agent_id_001", 7),
(try_end),
(try_for_range, ":var003", 0, 64),
    (entry_point_get_position, pos2, ":var003"),
    (get_sq_distance_between_positions,":sq_distance_004",1,2),
    (try_begin),
        (lt,":sq_distance_004",100),
        (agent_set_slot,":agent_id_001",8,":var003"),
    (try_end),
(try_end),
(agent_get_troop_id,":troop_id_005", ":agent_id_001"),
(try_begin),
    (eq,":troop_id_005","trp_tutorial_archer_1"),
    (agent_get_position,pos1,":agent_id_001"),
    (agent_set_scripted_destination,":agent_id_001",1),
    (scene_prop_get_num_instances, ":scp_num_instances_006", "spr_archery_target_with_hit_a"),
    (assign,":var007",10000000),
    (assign,":var008",-1),
    (try_for_range, ":var009", 0, ":scp_num_instances_006"),
        (scene_prop_get_instance, ":scp_instance_010", "spr_archery_target_with_hit_a", ":var009"),
        (prop_instance_get_position, pos2, ":scp_instance_010"),
        (get_sq_distance_between_positions,":sq_distance_011",1,2),
        (try_begin),
            (lt,":sq_distance_011",":var007"),
            (assign,":var007",":sq_distance_011"),
            (assign,":var008",":scp_instance_010"),
        (try_end),
    (try_end),
    (agent_set_slot,":agent_id_001",9,":var008"),
(else_try),
    (this_or_next|eq,":troop_id_005","trp_tutorial_rider_2"),
    (eq,":troop_id_005","trp_tutorial_rider_1"),
    (agent_set_slot,":agent_id_001",11,48),
    (agent_set_slot,":agent_id_001",9,-1),
    (entry_point_get_position, pos1, 48),
    (agent_set_scripted_destination,":agent_id_001",1),
(try_end),
]),

(ti_on_agent_knocked_down, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_003", ":var001"),
(agent_get_troop_id,":troop_id_004", ":var002"),
(try_begin),
    (ge,"$g_tutorial_training_ground_melee_trainer_attack",0),
(else_try),
    (ge,"$g_tutorial_training_ground_melee_trainer_parry",0),
    (try_begin),
        (eq,":troop_id_003","trp_player"),
        (eq,":troop_id_004","$g_tutorial_training_ground_melee_trainer_parry"),
        (assign,"$g_tutorial_training_ground_melee_state",0),
        (agent_set_team, ":var001", 0),
        (agent_set_team, ":var002", 7),
        (tutorial_message, -1),
        (assign,"$g_tutorial_mouse_dir",-1),
        (assign,"$g_tutorial_mouse_click",-1),
        (assign,"$g_tutorial_training_ground_conversation_state",2),
        (play_sound,"snd_tutorial_fail"),
        (start_mission_conversation,"$g_tutorial_training_ground_melee_trainer_parry"),
        (assign,"$g_tutorial_training_ground_melee_trainer_parry",-1),
        (try_begin),
            (eq,"$g_tutorial_training_ground_melee_trainer_action_state",1),
            (agent_set_attack_action, ":var001", 0, 0),
        (try_end),
    (else_try),
        (eq,":troop_id_004","trp_player"),
        (eq,":troop_id_003","$g_tutorial_training_ground_melee_trainer_parry"),
        (agent_set_team, ":var001", 7),
        (agent_set_team, ":var002", 0),
        (tutorial_message, -1),
        (assign,"$g_tutorial_mouse_dir",-1),
        (assign,"$g_tutorial_mouse_click",-1),
        (assign,"$g_tutorial_training_ground_conversation_state",3),
        (play_sound,"snd_tutorial_fail"),
        (start_mission_conversation,"$g_tutorial_training_ground_melee_trainer_parry"),
        (assign,"$g_tutorial_training_ground_melee_trainer_parry",-1),
        (try_begin),
            (eq,"$g_tutorial_training_ground_melee_trainer_action_state",1),
            (agent_set_attack_action, ":var001", 0, 0),
        (try_end),
    (try_end),
(else_try),
    (ge,"$g_tutorial_training_ground_melee_trainer_chamber",0),
    (try_begin),
        (eq,":troop_id_003","trp_player"),
        (eq,":troop_id_004","$g_tutorial_training_ground_melee_trainer_chamber"),
        (assign,"$g_tutorial_training_ground_melee_state",0),
        (agent_set_team, ":var001", 0),
        (agent_set_team, ":var002", 7),
        (tutorial_message, -1),
        (assign,"$g_tutorial_mouse_dir",-1),
        (assign,"$g_tutorial_mouse_click",-1),
        (assign,"$g_tutorial_training_ground_conversation_state",7),
        (play_sound,"snd_tutorial_fail"),
        (start_mission_conversation,"$g_tutorial_training_ground_melee_trainer_chamber"),
        (assign,"$g_tutorial_training_ground_melee_trainer_chamber",-1),
        (try_begin),
            (eq,"$g_tutorial_training_ground_melee_trainer_action_state",1),
            (agent_set_attack_action, ":var001", 0, 0),
        (try_end),
    (else_try),
        (eq,":troop_id_004","trp_player"),
        (eq,":troop_id_003","$g_tutorial_training_ground_melee_trainer_chamber"),
        (agent_set_team, ":var001", 7),
        (agent_set_team, ":var002", 0),
        (tutorial_message, -1),
        (assign,"$g_tutorial_mouse_dir",-1),
        (assign,"$g_tutorial_mouse_click",-1),
        (assign,"$g_tutorial_training_ground_conversation_state",8),
        (play_sound,"snd_tutorial_fail"),
        (start_mission_conversation,"$g_tutorial_training_ground_melee_trainer_chamber"),
        (assign,"$g_tutorial_training_ground_melee_trainer_chamber",-1),
        (try_begin),
            (eq,"$g_tutorial_training_ground_melee_trainer_action_state",1),
            (agent_set_attack_action, ":var001", 0, 0),
        (try_end),
    (try_end),
(else_try),
    (ge,"$g_tutorial_training_ground_melee_trainer_combat",0),
    (try_begin),
        (eq,":troop_id_003","trp_player"),
        (eq,":troop_id_004","$g_tutorial_training_ground_melee_trainer_combat"),
        (assign,"$g_tutorial_training_ground_melee_state",0),
        (agent_set_team, ":var001", 0),
        (agent_set_team, ":var002", 7),
        (tutorial_message, -1),
        (assign,"$g_tutorial_training_ground_conversation_state",4),
        (play_sound,"snd_tutorial_fail"),
        (start_mission_conversation,"$g_tutorial_training_ground_melee_trainer_combat"),
        (assign,"$g_tutorial_training_ground_melee_trainer_combat",-1),
    (else_try),
        (eq,":troop_id_004","trp_player"),
        (eq,":troop_id_003","$g_tutorial_training_ground_melee_trainer_combat"),
        (assign,"$g_tutorial_training_ground_melee_state",0),
        (agent_set_team, ":var001", 7),
        (agent_set_team, ":var002", 0),
        (tutorial_message, -1),
        (assign,"$g_tutorial_training_ground_conversation_state",5),
        (play_sound,"snd_tutorial_2"),
        (start_mission_conversation,"$g_tutorial_training_ground_melee_trainer_combat"),
        (assign,"$g_tutorial_training_ground_melee_trainer_combat",-1),
    (try_end),
(else_try),
    (agent_is_human,":var001"),
    (assign,"$g_tutorial_training_ground_melee_last_winner",":var002"),
    (assign,"$g_tutorial_training_ground_melee_last_loser",":var001"),
    (assign,"$g_tutorial_training_ground_melee_state",0),
    (agent_set_team, "$g_tutorial_training_ground_melee_cur_fighter_1", 7),
    (agent_set_team, "$g_tutorial_training_ground_melee_cur_fighter_2", 7),
    (agent_force_rethink, "$g_tutorial_training_ground_melee_cur_fighter_1"),
    (agent_force_rethink, "$g_tutorial_training_ground_melee_cur_fighter_2"),
(try_end),
(agent_set_hit_points,":var001",100,0),
(agent_set_hit_points,":var002",100,0),
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(scene_set_day_time, 13),
(team_set_relation, 0, 1, 0),
(team_set_relation, 0, 2, 0),
(team_set_relation, 0, 3, 0),
(team_set_relation, 0, 7, 0),
(team_set_relation, 7, 1, 1),
(team_set_relation, 7, 2, 1),
(team_set_relation, 7, 3, 1),
(team_set_relation, 1, 2, -1),
(team_set_relation, 1, 3, 1),
(team_set_relation, 2, 3, 1),
(assign,"$g_position_to_use_for_replacing_scene_items",8),
(call_script, "script_replace_scene_items_with_spawn_items_before_ms"),
(assign,"$g_tutorial_training_ground_state",0),
(assign,"$g_tutorial_training_ground_conversation_state",0),
(assign,"$g_tutorial_training_ground_melee_paused",0),
(assign,"$g_tutorial_training_ground_melee_state",0),
(assign,"$g_tutorial_training_ground_melee_next_action_time",0),
(assign,"$g_tutorial_training_ground_melee_last_winner",-1),
(assign,"$g_tutorial_training_ground_melee_last_loser",-1),
(assign,"$g_tutorial_training_ground_melee_cur_fighter_1",-1),
(assign,"$g_tutorial_training_ground_melee_cur_fighter_2",-1),
(assign,"$g_tutorial_training_ground_melee_trainer_attack",-1),
(assign,"$g_tutorial_training_ground_melee_trainer_parry",-1),
(assign,"$g_tutorial_training_ground_melee_trainer_combat",-1),
(assign,"$g_tutorial_training_ground_melee_trainer_chamber",-1),
(assign,"$g_tutorial_training_ground_melee_trainer_next_action_time",0),
(assign,"$g_tutorial_training_ground_archer_trainer_state",0),
(assign,"$g_tutorial_training_ground_archer_trainer_completed_chapters",0),
(assign,"$g_tutorial_training_ground_horseman_trainer_state",0),
(assign,"$g_tutorial_training_ground_horseman_trainer_completed_chapters",0),
(assign,"$g_tutorial_training_ground_next_score_time",0),
(assign,"$g_tutorial_mouse_dir",-1),
(assign,"$g_tutorial_mouse_click",-1),
(assign,"$g_pointer_arrow_height_adder",-1000),
]),

(0.0, 0.0, ti_once, [
], [
(tutorial_message_set_size, 17, 17),
(tutorial_message_set_position, 500, 650),
(tutorial_message_set_center_justify, 0),
(mission_enable_talk),
(call_script, "script_replace_scene_items_with_spawn_items_after_ms"),
(entry_point_get_position, pos1, 59),
(set_spawn_position, 1),
(spawn_horse,"itm_practice_horse", 0),
(assign,"$g_tutorial_training_ground_intro_message_being_displayed",1),
(scene_spawned_item_get_instance, ":item_instance_001", "itm_practice_bow", 0),
(prop_instance_get_position, pos0, ":item_instance_001"),
(position_move_z,0,-1000,1),
(prop_instance_set_position, ":item_instance_001", 0),
(scene_spawned_item_get_instance, ":item_instance_001", "itm_practice_bow_2", 0),
(prop_instance_get_position, pos0, ":item_instance_001"),
(position_move_z,0,-1000,1),
(prop_instance_set_position, ":item_instance_001", 0),
(scene_spawned_item_get_instance, ":item_instance_001", "itm_practice_arrows", 0),
(prop_instance_get_position, pos0, ":item_instance_001"),
(position_move_z,0,-1000,1),
(prop_instance_set_position, ":item_instance_001", 0),
(scene_spawned_item_get_instance, ":item_instance_001", "itm_practice_arrows_2", 0),
(prop_instance_get_position, pos0, ":item_instance_001"),
(position_move_z,0,-1000,1),
(prop_instance_set_position, ":item_instance_001", 0),
(scene_spawned_item_get_instance, ":item_instance_001", "itm_practice_crossbow", 0),
(prop_instance_get_position, pos0, ":item_instance_001"),
(position_move_z,0,-1000,1),
(prop_instance_set_position, ":item_instance_001", 0),
(scene_spawned_item_get_instance, ":item_instance_001", "itm_practice_bolts", 0),
(prop_instance_get_position, pos0, ":item_instance_001"),
(position_move_z,0,-1000,1),
(prop_instance_set_position, ":item_instance_001", 0),
(scene_spawned_item_get_instance, ":item_instance_001", "itm_practice_javelin", 0),
(prop_instance_get_position, pos0, ":item_instance_001"),
(position_move_z,0,-1000,1),
(prop_instance_set_position, ":item_instance_001", 0),
(scene_spawned_item_get_instance, ":item_instance_001", "itm_arena_lance", 0),
(prop_instance_get_position, pos0, ":item_instance_001"),
(position_move_z,0,-1000,1),
(prop_instance_set_position, ":item_instance_001", 0),
]),

(0.0, 1.0, ti_once, [
], [
(tutorial_message_set_background, 1),
(tutorial_message,"str_tutorial_training_ground_intro_message"),
]),

(0.0, 0.0, 0.0, [
(try_for_agents, ":cur_agent"),
    (agent_get_troop_id,":troop_id_003", ":cur_agent"),
    (try_begin),
        (eq,":troop_id_003","trp_tutorial_archer_1"),
        (try_begin),
            (eq,1,1),
            (agent_get_wielded_item,":agent_wieled_item_004",":cur_agent",0),
            (try_begin),
                (neq,":agent_wieled_item_004","itm_practice_bow"),
                (agent_set_wielded_item, ":cur_agent", "itm_practice_bow"),
            (else_try),
                (agent_get_slot,":agent_slot_005",":cur_agent",9),
                (prop_instance_get_position, pos1, ":agent_slot_005"),
                (position_move_z,1,10),
                (agent_set_look_target_position, ":cur_agent", 1),
                (try_begin),
                    (neg|agent_slot_ge,":cur_agent",19,":m_timer_a_001"),
                    (agent_set_attack_action, ":cur_agent", 0),
                    (store_random_in_range,":random_x_006",3,13),
                    (val_add, ":random_x_006", ":m_timer_a_001"),
                    (agent_set_slot,":cur_agent",19,":random_x_006"),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
], [
]),

(0.0, 0.0, 0.0, [
(try_for_agents, ":cur_agent"),
    (agent_get_troop_id,":troop_id_002", ":cur_agent"),
    (try_begin),
        (this_or_next|eq,":troop_id_002","trp_tutorial_rider_2"),
        (eq,":troop_id_002","trp_tutorial_rider_1"),
        (agent_get_slot,":agent_slot_003",":cur_agent",11),
        (entry_point_get_position, pos1, ":agent_slot_003"),
        (agent_get_position,pos2,":cur_agent"),
        (get_sq_distance_between_positions,":sq_distance_004",1,2),
        (try_begin),
            (lt,":sq_distance_004",6400),
            (val_add, ":agent_slot_003", 1),
            (try_begin),
                (gt,":agent_slot_003",57),
                (assign,":agent_slot_003",48),
            (try_end),
        (try_end),
        (agent_set_slot,":cur_agent",11,":agent_slot_003"),
        (entry_point_get_position, pos1, ":agent_slot_003"),
        (agent_set_scripted_destination,":cur_agent",1),
    (try_end),
    (try_begin),
        (eq,":troop_id_002","trp_tutorial_rider_2"),
        (try_begin),
            (eq,1,1),
            (agent_get_wielded_item,":agent_wieled_item_005",":cur_agent",0),
            (try_begin),
                (neq,":agent_wieled_item_005","itm_practice_bow"),
                (agent_set_wielded_item, ":cur_agent", "itm_practice_bow"),
            (else_try),
                (scene_prop_get_num_instances, ":scp_num_instances_006", "spr_archery_target_with_hit_a"),
                (assign,":var007",10000000),
                (assign,":var008",-1),
                (try_for_range, ":var009", 0, ":scp_num_instances_006"),
                    (scene_prop_get_instance, ":scp_instance_010", "spr_archery_target_with_hit_a", ":var009"),
                    (try_begin),
                        (neg|agent_slot_eq,":cur_agent",9,":scp_instance_010"),
                        (prop_instance_get_position, pos1, ":scp_instance_010"),
                        (try_begin),
                            (position_is_behind_position,2,1),
                            (get_sq_distance_between_positions,":sq_distance_004",1,2),
                            (try_begin),
                                (lt,":sq_distance_004",":var007"),
                                (assign,":var007",":sq_distance_004"),
                                (assign,":var008",":scp_instance_010"),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
            (try_begin),
                (lt,":var007",40000),
                (prop_instance_get_position, pos1, ":var008"),
                (position_move_z,1,10),
                (init_position,3),
                (position_set_x,3,-160),
                (position_transform_position_to_parent,4,1,3),
                (copy_position,1,4),
                (agent_set_look_target_position, ":cur_agent", 1),
                (try_begin),
                    (lt,":var007",22500),
                    (agent_set_slot,":cur_agent",9,":var008"),
                    (agent_set_attack_action, ":cur_agent", 0),
                (else_try),
                    (agent_get_slot,":agent_slot_011",":cur_agent",9),
                    (try_begin),
                        (ge,":agent_slot_011",0),
                        (prop_instance_get_position, pos1, ":agent_slot_011"),
                        (get_sq_distance_between_positions,":sq_distance_004",1,2),
                        (try_begin),
                            (lt,":sq_distance_004",40000),
                            (position_move_z,1,10),
                            (init_position,3),
                            (position_set_x,3,-160),
                            (position_transform_position_to_parent,4,1,3),
                            (copy_position,1,4),
                            (agent_set_look_target_position, ":cur_agent", 1),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (else_try),
        (eq,":troop_id_002","trp_tutorial_rider_1"),
        (try_begin),
            (eq,1,1),
            (agent_get_wielded_item,":agent_wieled_item_005",":cur_agent",0),
            (try_begin),
                (neq,":agent_wieled_item_005","itm_practice_sword"),
                (agent_set_wielded_item, ":cur_agent", "itm_practice_sword"),
            (else_try),
                (scene_prop_get_num_instances, ":scp_num_instances_006", "spr_dummy_a_undestructable"),
                (assign,":var007",10000000),
                (assign,":var008",-1),
                (try_for_range, ":var009", 0, ":scp_num_instances_006"),
                    (scene_prop_get_instance, ":scp_instance_010", "spr_dummy_a_undestructable", ":var009"),
                    (try_begin),
                        (neg|agent_slot_eq,":cur_agent",9,":scp_instance_010"),
                        (prop_instance_get_position, pos1, ":scp_instance_010"),
                        (get_sq_distance_between_positions,":sq_distance_004",1,2),
                        (try_begin),
                            (lt,":sq_distance_004",":var007"),
                            (assign,":var007",":sq_distance_004"),
                            (assign,":var008",":scp_instance_010"),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
            (try_begin),
                (lt,":var007",10000),
                (prop_instance_get_position, pos1, ":var008"),
                (position_transform_position_to_local, 3,2,1),
                (position_get_x,":pos_x_012",3),
                (position_get_y,":pos_y_013",3),
                (try_begin),
                    (is_between,":pos_x_012",-200,200),
                    (gt,":pos_y_013",-100),
                    (init_position,3),
                    (try_begin),
                        (lt,":pos_x_012",0),
                        (position_move_x,3,-100),
                        (position_move_z,3,100),
                    (else_try),
                        (position_move_x,3,100),
                        (position_move_z,3,150),
                    (try_end),
                (try_end),
                (position_transform_position_to_parent,4,2,3),
                (agent_set_look_target_position, ":cur_agent", 4),
                (try_begin),
                    (lt,":pos_x_012",0),
                    (agent_set_attack_action, ":cur_agent", 2, 1),
                (else_try),
                    (agent_set_attack_action, ":cur_agent", 1, 1),
                (try_end),
                (try_begin),
                    (this_or_next|ge,":var007",900),
                    (lt,":pos_y_013",100),
                    (agent_set_attack_action, ":cur_agent", 0, 0),
                    (agent_set_slot,":cur_agent",9,":var008"),
                (else_try),
                    (agent_get_slot,":agent_slot_011",":cur_agent",9),
                    (try_begin),
                        (ge,":agent_slot_011",0),
                        (prop_instance_get_position, pos1, ":agent_slot_011"),
                        (get_sq_distance_between_positions,":sq_distance_004",1,2),
                        (try_begin),
                            (lt,":sq_distance_004",10000),
                            (position_transform_position_to_local, 3,2,1),
                            (position_get_x,":pos_x_012",3),
                            (position_get_y,":pos_y_013",3),
                            (try_begin),
                                (is_between,":pos_x_012",-200,200),
                                (gt,":pos_y_013",-100),
                                (init_position,3),
                                (try_begin),
                                    (lt,":pos_x_012",0),
                                    (position_move_x,3,-100),
                                    (position_move_z,3,100),
                                (else_try),
                                    (position_move_x,3,100),
                                    (position_move_z,3,150),
                                (try_end),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
                (position_transform_position_to_parent,4,2,3),
                (agent_set_look_target_position, ":cur_agent", 4),
            (try_end),
        (try_end),
    (try_end),
], [
]),

(0.0, 0.0, 0.0, [
(try_for_agents, ":cur_agent"),
    (agent_get_troop_id,":troop_id_003", ":cur_agent"),
    (try_begin),
        (eq,":troop_id_003","trp_tutorial_archer_1"),
        (try_begin),
            (eq,1,1),
            (agent_get_wielded_item,":agent_wieled_item_004",":cur_agent",0),
            (try_begin),
                (neq,":agent_wieled_item_004","itm_practice_bow"),
                (agent_set_wielded_item, ":cur_agent", "itm_practice_bow"),
            (else_try),
                (agent_get_slot,":agent_slot_005",":cur_agent",9),
                (prop_instance_get_position, pos1, ":agent_slot_005"),
                (agent_set_look_target_position, ":cur_agent", 1),
                (try_begin),
                    (neg|agent_slot_ge,":cur_agent",19,":m_timer_a_001"),
                    (agent_set_attack_action, ":cur_agent", 0),
                    (store_random_in_range,":random_x_006",3,13),
                    (val_add, ":random_x_006", ":m_timer_a_001"),
                    (agent_set_slot,":cur_agent",19,":random_x_006"),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
], [
]),

(0.0, 0.0, 0.0, [
(call_script, "script_iterate_pointer_arrow"),
], [
]),

(5.0, 0.0, 0.0, [
(eq,1,1),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (ge,":m_timer_a_001",30),
    (eq,"$g_tutorial_training_ground_intro_message_being_displayed",1),
    (assign,"$g_tutorial_training_ground_intro_message_being_displayed",0),
    (tutorial_message, -1),
(try_end),
(try_end),
(get_player_agent_no,":agent_no_002"),
(try_for_agents, ":cur_agent"),
(try_begin),
    (agent_is_human,":cur_agent"),
    (neq,":cur_agent",":agent_no_002"),
    (agent_refill_ammo,":cur_agent"),
(try_end),
], [
]),

(0.0, 0.0, 0.0, [
(agent_get_wielded_item,":agent_wieled_item_002",":agent_no_001",0),
(assign,":var003",0),
(try_begin),
    (eq,":agent_wieled_item_002","itm_practice_bow"),
    (agent_has_item_equipped,":agent_no_001","itm_practice_arrows"),
    (agent_get_ammo,":agent_ammo_004",":agent_no_001", 1),
    (try_begin),
        (eq,":agent_ammo_004",0),
        (assign,":var003",1),
    (else_try),
        (eq,":agent_wieled_item_002","itm_practice_bow_2"),
        (agent_has_item_equipped,":agent_no_001","itm_practice_arrows_2"),
        (agent_get_ammo,":agent_ammo_004",":agent_no_001", 1),
        (try_begin),
            (eq,":agent_ammo_004",0),
            (assign,":var003",1),
        (else_try),
            (eq,":agent_wieled_item_002","itm_practice_crossbow"),
            (agent_has_item_equipped,":agent_no_001","itm_practice_bolts"),
            (agent_get_ammo,":agent_ammo_004",":agent_no_001", 1),
            (try_begin),
                (eq,":agent_ammo_004",0),
                (assign,":var003",1),
            (else_try),
                (eq,":agent_wieled_item_002","itm_practice_javelin"),
                (agent_get_ammo,":agent_ammo_004",":agent_no_001", 1),
                (try_begin),
                    (le,":agent_ammo_004",1),
                    (assign,":var003",1),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,":var003",1),
    (agent_refill_ammo,":agent_no_001"),
    (dialog_box,"str_tutorial_training_ground_ammo_refill","@Tutorial"),
], [
]),

(0.0, 0.0, 0.0, [
(try_begin),
    (neq,"$g_tutorial_training_ground_horseman_trainer_state",0),
    (mission_disable_talk),
    (try_begin),
        (eq,"$g_tutorial_training_ground_horseman_trainer_state",1),
        (assign,"$g_tutorial_training_ground_current_score",0),
        (val_add, "$g_tutorial_training_ground_horseman_trainer_state", 1),
    (else_try),
        (eq,"$g_tutorial_training_ground_horseman_trainer_state",2),
        (try_begin),
            (eq,1,1),
            (try_begin),
                (ge,"$g_tutorial_training_ground_horseman_trainer_item_1",0),
                (scene_spawned_item_get_instance, ":item_instance_002", "$g_tutorial_training_ground_horseman_trainer_item_1", 0),
                (prop_instance_get_position, pos0, ":item_instance_002"),
                (position_move_z,0,1000,1),
                (prop_instance_set_position, ":item_instance_002", 0),
                (scene_prop_get_instance, ":scp_instance_003", "spr_pointer_arrow", 0),
                (prop_instance_set_position, ":scp_instance_003", 0),
                (assign,"$g_pointer_arrow_height_adder",200),
                (try_begin),
                    (ge,"$g_tutorial_training_ground_horseman_trainer_item_2",0),
                    (scene_spawned_item_get_instance, ":item_instance_002", "$g_tutorial_training_ground_horseman_trainer_item_2", 0),
                    (prop_instance_get_position, pos0, ":item_instance_002"),
                    (position_move_z,0,1000,1),
                    (prop_instance_set_position, ":item_instance_002", 0),
                (try_end),
            (try_end),
        (try_end),
        (val_add, "$g_tutorial_training_ground_horseman_trainer_state", 1),
    (try_end),
(else_try),
    (eq,"$g_tutorial_training_ground_horseman_trainer_state",3),
    (try_begin),
        (ge,"$g_tutorial_training_ground_horseman_trainer_item_1",0),
        (try_begin),
            (eq,1,1),
            (str_store_item_name,s0,"$g_tutorial_training_ground_horseman_trainer_item_1"),
            (tutorial_message,"str_tutorial_training_ground_horseman_text_1"),
            (try_begin),
                (agent_has_item_equipped,":agent_no_001","$g_tutorial_training_ground_horseman_trainer_item_1"),
                (val_add, "$g_tutorial_training_ground_horseman_trainer_state", 1),
                (play_sound,"snd_tutorial_1"),
            (try_end),
        (try_end),
    (else_try),
        (val_add, "$g_tutorial_training_ground_horseman_trainer_state", 1),
    (try_end),
(else_try),
    (eq,"$g_tutorial_training_ground_horseman_trainer_state",4),
    (try_begin),
        (ge,"$g_tutorial_training_ground_horseman_trainer_item_2",0),
        (try_begin),
            (eq,1,1),
            (str_store_item_name,s0,"$g_tutorial_training_ground_horseman_trainer_item_2"),
            (tutorial_message,"str_tutorial_training_ground_horseman_text_1"),
            (try_begin),
                (agent_has_item_equipped,":agent_no_001","$g_tutorial_training_ground_horseman_trainer_item_2"),
                (val_add, "$g_tutorial_training_ground_horseman_trainer_state", 1),
                (play_sound,"snd_tutorial_1"),
            (try_end),
        (try_end),
    (else_try),
        (val_add, "$g_tutorial_training_ground_horseman_trainer_state", 1),
    (try_end),
(else_try),
    (eq,"$g_tutorial_training_ground_horseman_trainer_state",5),
    (try_begin),
        (eq,1,1),
        (agent_get_horse,":agent_horse_004",":agent_no_001"),
        (try_begin),
            (lt,":agent_horse_004",0),
            (tutorial_message,"str_tutorial_training_ground_horseman_text_2"),
            (try_begin),
                (eq,1,1),
                (assign,":var005",-1),
                (try_for_agents, ":cur_agent"),
                    (agent_get_item_id,":agent_item_id_007", ":cur_agent"),
                    (try_begin),
                        (eq,":agent_item_id_007","itm_practice_horse"),
                        (assign,":var005",":cur_agent"),
                    (try_end),
                (try_end),
            (try_end),
            (agent_get_position,pos0,":var005"),
            (scene_prop_get_instance, ":scp_instance_003", "spr_pointer_arrow", 0),
            (prop_instance_get_position, pos1, ":scp_instance_003"),
            (set_fixed_point_multiplier, 100),
            (position_get_x,":pos_x_008",0),
            (position_get_x,":pos_x_009",1),
            (position_get_y,":pos_y_010",0),
            (position_get_y,":pos_y_011",1),
            (try_begin),
                (this_or_next|eq,":pos_x_008",":pos_x_009"),
                (neq,":pos_y_010",":pos_y_011"),
                (prop_instance_set_position, ":scp_instance_003", 0),
                (assign,"$g_pointer_arrow_height_adder",200),
            (try_end),
        (try_end),
    (else_try),
        (val_add, "$g_tutorial_training_ground_horseman_trainer_state", 1),
    (try_end),
(else_try),
    (eq,"$g_tutorial_training_ground_horseman_trainer_state",6),
    (try_begin),
        (eq,"$g_tutorial_training_ground_horseman_trainer_completed_chapters",0),
        (tutorial_message,"str_tutorial_training_ground_horseman_text_3"),
    (else_try),
        (eq,"$g_tutorial_training_ground_horseman_trainer_completed_chapters",1),
        (assign,":var012","spr_dummy_a_undestructable"),
        (tutorial_message,"str_tutorial_training_ground_horseman_text_4"),
    (else_try),
        (assign,":var012","spr_archery_target_with_hit_a"),
        (tutorial_message,"str_tutorial_training_ground_horseman_text_5"),
    (try_end),
    (try_begin),
        (eq,"$g_tutorial_training_ground_horseman_trainer_completed_chapters",0),
        (store_add, ":var013", "$g_tutorial_training_ground_current_score", 48),
        (entry_point_get_position, pos0, ":var013"),
        (init_position,2),
        (position_move_y,2,-800),
        (position_transform_position_to_parent,3,0,2),
        (copy_position,0,3),
        (agent_get_position,pos2,":agent_no_001"),
        (try_begin),
            (eq,1,1),
            (get_distance_between_positions,":distance_014",0,2),
            (try_begin),
                (lt,":distance_014",500),
                (val_add, "$g_tutorial_training_ground_current_score", 1),
                (try_begin),
                    (ge,"$g_tutorial_training_ground_current_score",10),
                    (assign,"$g_pointer_arrow_height_adder",-1000),
                    (tutorial_message,"str_tutorial_training_ground_horseman_text_6", 0, 10),
                    (assign,"$g_tutorial_training_ground_horseman_trainer_state",0),
                    (val_add, "$g_tutorial_training_ground_horseman_trainer_completed_chapters", 1),
                    (play_sound,"snd_tutorial_2"),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (eq,1,1),
            (scene_prop_get_instance, ":scp_instance_003", "spr_pointer_arrow", 0),
            (prop_instance_get_position, pos1, ":scp_instance_003"),
            (set_fixed_point_multiplier, 1),
            (position_get_x,":pos_x_008",0),
            (position_get_x,":pos_x_009",1),
            (position_get_y,":pos_y_010",0),
            (position_get_y,":pos_y_011",1),
            (try_begin),
                (this_or_next|eq,":pos_x_008",":pos_x_009"),
                (neq,":pos_y_010",":pos_y_011"),
                (prop_instance_set_position, ":scp_instance_003", 0),
                (assign,"$g_pointer_arrow_height_adder",150),
                (play_sound,"snd_tutorial_1"),
            (try_end),
        (try_end),
    (else_try),
        (scene_prop_get_num_instances, ":scp_num_instances_015", ":var012"),
        (try_begin),
            (lt,"$g_tutorial_training_ground_current_score",6),
            (assign,":var016",-1),
            (store_add, ":var017", "$g_tutorial_training_ground_current_score", 1),
            (try_for_range, ":var018", 0, ":scp_num_instances_015"),
                (scene_prop_get_instance, ":scp_instance_019", ":var012", ":var018"),
                (prop_instance_get_variation_id_2, ":prop_variation_id_2__020", ":scp_instance_019"),
                (try_begin),
                    (eq,":var017",":prop_variation_id_2__020"),
                    (assign,":var016",":scp_instance_019"),
                    (assign,":scp_num_instances_015",0),
                (try_end),
            (try_end),
            (try_begin),
                (eq,1,1),
                (prop_instance_get_position, pos0, ":var016"),
                (scene_prop_get_instance, ":scp_instance_003", "spr_pointer_arrow", 0),
                (prop_instance_get_position, pos1, ":scp_instance_003"),
                (set_fixed_point_multiplier, 1),
                (position_get_x,":pos_x_008",0),
                (position_get_x,":pos_x_009",1),
                (position_get_y,":pos_y_010",0),
                (position_get_y,":pos_y_011",1),
                (try_begin),
                    (this_or_next|eq,":pos_x_008",":pos_x_009"),
                    (neq,":pos_y_010",":pos_y_011"),
                    (prop_instance_set_position, ":scp_instance_003", 0),
                    (assign,"$g_pointer_arrow_height_adder",200),
                    (play_sound,"snd_tutorial_1"),
                (try_end),
            (try_end),
        (else_try),
            (assign,"$g_pointer_arrow_height_adder",-1000),
            (try_begin),
                (ge,"$g_tutorial_training_ground_horseman_trainer_item_2",0),
                (agent_unequip_item, ":agent_no_001", "$g_tutorial_training_ground_horseman_trainer_item_2"),
            (try_end),
            (agent_unequip_item, ":agent_no_001", "$g_tutorial_training_ground_horseman_trainer_item_1"),
            (tutorial_message,"str_tutorial_training_ground_horseman_text_6", 0, 10),
            (assign,"$g_tutorial_training_ground_horseman_trainer_state",0),
            (val_add, "$g_tutorial_training_ground_horseman_trainer_completed_chapters", 1),
            (play_sound,"snd_tutorial_2"),
        (try_end),
    (try_end),
], [
]),

(0.0, 0.0, 0.0, [
(try_begin),
    (neq,"$g_tutorial_training_ground_archer_trainer_state",0),
    (mission_disable_talk),
    (try_begin),
        (eq,"$g_tutorial_training_ground_archer_trainer_state",1),
        (try_begin),
            (eq,1,1),
            (assign,"$g_last_destroyed_gourds",0),
            (assign,"$g_tutorial_training_ground_current_score",0),
            (scene_spawned_item_get_instance, ":item_instance_002", "$g_tutorial_training_ground_archer_trainer_item_1", 0),
            (prop_instance_get_position, pos0, ":item_instance_002"),
            (position_move_z,0,1000,1),
            (prop_instance_set_position, ":item_instance_002", 0),
            (scene_prop_get_instance, ":scp_instance_003", "spr_pointer_arrow", 0),
            (prop_instance_set_position, ":scp_instance_003", 0),
            (assign,"$g_pointer_arrow_height_adder",100),
            (try_begin),
                (ge,"$g_tutorial_training_ground_archer_trainer_item_2",0),
                (scene_spawned_item_get_instance, ":item_instance_002", "$g_tutorial_training_ground_archer_trainer_item_2", 0),
                (prop_instance_get_position, pos0, ":item_instance_002"),
                (position_move_z,0,1000,1),
                (prop_instance_set_position, ":item_instance_002", 0),
            (try_end),
        (try_end),
        (val_add, "$g_tutorial_training_ground_archer_trainer_state", 1),
    (try_end),
(else_try),
    (eq,"$g_tutorial_training_ground_archer_trainer_state",2),
    (try_begin),
        (eq,1,1),
        (str_store_item_name,s0,"$g_tutorial_training_ground_archer_trainer_item_1"),
        (tutorial_message,"str_tutorial_training_ground_archer_text_1"),
        (try_begin),
            (agent_has_item_equipped,":agent_no_001","$g_tutorial_training_ground_archer_trainer_item_1"),
            (val_add, "$g_tutorial_training_ground_archer_trainer_state", 1),
            (play_sound,"snd_tutorial_1"),
        (try_end),
    (try_end),
(else_try),
    (eq,"$g_tutorial_training_ground_archer_trainer_state",3),
    (try_begin),
        (ge,"$g_tutorial_training_ground_archer_trainer_item_2",0),
        (try_begin),
            (eq,1,1),
            (str_store_item_name,s0,"$g_tutorial_training_ground_archer_trainer_item_2"),
            (tutorial_message,"str_tutorial_training_ground_archer_text_1"),
            (try_begin),
                (agent_has_item_equipped,":agent_no_001","$g_tutorial_training_ground_archer_trainer_item_2"),
                (val_add, "$g_tutorial_training_ground_archer_trainer_state", 1),
                (play_sound,"snd_tutorial_1"),
            (try_end),
        (try_end),
    (else_try),
        (val_add, "$g_tutorial_training_ground_archer_trainer_state", 1),
    (try_end),
(else_try),
    (eq,"$g_tutorial_training_ground_archer_trainer_state",4),
    (try_begin),
        (eq,1,1),
        (try_for_range, ":var004", 0, 3),
            (scene_prop_get_instance, ":scp_instance_005", "spr_gourd", ":var004"),
            (prop_instance_refill_hit_points, ":scp_instance_005"),
            (entry_point_get_position, pos0, 45),
            (init_position,1),
            (store_sub, ":var006", ":var004", 1),
            (val_mul, ":var006", 5),
            (position_rotate_z,1,":var006"),
            (try_begin),
                (ge,"$g_tutorial_training_ground_archer_trainer_item_2",0),
                (position_move_y,1,1300),
            (else_try),
                (position_move_y,1,800),
                (val_mul, ":var006", 2),
            (try_end),
            (position_transform_position_to_parent,2,0,1),
            (position_set_z_to_ground_level, 2),
            (scene_prop_get_instance, ":scp_instance_007", "spr_gourd_spike", ":var004"),
            (prop_instance_set_position, ":scp_instance_007", 2),
            (position_move_z,2,150,1),
            (prop_instance_set_position, ":scp_instance_005", 2),
        (try_end),
        (scene_prop_get_instance, ":scp_instance_003", "spr_pointer_arrow", 0),
        (scene_prop_get_instance, ":scp_instance_007", "spr_gourd_spike", 1),
        (prop_instance_get_position, pos1, ":scp_instance_007"),
        (prop_instance_set_position, ":scp_instance_003", 1),
        (assign,"$g_pointer_arrow_height_adder",200),
        (tutorial_message,"str_tutorial_training_ground_archer_text_2"),
        (val_add, "$g_tutorial_training_ground_archer_trainer_state", 1),
    (try_end),
(else_try),
    (eq,"$g_tutorial_training_ground_archer_trainer_state",5),
    (try_begin),
        (eq,1,1),
        (try_begin),
            (neq,"$g_tutorial_training_ground_current_score","$g_last_destroyed_gourds"),
            (assign,"$g_tutorial_training_ground_current_score","$g_last_destroyed_gourds"),
            (try_begin),
                (lt,"$g_last_destroyed_gourds",3),
                (play_sound,"snd_tutorial_1"),
            (else_try),
                (play_sound,"snd_tutorial_2"),
            (try_end),
        (try_end),
        (try_begin),
            (eq,"$g_tutorial_training_ground_archer_trainer_completed_chapters",0),
            (eq,"$g_last_destroyed_gourds",0),
            (entry_point_get_position, pos0, 45),
            (agent_get_position,pos1,":agent_no_001"),
            (try_begin),
                (neg|position_is_behind_position,1,0),
                (tutorial_message,"str_tutorial_training_ground_archer_text_3"),
            (else_try),
                (eq,"$g_tutorial_training_ground_archer_trainer_completed_chapters",0),
                (eq,"$g_last_destroyed_gourds",1),
                (tutorial_message,"str_tutorial_training_ground_archer_text_4"),
            (try_end),
        (try_end),
        (try_begin),
            (ge,"$g_last_destroyed_gourds",3),
            (assign,"$g_pointer_arrow_height_adder",-1000),
            (val_add, "$g_tutorial_training_ground_archer_trainer_state", 1),
        (try_end),
    (try_end),
(else_try),
    (eq,"$g_tutorial_training_ground_archer_trainer_state",6),
    (try_begin),
        (eq,1,1),
        (try_begin),
            (ge,"$g_tutorial_training_ground_archer_trainer_item_2",0),
            (agent_unequip_item, ":agent_no_001", "$g_tutorial_training_ground_archer_trainer_item_2"),
        (try_end),
        (agent_unequip_item, ":agent_no_001", "$g_tutorial_training_ground_archer_trainer_item_1"),
        (tutorial_message,"str_tutorial_training_ground_archer_text_5", 0, 10),
        (assign,"$g_tutorial_training_ground_archer_trainer_state",0),
        (val_add, "$g_tutorial_training_ground_archer_trainer_completed_chapters", 1),
    (try_end),
], [
]),

(0.0, 0.0, 0.0, [
(try_begin),
    (neq,"$g_tutorial_training_ground_melee_trainer_attack",-1),
    (mission_disable_talk),
    (try_for_agents, ":cur_agent"),
        (agent_get_troop_id,":troop_id_003", ":cur_agent"),
        (try_begin),
            (eq,":troop_id_003","$g_tutorial_training_ground_melee_trainer_attack"),
            (assign,":var004",":cur_agent"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,"$g_tutorial_training_ground_melee_state",0),
    (try_begin),
        (eq,1,1),
        (try_for_agents, ":cur_agent"),
            (agent_get_troop_id,":troop_id_003", ":cur_agent"),
            (try_begin),
                (this_or_next|eq,":troop_id_003","trp_tutorial_fighter_4"),
                (this_or_next|eq,":troop_id_003","trp_tutorial_fighter_3"),
                (this_or_next|eq,":troop_id_003","trp_tutorial_fighter_2"),
                (eq,":troop_id_003","trp_tutorial_fighter_1"),
                (agent_set_team, ":cur_agent", 7),
                (agent_get_slot,":agent_slot_005",":cur_agent",8),
                (entry_point_get_position, pos1, ":agent_slot_005"),
                (agent_set_scripted_destination,":cur_agent",1),
                (agent_force_rethink, ":cur_agent"),
            (try_end),
        (try_end),
        (agent_set_wielded_item, ":var004", "itm_practice_sword"),
        (store_random_in_range,"$g_tutorial_training_ground_melee_state",1,5),
        (assign,"$g_tutorial_update_mouse_presentation",1),
        (assign,"$g_tutorial_training_ground_next_score_time",0),
    (try_end),
(else_try),
    (gt,"$g_tutorial_training_ground_melee_state",0),
    (try_begin),
        (eq,1,1),
        (agent_set_team, ":agent_no_001", 1),
        (agent_set_team, ":var004", 2),
        (agent_get_position,pos1,":agent_no_001"),
        (agent_set_scripted_destination_no_attack,":var004",1),
        (agent_get_attack_action, ":agent_attack_action_006", ":agent_no_001"),
        (try_begin),
            (eq,":agent_attack_action_006",2),
            (agent_get_action_dir, ":agent_action_direction_007", ":agent_no_001"),
            (try_begin),
                (eq,":agent_action_direction_007",0),
                (agent_set_defend_action, ":var004", 0, 1),
            (else_try),
                (eq,":agent_action_direction_007",3),
                (agent_set_defend_action, ":var004", 3, 1),
            (else_try),
                (eq,":agent_action_direction_007",1),
                (agent_set_defend_action, ":var004", 2, 1),
            (else_try),
                (eq,":agent_action_direction_007",2),
                (agent_set_defend_action, ":var004", 1, 1),
            (try_end),
        (try_end),
        (try_begin),
            (ge,"$g_tutorial_training_ground_current_score",5),
            (tutorial_message, -1),
            (assign,"$g_tutorial_training_ground_melee_state",0),
            (agent_set_team, ":agent_no_001", 0),
            (agent_set_team, ":var004", 7),
            (agent_set_hit_points,":agent_no_001",100,0),
            (agent_set_hit_points,":var004",100,0),
            (assign,"$g_tutorial_training_ground_conversation_state",9),
            (start_mission_conversation,"$g_tutorial_training_ground_melee_trainer_attack"),
            (assign,"$g_tutorial_training_ground_melee_trainer_attack",-1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,1,1),
    (agent_get_attack_action, ":agent_attack_action_006", ":agent_no_001"),
    (try_begin),
        (eq,":agent_attack_action_006",2),
        (agent_get_action_dir, ":agent_action_direction_007", ":agent_no_001"),
        (store_add, ":var008", ":agent_action_direction_007", 1),
        (agent_get_wielded_item,":agent_wieled_item_009",":agent_no_001",0),
        (try_begin),
            (call_script, "script_cf_is_melee_weapon_for_tutorial", ":agent_wieled_item_009"),
            (store_mission_timer_a,":m_timer_a_010"),
            (try_begin),
                (gt,":m_timer_a_010","$g_tutorial_training_ground_next_score_time"),
                (try_begin),
                    (eq,":var008","$g_tutorial_training_ground_melee_state"),
                    (val_add, "$g_tutorial_training_ground_current_score", 1),
                    (try_begin),
                        (ge,"$g_tutorial_training_ground_current_score",5),
                        (assign,"$g_tutorial_training_ground_melee_state",5),
                        (play_sound,"snd_tutorial_2"),
                    (else_try),
                        (play_sound,"snd_tutorial_1"),
                        (assign,":var011",100),
                        (try_for_range, ":var012", 0, ":var011"),
                            (store_random_in_range,":random_x_013",1,5),
                            (try_begin),
                                (neq,":random_x_013","$g_tutorial_training_ground_melee_state"),
                                (assign,"$g_tutorial_training_ground_melee_state",":random_x_013"),
                                (assign,":var011",0),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
        (assign,"$g_tutorial_update_mouse_presentation",1),
    (else_try),
        (val_add, "$g_tutorial_training_ground_current_score_2", 1),
        (play_sound,"snd_tutorial_fail"),
    (try_end),
    (store_add, "$g_tutorial_training_ground_next_score_time", ":m_timer_a_010", 1),
(try_end),
(assign,reg0,"$g_tutorial_training_ground_current_score"),
(assign,reg1,"$g_tutorial_training_ground_current_score_2"),
(str_clear, 0),
(assign,"$g_tutorial_mouse_dir",-1),
(assign,"$g_tutorial_mouse_click",-1),
(try_begin),
    (neq,"$g_tutorial_training_ground_melee_state",5),
    (store_mission_timer_a,":m_timer_a_010"),
    (try_begin),
        (this_or_next|eq,"$g_tutorial_update_mouse_presentation",0),
        (gt,":m_timer_a_010","$g_tutorial_training_ground_next_score_time"),
        (try_begin),
            (eq,"$g_tutorial_training_ground_melee_state",1),
            (str_store_string,s0,"str_tutorial_training_ground_attack_training_down"),
        (else_try),
            (eq,"$g_tutorial_training_ground_melee_state",4),
            (str_store_string,s0,"str_tutorial_training_ground_attack_training_up"),
        (else_try),
            (eq,"$g_tutorial_training_ground_melee_state",2),
            (str_store_string,s0,"str_tutorial_training_ground_attack_training_right"),
        (else_try),
            (eq,"$g_tutorial_training_ground_melee_state",3),
            (str_store_string,s0,"str_tutorial_training_ground_attack_training_left"),
        (try_end),
    (try_end),
    (store_sub, "$g_tutorial_mouse_dir", "$g_tutorial_training_ground_melee_state", 1),
    (assign,"$g_tutorial_mouse_click",0),
    (try_begin),
        (eq,"$g_tutorial_update_mouse_presentation",1),
        (assign,"$g_tutorial_update_mouse_presentation",0),
        (start_presentation, "prsnt_tutorial_show_mouse_movement"),
    (try_end),
(try_end),
(try_begin),
    (eq,1,1),
    (agent_get_wielded_item,":agent_wieled_item_009",":agent_no_001",0),
    (try_begin),
        (call_script, "script_cf_is_melee_weapon_for_tutorial", ":agent_wieled_item_009"),
        (tutorial_message,"str_tutorial_training_ground_attack_training"),
    (else_try),
        (tutorial_message,"str_tutorial_training_ground_warning_melee"),
    (try_end),
], [
]),

(0.0, 0.0, 0.0, [
(try_begin),
    (neq,"$g_tutorial_training_ground_melee_trainer_parry",-1),
    (mission_disable_talk),
    (try_for_agents, ":cur_agent"),
        (agent_get_troop_id,":troop_id_003", ":cur_agent"),
        (try_begin),
            (eq,":troop_id_003","$g_tutorial_training_ground_melee_trainer_parry"),
            (assign,":var004",":cur_agent"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,"$g_tutorial_training_ground_melee_state",0),
    (try_begin),
        (eq,1,1),
        (try_for_agents, ":cur_agent"),
            (agent_get_troop_id,":troop_id_003", ":cur_agent"),
            (try_begin),
                (this_or_next|eq,":troop_id_003","trp_tutorial_fighter_4"),
                (this_or_next|eq,":troop_id_003","trp_tutorial_fighter_3"),
                (this_or_next|eq,":troop_id_003","trp_tutorial_fighter_2"),
                (eq,":troop_id_003","trp_tutorial_fighter_1"),
                (agent_set_team, ":cur_agent", 7),
                (agent_get_slot,":agent_slot_005",":cur_agent",8),
                (entry_point_get_position, pos1, ":agent_slot_005"),
                (agent_set_scripted_destination,":cur_agent",1),
                (agent_force_rethink, ":cur_agent"),
            (try_end),
        (try_end),
        (agent_set_wielded_item, ":var004", "itm_practice_sword"),
        (val_add, "$g_tutorial_training_ground_melee_state", 1),
        (store_mission_timer_a,"$g_tutorial_training_ground_melee_next_action_time"),
        (val_add, "$g_tutorial_training_ground_melee_next_action_time", 1),
    (try_end),
(else_try),
    (eq,"$g_tutorial_training_ground_melee_state",1),
    (try_begin),
        (eq,1,1),
        (store_mission_timer_a,":m_timer_a_006"),
        (try_begin),
            (gt,":m_timer_a_006","$g_tutorial_training_ground_melee_next_action_time"),
            (agent_set_team, ":agent_no_001", 1),
            (agent_set_team, ":var004", 2),
            (agent_get_position,pos1,":agent_no_001"),
            (agent_set_scripted_destination_no_attack,":var004",1),
            (agent_get_position,pos2,":var004"),
            (get_sq_distance_between_positions,":sq_distance_007",1,2),
            (try_begin),
                (lt,":sq_distance_007",400),
                (try_begin),
                    (eq,"$g_tutorial_training_ground_melee_trainer_action_state",0),
                    (try_begin),
                        (ge,"$g_tutorial_training_ground_current_score",5),
                        (assign,"$g_tutorial_mouse_dir",-1),
                        (assign,"$g_tutorial_mouse_click",-1),
                        (tutorial_message, -1),
                        (assign,"$g_tutorial_training_ground_melee_state",0),
                        (agent_set_team, ":agent_no_001", 0),
                        (agent_set_team, ":var004", 7),
                        (agent_set_hit_points,":agent_no_001",100,0),
                        (agent_set_hit_points,":var004",100,0),
                        (assign,"$g_tutorial_training_ground_conversation_state",1),
                        (start_mission_conversation,"$g_tutorial_training_ground_melee_trainer_parry"),
                        (assign,"$g_tutorial_training_ground_melee_trainer_parry",-1),
                    (else_try),
                        (store_random_in_range,":random_x_008",0,4),
                        (agent_set_attack_action, ":var004", ":random_x_008", 1),
                        (val_add, "$g_tutorial_training_ground_melee_trainer_action_state", 1),
                        (assign,"$g_tutorial_mouse_dir",":random_x_008"),
                        (try_begin),
                            (is_between,":random_x_008",1,3),
                            (store_sub, "$g_tutorial_mouse_dir", 3, ":random_x_008"),
                        (try_end),
                    (try_end),
                (try_end),
                (assign,"$g_tutorial_mouse_click",1),
                (start_presentation, "prsnt_tutorial_show_mouse_movement"),
            (try_end),
        (else_try),
            (eq,"$g_tutorial_training_ground_melee_trainer_action_state",1),
            (agent_get_defend_action, ":agent_defend_action_009", ":agent_no_001"),
            (try_begin),
                (gt,":agent_defend_action_009",0),
                (agent_get_action_dir, ":agent_action_direction_010", ":agent_no_001"),
                (agent_get_action_dir, ":agent_action_direction_011", ":var004"),
                (assign,":var012",0),
                (try_begin),
                    (eq,":agent_action_direction_011",0),
                    (eq,":agent_action_direction_010",0),
                    (assign,":var012",1),
                (else_try),
                    (eq,":agent_action_direction_011",3),
                    (eq,":agent_action_direction_010",3),
                    (assign,":var012",1),
                (else_try),
                    (eq,":agent_action_direction_011",1),
                    (eq,":agent_action_direction_010",2),
                    (assign,":var012",1),
                (else_try),
                    (eq,":agent_action_direction_011",2),
                    (eq,":agent_action_direction_010",1),
                    (assign,":var012",1),
                (try_end),
            (try_end),
            (try_begin),
                (eq,":var012",1),
                (assign,"$g_tutorial_mouse_dir",-1),
                (assign,"$g_tutorial_mouse_click",-1),
                (agent_set_attack_action, ":var004", 0, 0),
                (val_add, "$g_tutorial_training_ground_melee_trainer_action_state", 1),
                (store_mission_timer_a,"$g_tutorial_training_ground_melee_trainer_next_action_time"),
                (val_add, "$g_tutorial_training_ground_melee_trainer_next_action_time", 2),
            (else_try),
                (eq,"$g_tutorial_training_ground_melee_trainer_action_state",2),
                (try_begin),
                    (eq,1,1),
                    (store_mission_timer_a,":m_timer_a_006"),
                    (try_begin),
                        (gt,":m_timer_a_006","$g_tutorial_training_ground_melee_trainer_next_action_time"),
                        (assign,"$g_tutorial_training_ground_melee_trainer_action_state",0),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (agent_is_in_parried_animation, ":var004"),
    (agent_get_wielded_item,":agent_wieled_item_013",":agent_no_001",1),
    (try_begin),
        (eq,":agent_wieled_item_013",-1),
        (agent_get_wielded_item,":agent_wieled_item_014",":agent_no_001",0),
        (try_begin),
            (neq,":agent_wieled_item_014","itm_practice_dagger"),
            (call_script, "script_cf_is_melee_weapon_for_tutorial", ":agent_wieled_item_014"),
            (store_mission_timer_a,":m_timer_a_006"),
            (try_begin),
                (gt,":m_timer_a_006","$g_tutorial_training_ground_next_score_time"),
                (val_add, "$g_tutorial_training_ground_current_score", 1),
                (try_begin),
                    (lt,"$g_tutorial_training_ground_current_score",5),
                    (play_sound,"snd_tutorial_1"),
                (else_try),
                    (play_sound,"snd_tutorial_2"),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (store_add, "$g_tutorial_training_ground_next_score_time", ":m_timer_a_006", 1),
(try_end),
(assign,reg0,"$g_tutorial_training_ground_current_score"),
(try_begin),
    (eq,1,1),
    (agent_get_wielded_item,":agent_wieled_item_013",":agent_no_001",1),
    (try_begin),
        (eq,":agent_wieled_item_013",-1),
        (agent_get_wielded_item,":agent_wieled_item_014",":agent_no_001",0),
        (try_begin),
            (neq,":agent_wieled_item_014","itm_practice_dagger"),
            (call_script, "script_cf_is_melee_weapon_for_tutorial", ":agent_wieled_item_014"),
            (tutorial_message,"str_tutorial_training_ground_parry_training"),
        (else_try),
            (neq,":agent_wieled_item_013",-1),
            (tutorial_message,"str_tutorial_training_ground_warning_shield"),
        (else_try),
            (tutorial_message,"str_tutorial_training_ground_warning_melee_with_parry"),
        (try_end),
    (try_end),
], [
]),

(0.0, 0.0, 0.0, [
(try_begin),
    (neq,"$g_tutorial_training_ground_melee_trainer_chamber",-1),
    (mission_disable_talk),
    (try_for_agents, ":cur_agent"),
        (agent_get_troop_id,":troop_id_003", ":cur_agent"),
        (try_begin),
            (eq,":troop_id_003","$g_tutorial_training_ground_melee_trainer_chamber"),
            (assign,":var004",":cur_agent"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,"$g_tutorial_training_ground_melee_state",0),
    (try_begin),
        (eq,1,1),
        (try_for_agents, ":cur_agent"),
            (agent_get_troop_id,":troop_id_003", ":cur_agent"),
            (try_begin),
                (this_or_next|eq,":troop_id_003","trp_tutorial_fighter_4"),
                (this_or_next|eq,":troop_id_003","trp_tutorial_fighter_3"),
                (this_or_next|eq,":troop_id_003","trp_tutorial_fighter_2"),
                (eq,":troop_id_003","trp_tutorial_fighter_1"),
                (agent_set_team, ":cur_agent", 7),
                (agent_get_slot,":agent_slot_005",":cur_agent",8),
                (entry_point_get_position, pos1, ":agent_slot_005"),
                (agent_set_scripted_destination,":cur_agent",1),
                (agent_force_rethink, ":cur_agent"),
            (try_end),
        (try_end),
        (agent_set_wielded_item, ":var004", "itm_practice_sword"),
        (val_add, "$g_tutorial_training_ground_melee_state", 1),
        (store_mission_timer_a,"$g_tutorial_training_ground_melee_next_action_time"),
        (val_add, "$g_tutorial_training_ground_melee_next_action_time", 1),
    (try_end),
(else_try),
    (eq,"$g_tutorial_training_ground_melee_state",1),
    (try_begin),
        (eq,1,1),
        (store_mission_timer_a,":m_timer_a_006"),
        (try_begin),
            (gt,":m_timer_a_006","$g_tutorial_training_ground_melee_next_action_time"),
            (agent_set_team, ":agent_no_001", 1),
            (agent_set_team, ":var004", 2),
            (agent_get_position,pos1,":agent_no_001"),
            (agent_set_scripted_destination_no_attack,":var004",1),
            (agent_get_position,pos2,":var004"),
            (get_sq_distance_between_positions,":sq_distance_007",1,2),
            (try_begin),
                (lt,":sq_distance_007",400),
                (try_begin),
                    (eq,"$g_tutorial_training_ground_melee_trainer_action_state",0),
                    (try_begin),
                        (ge,"$g_tutorial_training_ground_current_score",5),
                        (tutorial_message, -1),
                        (assign,"$g_tutorial_training_ground_melee_state",0),
                        (agent_set_team, ":agent_no_001", 0),
                        (agent_set_team, ":var004", 7),
                        (agent_set_hit_points,":agent_no_001",100,0),
                        (agent_set_hit_points,":var004",100,0),
                        (assign,"$g_tutorial_training_ground_conversation_state",6),
                        (start_mission_conversation,"$g_tutorial_training_ground_melee_trainer_chamber"),
                        (assign,"$g_tutorial_training_ground_melee_trainer_chamber",-1),
                    (else_try),
                        (store_random_in_range,"$g_tutorial_training_ground_melee_trainer_attack_dir",0,4),
                        (agent_set_attack_action, ":var004", "$g_tutorial_training_ground_melee_trainer_attack_dir", 1),
                        (val_add, "$g_tutorial_training_ground_melee_trainer_action_state", 1),
                        (store_mission_timer_a,"$g_tutorial_training_ground_melee_trainer_next_action_time"),
                        (val_add, "$g_tutorial_training_ground_melee_trainer_next_action_time", 1),
                    (try_end),
                (try_end),
            (try_end),
        (else_try),
            (eq,"$g_tutorial_training_ground_melee_trainer_action_state",1),
            (try_begin),
                (eq,1,1),
                (store_mission_timer_a,":m_timer_a_006"),
                (try_begin),
                    (gt,":m_timer_a_006","$g_tutorial_training_ground_melee_trainer_next_action_time"),
                    (agent_set_attack_action, ":var004", -1, 0),
                    (agent_set_defend_action, ":var004", 0, 1),
                    (val_add, "$g_tutorial_training_ground_melee_trainer_action_state", 1),
                    (store_mission_timer_a,"$g_tutorial_training_ground_melee_trainer_next_action_time"),
                    (val_add, "$g_tutorial_training_ground_melee_trainer_next_action_time", 1),
                (try_end),
            (try_end),
        (else_try),
            (eq,"$g_tutorial_training_ground_melee_trainer_action_state",2),
            (try_begin),
                (eq,1,1),
                (store_mission_timer_a,":m_timer_a_006"),
                (try_begin),
                    (gt,":m_timer_a_006","$g_tutorial_training_ground_melee_trainer_next_action_time"),
                    (agent_set_attack_action, ":var004", "$g_tutorial_training_ground_melee_trainer_attack_dir", 0),
                    (val_add, "$g_tutorial_training_ground_melee_trainer_action_state", 1),
                    (store_mission_timer_a,"$g_tutorial_training_ground_melee_trainer_next_action_time"),
                    (val_add, "$g_tutorial_training_ground_melee_trainer_next_action_time", 2),
                (try_end),
            (try_end),
        (else_try),
            (eq,"$g_tutorial_training_ground_melee_trainer_action_state",3),
            (try_begin),
                (eq,1,1),
                (store_mission_timer_a,":m_timer_a_006"),
                (try_begin),
                    (gt,":m_timer_a_006","$g_tutorial_training_ground_melee_trainer_next_action_time"),
                    (assign,"$g_tutorial_training_ground_melee_trainer_action_state",0),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (agent_is_in_parried_animation, ":var004"),
    (agent_get_attack_action, ":agent_attack_action_008", ":agent_no_001"),
    (store_mission_timer_a,":m_timer_a_006"),
    (try_begin),
        (gt,":m_timer_a_006","$g_tutorial_training_ground_next_score_time"),
        (store_add, "$g_tutorial_training_ground_next_score_time", ":m_timer_a_006", 1),
        (try_begin),
            (eq,":agent_attack_action_008",1),
            (val_add, "$g_tutorial_training_ground_current_score", 1),
            (try_begin),
                (lt,"$g_tutorial_training_ground_current_score",5),
                (play_sound,"snd_tutorial_1"),
            (else_try),
                (play_sound,"snd_tutorial_2"),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(assign,reg0,"$g_tutorial_training_ground_current_score"),
], [
]),

(0.0, 0.0, 0.0, [
(try_begin),
    (neq,"$g_tutorial_training_ground_melee_trainer_combat",-1),
    (mission_disable_talk),
    (try_for_agents, ":cur_agent"),
        (agent_get_troop_id,":troop_id_003", ":cur_agent"),
        (try_begin),
            (eq,":troop_id_003","$g_tutorial_training_ground_melee_trainer_combat"),
            (assign,":var004",":cur_agent"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,"$g_tutorial_training_ground_melee_state",0),
    (try_begin),
        (eq,1,1),
        (try_for_agents, ":cur_agent"),
            (agent_get_troop_id,":troop_id_003", ":cur_agent"),
            (try_begin),
                (this_or_next|eq,":troop_id_003","trp_tutorial_fighter_4"),
                (this_or_next|eq,":troop_id_003","trp_tutorial_fighter_3"),
                (this_or_next|eq,":troop_id_003","trp_tutorial_fighter_2"),
                (eq,":troop_id_003","trp_tutorial_fighter_1"),
                (agent_set_team, ":cur_agent", 7),
                (agent_get_slot,":agent_slot_005",":cur_agent",8),
                (entry_point_get_position, pos1, ":agent_slot_005"),
                (agent_set_scripted_destination,":cur_agent",1),
                (agent_force_rethink, ":cur_agent"),
            (try_end),
        (try_end),
        (agent_set_wielded_item, ":var004", "itm_practice_sword"),
        (val_add, "$g_tutorial_training_ground_melee_state", 1),
        (store_mission_timer_a,"$g_tutorial_training_ground_melee_next_action_time"),
        (val_add, "$g_tutorial_training_ground_melee_next_action_time", 1),
    (try_end),
(else_try),
    (eq,"$g_tutorial_training_ground_melee_state",1),
    (try_begin),
        (eq,1,1),
        (store_mission_timer_a,":m_timer_a_006"),
        (try_begin),
            (gt,":m_timer_a_006","$g_tutorial_training_ground_melee_next_action_time"),
            (agent_set_team, ":agent_no_001", 1),
            (agent_set_team, ":var004", 2),
            (agent_clear_scripted_mode,":var004"),
            (agent_force_rethink, ":var004"),
        (try_end),
    (try_end),
], [
]),

(0.0, 0.0, 0.0, [
(eq,"$g_tutorial_training_ground_melee_trainer_attack",-1),
(eq,"$g_tutorial_training_ground_melee_trainer_parry",-1),
(eq,"$g_tutorial_training_ground_melee_trainer_combat",-1),
(eq,"$g_tutorial_training_ground_melee_trainer_chamber",-1),
(eq,"$g_tutorial_training_ground_archer_trainer_state",0),
(eq,"$g_tutorial_training_ground_horseman_trainer_state",0),
(mission_enable_talk),
], [
]),

(0.0, 0.0, 0.0, [
(eq,"$g_tutorial_training_ground_melee_trainer_attack",-1),
(eq,"$g_tutorial_training_ground_melee_trainer_parry",-1),
(eq,"$g_tutorial_training_ground_melee_trainer_combat",-1),
(eq,"$g_tutorial_training_ground_melee_trainer_chamber",-1),
(get_player_agent_no,":agent_no_001"),
(agent_get_position,pos1,":agent_no_001"),
(assign,":var002",10000000),
(try_for_agents, ":cur_agent"),
    (agent_get_troop_id,":troop_id_004", ":cur_agent"),
    (try_begin),
        (this_or_next|eq,":troop_id_004","trp_tutorial_fighter_4"),
        (this_or_next|eq,":troop_id_004","trp_tutorial_fighter_3"),
        (this_or_next|eq,":troop_id_004","trp_tutorial_fighter_2"),
        (eq,":troop_id_004","trp_tutorial_fighter_1"),
        (agent_get_position,pos2,":cur_agent"),
        (get_sq_distance_between_positions,":sq_distance_005",1,2),
        (try_begin),
            (lt,":sq_distance_005",":var002"),
            (assign,":var002",":sq_distance_005"),
        (try_end),
    (try_end),
(try_end),
(try_end),
(try_begin),
(le,":var002",1600),
(assign,"$g_tutorial_training_ground_melee_paused",1),
(try_for_agents, ":cur_agent"),
    (agent_get_troop_id,":troop_id_004", ":cur_agent"),
    (try_begin),
        (this_or_next|eq,":troop_id_004","trp_tutorial_fighter_4"),
        (this_or_next|eq,":troop_id_004","trp_tutorial_fighter_3"),
        (this_or_next|eq,":troop_id_004","trp_tutorial_fighter_2"),
        (eq,":troop_id_004","trp_tutorial_fighter_1"),
        (agent_set_team, ":cur_agent", 7),
        (agent_get_position,pos2,":cur_agent"),
        (agent_set_scripted_destination,":cur_agent",2),
        (try_begin),
            (neq,":cur_agent","$g_tutorial_training_ground_melee_cur_fighter_1"),
            (neq,":cur_agent","$g_tutorial_training_ground_melee_cur_fighter_2"),
            (agent_set_wielded_item, ":cur_agent", -1),
        (try_end),
    (try_end),
    (agent_force_rethink, ":cur_agent"),
    (agent_set_look_target_agent, ":cur_agent", ":agent_no_001"),
(try_end),
(else_try),
(gt,"$g_tutorial_training_ground_melee_paused",0),
(assign,"$g_tutorial_training_ground_melee_paused",0),
(assign,"$g_tutorial_training_ground_melee_state",0),
(try_end),
(try_begin),
(eq,"$g_tutorial_training_ground_melee_paused",0),
(eq,"$g_tutorial_training_ground_melee_state",0),
(try_begin),
    (eq,1,1),
    (assign,"$g_tutorial_training_ground_melee_cur_fighter_1",-1),
    (assign,"$g_tutorial_training_ground_melee_cur_fighter_2",-1),
    (try_for_range, ":var006", 0, 2),
        (try_begin),
            (ge,"$g_tutorial_training_ground_melee_last_winner",0),
            (assign,"$g_tutorial_training_ground_melee_cur_fighter_1","$g_tutorial_training_ground_melee_last_winner"),
            (assign,"$g_tutorial_training_ground_melee_last_winner",-1),
        (try_end),
        (try_begin),
            (this_or_next|eq,"$g_tutorial_training_ground_melee_cur_fighter_1",-1),
            (eq,"$g_tutorial_training_ground_melee_cur_fighter_2",-1),
            (assign,":var007",0),
            (try_for_agents, ":cur_agent"),
                (agent_get_troop_id,":troop_id_004", ":cur_agent"),
                (try_begin),
                    (this_or_next|eq,":troop_id_004","trp_tutorial_fighter_1"),
                    (this_or_next|eq,":troop_id_004","trp_tutorial_fighter_2"),
                    (this_or_next|eq,":troop_id_004","trp_tutorial_fighter_3"),
                    (eq,":troop_id_004","trp_tutorial_fighter_4"),
                    (neq,":cur_agent","$g_tutorial_training_ground_melee_cur_fighter_1"),
                    (neq,":cur_agent","$g_tutorial_training_ground_melee_cur_fighter_2"),
                    (neq,":cur_agent","$g_tutorial_training_ground_melee_last_loser"),
                    (val_add, ":var007", 1),
                (try_end),
            (try_end),
        (try_end),
        (store_random_in_range,":random_x_008",0,":var007"),
        (try_for_agents, ":cur_agent"),
            (agent_get_troop_id,":troop_id_004", ":cur_agent"),
            (try_begin),
                (this_or_next|eq,":troop_id_004","trp_tutorial_fighter_1"),
                (this_or_next|eq,":troop_id_004","trp_tutorial_fighter_2"),
                (this_or_next|eq,":troop_id_004","trp_tutorial_fighter_3"),
                (eq,":troop_id_004","trp_tutorial_fighter_4"),
                (neq,":cur_agent","$g_tutorial_training_ground_melee_cur_fighter_1"),
                (neq,":cur_agent","$g_tutorial_training_ground_melee_cur_fighter_2"),
                (neq,":cur_agent","$g_tutorial_training_ground_melee_last_loser"),
                (val_sub, ":random_x_008", 1),
                (try_begin),
                    (lt,":random_x_008",0),
                    (try_begin),
                        (eq,"$g_tutorial_training_ground_melee_cur_fighter_1",-1),
                        (assign,"$g_tutorial_training_ground_melee_cur_fighter_1",":cur_agent"),
                    (else_try),
                        (assign,"$g_tutorial_training_ground_melee_cur_fighter_2",":cur_agent"),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_for_agents, ":cur_agent"),
        (agent_get_troop_id,":troop_id_004", ":cur_agent"),
        (try_begin),
            (this_or_next|eq,":troop_id_004","trp_tutorial_fighter_1"),
            (this_or_next|eq,":troop_id_004","trp_tutorial_fighter_2"),
            (this_or_next|eq,":troop_id_004","trp_tutorial_fighter_3"),
            (eq,":troop_id_004","trp_tutorial_fighter_4"),
            (neq,":cur_agent","$g_tutorial_training_ground_melee_cur_fighter_1"),
            (neq,":cur_agent","$g_tutorial_training_ground_melee_cur_fighter_2"),
            (agent_set_wielded_item, ":cur_agent", -1),
        (try_end),
    (try_end),
    (val_add, "$g_tutorial_training_ground_melee_state", 1),
    (store_mission_timer_a,"$g_tutorial_training_ground_melee_next_action_time"),
    (val_add, "$g_tutorial_training_ground_melee_next_action_time", 3),
(try_end),
(else_try),
(eq,"$g_tutorial_training_ground_melee_state",1),
(try_begin),
    (eq,1,1),
    (store_mission_timer_a,":m_timer_a_009"),
    (try_begin),
        (gt,":m_timer_a_009","$g_tutorial_training_ground_melee_next_action_time"),
        (try_for_agents, ":cur_agent"),
            (try_begin),
                (agent_is_human,":cur_agent"),
                (agent_get_troop_id,":troop_id_004", ":cur_agent"),
                (try_begin),
                    (this_or_next|eq,":troop_id_004","trp_tutorial_fighter_4"),
                    (this_or_next|eq,":troop_id_004","trp_tutorial_fighter_3"),
                    (this_or_next|eq,":troop_id_004","trp_tutorial_fighter_2"),
                    (eq,":troop_id_004","trp_tutorial_fighter_1"),
                    (try_begin),
                        (eq,":cur_agent","$g_tutorial_training_ground_melee_cur_fighter_1"),
                        (entry_point_get_position, pos1, 30),
                        (agent_set_scripted_destination,":cur_agent",1),
                    (else_try),
                        (eq,":cur_agent","$g_tutorial_training_ground_melee_cur_fighter_2"),
                        (entry_point_get_position, pos1, 31),
                        (agent_set_scripted_destination,":cur_agent",1),
                    (else_try),
                        (agent_get_slot,":agent_slot_010",":cur_agent",8),
                        (entry_point_get_position, pos1, ":agent_slot_010"),
                        (agent_set_scripted_destination,":cur_agent",1),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (val_add, "$g_tutorial_training_ground_melee_state", 1),
(try_end),
(else_try),
(eq,"$g_tutorial_training_ground_melee_state",2),
(try_begin),
    (eq,1,1),
    (agent_set_look_target_agent, "$g_tutorial_training_ground_melee_cur_fighter_1", "$g_tutorial_training_ground_melee_cur_fighter_2"),
    (agent_set_look_target_agent, "$g_tutorial_training_ground_melee_cur_fighter_2", "$g_tutorial_training_ground_melee_cur_fighter_1"),
    (agent_get_position,pos1,"$g_tutorial_training_ground_melee_cur_fighter_1"),
    (entry_point_get_position, pos2, 30),
    (get_sq_distance_between_positions,":sq_distance_011",1,2),
    (try_begin),
        (lt,":sq_distance_011",400),
        (agent_get_position,pos1,"$g_tutorial_training_ground_melee_cur_fighter_2"),
        (entry_point_get_position, pos2, 31),
        (get_sq_distance_between_positions,":sq_distance_012",1,2),
        (try_begin),
            (lt,":sq_distance_012",400),
            (val_add, "$g_tutorial_training_ground_melee_state", 1),
            (store_mission_timer_a,"$g_tutorial_training_ground_melee_next_action_time"),
            (val_add, "$g_tutorial_training_ground_melee_next_action_time", 1),
        (try_end),
    (try_end),
(try_end),
(else_try),
(eq,"$g_tutorial_training_ground_melee_state",3),
(try_begin),
    (eq,1,1),
    (agent_set_look_target_agent, "$g_tutorial_training_ground_melee_cur_fighter_1", "$g_tutorial_training_ground_melee_cur_fighter_2"),
    (agent_set_look_target_agent, "$g_tutorial_training_ground_melee_cur_fighter_2", "$g_tutorial_training_ground_melee_cur_fighter_1"),
    (store_mission_timer_a,":m_timer_a_009"),
    (try_begin),
        (gt,":m_timer_a_009","$g_tutorial_training_ground_melee_next_action_time"),
        (agent_clear_scripted_mode,"$g_tutorial_training_ground_melee_cur_fighter_1"),
        (agent_clear_scripted_mode,"$g_tutorial_training_ground_melee_cur_fighter_2"),
        (agent_set_team, "$g_tutorial_training_ground_melee_cur_fighter_1", 1),
        (agent_set_team, "$g_tutorial_training_ground_melee_cur_fighter_2", 2),
        (agent_force_rethink, "$g_tutorial_training_ground_melee_cur_fighter_1"),
        (agent_force_rethink, "$g_tutorial_training_ground_melee_cur_fighter_2"),
        (val_add, "$g_tutorial_training_ground_melee_state", 1),
    (try_end),
(try_end),
], [
]),

]),
("tutorial_1", 0, -1,
"You enter the training ground.",
[(0, mtef_no_companions|mtef_no_regulars|mtef_leader_only, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_foot|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all|af_override_everything, 0, 1, [itm_tutorial_shield,itm_tutorial_sword,itm_tutorial_short_bow,itm_tutorial_arrows,itm_leather_jerkin,itm_leather_boots,]),
],
[
(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (lt,"$tutorial_1_state",5),
    (question_box,"str_do_you_wish_to_leave_tutorial"),
(else_try),
    (finish_mission, 0),
(try_end),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (finish_mission, 0),
(try_end),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_tutorial"),
], [
]),

(0.0, 0.0, ti_once, [
(tutorial_message_set_position, 500, 650),
(tutorial_message_set_center_justify, 0),
(assign,"$tutorial_1_state",0),
(assign,"$tutorial_1_msg_1_displayed",0),
(assign,"$tutorial_1_msg_2_displayed",0),
(assign,"$tutorial_1_msg_3_displayed",0),
(assign,"$tutorial_1_msg_4_displayed",0),
(assign,"$tutorial_1_msg_5_displayed",0),
], [
]),

(0.0, 0.0, 0.0, [
(eq,"$tutorial_1_state",0),
(try_begin),
    (eq,"$tutorial_1_msg_1_displayed",0),
    (store_mission_timer_a,":m_timer_a_001"),
    (try_begin),
        (gt,":m_timer_a_001",0),
        (assign,"$tutorial_1_msg_1_displayed",1),
        (tutorial_message,"str_tutorial_1_msg_1"),
        (scene_prop_get_instance, ":scp_instance_002", "spr_tutorial_flag_yellow", 0),
        (entry_point_get_position, pos1, 1),
        (prop_instance_animate_to_position, ":scp_instance_002", 1, 1),
    (try_end),
(try_end),
(tutorial_message,"str_tutorial_1_msg_1"),
(get_player_agent_no,":agent_no_003"),
(agent_get_position,pos1,":agent_no_003"),
(entry_point_get_position, pos2, 1),
(get_distance_between_positions,":distance_004",1,2),
(try_begin),
    (le,":distance_004",100),
    (val_add, "$tutorial_1_state", 1),
    (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_a", 0),
    (prop_instance_get_position, pos1, ":scp_instance_005"),
    (position_rotate_z,1,-90),
    (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
    (scene_prop_get_instance, ":scp_instance_002", "spr_tutorial_flag_yellow", 0),
    (entry_point_get_position, pos1, 2),
    (prop_instance_animate_to_position, ":scp_instance_002", 1, 1),
(else_try),
    (eq,"$tutorial_1_state",1),
    (try_begin),
        (eq,"$tutorial_1_msg_2_displayed",0),
        (assign,"$tutorial_1_msg_2_displayed",1),
        (tutorial_message,"str_tutorial_1_msg_2"),
        (play_sound,"snd_tutorial_1"),
    (try_end),
(try_end),
(get_player_agent_no,":agent_no_003"),
(agent_get_position,pos1,":agent_no_003"),
(entry_point_get_position, pos2, 2),
(get_distance_between_positions,":distance_004",1,2),
(try_begin),
    (le,":distance_004",100),
    (val_add, "$tutorial_1_state", 1),
    (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_a", 1),
    (prop_instance_get_position, pos1, ":scp_instance_005"),
    (position_rotate_z,1,90),
    (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
    (scene_prop_get_instance, ":scp_instance_002", "spr_tutorial_flag_yellow", 0),
    (entry_point_get_position, pos1, 3),
    (prop_instance_animate_to_position, ":scp_instance_002", 1, 1),
(else_try),
    (eq,"$tutorial_1_state",2),
    (try_begin),
        (eq,"$tutorial_1_msg_3_displayed",0),
        (assign,"$tutorial_1_msg_3_displayed",1),
        (tutorial_message,"str_tutorial_1_msg_3"),
        (assign,"$tutorial_num_total_dummies_destroyed",0),
        (play_sound,"snd_tutorial_1"),
    (try_end),
(try_end),
(try_begin),
    (ge,"$tutorial_num_total_dummies_destroyed",4),
    (val_add, "$tutorial_1_state", 1),
    (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_a", 2),
    (prop_instance_get_position, pos1, ":scp_instance_005"),
    (position_rotate_z,1,90),
    (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
(else_try),
    (eq,"$tutorial_1_state",3),
    (try_begin),
        (eq,"$tutorial_1_msg_4_displayed",0),
        (assign,"$tutorial_1_msg_4_displayed",1),
        (tutorial_message,"str_tutorial_1_msg_4"),
        (store_mission_timer_a,"$tutorial_time"),
        (play_sound,"snd_tutorial_1"),
    (try_end),
(try_end),
(store_mission_timer_a,":m_timer_a_001"),
(val_sub, ":m_timer_a_001", "$tutorial_time"),
(try_begin),
    (gt,":m_timer_a_001",10),
    (val_add, "$tutorial_1_state", 1),
(else_try),
    (eq,"$tutorial_1_state",4),
    (try_begin),
        (eq,"$tutorial_1_msg_5_displayed",0),
        (assign,"$tutorial_1_msg_5_displayed",1),
        (tutorial_message,"str_tutorial_1_msg_5"),
        (assign,"$g_last_archery_point_earned",0),
        (assign,"$tutorial_num_arrows_hit",0),
        (play_sound,"snd_tutorial_1"),
    (try_end),
(try_end),
(try_begin),
    (eq,1,1),
    (get_player_agent_no,":agent_no_003"),
    (agent_get_ammo,":agent_ammo_006",":agent_no_003"),
    (try_begin),
        (le,":agent_ammo_006",0),
        (agent_refill_ammo,":agent_no_003"),
        (tutorial_message,"str_tutorial_ammo_refilled"),
    (try_end),
(try_end),
(try_begin),
    (gt,"$g_last_archery_point_earned",0),
    (assign,"$g_last_archery_point_earned",0),
    (val_add, "$tutorial_num_arrows_hit", 1),
    (try_begin),
        (gt,"$tutorial_num_arrows_hit",2),
        (val_add, "$tutorial_1_state", 1),
    (else_try),
        (eq,"$tutorial_1_state",5),
        (eq,"$tutorial_1_msg_6_displayed",0),
        (assign,"$tutorial_1_msg_6_displayed",1),
        (tutorial_message,"str_tutorial_1_msg_6"),
        (play_sound,"snd_tutorial_2"),
        (assign,"$tutorial_1_finished",1),
    (try_end),
(try_end),
], [
]),

]),
("tutorial_2", mtf_arena_fight|mtf_team_fight, -1,
"You enter the training ground.",
[(0, mtef_no_companions|mtef_no_regulars|mtef_team_0|mtef_leader_only, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_foot|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all|af_override_everything, 0, 1, [itm_tutorial_shield,itm_leather_jerkin,itm_leather_boots,]),
(2, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(4, mtef_visitor_source|mtef_team_1, 0, 0, 1, []),
],
[
(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (lt,"$tutorial_2_state",9),
    (question_box,"str_do_you_wish_to_leave_tutorial"),
(else_try),
    (finish_mission, 0),
(try_end),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (finish_mission, 0),
(try_end),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_tutorial"),
], [
]),

(0.0, 0.0, ti_once, [
(try_begin),
    (gt,":m_timer_a_001",2),
    (main_hero_fallen),
    (assign,"$tutorial_2_state",100),
], [
]),

(0.0, 0.0, ti_once, [
(tutorial_message_set_position, 500, 650),
(tutorial_message_set_center_justify, 0),
(assign,"$tutorial_2_state",0),
(assign,"$tutorial_2_msg_1_displayed",0),
(assign,"$tutorial_2_msg_2_displayed",0),
(assign,"$tutorial_2_msg_3_displayed",0),
(assign,"$tutorial_2_msg_4_displayed",0),
(assign,"$tutorial_2_msg_5_displayed",0),
(assign,"$tutorial_2_msg_6_displayed",0),
(assign,"$tutorial_2_msg_7_displayed",0),
(assign,"$tutorial_2_msg_8_displayed",0),
(assign,"$tutorial_2_msg_9_displayed",0),
], [
]),

(10.0, 0.0, 0.0, [
(call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_archer"),
(agent_refill_ammo,reg0),
], [
]),

(0.0, 0.0, 0.0, [
(eq,"$tutorial_2_state",0),
(try_begin),
    (eq,"$tutorial_2_msg_1_displayed",0),
    (store_mission_timer_a,":m_timer_a_001"),
    (try_begin),
        (gt,":m_timer_a_001",0),
        (assign,"$tutorial_2_msg_1_displayed",1),
        (tutorial_message,"str_tutorial_2_msg_1"),
        (team_give_order, 1, 9, 11),
        (team_give_order, 1, 0, 2),
        (try_begin),
            (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_maceman"),
            (assign,":var002",reg0),
            (agent_get_position,pos1,":var002"),
            (agent_set_scripted_destination,":var002",1,0),
        (try_end),
    (try_end),
(try_end),
(get_player_agent_no,":agent_no_003"),
(try_begin),
    (ge,":agent_no_003",0),
    (agent_get_position,pos1,":agent_no_003"),
    (entry_point_get_position, pos2, 1),
    (get_distance_between_positions,":distance_004",1,2),
    (try_begin),
        (le,":distance_004",200),
        (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_a", 0),
        (prop_instance_get_position, pos1, ":scp_instance_005"),
        (position_rotate_z,1,90),
        (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
        (val_add, "$tutorial_2_state", 1),
    (else_try),
        (eq,"$tutorial_2_state",1),
        (scene_prop_get_instance, ":scp_instance_006", "spr_barrier_4m", 0),
        (prop_instance_get_position, pos1, ":scp_instance_006"),
        (get_player_agent_no,":agent_no_003"),
        (agent_get_position,pos2,":agent_no_003"),
        (try_begin),
            (position_is_behind_position,2,1),
            (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_a", 0),
            (prop_instance_get_position, pos1, ":scp_instance_005"),
            (position_rotate_z,1,-90),
            (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
            (val_add, "$tutorial_2_state", 1),
        (else_try),
            (eq,"$tutorial_2_state",2),
            (get_player_agent_no,":agent_no_003"),
            (agent_set_kick_allowed, ":agent_no_003", 0),
            (try_begin),
                (eq,"$tutorial_2_melee_agent_state",0),
                (val_add, "$tutorial_2_melee_agent_state", 1),
                (try_begin),
                    (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_maceman"),
                    (assign,":var002",reg0),
                    (entry_point_get_position, pos1, 3),
                    (agent_set_scripted_destination,":var002",1,0),
                (else_try),
                    (eq,"$tutorial_2_melee_agent_state",1),
                    (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_maceman"),
                    (assign,":var002",reg0),
                    (entry_point_get_position, pos1, 3),
                    (agent_get_position,pos2,":var002"),
                    (get_distance_between_positions,":distance_004",1,2),
                    (try_begin),
                        (le,":distance_004",250),
                        (agent_clear_scripted_mode,":var002"),
                        (val_add, "$tutorial_2_melee_agent_state", 1),
                        (store_mission_timer_a,"$tutorial_time"),
                    (else_try),
                        (eq,"$tutorial_2_melee_agent_state",2),
                        (try_begin),
                            (eq,"$tutorial_2_msg_2_displayed",0),
                            (assign,"$tutorial_2_msg_2_displayed",1),
                            (play_sound,"snd_tutorial_1"),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_maceman"),
        (assign,":var002",reg0),
        (store_mission_timer_a,":m_timer_a_001"),
        (val_sub, ":m_timer_a_001", "$tutorial_time"),
        (store_sub, reg3, 20, ":m_timer_a_001"),
        (tutorial_message,"str_tutorial_2_msg_2"),
        (try_begin),
            (gt,":m_timer_a_001",20),
            (entry_point_get_position, pos1, 3),
            (agent_set_scripted_destination,":var002",1,0),
            (val_add, "$tutorial_2_melee_agent_state", 1),
        (else_try),
            (eq,"$tutorial_2_melee_agent_state",3),
            (try_begin),
                (eq,"$tutorial_2_msg_3_displayed",0),
                (assign,"$tutorial_2_msg_3_displayed",1),
                (tutorial_message,"str_tutorial_2_msg_3"),
                (play_sound,"snd_tutorial_1"),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_maceman"),
        (assign,":var002",reg0),
        (entry_point_get_position, pos1, 3),
        (agent_get_position,pos2,":var002"),
        (get_distance_between_positions,":distance_004",1,2),
        (try_begin),
            (le,":distance_004",250),
            (entry_point_get_position, pos1, 2),
            (agent_set_scripted_destination,":var002",1,0),
            (val_add, "$tutorial_2_melee_agent_state", 1),
        (else_try),
            (eq,"$tutorial_2_melee_agent_state",4),
            (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_maceman"),
            (assign,":var002",reg0),
            (entry_point_get_position, pos1, 2),
            (agent_get_position,pos2,":var002"),
            (get_distance_between_positions,":distance_004",1,2),
            (try_begin),
                (le,":distance_004",250),
                (entry_point_get_position, pos1, 30),
                (agent_set_position,":var002",1),
                (agent_set_scripted_destination,":var002",1,0),
                (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_a", 1),
                (prop_instance_get_position, pos1, ":scp_instance_005"),
                (position_rotate_z,1,90),
                (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
                (val_add, "$tutorial_2_melee_agent_state", 1),
                (val_add, "$tutorial_2_state", 1),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(else_try),
(eq,"$tutorial_2_state",3),
(scene_prop_get_instance, ":scp_instance_006", "spr_barrier_4m", 1),
(prop_instance_get_position, pos1, ":scp_instance_006"),
(get_player_agent_no,":agent_no_003"),
(agent_set_kick_allowed, ":agent_no_003", 1),
(agent_get_position,pos2,":agent_no_003"),
(try_begin),
    (position_is_behind_position,2,1),
    (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_a", 1),
    (prop_instance_get_position, pos1, ":scp_instance_005"),
    (position_rotate_z,1,-90),
    (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
    (store_mission_timer_a,"$tutorial_time"),
    (val_add, "$tutorial_2_state", 1),
(else_try),
    (eq,"$tutorial_2_state",4),
    (try_begin),
        (eq,"$tutorial_2_msg_4_displayed",0),
        (assign,"$tutorial_2_msg_4_displayed",1),
        (play_sound,"snd_tutorial_1"),
    (try_end),
(try_end),
(store_mission_timer_a,":m_timer_a_001"),
(val_sub, ":m_timer_a_001", "$tutorial_time"),
(store_sub, reg3, 20, ":m_timer_a_001"),
(tutorial_message,"str_tutorial_2_msg_4"),
(try_begin),
    (gt,":m_timer_a_001",20),
    (entry_point_get_position, pos1, 5),
    (set_spawn_position, 1),
    (spawn_item, "itm_tutorial_sword"),
    (try_begin),
        (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_maceman"),
        (assign,":var002",reg0),
        (entry_point_get_position, pos1, 3),
        (agent_set_position,":var002",1),
        (agent_set_scripted_destination,":var002",1,0),
        (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_a", 2),
        (prop_instance_get_position, pos1, ":scp_instance_005"),
        (position_rotate_z,1,90),
        (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
        (val_add, "$tutorial_2_state", 1),
    (else_try),
        (eq,"$tutorial_2_state",5),
        (try_begin),
            (eq,"$tutorial_2_msg_5_displayed",0),
            (assign,"$tutorial_2_msg_5_displayed",1),
            (tutorial_message,"str_tutorial_2_msg_5"),
            (play_sound,"snd_tutorial_1"),
        (try_end),
    (try_end),
(try_end),
(scene_prop_get_instance, ":scp_instance_006", "spr_barrier_4m", 2),
(prop_instance_get_position, pos1, ":scp_instance_006"),
(get_player_agent_no,":agent_no_003"),
(agent_get_position,pos2,":agent_no_003"),
(try_begin),
    (position_is_behind_position,2,1),
    (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_a", 2),
    (prop_instance_get_position, pos1, ":scp_instance_005"),
    (position_rotate_z,1,-90),
    (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
    (val_add, "$tutorial_2_state", 1),
(else_try),
    (eq,"$tutorial_2_state",6),
    (try_begin),
        (eq,"$tutorial_2_msg_6_displayed",0),
        (assign,"$tutorial_2_msg_6_displayed",1),
        (tutorial_message,"str_tutorial_2_msg_6"),
        (play_sound,"snd_tutorial_1"),
    (try_end),
(try_end),
(get_player_agent_no,":agent_no_003"),
(try_begin),
    (agent_has_item_equipped,":agent_no_003","itm_tutorial_sword"),
    (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_a", 3),
    (prop_instance_get_position, pos1, ":scp_instance_005"),
    (position_rotate_z,1,-90),
    (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
    (val_add, "$tutorial_2_state", 1),
(else_try),
    (eq,"$tutorial_2_state",7),
    (try_begin),
        (eq,"$tutorial_2_msg_7_displayed",0),
        (assign,"$tutorial_2_msg_7_displayed",1),
        (tutorial_message,"str_tutorial_2_msg_7"),
        (play_sound,"snd_tutorial_1"),
        (get_player_agent_no,":agent_no_003"),
        (agent_set_hit_points,":agent_no_003",100),
    (try_end),
(try_end),
(try_begin),
    (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_archer"),
    (assign,":var002",reg0),
    (try_begin),
        (neg|agent_is_alive,":var002"),
        (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_maceman"),
        (assign,":var002",reg0),
        (agent_clear_scripted_mode,":var002"),
        (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_a", 4),
        (prop_instance_get_position, pos1, ":scp_instance_005"),
        (position_rotate_z,1,-90),
        (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
        (val_add, "$tutorial_2_state", 1),
    (else_try),
        (eq,"$tutorial_2_state",8),
        (try_begin),
            (eq,"$tutorial_2_msg_8_displayed",0),
            (assign,"$tutorial_2_msg_8_displayed",1),
            (tutorial_message,"str_tutorial_2_msg_8"),
            (play_sound,"snd_tutorial_1"),
            (get_player_agent_no,":agent_no_003"),
            (agent_set_hit_points,":agent_no_003",100),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_maceman"),
    (assign,":var002",reg0),
    (try_begin),
        (neg|agent_is_alive,":var002"),
        (val_add, "$tutorial_2_state", 1),
    (else_try),
        (eq,"$tutorial_2_state",9),
        (eq,"$tutorial_2_msg_9_displayed",0),
        (assign,"$tutorial_2_msg_9_displayed",1),
        (tutorial_message,"str_tutorial_2_msg_9"),
        (play_sound,"snd_tutorial_2"),
        (assign,"$tutorial_2_finished",1),
    (else_try),
        (gt,"$tutorial_2_state",30),
        (tutorial_message,"str_tutorial_failed"),
    (try_end),
(try_end),
], [
]),

]),
("tutorial_3", mtf_arena_fight|mtf_team_fight, -1,
"You enter the training ground.",
[(0, mtef_no_companions|mtef_no_regulars|mtef_team_0|mtef_leader_only, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_foot|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all|af_override_everything, 0, 1, [itm_leather_jerkin,itm_leather_boots,]),
(3, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(5, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
],
[
(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (lt,"$tutorial_3_state",12),
    (question_box,"str_do_you_wish_to_leave_tutorial"),
(else_try),
    (finish_mission, 0),
(try_end),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (finish_mission, 0),
(try_end),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_tutorial"),
], [
]),

(0.0, 0.0, ti_once, [
(try_begin),
    (gt,":m_timer_a_001",2),
    (main_hero_fallen),
    (assign,"$tutorial_3_state",100),
], [
]),

(0.0, 0.0, ti_once, [
(tutorial_message_set_position, 500, 650),
(tutorial_message_set_center_justify, 0),
(assign,"$tutorial_3_state",0),
(assign,"$tutorial_3_msg_1_displayed",0),
(assign,"$tutorial_3_msg_2_displayed",0),
(assign,"$tutorial_3_msg_3_displayed",0),
(assign,"$tutorial_3_msg_4_displayed",0),
(assign,"$tutorial_3_msg_5_displayed",0),
], [
]),

(0.0, 0.0, 0.0, [
(eq,"$tutorial_3_state",0),
(try_begin),
    (eq,"$tutorial_3_msg_1_displayed",0),
    (store_mission_timer_a,":m_timer_a_001"),
    (try_begin),
        (gt,":m_timer_a_001",0),
        (assign,"$tutorial_3_msg_1_displayed",1),
        (tutorial_message,"str_tutorial_3_msg_1"),
        (try_begin),
            (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_maceman"),
            (assign,":var002",reg0),
            (agent_get_position,pos1,":var002"),
            (agent_set_scripted_destination,":var002",1,0),
            (try_begin),
                (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_swordsman"),
                (assign,":var002",reg0),
                (agent_get_position,pos1,":var002"),
                (agent_set_scripted_destination,":var002",1,0),
                (entry_point_get_position, pos1, 1),
                (set_spawn_position, 1),
                (spawn_item, "itm_tutorial_staff_no_attack"),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(get_player_agent_no,":agent_no_003"),
(try_begin),
    (ge,":agent_no_003",0),
    (agent_has_item_equipped,":agent_no_003","itm_tutorial_staff_no_attack"),
    (val_add, "$tutorial_3_state", 1),
(else_try),
    (eq,"$tutorial_3_state",1),
    (try_begin),
        (eq,"$tutorial_3_msg_2_displayed",0),
        (assign,"$tutorial_3_msg_2_displayed",1),
        (tutorial_message,"str_tutorial_3_msg_2"),
        (play_sound,"snd_tutorial_1"),
    (try_end),
(try_end),
(get_player_agent_no,":agent_no_003"),
(agent_get_position,pos1,":agent_no_003"),
(entry_point_get_position, pos2, 2),
(get_distance_between_positions,":distance_004",1,2),
(try_begin),
    (le,":distance_004",200),
    (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_b", 0),
    (prop_instance_get_position, pos1, ":scp_instance_005"),
    (position_rotate_z,1,-90),
    (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
    (val_add, "$tutorial_3_state", 1),
(else_try),
    (eq,"$tutorial_3_state",2),
    (scene_prop_get_instance, ":scp_instance_006", "spr_barrier_4m", 0),
    (prop_instance_get_position, pos1, ":scp_instance_006"),
    (get_player_agent_no,":agent_no_003"),
    (agent_get_position,pos2,":agent_no_003"),
    (try_begin),
        (position_is_behind_position,2,1),
        (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_b", 0),
        (prop_instance_get_position, pos1, ":scp_instance_005"),
        (position_rotate_z,1,90),
        (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
        (val_add, "$tutorial_3_state", 1),
    (else_try),
        (eq,"$tutorial_3_state",3),
        (get_player_agent_no,":agent_no_003"),
        (agent_set_kick_allowed, ":agent_no_003", 0),
        (try_begin),
            (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_maceman"),
            (assign,":var002",reg0),
            (entry_point_get_position, pos1, 4),
            (agent_set_scripted_destination,":var002",1,0),
            (val_add, "$tutorial_3_state", 1),
        (else_try),
            (eq,"$tutorial_3_state",4),
            (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_maceman"),
            (assign,":var002",reg0),
            (entry_point_get_position, pos1, 4),
            (agent_get_position,pos2,":var002"),
            (get_distance_between_positions,":distance_004",1,2),
            (try_begin),
                (le,":distance_004",250),
                (agent_clear_scripted_mode,":var002"),
                (val_add, "$tutorial_3_state", 1),
                (store_mission_timer_a,"$tutorial_time"),
            (else_try),
                (eq,"$tutorial_3_state",5),
                (try_begin),
                    (eq,"$tutorial_3_msg_3_displayed",0),
                    (assign,"$tutorial_3_msg_3_displayed",1),
                    (play_sound,"snd_tutorial_1"),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_maceman"),
    (assign,":var002",reg0),
    (store_mission_timer_a,":m_timer_a_001"),
    (val_sub, ":m_timer_a_001", "$tutorial_time"),
    (store_sub, reg3, 20, ":m_timer_a_001"),
    (tutorial_message,"str_tutorial_3_msg_3"),
    (try_begin),
        (gt,":m_timer_a_001",20),
        (entry_point_get_position, pos1, 4),
        (agent_set_scripted_destination,":var002",1,0),
        (val_add, "$tutorial_3_state", 1),
    (else_try),
        (eq,"$tutorial_3_state",6),
        (try_begin),
            (eq,"$tutorial_3_msg_4_displayed",0),
            (assign,"$tutorial_3_msg_4_displayed",1),
            (tutorial_message,"str_tutorial_3_msg_4"),
            (play_sound,"snd_tutorial_1"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_maceman"),
    (assign,":var002",reg0),
    (entry_point_get_position, pos1, 4),
    (agent_get_position,pos2,":var002"),
    (get_distance_between_positions,":distance_004",1,2),
    (try_begin),
        (le,":distance_004",250),
        (entry_point_get_position, pos1, 3),
        (agent_set_scripted_destination,":var002",1,0),
        (val_add, "$tutorial_3_state", 1),
    (else_try),
        (eq,"$tutorial_3_state",7),
        (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_maceman"),
        (assign,":var002",reg0),
        (entry_point_get_position, pos1, 3),
        (agent_get_position,pos2,":var002"),
        (get_distance_between_positions,":distance_004",1,2),
        (try_begin),
            (le,":distance_004",250),
            (entry_point_get_position, pos1, 7),
            (agent_set_scripted_destination,":var002",1,0),
            (agent_set_position,":var002",1),
            (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_b", 1),
            (prop_instance_get_position, pos1, ":scp_instance_005"),
            (position_rotate_z,1,-90),
            (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
            (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_b", 3),
            (prop_instance_get_position, pos1, ":scp_instance_005"),
            (position_rotate_z,1,-90),
            (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
            (val_add, "$tutorial_3_state", 1),
        (else_try),
            (eq,"$tutorial_3_state",8),
            (scene_prop_get_instance, ":scp_instance_006", "spr_barrier_4m", 1),
            (prop_instance_get_position, pos1, ":scp_instance_006"),
            (get_player_agent_no,":agent_no_003"),
            (agent_get_position,pos2,":agent_no_003"),
            (try_begin),
                (position_is_behind_position,2,1),
                (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_b", 1),
                (prop_instance_get_position, pos1, ":scp_instance_005"),
                (position_rotate_z,1,90),
                (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
                (val_add, "$tutorial_3_state", 1),
            (else_try),
                (eq,"$tutorial_3_state",9),
                (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_swordsman"),
                (assign,":var002",reg0),
                (entry_point_get_position, pos1, 6),
                (agent_set_scripted_destination,":var002",1,0),
                (val_add, "$tutorial_3_state", 1),
            (else_try),
                (eq,"$tutorial_3_state",10),
                (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_swordsman"),
                (assign,":var002",reg0),
                (entry_point_get_position, pos1, 6),
                (agent_get_position,pos2,":var002"),
                (get_distance_between_positions,":distance_004",1,2),
                (try_begin),
                    (le,":distance_004",250),
                    (agent_clear_scripted_mode,":var002"),
                    (val_add, "$tutorial_3_state", 1),
                    (store_mission_timer_a,"$tutorial_time"),
                (else_try),
                    (eq,"$tutorial_3_state",11),
                    (try_begin),
                        (eq,"$tutorial_3_msg_5_displayed",0),
                        (assign,"$tutorial_3_msg_5_displayed",1),
                        (play_sound,"snd_tutorial_1"),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_swordsman"),
    (assign,":var002",reg0),
    (store_mission_timer_a,":m_timer_a_001"),
    (val_sub, ":m_timer_a_001", "$tutorial_time"),
    (store_sub, reg3, 20, ":m_timer_a_001"),
    (tutorial_message,"str_tutorial_3_msg_5"),
    (try_begin),
        (gt,":m_timer_a_001",20),
        (entry_point_get_position, pos1, 6),
        (agent_set_scripted_destination,":var002",1,0),
        (val_add, "$tutorial_3_state", 1),
    (else_try),
        (eq,"$tutorial_3_state",12),
        (try_begin),
            (eq,"$tutorial_3_msg_6_displayed",0),
            (assign,"$tutorial_3_msg_6_displayed",1),
            (tutorial_message,"str_tutorial_3_msg_6"),
            (play_sound,"snd_tutorial_1"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_swordsman"),
    (assign,":var002",reg0),
    (entry_point_get_position, pos1, 6),
    (agent_get_position,pos2,":var002"),
    (get_distance_between_positions,":distance_004",1,2),
    (try_begin),
        (le,":distance_004",250),
        (entry_point_get_position, pos1, 5),
        (agent_set_scripted_destination,":var002",1,0),
        (val_add, "$tutorial_3_state", 1),
    (else_try),
        (eq,"$tutorial_3_state",13),
        (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_swordsman"),
        (assign,":var002",reg0),
        (entry_point_get_position, pos1, 5),
        (agent_get_position,pos2,":var002"),
        (get_distance_between_positions,":distance_004",1,2),
        (try_begin),
            (le,":distance_004",250),
            (entry_point_get_position, pos1, 7),
            (agent_set_scripted_destination,":var002",1,0),
            (agent_set_position,":var002",1),
            (val_add, "$tutorial_3_state", 1),
        (else_try),
            (gt,"$tutorial_3_state",30),
            (tutorial_message,"str_tutorial_failed"),
        (try_end),
    (try_end),
(try_end),
], [
]),

]),
("tutorial_3_2", mtf_arena_fight|mtf_team_fight, -1,
"You enter the training ground.",
[(0, mtef_no_companions|mtef_no_regulars|mtef_team_0|mtef_leader_only, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_foot|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all|af_override_everything, 0, 1, [itm_tutorial_staff,itm_leather_jerkin,itm_leather_boots,]),
(4, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(6, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
],
[
(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (lt,"$tutorial_3_state",5),
    (question_box,"str_do_you_wish_to_leave_tutorial"),
(else_try),
    (finish_mission, 0),
(try_end),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (finish_mission, 0),
(try_end),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_tutorial"),
], [
]),

(0.0, 0.0, ti_once, [
(try_begin),
    (gt,":m_timer_a_001",2),
    (main_hero_fallen),
    (assign,"$tutorial_3_state",100),
], [
]),

(0.0, 0.0, ti_once, [
(tutorial_message_set_position, 500, 650),
(tutorial_message_set_center_justify, 0),
(assign,"$tutorial_3_state",0),
(assign,"$tutorial_3_msg_1_displayed",0),
(assign,"$tutorial_3_msg_2_displayed",0),
(assign,"$tutorial_3_msg_3_displayed",0),
(assign,"$tutorial_3_msg_4_displayed",0),
], [
]),

(0.0, 0.0, 0.0, [
(eq,"$tutorial_3_state",0),
(try_begin),
    (eq,"$tutorial_3_msg_1_displayed",0),
    (store_mission_timer_a,":m_timer_a_001"),
    (try_begin),
        (gt,":m_timer_a_001",0),
        (assign,"$tutorial_3_msg_1_displayed",1),
        (tutorial_message,"str_tutorial_3_2_msg_1"),
        (play_sound,"snd_tutorial_1"),
        (try_begin),
            (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_maceman"),
            (assign,":var002",reg0),
            (agent_get_position,pos1,":var002"),
            (agent_set_scripted_destination,":var002",1,0),
            (try_begin),
                (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_swordsman"),
                (assign,":var002",reg0),
                (agent_get_position,pos1,":var002"),
                (agent_set_scripted_destination,":var002",1,0),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(get_player_agent_no,":agent_no_003"),
(agent_get_position,pos1,":agent_no_003"),
(entry_point_get_position, pos2, 2),
(get_distance_between_positions,":distance_004",1,2),
(try_begin),
    (le,":distance_004",200),
    (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_b", 0),
    (prop_instance_get_position, pos1, ":scp_instance_005"),
    (position_rotate_z,1,-90),
    (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
    (val_add, "$tutorial_3_state", 1),
(else_try),
    (eq,"$tutorial_3_state",1),
    (try_begin),
        (eq,"$tutorial_3_msg_2_displayed",0),
        (assign,"$tutorial_3_msg_2_displayed",1),
        (tutorial_message,"str_tutorial_3_2_msg_2"),
        (play_sound,"snd_tutorial_1"),
    (try_end),
(try_end),
(scene_prop_get_instance, ":scp_instance_006", "spr_barrier_4m", 0),
(prop_instance_get_position, pos1, ":scp_instance_006"),
(get_player_agent_no,":agent_no_003"),
(agent_get_position,pos2,":agent_no_003"),
(try_begin),
    (position_is_behind_position,2,1),
    (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_b", 0),
    (prop_instance_get_position, pos1, ":scp_instance_005"),
    (position_rotate_z,1,90),
    (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
    (try_begin),
        (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_maceman"),
        (agent_clear_scripted_mode,reg0),
        (val_add, "$tutorial_3_state", 1),
    (else_try),
        (eq,"$tutorial_3_state",2),
        (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_maceman"),
        (neg|agent_is_alive,reg0),
        (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_b", 1),
        (prop_instance_get_position, pos1, ":scp_instance_005"),
        (position_rotate_z,1,-90),
        (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
        (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_b", 3),
        (prop_instance_get_position, pos1, ":scp_instance_005"),
        (position_rotate_z,1,-90),
        (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
        (val_add, "$tutorial_3_state", 1),
    (else_try),
        (eq,"$tutorial_3_state",3),
        (try_begin),
            (eq,"$tutorial_3_msg_3_displayed",0),
            (assign,"$tutorial_3_msg_3_displayed",1),
            (tutorial_message,"str_tutorial_3_2_msg_3"),
            (play_sound,"snd_tutorial_1"),
        (try_end),
    (try_end),
(try_end),
(scene_prop_get_instance, ":scp_instance_006", "spr_barrier_4m", 1),
(prop_instance_get_position, pos1, ":scp_instance_006"),
(get_player_agent_no,":agent_no_003"),
(agent_get_position,pos2,":agent_no_003"),
(try_begin),
    (position_is_behind_position,2,1),
    (scene_prop_get_instance, ":scp_instance_005", "spr_tutorial_door_b", 1),
    (prop_instance_get_position, pos1, ":scp_instance_005"),
    (position_rotate_z,1,90),
    (prop_instance_animate_to_position, ":scp_instance_005", 1, 150),
    (try_begin),
        (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_swordsman"),
        (agent_clear_scripted_mode,reg0),
        (val_add, "$tutorial_3_state", 1),
    (else_try),
        (eq,"$tutorial_3_state",4),
        (try_begin),
            (eq,"$tutorial_3_msg_4_displayed",0),
            (assign,"$tutorial_3_msg_4_displayed",1),
            (tutorial_message,"str_tutorial_3_2_msg_4"),
            (play_sound,"snd_tutorial_1"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (call_script, "script_cf_get_first_agent_with_troop_id", "trp_tutorial_swordsman"),
    (neg|agent_is_alive,reg0),
    (val_add, "$tutorial_3_state", 1),
(else_try),
    (eq,"$tutorial_3_state",5),
    (eq,"$tutorial_3_msg_5_displayed",0),
    (assign,"$tutorial_3_msg_5_displayed",1),
    (tutorial_message,"str_tutorial_3_2_msg_5"),
    (play_sound,"snd_tutorial_2"),
    (assign,"$tutorial_3_finished",1),
(else_try),
    (gt,"$tutorial_3_state",30),
    (tutorial_message,"str_tutorial_failed"),
(try_end),
], [
]),

]),
("tutorial_4", mtf_arena_fight|mtf_team_fight, -1,
"You enter the training ground.",
[(0, mtef_no_companions|mtef_no_regulars|mtef_team_0|mtef_leader_only, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_foot|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all|af_override_everything, 0, 1, [itm_tutorial_sword,itm_tutorial_short_bow,itm_tutorial_arrows,itm_leather_jerkin,itm_leather_boots,]),
],
[
(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (lt,"$tutorial_4_state",11),
    (question_box,"str_do_you_wish_to_leave_tutorial"),
(else_try),
    (finish_mission, 0),
(try_end),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (finish_mission, 0),
(try_end),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_tutorial"),
], [
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(scene_set_day_time, 13),
]),

(0.0, 0.0, ti_once, [
(tutorial_message_set_position, 500, 650),
(tutorial_message_set_center_justify, 0),
(assign,"$tutorial_4_state",0),
(assign,"$tutorial_4_msg_1_displayed",0),
(assign,"$tutorial_4_msg_2_displayed",0),
(assign,"$tutorial_4_msg_3_displayed",0),
(assign,"$tutorial_4_msg_4_displayed",0),
(assign,"$tutorial_4_msg_5_displayed",0),
(assign,"$tutorial_4_msg_6_displayed",0),
], [
]),

(0.0, 0.0, 0.0, [
(eq,"$tutorial_4_state",0),
(try_begin),
    (eq,"$tutorial_4_msg_1_displayed",0),
    (store_mission_timer_a,":m_timer_a_001"),
    (try_begin),
        (gt,":m_timer_a_001",0),
        (assign,"$tutorial_4_msg_1_displayed",1),
        (tutorial_message,"str_tutorial_4_msg_1"),
        (entry_point_get_position, pos1, 1),
        (set_spawn_position, 1),
        (spawn_horse,"itm_tutorial_saddle_horse"),
        (assign,"$tutorial_num_total_dummies_destroyed",0),
    (try_end),
(try_end),
(get_player_agent_no,":agent_no_002"),
(agent_get_horse,":agent_horse_003",":agent_no_002"),
(try_begin),
    (ge,":agent_horse_003",0),
    (val_add, "$tutorial_4_state", 1),
    (entry_point_get_position, pos1, 2),
    (scene_prop_get_instance, ":scp_instance_004", "spr_tutorial_flag_yellow", 0),
    (prop_instance_animate_to_position, ":scp_instance_004", 1, 1),
(else_try),
    (eq,"$tutorial_4_state",1),
    (try_begin),
        (eq,"$tutorial_4_msg_2_displayed",0),
        (assign,"$tutorial_4_msg_2_displayed",1),
        (tutorial_message,"str_tutorial_4_msg_2"),
        (play_sound,"snd_tutorial_1"),
    (try_end),
(try_end),
(get_player_agent_no,":agent_no_002"),
(agent_get_position,pos1,":agent_no_002"),
(entry_point_get_position, pos2, 2),
(get_distance_between_positions,":distance_005",1,2),
(try_begin),
    (le,":distance_005",200),
    (val_add, "$tutorial_4_state", 1),
    (entry_point_get_position, pos1, 3),
    (scene_prop_get_instance, ":scp_instance_004", "spr_tutorial_flag_yellow", 0),
    (prop_instance_animate_to_position, ":scp_instance_004", 1, 1),
(else_try),
    (eq,"$tutorial_4_state",2),
    (get_player_agent_no,":agent_no_002"),
    (agent_get_position,pos1,":agent_no_002"),
    (entry_point_get_position, pos2, 3),
    (get_distance_between_positions,":distance_005",1,2),
    (try_begin),
        (le,":distance_005",200),
        (val_add, "$tutorial_4_state", 1),
        (entry_point_get_position, pos1, 4),
        (scene_prop_get_instance, ":scp_instance_004", "spr_tutorial_flag_yellow", 0),
        (prop_instance_animate_to_position, ":scp_instance_004", 1, 1),
    (else_try),
        (eq,"$tutorial_4_state",3),
        (get_player_agent_no,":agent_no_002"),
        (agent_get_position,pos1,":agent_no_002"),
        (entry_point_get_position, pos2, 4),
        (get_distance_between_positions,":distance_005",1,2),
        (try_begin),
            (le,":distance_005",200),
            (val_add, "$tutorial_4_state", 1),
            (entry_point_get_position, pos1, 5),
            (scene_prop_get_instance, ":scp_instance_004", "spr_tutorial_flag_yellow", 0),
            (prop_instance_animate_to_position, ":scp_instance_004", 1, 1),
        (else_try),
            (eq,"$tutorial_4_state",4),
            (get_player_agent_no,":agent_no_002"),
            (agent_get_position,pos1,":agent_no_002"),
            (entry_point_get_position, pos2, 5),
            (get_distance_between_positions,":distance_005",1,2),
            (try_begin),
                (le,":distance_005",200),
                (val_add, "$tutorial_4_state", 1),
                (entry_point_get_position, pos1, 6),
                (scene_prop_get_instance, ":scp_instance_004", "spr_tutorial_flag_yellow", 0),
                (prop_instance_animate_to_position, ":scp_instance_004", 1, 1),
            (else_try),
                (eq,"$tutorial_4_state",5),
                (get_player_agent_no,":agent_no_002"),
                (agent_get_position,pos1,":agent_no_002"),
                (entry_point_get_position, pos2, 6),
                (get_distance_between_positions,":distance_005",1,2),
                (try_begin),
                    (le,":distance_005",200),
                    (val_add, "$tutorial_4_state", 1),
                    (entry_point_get_position, pos1, 1),
                    (scene_prop_get_instance, ":scp_instance_004", "spr_tutorial_flag_yellow", 0),
                    (prop_instance_animate_to_position, ":scp_instance_004", 1, 1),
                (else_try),
                    (eq,"$tutorial_4_state",6),
                    (get_player_agent_no,":agent_no_002"),
                    (agent_get_position,pos1,":agent_no_002"),
                    (entry_point_get_position, pos2, 1),
                    (get_distance_between_positions,":distance_005",1,2),
                    (try_begin),
                        (le,":distance_005",200),
                        (val_add, "$tutorial_4_state", 1),
                        (entry_point_get_position, pos1, 7),
                        (scene_prop_get_instance, ":scp_instance_004", "spr_tutorial_flag_yellow", 0),
                        (prop_instance_animate_to_position, ":scp_instance_004", 1, 1),
                    (else_try),
                        (eq,"$tutorial_4_state",7),
                        (try_begin),
                            (eq,"$tutorial_4_msg_3_displayed",0),
                            (assign,"$tutorial_4_msg_3_displayed",1),
                            (tutorial_message,"str_tutorial_4_msg_3"),
                            (play_sound,"snd_tutorial_1"),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(get_player_agent_no,":agent_no_002"),
(agent_get_position,pos1,":agent_no_002"),
(entry_point_get_position, pos2, 7),
(get_distance_between_positions,":distance_005",1,2),
(try_begin),
    (le,":distance_005",200),
    (val_add, "$tutorial_4_state", 1),
    (entry_point_get_position, pos1, 20),
    (scene_prop_get_instance, ":scp_instance_004", "spr_tutorial_flag_yellow", 0),
    (prop_instance_animate_to_position, ":scp_instance_004", 1, 1),
(else_try),
    (eq,"$tutorial_4_state",8),
    (try_begin),
        (eq,"$tutorial_4_msg_4_displayed",0),
        (assign,"$tutorial_4_msg_4_displayed",1),
        (tutorial_message,"str_tutorial_4_msg_4"),
        (play_sound,"snd_tutorial_1"),
    (try_end),
(try_end),
(try_begin),
    (ge,"$tutorial_num_total_dummies_destroyed",2),
    (val_add, "$tutorial_4_state", 1),
    (entry_point_get_position, pos1, 8),
    (scene_prop_get_instance, ":scp_instance_004", "spr_tutorial_flag_yellow", 0),
    (prop_instance_animate_to_position, ":scp_instance_004", 1, 1),
(else_try),
    (eq,"$tutorial_4_state",9),
    (try_begin),
        (eq,"$tutorial_4_msg_5_displayed",0),
        (assign,"$tutorial_4_msg_5_displayed",1),
        (tutorial_message,"str_tutorial_4_msg_5"),
        (play_sound,"snd_tutorial_1"),
    (try_end),
(try_end),
(get_player_agent_no,":agent_no_002"),
(agent_get_position,pos1,":agent_no_002"),
(entry_point_get_position, pos2, 8),
(get_distance_between_positions,":distance_005",1,2),
(try_begin),
    (le,":distance_005",200),
    (val_add, "$tutorial_4_state", 1),
    (entry_point_get_position, pos1, 20),
    (scene_prop_get_instance, ":scp_instance_004", "spr_tutorial_flag_yellow", 0),
    (prop_instance_animate_to_position, ":scp_instance_004", 1, 1),
(else_try),
    (eq,"$tutorial_4_state",10),
    (try_begin),
        (eq,"$tutorial_4_msg_6_displayed",0),
        (assign,"$tutorial_4_msg_6_displayed",1),
        (tutorial_message,"str_tutorial_4_msg_6"),
        (play_sound,"snd_tutorial_1"),
        (assign,"$g_last_archery_point_earned",0),
        (assign,"$tutorial_num_arrows_hit",0),
    (try_end),
(try_end),
(try_begin),
    (eq,1,1),
    (get_player_agent_no,":agent_no_002"),
    (agent_get_ammo,":agent_ammo_006",":agent_no_002"),
    (try_begin),
        (le,":agent_ammo_006",0),
        (agent_refill_ammo,":agent_no_002"),
        (tutorial_message,"str_tutorial_ammo_refilled"),
    (try_end),
(try_end),
(try_begin),
    (gt,"$g_last_archery_point_earned",0),
    (assign,"$g_last_archery_point_earned",0),
    (val_add, "$tutorial_num_arrows_hit", 1),
    (try_begin),
        (gt,"$tutorial_num_arrows_hit",2),
        (val_add, "$tutorial_4_state", 1),
    (else_try),
        (eq,"$tutorial_4_state",11),
        (eq,"$tutorial_4_msg_7_displayed",0),
        (assign,"$tutorial_4_msg_7_displayed",1),
        (tutorial_message,"str_tutorial_4_msg_7"),
        (play_sound,"snd_tutorial_2"),
        (assign,"$tutorial_4_finished",1),
    (try_end),
(try_end),
], [
]),

]),
("tutorial_5", mtf_arena_fight|mtf_team_fight, -1,
"You enter the training ground.",
[(0, mtef_visitor_source|mtef_team_0, af_override_weapons|af_override_weapon_0|af_override_weapon_1|af_override_weapon_2|af_override_weapon_3|af_override_head|af_override_body|af_override_foot|af_override_gloves|af_override_horse|af_override_all_but_horse|af_override_all|af_override_everything, 0, 1, [itm_tutorial_sword,itm_tutorial_shield,itm_tutorial_short_bow,itm_tutorial_arrows,itm_tutorial_saddle_horse,itm_leather_jerkin,itm_leather_boots,]),
(1, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(2, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(3, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(4, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(8, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(9, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(10, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(13, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(14, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(15, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(16, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
],
[
(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (lt,"$tutorial_5_state",5),
    (question_box,"str_do_you_wish_to_leave_tutorial"),
(else_try),
    (finish_mission, 0),
(try_end),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (finish_mission, 0),
(try_end),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_tutorial"),
], [
]),

(0.0, 0.0, ti_once, [
(try_begin),
    (gt,":m_timer_a_001",2),
    (main_hero_fallen),
    (assign,"$tutorial_5_state",100),
], [
]),

(0.0, 0.0, ti_once, [
(tutorial_message_set_position, 500, 650),
(tutorial_message_set_center_justify, 0),
(assign,"$tutorial_5_state",0),
(assign,"$tutorial_5_msg_1_displayed",0),
(assign,"$tutorial_5_msg_2_displayed",0),
(assign,"$tutorial_5_msg_3_displayed",0),
(assign,"$tutorial_5_msg_4_displayed",0),
(assign,"$tutorial_5_msg_5_displayed",0),
], [
]),

(0.0, 0.0, ti_once, [
(team_give_order, 0, 9, 11),
(set_show_messages,1),
(try_begin),
    (gt,":m_timer_a_001",3),
    (store_mission_timer_a,":m_timer_a_001"),
], [
]),

(0.0, 0.0, 0.0, [
(call_script,"script_cf_turn_windmill_fans"),
], [
]),

(0.0, 0.0, 0.0, [
(eq,"$tutorial_5_state",0),
(try_begin),
    (eq,"$tutorial_5_msg_1_displayed",0),
    (store_mission_timer_a,":m_timer_a_001"),
    (try_begin),
        (gt,":m_timer_a_001",0),
        (assign,"$tutorial_5_msg_1_displayed",1),
        (tutorial_message,"str_tutorial_5_msg_1"),
        (entry_point_get_position, pos1, 5),
        (scene_prop_get_instance, ":scp_instance_002", "spr_tutorial_flag_yellow", 0),
        (prop_instance_animate_to_position, ":scp_instance_002", 1, 1),
    (try_end),
(try_end),
(try_begin),
    (call_script, "script_cf_team_get_average_position_of_agents_with_type_to_pos1", 0, 0),
    (entry_point_get_position, pos2, 5),
    (get_distance_between_positions,":distance_003",1,2),
    (try_begin),
        (le,":distance_003",1000),
        (val_add, "$tutorial_5_state", 1),
        (entry_point_get_position, pos1, 6),
        (scene_prop_get_instance, ":scp_instance_002", "spr_tutorial_flag_red", 0),
        (prop_instance_animate_to_position, ":scp_instance_002", 1, 1),
    (else_try),
        (eq,"$tutorial_5_state",1),
        (try_begin),
            (eq,"$tutorial_5_msg_2_displayed",0),
            (assign,"$tutorial_5_msg_2_displayed",1),
            (tutorial_message,"str_tutorial_5_msg_2"),
            (play_sound,"snd_tutorial_1"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (call_script, "script_cf_team_get_average_position_of_agents_with_type_to_pos1", 0, 0),
    (entry_point_get_position, pos2, 5),
    (get_distance_between_positions,":distance_003",1,2),
    (try_begin),
        (le,":distance_003",1000),
        (get_player_agent_no,":agent_no_004"),
        (agent_get_position,pos1,":agent_no_004"),
        (entry_point_get_position, pos2, 6),
        (get_distance_between_positions,":distance_003",1,2),
        (try_begin),
            (le,":distance_003",500),
            (val_add, "$tutorial_5_state", 1),
            (entry_point_get_position, pos1, 7),
            (scene_prop_get_instance, ":scp_instance_002", "spr_tutorial_flag_yellow", 0),
            (prop_instance_animate_to_position, ":scp_instance_002", 1, 1),
            (entry_point_get_position, pos1, 30),
            (scene_prop_get_instance, ":scp_instance_002", "spr_tutorial_flag_red", 0),
            (prop_instance_animate_to_position, ":scp_instance_002", 1, 1),
        (else_try),
            (eq,"$tutorial_5_state",2),
            (try_begin),
                (eq,"$tutorial_5_msg_3_displayed",0),
                (assign,"$tutorial_5_msg_3_displayed",1),
                (tutorial_message,"str_tutorial_5_msg_3"),
                (play_sound,"snd_tutorial_1"),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(get_player_agent_no,":agent_no_004"),
(agent_get_position,pos1,":agent_no_004"),
(entry_point_get_position, pos2, 7),
(get_distance_between_positions,":distance_003",1,2),
(try_begin),
    (le,":distance_003",500),
    (val_add, "$tutorial_5_state", 1),
    (modify_visitors_at_site,"scn_tutorial_5"),
    (reset_visitors),
    (set_visitor,5,"trp_vaegir_archer"),
    (set_visitor,6,"trp_vaegir_archer"),
    (set_visitor,7,"trp_vaegir_archer"),
    (entry_point_get_position, pos1, 11),
    (scene_prop_get_instance, ":scp_instance_002", "spr_tutorial_flag_yellow", 0),
    (prop_instance_animate_to_position, ":scp_instance_002", 1, 1),
    (entry_point_get_position, pos1, 12),
    (scene_prop_get_instance, ":scp_instance_002", "spr_tutorial_flag_red", 0),
    (prop_instance_animate_to_position, ":scp_instance_002", 1, 1),
    (set_show_messages,0),
    (team_give_order, 0, 1, 11),
    (set_show_messages,1),
(else_try),
    (eq,"$tutorial_5_state",3),
    (try_begin),
        (eq,"$tutorial_5_msg_4_displayed",0),
        (assign,"$tutorial_5_msg_4_displayed",1),
        (tutorial_message,"str_tutorial_5_msg_4"),
        (play_sound,"snd_tutorial_1"),
    (try_end),
(try_end),
(try_begin),
    (call_script, "script_cf_team_get_average_position_of_agents_with_type_to_pos1", 0, 1),
    (entry_point_get_position, pos2, 11),
    (get_distance_between_positions,":distance_003",1,2),
    (try_begin),
        (le,":distance_003",1000),
        (call_script, "script_cf_team_get_average_position_of_agents_with_type_to_pos1", 0, 0),
        (entry_point_get_position, pos2, 12),
        (get_distance_between_positions,":distance_003",1,2),
        (try_begin),
            (le,":distance_003",1000),
            (val_add, "$tutorial_5_state", 1),
            (entry_point_get_position, pos1, 30),
            (scene_prop_get_instance, ":scp_instance_002", "spr_tutorial_flag_yellow", 0),
            (prop_instance_animate_to_position, ":scp_instance_002", 1, 1),
            (scene_prop_get_instance, ":scp_instance_002", "spr_tutorial_flag_red", 0),
            (prop_instance_animate_to_position, ":scp_instance_002", 1, 1),
            (modify_visitors_at_site,"scn_tutorial_5"),
            (reset_visitors),
            (set_visitor,8,"trp_bandit"),
            (set_visitor,9,"trp_bandit"),
            (set_visitor,10,"trp_bandit"),
            (set_visitor,11,"trp_bandit"),
            (team_give_order, 1, 9, 2),
        (else_try),
            (eq,"$tutorial_5_state",4),
            (try_begin),
                (eq,"$tutorial_5_msg_5_displayed",0),
                (assign,"$tutorial_5_msg_5_displayed",1),
                (tutorial_message,"str_tutorial_5_msg_5"),
                (play_sound,"snd_tutorial_1"),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(assign,":var005",0),
(try_for_agents, ":cur_agent"),
    (try_begin),
        (agent_is_human,":cur_agent"),
        (agent_is_alive,":cur_agent"),
        (agent_get_team, ":agent_team_no_007", ":cur_agent"),
        (try_begin),
            (eq,":agent_team_no_007",1),
            (val_add, ":var005", 1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,":var005",0),
    (val_add, "$tutorial_5_state", 1),
(else_try),
    (eq,"$tutorial_5_state",5),
    (eq,"$tutorial_5_msg_6_displayed",0),
    (assign,"$tutorial_5_msg_6_displayed",1),
    (tutorial_message,"str_tutorial_5_msg_6"),
    (play_sound,"snd_tutorial_2"),
    (assign,"$tutorial_5_finished",1),
(else_try),
    (gt,"$tutorial_5_state",30),
    (tutorial_message,"str_tutorial_failed"),
    (entry_point_get_position, pos1, 30),
    (scene_prop_get_instance, ":scp_instance_002", "spr_tutorial_flag_yellow", 0),
    (prop_instance_animate_to_position, ":scp_instance_002", 1, 1),
    (scene_prop_get_instance, ":scp_instance_002", "spr_tutorial_flag_red", 0),
    (prop_instance_animate_to_position, ":scp_instance_002", 1, 1),
(try_end),
], [
]),

]),
("quick_battle_battle", mtf_battle_mode, -1,
"You lead your men to battle.",
[(0, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(1, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(2, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(3, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(4, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(5, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(6, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(7, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(8, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(9, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(10, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(11, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(12, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(13, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(14, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(15, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(16, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(17, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(18, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(19, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(20, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(21, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(22, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(23, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(24, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(25, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(26, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(27, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(28, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(29, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(30, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(31, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
],
[
(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (neq,"$g_battle_result",0),
    (call_script, "script_custom_battle_end"),
    (finish_mission, ":"),
(else_try),
    (question_box,"str_give_up_fight"),
(try_end),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (assign,"$g_battle_result",-1),
    (call_script, "script_custom_battle_end"),
    (finish_mission, ":"),
(try_end),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_now"),
], [
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(scene_set_day_time, 15),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(0.0, 0.0, ti_once, [
], [
(assign,"$g_battle_result",0),
(call_script, "script_combat_music_set_situation_with_culture"),
]),

(30.0, 0.0, 0.0, [
], [
(call_script, "script_combat_music_set_situation_with_culture"),
]),

(1.0, 60.0, ti_once, [
(try_begin),
    (ge,reg1,10),
    (all_enemies_defeated),
    (neg|main_hero_fallen),
    (set_mission_result,1),
    (display_message, "str_msg_battle_won"),
    (assign,"$g_battle_won",1),
    (assign,"$g_battle_result",1),
], [
(call_script, "script_custom_battle_end"),
(finish_mission, 1),
]),

(10.0, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_battle_won",1),
    (display_message, "str_msg_battle_won"),
(try_end),
]),

(1.0, 4.0, ti_once, [
(main_hero_fallen),
(assign,"$g_battle_result",-1),
], [
(call_script, "script_custom_battle_end"),
(finish_mission, ":"),
]),

]),
("quick_battle_siege", mtf_battle_mode, -1,
"You lead your men to battle.",
[(0, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(1, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(2, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(3, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(4, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(5, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(6, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(7, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(8, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(9, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(10, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(11, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(12, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(13, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(14, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(15, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(16, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(17, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(18, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(19, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(20, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(21, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(22, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(23, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(24, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(25, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(26, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(27, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(28, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(29, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(30, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(31, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(32, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(33, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(34, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(35, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(36, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(37, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(38, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(39, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(40, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(41, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(42, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(43, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(44, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(45, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(46, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
(47, mtef_visitor_source|mtef_team_0, af_override_horse, aif_start_alarmed, 1, []),
],
[
(ti_before_mission_start, 0.0, 0.0, [
], [
(team_set_relation, 0, 2, 1),
(team_set_relation, 1, 3, 1),
(call_script, "script_change_banners_and_chest"),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(0.0, 0.0, ti_once, [
(assign,"$attacker_team",1),
(assign,"$defender_team_2",2),
], [
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(scene_set_day_time, 15),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (neq,"$g_battle_result",0),
    (call_script, "script_custom_battle_end"),
    (finish_mission, ":"),
(else_try),
    (question_box,"str_give_up_fight"),
(try_end),
]),

(ti_question_answered, 0.0, 0.0, [
], [
(try_begin),
    (eq,":var001",0),
    (assign,"$g_battle_result",-1),
    (call_script, "script_custom_battle_end"),
    (finish_mission, ":"),
(try_end),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_now"),
], [
]),

(0.0, 0.0, ti_once, [
], [
(assign,"$g_battle_result",0),
(call_script, "script_music_set_situation_with_culture", 262144),
]),

(30.0, 0.0, 0.0, [
], [
(call_script, "script_combat_music_set_situation_with_culture"),
]),

(1.0, 60.0, ti_once, [
(try_begin),
    (ge,reg1,10),
    (all_enemies_defeated),
    (neg|main_hero_fallen),
    (set_mission_result,1),
    (display_message, "str_msg_battle_won"),
    (assign,"$g_battle_won",1),
    (assign,"$g_battle_result",1),
], [
(call_script, "script_custom_battle_end"),
(finish_mission, 1),
]),

(10.0, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_battle_won",1),
    (display_message, "str_msg_battle_won"),
(try_end),
]),

(1.0, 4.0, ti_once, [
(main_hero_fallen),
(assign,"$g_battle_result",-1),
], [
(call_script, "script_custom_battle_end"),
(finish_mission, ":"),
]),

(5.0, 0.0, 0.0, [
], [
(try_for_agents, ":cur_agent"),
    (try_begin),
        (agent_is_human,":cur_agent"),
        (agent_is_alive,":cur_agent"),
        (agent_get_team, ":agent_team_no_002", ":cur_agent"),
        (try_begin),
            (this_or_next|eq,":agent_team_no_002","$attacker_team_2"),
            (eq,":agent_team_no_002","$attacker_team"),
            (agent_ai_set_always_attack_in_melee, ":cur_agent",1),
        (try_end),
    (try_end),
(try_end),
]),

(120.0, 0.0, 0.0, [
], [
(get_player_agent_no,":agent_no_001"),
(try_for_agents, ":cur_agent"),
    (try_begin),
        (neq,":cur_agent",":agent_no_001"),
        (agent_is_alive,":cur_agent"),
        (agent_is_human,":cur_agent"),
        (agent_get_team, ":agent_team_no_003", ":cur_agent"),
        (try_begin),
            (this_or_next|eq,":agent_team_no_003","$defender_team_2"),
            (eq,":agent_team_no_003","$defender_team"),
            (agent_refill_ammo,":cur_agent"),
        (try_end),
    (try_end),
(try_end),
]),

(0.0, 0.0, ti_once, [
(call_script, "script_siege_init_ai_and_belfry"),
], [
]),

(0.0, 0.0, ti_once, [
(call_script,"script_cf_siege_move_belfry"),
], [
]),

(0.0, 2.0, ti_once, [
(call_script,"script_cf_siege_rotate_belfry_platform"),
], [
(assign,"$belfry_positioned",3),
]),

(0.0, 0.0, ti_once, [
(call_script,"script_cf_siege_assign_men_to_belfry"),
], [
]),

(0.0, 0.0, ti_once, [
(entry_point_get_position, pos10, 10),
(try_for_range, ":var001", 0, 9),
    (try_begin),
        (neq,":var001",1),
        (team_give_order, "$defender_team", ":var001", 0),
        (team_give_order, "$defender_team", ":var001", 7),
        (team_give_order, "$defender_team", ":var001", 7),
        (team_give_order, "$defender_team_2", ":var001", 0),
        (team_give_order, "$defender_team_2", ":var001", 7),
        (team_give_order, "$defender_team_2", ":var001", 7),
    (try_end),
(try_end),
(team_give_order, "$defender_team", 1, 11),
(team_set_order_position, "$defender_team", 9, 10),
(team_give_order, "$defender_team_2", 1, 11),
(team_set_order_position, "$defender_team_2", 9, 10),
], [
]),

]),
("multiplayer_dm", mtf_battle_mode, -1,
"You lead your men to battle.",
[(0, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(1, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(2, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(3, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(4, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(5, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(6, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(7, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(8, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(9, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(10, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(11, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(12, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(13, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(14, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(15, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(16, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(17, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(18, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(19, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(20, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(21, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(22, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(23, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(24, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(25, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(26, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(27, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(28, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(29, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(30, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(31, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(32, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(33, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(34, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(35, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(36, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(37, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(38, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(39, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(40, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(41, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(42, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(43, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(44, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(45, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(46, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(47, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(48, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(49, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(50, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(51, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(52, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(53, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(54, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(55, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(56, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(57, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(58, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(59, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(60, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(61, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(62, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(63, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
],
[
(1.0, 5.0, 0.0, [
(multiplayer_is_server),
(eq,"$g_multiplayer_poll_running",1),
(eq,"$g_multiplayer_poll_ended",0),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (this_or_next|eq,":var002","$g_multiplayer_poll_num_sent"),
    (gt,":m_timer_a_001","$g_multiplayer_poll_end_time"),
    (call_script, "script_cf_multiplayer_evaluate_poll"),
    (store_add, ":var002", "$g_multiplayer_poll_no_count", "$g_multiplayer_poll_yes_count"),
(try_end),
], [
(assign,"$g_multiplayer_poll_running",0),
(try_begin),
    (this_or_next|eq,"$g_multiplayer_poll_to_show",3),
    (eq,"$g_multiplayer_poll_to_show",0),
    (call_script, "script_game_multiplayer_get_game_type_mission_template", "$g_multiplayer_game_type"),
    (start_multiplayer_mission, reg0, "$g_multiplayer_poll_value_to_show", 1),
    (call_script, "script_game_set_multiplayer_mission_end"),
(try_end),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_on_agent_spawn_common", ":var001"),
]),

(ti_server_player_joined, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_player_joined_common", ":var001"),
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(assign,"$g_multiplayer_game_type",0),
(call_script, "script_multiplayer_server_before_mission_start_common"),
(multiplayer_make_everyone_enemy),
(call_script, "script_multiplayer_init_mission_variables"),
(call_script, "script_multiplayer_remove_destroy_mod_targets"),
(call_script, "script_multiplayer_remove_headquarters_flags"),
]),

(ti_after_mission_start, 0.0, 0.0, [
], [
(set_spawn_effector_scene_prop_kind, 0, -1),
(set_spawn_effector_scene_prop_kind, 1, -1),
(call_script, "script_initialize_all_scene_prop_slots"),
(call_script, "script_multiplayer_move_moveable_objects_initial_positions"),
(assign,"$g_multiplayer_ready_for_spawning_agent",1),
]),

(ti_on_multiplayer_mission_end, 0.0, 0.0, [
], [
(try_begin),
    (eq,1,1),
    (multiplayer_get_my_player, ":my_player"),
    (try_begin),
        (is_between,":my_player",0,1000),
        (player_get_team_no,  ":team_no_002", ":my_player"),
        (try_begin),
            (lt,":team_no_002",2),
            (player_get_kill_count, ":kill_count_003", ":my_player"),
            (player_get_death_count, ":death_count_004", ":my_player"),
            (store_mul, ":var005", ":kill_count_003", 1000),
            (val_sub, ":var005", ":death_count_004"),
            (assign,":var006",1),
            (get_max_players, ":max_players"),
            (assign,":var008",":max_players"),
            (try_for_range, ":player_id_009", 0, ":var008"),
                (try_begin),
                    (player_is_active, ":player_id_009"),
                    (player_get_team_no,  ":team_no_010", ":player_id_009"),
                    (try_begin),
                        (this_or_next|eq,":team_no_010",1),
                        (eq,":team_no_010",0),
                        (player_get_kill_count, ":kill_count_003", ":player_id_009"),
                        (player_get_death_count, ":death_count_004", ":player_id_009"),
                        (store_mul, ":var011", ":kill_count_003", 1000),
                        (val_sub, ":var011", ":death_count_004"),
                        (try_begin),
                            (gt,":var011",":var005"),
                            (assign,":var006",0),
                            (assign,":var008",0),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var006",1),
        (unlock_achievement, 68),
    (try_end),
(try_end),
(call_script, "script_multiplayer_event_mission_end"),
(assign,"$g_multiplayer_stats_chart_opened_manually",0),
(start_presentation, "prsnt_multiplayer_stats_chart_deathmatch"),
]),

(ti_on_agent_killed_or_wounded, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_on_agent_killed_or_wounded_common", ":var001", ":var002"),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (get_max_players, ":max_players"),
    (try_for_range, ":player_id_002", 0, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_002"),
            (neg|player_is_busy_with_menus, ":player_id_002"),
            (player_get_team_no,  ":team_no_003", ":player_id_002"),
            (try_begin),
                (lt,":team_no_003",2),
                (player_get_troop_id, ":troop_id_004", ":player_id_002"),
                (try_begin),
                    (ge,":troop_id_004",0),
                    (player_get_agent_id, ":agent_id_005", ":player_id_002"),
                    (assign,":var006",0),
                    (try_begin),
                        (eq,1,1),
                        (player_get_slot,":player_slot_007",":player_id_002",24),
                        (try_begin),
                            (eq,":player_slot_007",1),
                            (assign,":var006",1),
                            (player_set_slot,":player_id_002",24,0),
                        (else_try),
                            (try_begin),
                                (lt,":agent_id_005",0),
                                (assign,":var006",1),
                            (else_try),
                                (neg|agent_is_alive,":agent_id_005"),
                                (agent_get_time_elapsed_since_removed, ":agent_time_since_removed_008", ":agent_id_005"),
                                (try_begin),
                                    (gt,":agent_time_since_removed_008","$g_multiplayer_respawn_period"),
                                    (assign,":var006",1),
                                (try_end),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var006",1),
        (call_script, "script_multiplayer_buy_agent_equipment", ":player_id_002"),
        (troop_get_inventory_slot,":troop_inv_slot_009",":troop_id_004",8),
        (try_begin),
            (ge,":troop_inv_slot_009",0),
            (assign,":var010",1),
        (else_try),
            (assign,":var010",0),
        (try_end),
    (try_end),
    (call_script, "script_multiplayer_find_spawn_point", ":team_no_003", 0, ":var010"),
    (player_spawn_new_agent, ":player_id_002", reg0),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (store_mission_timer_a,":m_timer_a_001"),
    (try_begin),
        (ge,":m_timer_a_001",2),
        (assign,":var002",0),
        (assign,":var003",0),
        (try_for_agents, ":cur_agent"),
            (try_begin),
                (agent_is_non_player, ":cur_agent"),
                (agent_is_human,":cur_agent"),
                (assign,":var005",0),
                (try_begin),
                    (agent_is_alive,":cur_agent"),
                    (assign,":var005",1),
                (else_try),
                    (agent_get_time_elapsed_since_removed, ":agent_time_since_removed_006", ":cur_agent"),
                    (try_begin),
                        (le,":agent_time_since_removed_006","$g_multiplayer_respawn_period"),
                        (assign,":var005",1),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var005",1),
        (agent_get_team, ":agent_team_no_007", ":cur_agent"),
        (try_begin),
            (eq,":agent_team_no_007",0),
            (val_add, ":var002", 1),
        (else_try),
            (eq,":agent_team_no_007",1),
            (val_add, ":var003", 1),
        (try_end),
    (try_end),
(try_end),
(store_sub, "$g_multiplayer_num_bots_required_team_1", "$g_multiplayer_num_bots_team_1", ":var002"),
(store_sub, "$g_multiplayer_num_bots_required_team_2", "$g_multiplayer_num_bots_team_2", ":var003"),
(val_max,"$g_multiplayer_num_bots_required_team_1",0),
(val_max,"$g_multiplayer_num_bots_required_team_2",0),
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (eq,"$g_multiplayer_ready_for_spawning_agent",1),
    (store_add, ":var001", "$g_multiplayer_num_bots_required_team_1", "$g_multiplayer_num_bots_required_team_2"),
    (try_begin),
        (gt,":var001",0),
        (store_random_in_range,":random_x_002",0,":var001"),
        (val_sub, ":random_x_002", "$g_multiplayer_num_bots_required_team_1"),
        (try_begin),
            (lt,":random_x_002",0),
            (assign,":team_id_003",0),
            (val_sub, "$g_multiplayer_num_bots_required_team_1", 1),
        (else_try),
            (assign,":team_id_003",1),
            (val_sub, "$g_multiplayer_num_bots_required_team_2", 1),
        (try_end),
    (try_end),
    (team_get_faction, ":team_faction_004", ":team_id_003"),
    (assign,":var005",0),
    (try_for_range, ":trp_006", "trp_swadian_crossbowman_multiplayer_ai", "trp_swadian_crossbowman_multiplayer"),
        (store_troop_faction,":troop_faction_007",":trp_006"),
        (try_begin),
            (eq,":troop_faction_007",":team_faction_004"),
            (val_add, ":var005", 1),
        (try_end),
    (try_end),
    (store_random_in_range,":random_x_008",0,":var005"),
    (assign,":var009","trp_swadian_crossbowman_multiplayer"),
    (try_for_range, ":trp_006", "trp_swadian_crossbowman_multiplayer_ai", ":var009"),
        (store_troop_faction,":troop_faction_007",":trp_006"),
        (try_begin),
            (eq,":troop_faction_007",":team_faction_004"),
            (val_sub, ":random_x_008", 1),
            (try_begin),
                (lt,":random_x_008",0),
                (assign,":var009",0),
                (assign,":troop_id_010",":trp_006"),
            (try_end),
        (try_end),
    (try_end),
    (troop_get_inventory_slot,":troop_inv_slot_011",":troop_id_010",8),
    (try_begin),
        (ge,":troop_inv_slot_011",0),
        (assign,":var012",1),
    (else_try),
        (assign,":var012",0),
    (try_end),
    (call_script, "script_multiplayer_find_spawn_point", ":team_id_003", 0, ":var012"),
    (store_current_scene,":cur_scene_013"),
    (modify_visitors_at_site,":cur_scene_013"),
    (add_visitors_to_current_scene,reg0,":troop_id_010",1, ":team_id_003", -1),
    (assign,"$g_multiplayer_ready_for_spawning_agent",0),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (assign,":var001",0),
    (try_begin),
        (eq,1,1),
        (store_mission_timer_a,":m_timer_a_002"),
        (store_mul, ":var003", "$g_multiplayer_game_max_minutes", 60),
        (try_begin),
            (gt,":m_timer_a_002",":var003"),
            (assign,":var001",1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,":var001",1),
    (call_script, "script_game_multiplayer_get_game_type_mission_template", "$g_multiplayer_game_type"),
    (start_multiplayer_mission, reg0, "$g_multiplayer_selected_map", 0),
    (call_script, "script_game_set_multiplayer_mission_end"),
(try_end),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_multiplayer_mission_end_screen",0),
    (assign,"$g_multiplayer_stats_chart_opened_manually",1),
    (start_presentation, "prsnt_multiplayer_stats_chart_deathmatch"),
(try_end),
]),

(0.0, 0.0, ti_once, [
], [
(start_presentation, "prsnt_multiplayer_welcome_message"),
]),

(ti_escape_pressed, 0.0, 0.0, [
], [
(try_begin),
    (neg|is_presentation_active, "prsnt_multiplayer_escape_menu"),
    (neg|is_presentation_active, "prsnt_multiplayer_stats_chart_deathmatch"),
    (eq,"$g_waiting_for_confirmation_to_terminate",0),
    (start_presentation, "prsnt_multiplayer_escape_menu"),
(try_end),
]),

]),
("multiplayer_tdm", mtf_battle_mode, -1,
"You lead your men to battle.",
[(0, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(1, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(2, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(3, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(4, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(5, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(6, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(7, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(8, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(9, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(10, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(11, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(12, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(13, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(14, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(15, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(16, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(17, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(18, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(19, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(20, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(21, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(22, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(23, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(24, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(25, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(26, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(27, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(28, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(29, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(30, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(31, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(32, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(33, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(34, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(35, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(36, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(37, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(38, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(39, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(40, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(41, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(42, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(43, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(44, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(45, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(46, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(47, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(48, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(49, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(50, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(51, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(52, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(53, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(54, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(55, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(56, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(57, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(58, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(59, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(60, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(61, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(62, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(63, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
],
[
(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(1.0, 5.0, 0.0, [
(multiplayer_is_server),
(eq,"$g_multiplayer_poll_running",1),
(eq,"$g_multiplayer_poll_ended",0),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (this_or_next|eq,":var002","$g_multiplayer_poll_num_sent"),
    (gt,":m_timer_a_001","$g_multiplayer_poll_end_time"),
    (call_script, "script_cf_multiplayer_evaluate_poll"),
    (store_add, ":var002", "$g_multiplayer_poll_no_count", "$g_multiplayer_poll_yes_count"),
(try_end),
], [
(assign,"$g_multiplayer_poll_running",0),
(try_begin),
    (this_or_next|eq,"$g_multiplayer_poll_to_show",3),
    (eq,"$g_multiplayer_poll_to_show",0),
    (call_script, "script_game_multiplayer_get_game_type_mission_template", "$g_multiplayer_game_type"),
    (start_multiplayer_mission, reg0, "$g_multiplayer_poll_value_to_show", 1),
    (call_script, "script_game_set_multiplayer_mission_end"),
(try_end),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_on_agent_spawn_common", ":var001"),
]),

(ti_server_player_joined, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_player_joined_common", ":var001"),
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(assign,"$g_multiplayer_game_type",1),
(call_script, "script_multiplayer_server_before_mission_start_common"),
(call_script, "script_multiplayer_init_mission_variables"),
(call_script, "script_multiplayer_remove_destroy_mod_targets"),
(call_script, "script_multiplayer_remove_headquarters_flags"),
]),

(ti_after_mission_start, 0.0, 0.0, [
], [
(set_spawn_effector_scene_prop_kind, 0, -1),
(set_spawn_effector_scene_prop_kind, 1, -1),
(call_script, "script_initialize_all_scene_prop_slots"),
(call_script, "script_multiplayer_move_moveable_objects_initial_positions"),
(assign,"$g_multiplayer_ready_for_spawning_agent",1),
]),

(ti_on_multiplayer_mission_end, 0.0, 0.0, [
], [
(try_begin),
    (eq,1,1),
    (multiplayer_get_my_player, ":my_player"),
    (try_begin),
        (is_between,":my_player",0,1000),
        (player_get_team_no,  ":team_no_002", ":my_player"),
        (try_begin),
            (lt,":team_no_002",2),
            (team_get_score, ":team_score_003", 0),
            (team_get_score, ":team_score_004", 1),
            (assign,":var005",0),
            (try_begin),
                (eq,":team_no_002",0),
                (gt,":team_score_003",":team_score_004"),
                (assign,":var005",1),
            (else_try),
                (eq,":team_no_002",1),
                (gt,":team_score_004",":team_score_003"),
                (assign,":var005",1),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var005",1),
        (unlock_achievement, 67),
    (try_end),
(try_end),
(call_script, "script_multiplayer_event_mission_end"),
(assign,"$g_multiplayer_stats_chart_opened_manually",0),
(start_presentation, "prsnt_multiplayer_stats_chart"),
]),

(ti_on_agent_killed_or_wounded, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_on_agent_killed_or_wounded_common", ":var001", ":var002"),
(try_begin),
    (ge,":var002",0),
    (agent_is_human,":var001"),
    (agent_is_human,":var002"),
    (agent_get_team, ":agent_team_no_003", ":var002"),
    (try_begin),
        (le,":agent_team_no_003",1),
        (agent_get_team, ":agent_team_no_004", ":var001"),
        (try_begin),
            (neq,":agent_team_no_003",":agent_team_no_004"),
            (team_get_score, ":team_score_005", ":agent_team_no_003"),
            (val_add, ":team_score_005", 1),
            (call_script, "script_team_set_score", ":agent_team_no_003", ":team_score_005"),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (get_max_players, ":max_players"),
    (try_for_range, ":player_id_002", 0, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_002"),
            (neg|player_is_busy_with_menus, ":player_id_002"),
            (player_get_team_no,  ":team_no_003", ":player_id_002"),
            (try_begin),
                (lt,":team_no_003",2),
                (player_get_troop_id, ":troop_id_004", ":player_id_002"),
                (try_begin),
                    (ge,":troop_id_004",0),
                    (player_get_agent_id, ":agent_id_005", ":player_id_002"),
                    (assign,":var006",0),
                    (try_begin),
                        (eq,1,1),
                        (player_get_slot,":player_slot_007",":player_id_002",24),
                        (try_begin),
                            (eq,":player_slot_007",1),
                            (assign,":var006",1),
                            (player_set_slot,":player_id_002",24,0),
                        (else_try),
                            (try_begin),
                                (lt,":agent_id_005",0),
                                (assign,":var006",1),
                            (else_try),
                                (neg|agent_is_alive,":agent_id_005"),
                                (agent_get_time_elapsed_since_removed, ":agent_time_since_removed_008", ":agent_id_005"),
                                (try_begin),
                                    (gt,":agent_time_since_removed_008","$g_multiplayer_respawn_period"),
                                    (assign,":var006",1),
                                (try_end),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var006",1),
        (call_script, "script_multiplayer_buy_agent_equipment", ":player_id_002"),
        (troop_get_inventory_slot,":troop_inv_slot_009",":troop_id_004",8),
        (try_begin),
            (ge,":troop_inv_slot_009",0),
            (assign,":var010",1),
        (else_try),
            (assign,":var010",0),
        (try_end),
    (try_end),
    (call_script, "script_multiplayer_find_spawn_point", ":team_no_003", 1, ":var010"),
    (player_spawn_new_agent, ":player_id_002", reg0),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (store_mission_timer_a,":m_timer_a_001"),
    (try_begin),
        (ge,":m_timer_a_001",2),
        (assign,":var002",0),
        (assign,":var003",0),
        (try_for_agents, ":cur_agent"),
            (try_begin),
                (agent_is_non_player, ":cur_agent"),
                (agent_is_human,":cur_agent"),
                (assign,":var005",0),
                (try_begin),
                    (agent_is_alive,":cur_agent"),
                    (assign,":var005",1),
                (else_try),
                    (agent_get_time_elapsed_since_removed, ":agent_time_since_removed_006", ":cur_agent"),
                    (try_begin),
                        (le,":agent_time_since_removed_006","$g_multiplayer_respawn_period"),
                        (assign,":var005",1),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var005",1),
        (agent_get_team, ":agent_team_no_007", ":cur_agent"),
        (try_begin),
            (eq,":agent_team_no_007",0),
            (val_add, ":var002", 1),
        (else_try),
            (eq,":agent_team_no_007",1),
            (val_add, ":var003", 1),
        (try_end),
    (try_end),
(try_end),
(store_sub, "$g_multiplayer_num_bots_required_team_1", "$g_multiplayer_num_bots_team_1", ":var002"),
(store_sub, "$g_multiplayer_num_bots_required_team_2", "$g_multiplayer_num_bots_team_2", ":var003"),
(val_max,"$g_multiplayer_num_bots_required_team_1",0),
(val_max,"$g_multiplayer_num_bots_required_team_2",0),
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (eq,"$g_multiplayer_ready_for_spawning_agent",1),
    (store_add, ":var001", "$g_multiplayer_num_bots_required_team_1", "$g_multiplayer_num_bots_required_team_2"),
    (try_begin),
        (gt,":var001",0),
        (try_begin),
            (this_or_next|eq,"$g_multiplayer_game_type",6),
            (this_or_next|eq,"$g_multiplayer_game_type",3),
            (eq,"$g_multiplayer_game_type",2),
            (team_get_score, ":team_score_002", 0),
            (team_get_score, ":team_score_003", 1),
            (store_add, ":var004", ":team_score_002", ":team_score_003"),
            (try_begin),
                (eq,":var004",0),
                (store_mission_timer_a,":m_timer_a_005"),
                (val_sub, ":m_timer_a_005", "$g_round_start_time"),
                (try_begin),
                    (lt,":m_timer_a_005",20),
                    (assign,":var006",0),
                (else_try),
                    (assign,":var006",1),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var006",1),
        (store_random_in_range,":random_x_007",0,":var001"),
        (val_sub, ":random_x_007", "$g_multiplayer_num_bots_required_team_1"),
        (try_begin),
            (lt,":random_x_007",0),
            (assign,":team_id_008",0),
        (else_try),
            (assign,":team_id_008",1),
        (try_end),
    (try_end),
    (try_begin),
        (this_or_next|eq,"$g_multiplayer_game_type",6),
        (this_or_next|eq,"$g_multiplayer_game_type",3),
        (eq,"$g_multiplayer_game_type",2),
        (store_mission_timer_a,":m_timer_a_005"),
        (val_sub, ":m_timer_a_005", "$g_round_start_time"),
        (try_begin),
            (le,":m_timer_a_005",20),
            (assign,":var009",0),
        (else_try),
            (assign,":var009",1),
        (try_end),
    (else_try),
        (assign,":var009",1),
    (try_end),
    (call_script, "script_multiplayer_find_bot_troop_and_group_for_spawn", ":team_id_008", ":var009"),
    (assign,":troop_id_010",reg0),
    (assign,":group_no_011",reg1),
    (team_get_faction, ":team_faction_012", ":team_id_008"),
    (assign,":var013",0),
    (try_for_range, ":trp_014", "trp_swadian_crossbowman_multiplayer_ai", "trp_swadian_crossbowman_multiplayer"),
        (store_troop_faction,":troop_faction_015",":trp_014"),
        (try_begin),
            (eq,":troop_faction_015",":team_faction_012"),
            (val_add, ":var013", 1),
        (try_end),
    (try_end),
    (assign,":var016",0),
    (get_max_players, ":max_players"),
    (try_for_range, ":player_id_018", 0, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_018"),
            (player_get_team_no,  ":team_no_019", ":player_id_018"),
            (try_begin),
                (eq,":team_id_008",":team_no_019"),
                (assign,":var020",0),
                (store_add, ":var021", 35, ":var013"),
                (try_for_range, ":var022", 35, ":var021"),
                    (try_begin),
                        (player_slot_ge,":player_id_018",":var022",1),
                        (assign,":var020",1),
                        (assign,":var021",0),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (ge,":var020",1),
            (val_add, ":var016", 1),
        (try_end),
    (try_end),
    (try_begin),
        (this_or_next|ge,":group_no_011",0),
        (eq,":var016",0),
        (troop_get_inventory_slot,":troop_inv_slot_023",":troop_id_010",8),
        (try_begin),
            (ge,":troop_inv_slot_023",0),
            (assign,":var024",1),
        (else_try),
            (assign,":var024",0),
        (try_end),
        (try_begin),
            (eq,"$g_multiplayer_game_type",6),
            (store_mission_timer_a,":m_timer_a_005"),
            (val_sub, ":m_timer_a_005", "$g_round_start_time"),
            (try_begin),
                (lt,":m_timer_a_005",20),
                (try_begin),
                    (eq,":team_id_008",0),
                    (call_script, "script_multiplayer_find_spawn_point", ":team_id_008", 1, ":var024"),
                (else_try),
                    (assign,reg0,32),
                (try_end),
            (else_try),
                (call_script, "script_multiplayer_find_spawn_point", ":team_id_008", 0, ":var024"),
            (try_end),
        (else_try),
            (this_or_next|eq,"$g_multiplayer_game_type",3),
            (eq,"$g_multiplayer_game_type",2),
            (try_begin),
                (eq,":team_id_008",0),
                (assign,reg0,0),
            (else_try),
                (assign,reg0,32),
            (try_end),
        (else_try),
            (call_script, "script_multiplayer_find_spawn_point", ":team_id_008", 0, ":var024"),
        (try_end),
        (store_current_scene,":cur_scene_025"),
        (modify_visitors_at_site,":cur_scene_025"),
        (add_visitors_to_current_scene,reg0,":troop_id_010",1, ":team_id_008", ":group_no_011"),
        (assign,"$g_multiplayer_ready_for_spawning_agent",0),
        (try_begin),
            (eq,":team_id_008",0),
            (val_sub, "$g_multiplayer_num_bots_required_team_1", 1),
        (else_try),
            (eq,":team_id_008",1),
            (val_sub, "$g_multiplayer_num_bots_required_team_2", 1),
        (try_end),
    (try_end),
(try_end),
]),

(3.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (try_for_agents, ":cur_agent"),
        (try_begin),
            (agent_is_non_player, ":cur_agent"),
            (agent_is_human,":cur_agent"),
            (agent_is_alive,":cur_agent"),
            (agent_get_group, ":agent_group_002", ":cur_agent"),
            (try_begin),
                (neg|player_is_active, ":agent_group_002"),
                (call_script, "script_multiplayer_change_leader_of_bot", ":cur_agent"),
            (else_try),
                (player_get_team_no,  ":team_no_003", ":agent_group_002"),
                (agent_get_team, ":agent_team_no_004", ":cur_agent"),
                (try_begin),
                    (neq,":team_no_003",":agent_team_no_004"),
                    (call_script, "script_multiplayer_change_leader_of_bot", ":cur_agent"),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(20.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (call_script, "script_check_team_balance"),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (assign,":var001",0),
    (try_begin),
        (eq,"$g_multiplayer_game_type",8),
        (try_begin),
            (eq,"$g_round_ended",1),
            (assign,":var001",1),
        (try_end),
    (try_end),
(else_try),
    (this_or_next|eq,"$g_multiplayer_game_type",6),
    (this_or_next|eq,"$g_multiplayer_game_type",3),
    (eq,"$g_multiplayer_game_type",2),
    (try_begin),
        (eq,"$g_round_ended",1),
        (store_mission_timer_a,":m_timer_a_002"),
        (val_sub, ":m_timer_a_002", "$g_round_finish_time"),
        (store_sub, ":var003", "$g_multiplayer_respawn_period", 1),
        (try_begin),
            (ge,":m_timer_a_002",":var003"),
            (store_mission_timer_a,":m_timer_a_004"),
            (try_begin),
                (this_or_next|eq,"$g_multiplayer_game_type",3),
                (eq,"$g_multiplayer_game_type",2),
                (assign,":var005",90),
            (else_try),
                (assign,":var005",120),
            (try_end),
        (try_end),
        (store_mul, ":var006", "$g_multiplayer_game_max_minutes", 60),
        (store_sub, ":var007", ":var006", ":var005"),
        (try_begin),
            (gt,":m_timer_a_004",":var007"),
            (assign,":var001",1),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var001",1),
    (else_try),
        (neq,"$g_multiplayer_game_type",2),
        (neq,"$g_multiplayer_game_type",3),
        (neq,"$g_multiplayer_game_type",6),
        (neq,"$g_multiplayer_game_type",5),
        (store_mission_timer_a,":m_timer_a_004"),
        (store_mul, ":var006", "$g_multiplayer_game_max_minutes", 60),
        (try_begin),
            (gt,":m_timer_a_004",":var006"),
            (assign,":var001",1),
        (else_try),
            (team_get_score, ":team_score_008", 0),
            (team_get_score, ":team_score_009", 1),
            (try_begin),
                (neq,"$g_multiplayer_game_type",5),
                (try_begin),
                    (this_or_next|ge,":team_score_008","$g_multiplayer_game_max_points"),
                    (ge,":team_score_009","$g_multiplayer_game_max_points"),
                    (assign,":var001",1),
                (try_end),
            (try_end),
        (try_end),
    (else_try),
        (assign,":var010",0),
        (get_max_players, ":max_players"),
        (try_for_range, ":player_id_012", 0, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_012"),
                (player_get_agent_id, ":agent_id_013", ":player_id_012"),
                (try_begin),
                    (ge,":agent_id_013",0),
                    (neg|agent_is_non_player, ":agent_id_013"),
                    (assign,":var010",1),
                    (assign,":max_players",0),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (eq,":var010",1),
            (this_or_next|gt,":team_score_008",0),
            (le,":team_score_009",0),
            (assign,":var001",1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,":var001",1),
    (call_script, "script_game_multiplayer_get_game_type_mission_template", "$g_multiplayer_game_type"),
    (start_multiplayer_mission, reg0, "$g_multiplayer_selected_map", 0),
    (call_script, "script_game_set_multiplayer_mission_end"),
(try_end),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_multiplayer_mission_end_screen",0),
    (assign,"$g_multiplayer_stats_chart_opened_manually",1),
    (start_presentation, "prsnt_multiplayer_stats_chart"),
(try_end),
]),

(0.0, 0.0, ti_once, [
], [
(start_presentation, "prsnt_multiplayer_welcome_message"),
]),

(ti_battle_window_opened, 0.0, 0.0, [
], [
(start_presentation, "prsnt_multiplayer_team_score_display"),
]),

(ti_escape_pressed, 0.0, 0.0, [
], [
(try_begin),
    (neg|is_presentation_active, "prsnt_multiplayer_escape_menu"),
    (neg|is_presentation_active, "prsnt_multiplayer_stats_chart"),
    (eq,"$g_waiting_for_confirmation_to_terminate",0),
    (start_presentation, "prsnt_multiplayer_escape_menu"),
(try_end),
]),

]),
("multiplayer_hq", mtf_battle_mode, -1,
"You lead your men to battle.",
[(0, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(1, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(2, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(3, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(4, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(5, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(6, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(7, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(8, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(9, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(10, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(11, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(12, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(13, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(14, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(15, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(16, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(17, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(18, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(19, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(20, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(21, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(22, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(23, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(24, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(25, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(26, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(27, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(28, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(29, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(30, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(31, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(32, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(33, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(34, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(35, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(36, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(37, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(38, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(39, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(40, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(41, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(42, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(43, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(44, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(45, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(46, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(47, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(48, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(49, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(50, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(51, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(52, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(53, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(54, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(55, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(56, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(57, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(58, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(59, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(60, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(61, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(62, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(63, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
],
[
(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(1.0, 5.0, 0.0, [
(multiplayer_is_server),
(eq,"$g_multiplayer_poll_running",1),
(eq,"$g_multiplayer_poll_ended",0),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (this_or_next|eq,":var002","$g_multiplayer_poll_num_sent"),
    (gt,":m_timer_a_001","$g_multiplayer_poll_end_time"),
    (call_script, "script_cf_multiplayer_evaluate_poll"),
    (store_add, ":var002", "$g_multiplayer_poll_no_count", "$g_multiplayer_poll_yes_count"),
(try_end),
], [
(assign,"$g_multiplayer_poll_running",0),
(try_begin),
    (this_or_next|eq,"$g_multiplayer_poll_to_show",3),
    (eq,"$g_multiplayer_poll_to_show",0),
    (call_script, "script_game_multiplayer_get_game_type_mission_template", "$g_multiplayer_game_type"),
    (start_multiplayer_mission, reg0, "$g_multiplayer_poll_value_to_show", 1),
    (call_script, "script_game_set_multiplayer_mission_end"),
(try_end),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_on_agent_spawn_common", ":var001"),
]),

(ti_server_player_joined, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_player_joined_common", ":var001"),
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(assign,"$g_multiplayer_game_type",5),
(call_script, "script_multiplayer_server_before_mission_start_common"),
(store_mul, ":var001", "$g_multiplayer_game_max_points", 10000),
(assign,"$g_score_team_1",":var001"),
(assign,"$g_score_team_2",":var001"),
(try_for_range, ":slot_no_002", 146, 156),
    (troop_set_slot,"trp_multiplayer_data",":slot_no_002",-1),
(try_end),
(try_begin),
    (multiplayer_is_server),
    (try_for_range, ":slot_no_002", 176, 186),
        (troop_set_slot,"trp_multiplayer_data",":slot_no_002",-1),
    (try_end),
(try_end),
(call_script, "script_multiplayer_init_mission_variables"),
(call_script, "script_multiplayer_remove_destroy_mod_targets"),
(try_begin),
    (multiplayer_is_server),
    (call_script, "script_team_set_score", 0, "$g_multiplayer_game_max_points"),
    (call_script, "script_team_set_score", 1, "$g_multiplayer_game_max_points"),
(try_end),
]),

(ti_after_mission_start, 0.0, 0.0, [
], [
(call_script, "script_determine_team_flags", 0),
(call_script, "script_determine_team_flags", 1),
(set_spawn_effector_scene_prop_kind, 0, "$team_1_flag_scene_prop"),
(set_spawn_effector_scene_prop_kind, 1, "$team_2_flag_scene_prop"),
(try_begin),
    (multiplayer_is_server),
    (assign,"$g_multiplayer_ready_for_spawning_agent",1),
    (assign,"$g_number_of_flags",0),
    (entry_point_get_position, pos1, 64),
    (entry_point_get_position, pos3, 64),
    (set_spawn_position, 3),
    (spawn_scene_prop, "spr_headquarters_pole_code_only"),
    (set_spawn_position, 3),
    (spawn_scene_prop, "$team_1_flag_scene_prop"),
    (set_spawn_position, 3),
    (spawn_scene_prop, "$team_2_flag_scene_prop"),
    (set_spawn_position, 3),
    (spawn_scene_prop, "spr_headquarters_flag_gray_code_only"),
    (store_add, ":slot_no_001", 146, "$g_number_of_flags"),
    (troop_set_slot,"trp_multiplayer_data",":slot_no_001",1),
    (val_add, "$g_number_of_flags", 1),
    (entry_point_get_position, pos2, 65),
    (entry_point_get_position, pos3, 65),
    (set_spawn_position, 3),
    (spawn_scene_prop, "spr_headquarters_pole_code_only"),
    (set_spawn_position, 3),
    (spawn_scene_prop, "$team_1_flag_scene_prop"),
    (set_spawn_position, 3),
    (spawn_scene_prop, "$team_2_flag_scene_prop"),
    (set_spawn_position, 3),
    (spawn_scene_prop, "spr_headquarters_flag_gray_code_only"),
    (store_add, ":slot_no_001", 146, "$g_number_of_flags"),
    (troop_set_slot,"trp_multiplayer_data",":slot_no_001",2),
    (val_add, "$g_number_of_flags", 1),
    (scene_prop_get_num_instances, ":scp_num_instances_002", "spr_headquarters_flag_red"),
    (scene_prop_get_num_instances, ":scp_num_instances_003", "spr_headquarters_flag_blue"),
    (scene_prop_get_num_instances, ":scp_num_instances_004", "spr_headquarters_flag_gray"),
    (assign,":var005","spr_headquarters_flag_gray"),
    (val_add, ":var005", 1),
    (try_for_range, ":var006", "spr_headquarters_flag_red", ":var005"),
        (try_begin),
            (eq,":var006","spr_headquarters_flag_red"),
            (assign,":var007",":scp_num_instances_002"),
        (else_try),
            (eq,":var006","spr_headquarters_flag_blue"),
            (assign,":var007",":scp_num_instances_003"),
        (else_try),
            (eq,":var006","spr_headquarters_flag_gray"),
            (assign,":var007",":scp_num_instances_004"),
        (try_end),
        (try_begin),
            (gt,":var007",0),
            (try_for_range, ":var008", 0, ":var007"),
                (scene_prop_get_instance, ":scp_instance_009", ":var006", ":var008"),
                (prop_instance_get_position, pos0, ":scp_instance_009"),
                (set_spawn_position, 0),
                (spawn_scene_prop, "spr_headquarters_pole_code_only"),
                (try_for_range, ":var010", "spr_headquarters_flag_red", ":var005"),
                    (set_spawn_position, 0),
                    (try_begin),
                        (eq,":var010","spr_headquarters_flag_red"),
                        (spawn_scene_prop, "$team_1_flag_scene_prop"),
                    (else_try),
                        (eq,":var010","spr_headquarters_flag_blue"),
                        (spawn_scene_prop, "$team_2_flag_scene_prop"),
                    (else_try),
                        (eq,":var010","spr_headquarters_flag_gray"),
                        (spawn_scene_prop, "spr_headquarters_flag_gray_code_only"),
                    (try_end),
                (try_end),
            (try_end),
            (store_add, ":slot_no_001", 146, "$g_number_of_flags"),
            (try_begin),
                (eq,":var006","spr_headquarters_flag_red"),
                (troop_set_slot,"trp_multiplayer_data",":slot_no_001",1),
            (else_try),
                (eq,":var006","spr_headquarters_flag_blue"),
                (troop_set_slot,"trp_multiplayer_data",":slot_no_001",2),
            (else_try),
                (eq,":var006","spr_headquarters_flag_gray"),
                (troop_set_slot,"trp_multiplayer_data",":slot_no_001",0),
            (try_end),
            (val_add, "$g_number_of_flags", 1),
        (try_end),
    (try_end),
    (assign,"$g_number_of_initial_team_1_flags",0),
    (assign,"$g_number_of_initial_team_2_flags",0),
    (try_for_range, ":var011", 0, "$g_number_of_flags"),
        (store_add, ":slot_no_001", 146, ":var011"),
        (troop_get_slot,":troop_slot_012","trp_multiplayer_data",":slot_no_001"),
        (try_begin),
            (eq,":var011",0),
            (entry_point_get_position, pos0, 64),
            (scene_prop_get_instance, ":scp_instance_009", "$team_1_flag_scene_prop", ":var011"),
            (assign,"$g_base_flag_team_1",":scp_instance_009"),
        (else_try),
            (eq,":var011",1),
            (entry_point_get_position, pos0, 65),
            (scene_prop_get_instance, ":scp_instance_009", "$team_2_flag_scene_prop", ":var011"),
            (assign,"$g_base_flag_team_2",":scp_instance_009"),
        (else_try),
            (assign,":var013",2),
            (scene_prop_get_num_instances, ":scp_num_instances_014", "spr_headquarters_flag_red"),
            (store_add, ":var015", ":var013", ":scp_num_instances_014"),
            (scene_prop_get_num_instances, ":scp_num_instances_016", "spr_headquarters_flag_blue"),
            (store_add, ":var017", ":var015", ":scp_num_instances_016"),
            (scene_prop_get_num_instances, ":scp_num_instances_018", "spr_headquarters_flag_gray"),
            (try_begin),
                (ge,":var011",":var013"),
                (gt,":scp_num_instances_014",0),
                (store_sub, ":var019", ":var011", ":var013"),
                (scene_prop_get_instance, ":scp_instance_009", "spr_headquarters_flag_red", ":var019"),
            (else_try),
                (ge,":var011",":var015"),
                (gt,":scp_num_instances_016",0),
                (store_sub, ":var019", ":var011", ":var015"),
                (scene_prop_get_instance, ":scp_instance_009", "spr_headquarters_flag_blue", ":var019"),
            (else_try),
                (ge,":var011",":var017"),
                (gt,":scp_num_instances_018",0),
                (store_sub, ":var019", ":var011", ":var017"),
                (scene_prop_get_instance, ":scp_instance_009", "spr_headquarters_flag_gray", ":var019"),
            (try_end),
            (prop_instance_get_position, pos0, ":scp_instance_009"),
        (try_end),
        (scene_prop_get_instance, ":scp_instance_020", "spr_headquarters_pole_code_only", ":var011"),
        (prop_instance_set_position, ":scp_instance_020", 0),
        (position_move_z,0,900),
        (try_begin),
            (eq,":troop_slot_012",0),
            (scene_prop_get_instance, ":scp_instance_009", "$team_1_flag_scene_prop", ":var011"),
            (prop_instance_set_position, ":scp_instance_009", 0),
            (scene_prop_set_visibility, ":scp_instance_009", 0),
            (scene_prop_get_instance, ":scp_instance_009", "$team_2_flag_scene_prop", ":var011"),
            (prop_instance_set_position, ":scp_instance_009", 0),
            (scene_prop_set_visibility, ":scp_instance_009", 0),
            (scene_prop_get_instance, ":scp_instance_009", "spr_headquarters_flag_gray_code_only", ":var011"),
            (prop_instance_set_position, ":scp_instance_009", 0),
            (scene_prop_set_visibility, ":scp_instance_009", 1),
        (else_try),
            (eq,":troop_slot_012",1),
            (scene_prop_get_instance, ":scp_instance_009", "$team_1_flag_scene_prop", ":var011"),
            (prop_instance_set_position, ":scp_instance_009", 0),
            (scene_prop_set_visibility, ":scp_instance_009", 1),
            (scene_prop_get_instance, ":scp_instance_009", "$team_2_flag_scene_prop", ":var011"),
            (prop_instance_set_position, ":scp_instance_009", 0),
            (scene_prop_set_visibility, ":scp_instance_009", 0),
            (scene_prop_get_instance, ":scp_instance_009", "spr_headquarters_flag_gray_code_only", ":var011"),
            (prop_instance_set_position, ":scp_instance_009", 0),
            (scene_prop_set_visibility, ":scp_instance_009", 0),
            (val_add, "$g_number_of_initial_team_1_flags", 1),
        (else_try),
            (scene_prop_get_instance, ":scp_instance_009", "$team_1_flag_scene_prop", ":var011"),
            (prop_instance_set_position, ":scp_instance_009", 0),
            (scene_prop_set_visibility, ":scp_instance_009", 0),
            (scene_prop_get_instance, ":scp_instance_009", "$team_2_flag_scene_prop", ":var011"),
            (prop_instance_set_position, ":scp_instance_009", 0),
            (scene_prop_set_visibility, ":scp_instance_009", 1),
            (scene_prop_get_instance, ":scp_instance_009", "spr_headquarters_flag_gray_code_only", ":var011"),
            (prop_instance_set_position, ":scp_instance_009", 0),
            (scene_prop_set_visibility, ":scp_instance_009", 0),
            (val_add, "$g_number_of_initial_team_2_flags", 1),
        (try_end),
    (try_end),
(else_try),
    (scene_prop_get_num_instances, ":scp_num_instances_002", "spr_headquarters_flag_red"),
    (scene_prop_get_num_instances, ":scp_num_instances_003", "spr_headquarters_flag_blue"),
    (scene_prop_get_num_instances, ":scp_num_instances_004", "spr_headquarters_flag_gray"),
    (assign,"$g_number_of_flags",2),
    (val_add, "$g_number_of_flags", ":scp_num_instances_002"),
    (val_add, "$g_number_of_flags", ":scp_num_instances_003"),
    (val_add, "$g_number_of_flags", ":scp_num_instances_004"),
(try_end),
(try_for_range, ":var019", 0, ":scp_num_instances_002"),
    (scene_prop_get_instance, ":scp_instance_009", "spr_headquarters_flag_red", ":var019"),
    (scene_prop_set_visibility, ":scp_instance_009", 0),
(try_end),
(try_for_range, ":var019", 0, ":scp_num_instances_003"),
    (scene_prop_get_instance, ":scp_instance_009", "spr_headquarters_flag_blue", ":var019"),
    (scene_prop_set_visibility, ":scp_instance_009", 0),
(try_end),
(try_for_range, ":var019", 0, ":scp_num_instances_004"),
    (scene_prop_get_instance, ":scp_instance_009", "spr_headquarters_flag_gray", ":var019"),
    (scene_prop_set_visibility, ":scp_instance_009", 0),
(try_end),
(try_for_range, ":var019", 0, "$g_number_of_flags"),
    (store_add, ":slot_no_021", 166, ":var019"),
    (troop_set_slot,"trp_multiplayer_data",":slot_no_021",0),
(try_end),
(call_script, "script_initialize_all_scene_prop_slots"),
(call_script, "script_multiplayer_move_moveable_objects_initial_positions"),
]),

(ti_on_multiplayer_mission_end, 0.0, 0.0, [
], [
(try_begin),
    (eq,1,1),
    (multiplayer_get_my_player, ":my_player"),
    (try_begin),
        (is_between,":my_player",0,1000),
        (player_get_team_no,  ":team_no_002", ":my_player"),
        (try_begin),
            (lt,":team_no_002",2),
            (call_script, "script_get_headquarters_scores"),
            (assign,":var003",reg0),
            (assign,":var004",reg1),
            (assign,":var005",0),
            (try_begin),
                (eq,":team_no_002",0),
                (gt,":var003",":var004"),
                (assign,":var005",1),
            (else_try),
                (eq,":team_no_002",1),
                (gt,":var004",":var003"),
                (assign,":var005",1),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var005",1),
        (unlock_achievement, 61),
    (try_end),
(try_end),
(call_script, "script_multiplayer_event_mission_end"),
(assign,"$g_multiplayer_stats_chart_opened_manually",0),
(start_presentation, "prsnt_multiplayer_stats_chart"),
]),

(ti_on_agent_killed_or_wounded, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_on_agent_killed_or_wounded_common", ":var001", ":var002"),
(try_begin),
    (multiplayer_is_server),
    (ge,":var002",0),
    (agent_is_human,":var001"),
    (agent_is_human,":var002"),
    (agent_get_team, ":agent_team_no_003", ":var002"),
    (try_begin),
        (le,":agent_team_no_003",1),
        (agent_get_team, ":agent_team_no_004", ":var001"),
        (try_begin),
            (neq,":agent_team_no_003",":agent_team_no_004"),
            (team_get_score, ":team_score_005", ":agent_team_no_004"),
            (try_begin),
                (eq,":agent_team_no_003",0),
                (val_add, "$g_score_team_2", -10000),
            (else_try),
                (val_add, "$g_score_team_1", -10000),
            (try_end),
        (try_end),
    (try_end),
    (val_sub, ":team_score_005", 1),
    (get_max_players, ":max_players"),
    (call_script, "script_team_set_score", ":agent_team_no_004", ":team_score_005"),
    (try_for_range, ":player_id_007", 1, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_007"),
            (multiplayer_send_2_int_to_player, ":player_id_007", 72, ":agent_team_no_004", ":team_score_005"),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (try_for_range, ":var001", 0, "$g_number_of_flags"),
        (store_add, ":slot_no_002", 166, ":var001"),
        (troop_get_slot,":troop_slot_003","trp_multiplayer_data",":slot_no_002"),
        (val_add, ":troop_slot_003", 1),
        (troop_set_slot,"trp_multiplayer_data",":slot_no_002",":troop_slot_003"),
        (store_add, ":slot_no_004", 176, ":var001"),
        (troop_get_slot,":troop_slot_005","trp_multiplayer_data",":slot_no_004"),
        (store_mod,":var006",":troop_slot_005",100),
        (try_begin),
            (ge,":troop_slot_005",100),
            (lt,":var006",25),
            (val_add, ":troop_slot_005", 1),
            (troop_set_slot,"trp_multiplayer_data",":slot_no_004",":troop_slot_005"),
        (try_end),
    (try_end),
(try_end),
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (try_for_range, ":var001", 0, "$g_number_of_flags"),
        (store_add, ":slot_no_002", 156, ":var001"),
        (troop_get_slot,":troop_slot_003","trp_multiplayer_data",":slot_no_002"),
        (store_div, ":var___x1", ":troop_slot_003", 100),
        (assign,":var004",":var___x1"),
        (store_mod,":var005",":troop_slot_003",100),
        (assign,":var006",0),
        (assign,":var007",0),
        (scene_prop_get_instance, ":scp_instance_008", "spr_headquarters_pole_code_only", ":var001"),
        (prop_instance_get_position, pos0, ":scp_instance_008"),
        (get_max_players, ":max_players"),
        (try_for_range, ":player_id_010", 0, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_010"),
                (player_get_agent_id, ":agent_id_011", ":player_id_010"),
                (try_begin),
                    (ge,":agent_id_011",0),
                    (agent_is_alive,":agent_id_011"),
                    (agent_get_team, ":agent_team_no_012", ":agent_id_011"),
                    (agent_get_position,pos1,":agent_id_011"),
                    (get_sq_distance_between_positions,":sq_distance_013",0,1),
                    (get_sq_distance_between_position_heights,":sq_distance_014",0,1),
                    (val_add, ":sq_distance_013", ":sq_distance_014"),
                    (try_begin),
                        (lt,":sq_distance_013",1600),
                        (try_begin),
                            (eq,":agent_team_no_012",0),
                            (val_add, ":var006", 1),
                        (else_try),
                            (eq,":agent_team_no_012",1),
                            (val_add, ":var007", 1),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (this_or_next|eq,":var004",":var006"),
        (neq,":var005",":var007"),
        (store_add, ":slot_no_015", 146, ":var001"),
        (troop_get_slot,":troop_slot_016","trp_multiplayer_data",":slot_no_015"),
        (store_add, ":slot_no_017", 176, ":var001"),
        (troop_get_slot,":troop_slot_018","trp_multiplayer_data",":slot_no_017"),
        (store_mod,":var019",":troop_slot_018",100),
        (store_div, ":var___x1", ":troop_slot_018", 100),
        (assign,":var020",":var___x1"),
        (try_begin),
            (eq,1,1),
            (assign,":var021",0),
            (try_begin),
                (neq,":troop_slot_016",1),
                (eq,":var004",0),
                (gt,":var006",0),
                (eq,":var007",0),
                (assign,":var022",1),
                (assign,":var021",1),
            (else_try),
                (neq,":troop_slot_016",2),
                (eq,":var005",0),
                (eq,":var006",0),
                (gt,":var007",0),
                (assign,":var022",2),
                (assign,":var021",1),
            (try_end),
            (try_begin),
                (eq,":var021",1),
                (store_mul, ":var023", ":var022", 100),
                (troop_set_slot,"trp_multiplayer_data",":slot_no_017",":var023"),
                (try_begin),
                    (this_or_next|eq,":var020",":var022"),
                    (ge,":var019",25),
                    (store_mul, ":var024", ":var022", 100),
                    (val_add, ":var024", ":var001"),
                    (call_script, "script_show_multiplayer_message", 10, ":var024"),
                    (try_for_range, ":player_id_010", 1, ":max_players"),
                        (try_begin),
                            (player_is_active, ":player_id_010"),
                            (multiplayer_send_2_int_to_player, ":player_id_010", 68, 10, ":var024"),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (eq,1,1),
            (store_mul, ":troop_slot_003", ":var006", 100),
            (val_add, ":troop_slot_003", ":var007"),
            (troop_set_slot,"trp_multiplayer_data",":slot_no_002",":troop_slot_003"),
            (call_script, "script_set_num_agents_around_flag", ":var001", ":troop_slot_003"),
            (get_max_players, ":max_players"),
            (try_for_range, ":player_id_010", 1, ":max_players"),
                (try_begin),
                    (player_is_active, ":player_id_010"),
                    (multiplayer_send_2_int_to_player, ":player_id_010", 73, ":var001", ":troop_slot_003"),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_for_range, ":var001", 0, "$g_number_of_flags"),
    (assign,":var025",-1),
    (scene_prop_get_instance, ":scp_instance_008", "spr_headquarters_pole_code_only", ":var001"),
    (prop_instance_get_position, pos0, ":scp_instance_008"),
    (store_add, ":slot_no_015", 146, ":var001"),
    (troop_get_slot,":troop_slot_016","trp_multiplayer_data",":slot_no_015"),
    (try_begin),
        (eq,1,1),
        (try_begin),
            (eq,1,1),
            (scene_prop_get_instance, ":scp_instance_026", "$team_1_flag_scene_prop", ":var001"),
            (scene_prop_get_visibility, ":scp_visibility_027", ":scp_instance_026"),
            (assign,":var028",1),
            (try_begin),
                (eq,":scp_visibility_027",0),
                (scene_prop_get_instance, ":scp_instance_026", "$team_2_flag_scene_prop", ":var001"),
                (scene_prop_get_visibility, ":scp_visibility_027", ":scp_instance_026"),
                (assign,":var028",2),
                (try_begin),
                    (eq,":scp_visibility_027",0),
                    (scene_prop_get_instance, ":scp_instance_026", "spr_headquarters_flag_gray_code_only", ":var001"),
                    (scene_prop_get_visibility, ":scp_visibility_027", ":scp_instance_026"),
                    (assign,":var028",0),
                (try_end),
            (try_end),
        (try_end),
        (prop_instance_get_position, pos1, ":scp_instance_026"),
        (try_begin),
            (eq,1,1),
            (get_sq_distance_between_positions,":sq_distance_013",0,1),
            (try_begin),
                (lt,":sq_distance_013",400),
                (store_add, ":slot_no_029", 156, ":var001"),
                (troop_get_slot,":troop_slot_030","trp_multiplayer_data",":slot_no_029"),
                (store_div, ":var___x1", ":troop_slot_030", 100),
                (assign,":var006",":var___x1"),
                (store_mod,":var007",":troop_slot_030",100),
                (try_begin),
                    (gt,":var006",0),
                    (eq,":var007",0),
                    (assign,":var025",0),
                    (assign,":var031",1),
                (else_try),
                    (eq,":var006",0),
                    (gt,":var007",0),
                    (assign,":var025",0),
                    (assign,":var031",2),
                (else_try),
                    (eq,":var006",0),
                    (eq,":var007",0),
                    (neq,":var028",0),
                    (assign,":var025",0),
                    (assign,":var031",0),
                (try_end),
            (try_end),
        (else_try),
            (neq,":troop_slot_016",":var028"),
            (get_sq_distance_between_positions,":sq_distance_013",0,1),
            (try_begin),
                (ge,":sq_distance_013",8100),
                (store_add, ":slot_no_029", 156, ":var001"),
                (troop_get_slot,":troop_slot_030","trp_multiplayer_data",":slot_no_029"),
                (store_div, ":var___x1", ":troop_slot_030", 100),
                (assign,":var006",":var___x1"),
                (store_mod,":var007",":troop_slot_030",100),
                (try_begin),
                    (eq,":var028",1),
                    (assign,":var025",1),
                    (assign,":var031",1),
                (else_try),
                    (eq,":var028",2),
                    (assign,":var025",2),
                    (assign,":var031",2),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (ge,":var025",0),
        (this_or_next|eq,":var025",":troop_slot_016"),
        (neq,":var028",":var031"),
        (try_begin),
            (neq,":troop_slot_016",0),
            (eq,":var025",0),
            (try_begin),
                (eq,":troop_slot_016",1),
                (assign,":var032",2),
            (else_try),
                (eq,":troop_slot_016",2),
                (assign,":var032",1),
            (try_end),
            (store_mul, ":var024", ":var032", 100),
            (val_add, ":var024", ":var001"),
            (call_script, "script_show_multiplayer_message", 8, ":var024"),
            (get_max_players, ":max_players"),
            (try_for_range, ":player_id_010", 1, ":max_players"),
                (try_begin),
                    (player_is_active, ":player_id_010"),
                    (multiplayer_send_2_int_to_player, ":player_id_010", 68, 8, ":var024"),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (neq,":troop_slot_016",":var025"),
            (neq,":var025",0),
            (store_mul, ":var024", ":var025", 100),
            (val_add, ":var024", ":var001"),
            (call_script, "script_show_multiplayer_message", 9, ":var024"),
            (get_max_players, ":max_players"),
            (try_for_range, ":player_id_010", 1, ":max_players"),
                (try_begin),
                    (player_is_active, ":player_id_010"),
                    (multiplayer_send_2_int_to_player, ":player_id_010", 68, 9, ":var024"),
                (try_end),
            (try_end),
        (try_end),
        (call_script, "script_set_num_agents_around_flag", ":var001", ":troop_slot_030"),
        (assign,":var033",0),
        (get_max_players, ":max_players"),
        (try_for_range, ":player_id_010", 1, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_010"),
                (multiplayer_send_2_int_to_player, ":player_id_010", 73, ":var001", ":troop_slot_030"),
                (val_add, ":var033", 1),
            (try_end),
        (try_end),
        (store_mul, ":var034", ":var025", 100),
        (val_add, ":var034", ":var031"),
        (call_script, "script_change_flag_owner", ":var001", ":var034"),
        (try_for_range, ":player_id_010", 1, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_010"),
                (multiplayer_send_2_int_to_player, ":player_id_010", 75, ":var001", ":var034"),
            (try_end),
        (try_end),
        (try_begin),
            (neq,":var025",0),
            (try_begin),
                (eq,":var025",1),
                (assign,":var035",":var006"),
            (else_try),
                (assign,":var035",":var007"),
            (try_end),
            (store_add, ":slot_no_036", 166, ":var001"),
            (troop_get_slot,":troop_slot_037","trp_multiplayer_data",":slot_no_036"),
            (troop_set_slot,"trp_multiplayer_data",":slot_no_036",0),
            (val_min,":troop_slot_037",360),
            (scene_prop_get_instance, ":scp_instance_038", "$team_1_flag_scene_prop", ":var001"),
            (scene_prop_get_instance, ":scp_instance_039", "$team_2_flag_scene_prop", ":var001"),
            (try_begin),
                (this_or_next|eq,"$g_base_flag_team_1",":scp_instance_038"),
                (eq,"$g_base_flag_team_2",":scp_instance_039"),
                (assign,":var040",2),
            (else_try),
                (assign,":var040",1),
            (try_end),
            (try_begin),
                (le,":var035",1),
                (assign,":var041",3),
            (else_try),
                (eq,":var035",2),
                (assign,":var041",2),
            (else_try),
                (le,":var035",6),
                (assign,":var041",1),
            (else_try),
                (assign,":var041",0),
            (try_end),
            (store_mul, ":var042", ":troop_slot_037", ":var033"),
            (val_mul, ":var042", ":var040"),
            (val_div, ":var042", 2),
            (try_begin),
                (gt,":var035",0),
                (store_div, ":var___x1", ":var042", ":var035"),
                (assign,":var043",":var___x1"),
            (try_end),
            (get_max_players, ":max_players"),
            (try_for_range, ":player_id_010", 0, ":max_players"),
                (try_begin),
                    (player_is_active, ":player_id_010"),
                    (player_get_agent_id, ":agent_id_011", ":player_id_010"),
                    (try_begin),
                        (ge,":agent_id_011",0),
                        (agent_get_team, ":agent_team_no_012", ":agent_id_011"),
                        (val_add, ":agent_team_no_012", 1),
                        (try_begin),
                            (eq,":agent_team_no_012",":var025"),
                            (agent_get_position,pos1,":agent_id_011"),
                            (prop_instance_get_position, pos0, ":scp_instance_008"),
                            (get_sq_distance_between_positions,":sq_distance_013",0,1),
                            (get_sq_distance_between_position_heights,":sq_distance_014",0,1),
                            (val_add, ":sq_distance_013", ":sq_distance_014"),
                            (try_begin),
                                (lt,":sq_distance_013",1600),
                                (player_get_score, ":score_044", ":player_id_010"),
                                (val_add, ":score_044", ":var041"),
                                (call_script, "script_player_set_score", ":player_id_010", ":score_044"),
                                (player_get_gold, ":gold_045", ":player_id_010"),
                                (val_add, ":gold_045", ":var043"),
                                (player_set_gold, ":player_id_010", ":gold_045", 15000),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (assign,":var001",0),
    (assign,":var002",0),
    (assign,":var003",0),
    (assign,":var004",0),
    (try_for_range, ":var005", 0, "$g_number_of_flags"),
        (store_add, ":slot_no_006", 146, ":var005"),
        (troop_get_slot,":troop_slot_007","trp_multiplayer_data",":slot_no_006"),
        (scene_prop_get_instance, ":scp_instance_008", "$team_1_flag_scene_prop", ":var005"),
        (scene_prop_get_instance, ":scp_instance_009", "$team_2_flag_scene_prop", ":var005"),
        (try_begin),
            (this_or_next|eq,"$g_base_flag_team_1",":scp_instance_008"),
            (eq,"$g_base_flag_team_2",":scp_instance_009"),
            (assign,":var010",2),
        (else_try),
            (assign,":var010",1),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":troop_slot_007",1),
        (val_add, ":var001", ":var010"),
        (val_add, ":var003", ":var010"),
    (else_try),
        (eq,":troop_slot_007",2),
        (val_add, ":var002", ":var010"),
        (val_add, ":var003", ":var010"),
    (else_try),
        (val_add, ":var004", ":var010"),
    (try_end),
(try_end),
(store_add, ":var011", ":var003", ":var004"),
(store_sub, ":var012", ":var001", ":var002"),
(store_mul, ":var013", ":var012", 2),
(store_sub, ":var014", "$g_number_of_initial_team_1_flags", "$g_number_of_initial_team_2_flags"),
(assign,":var015",0),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_017", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_017"),
        (val_add, ":var015", 1),
        (assign,":max_players",0),
    (try_end),
(try_end),
(try_begin),
    (ge,":var013",":var014"),
    (store_sub, ":var018", ":var013", ":var014"),
    (store_mul, ":var019", ":var018", 125),
    (val_add, ":var019", 500),
    (store_div, ":var___x1", 250000, ":var019"),
    (assign,":var020",":var___x1"),
    (try_begin),
        (lt,":var003",":var011"),
        (val_mul, ":var020", ":var003"),
        (val_div, ":var020", ":var011"),
        (val_mul, ":var019", ":var003"),
        (val_div, ":var019", ":var011"),
    (try_end),
    (call_script, "script_find_number_of_agents_constant"),
    (val_mul, ":var019", reg0),
    (val_div, ":var019", 100),
    (val_mul, ":var020", reg0),
    (val_div, ":var020", 100),
    (val_mul, ":var019", "$g_multiplayer_point_gained_from_flags"),
    (val_div, ":var019", 100),
    (val_mul, ":var020", "$g_multiplayer_point_gained_from_flags"),
    (val_div, ":var020", 100),
    (try_begin),
        (ge,":var015",1),
        (val_sub, "$g_score_team_2", ":var019"),
        (try_begin),
            (ge,":var002",1),
            (val_sub, "$g_score_team_1", ":var020"),
        (else_try),
            (val_sub, "$g_score_team_2", ":var020"),
        (try_end),
    (try_end),
(else_try),
    (store_sub, ":var018", ":var014", ":var013"),
    (store_mul, ":var019", ":var018", 125),
    (val_add, ":var019", 500),
    (store_div, ":var___x1", 250000, ":var019"),
    (assign,":var020",":var___x1"),
    (try_begin),
        (lt,":var003",":var011"),
        (val_mul, ":var020", ":var003"),
        (val_div, ":var020", ":var011"),
        (val_mul, ":var019", ":var003"),
        (val_div, ":var019", ":var011"),
    (try_end),
    (call_script, "script_find_number_of_agents_constant"),
    (val_mul, ":var019", reg0),
    (val_div, ":var019", 100),
    (val_mul, ":var020", reg0),
    (val_div, ":var020", 100),
    (val_mul, ":var019", "$g_multiplayer_point_gained_from_flags"),
    (val_div, ":var019", 100),
    (val_mul, ":var020", "$g_multiplayer_point_gained_from_flags"),
    (val_div, ":var020", 100),
    (try_begin),
        (ge,":var015",1),
        (try_begin),
            (ge,":var001",1),
            (val_sub, "$g_score_team_2", ":var020"),
        (else_try),
            (val_sub, "$g_score_team_1", ":var020"),
        (try_end),
        (val_sub, "$g_score_team_1", ":var019"),
    (try_end),
(try_end),
(team_get_score, ":team_score_021", 0),
(try_begin),
    (eq,1,1),
    (store_div, ":var___x1", "$g_score_team_1", 10000),
    (assign,":var022",":var___x1"),
    (try_begin),
        (neq,":var022",":team_score_021"),
        (get_max_players, ":max_players"),
        (call_script, "script_team_set_score", 0, ":var022"),
        (try_for_range, ":player_id_017", 1, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_017"),
                (multiplayer_send_2_int_to_player, ":player_id_017", 72, 0, ":var022"),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(team_get_score, ":team_score_024", 1),
(try_begin),
    (eq,1,1),
    (store_div, ":var___x1", "$g_score_team_2", 10000),
    (assign,":var025",":var___x1"),
    (try_begin),
        (neq,":var025",":team_score_024"),
        (get_max_players, ":max_players"),
        (call_script, "script_team_set_score", 1, ":var025"),
        (try_for_range, ":player_id_017", 1, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_017"),
                (multiplayer_send_2_int_to_player, ":player_id_017", 72, 1, ":var025"),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (get_max_players, ":max_players"),
    (try_for_range, ":player_id_002", 0, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_002"),
            (neg|player_is_busy_with_menus, ":player_id_002"),
            (player_get_team_no,  ":team_no_003", ":player_id_002"),
            (try_begin),
                (lt,":team_no_003",2),
                (player_get_troop_id, ":troop_id_004", ":player_id_002"),
                (try_begin),
                    (ge,":troop_id_004",0),
                    (player_get_agent_id, ":agent_id_005", ":player_id_002"),
                    (assign,":var006",0),
                    (try_begin),
                        (eq,1,1),
                        (player_get_slot,":player_slot_007",":player_id_002",24),
                        (try_begin),
                            (eq,":player_slot_007",1),
                            (assign,":var006",1),
                            (player_set_slot,":player_id_002",24,0),
                        (else_try),
                            (try_begin),
                                (lt,":agent_id_005",0),
                                (assign,":var006",1),
                            (else_try),
                                (neg|agent_is_alive,":agent_id_005"),
                                (agent_get_time_elapsed_since_removed, ":agent_time_since_removed_008", ":agent_id_005"),
                                (try_begin),
                                    (gt,":agent_time_since_removed_008","$g_multiplayer_respawn_period"),
                                    (assign,":var006",1),
                                (try_end),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var006",1),
        (call_script, "script_multiplayer_buy_agent_equipment", ":player_id_002"),
        (troop_get_inventory_slot,":troop_inv_slot_009",":troop_id_004",8),
        (try_begin),
            (ge,":troop_inv_slot_009",0),
            (assign,":var010",1),
        (else_try),
            (assign,":var010",0),
        (try_end),
    (try_end),
    (call_script, "script_multiplayer_find_spawn_point", ":team_no_003", 0, ":var010"),
    (player_spawn_new_agent, ":player_id_002", reg0),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (store_mission_timer_a,":m_timer_a_001"),
    (try_begin),
        (ge,":m_timer_a_001",2),
        (assign,":var002",0),
        (assign,":var003",0),
        (try_for_agents, ":cur_agent"),
            (try_begin),
                (agent_is_non_player, ":cur_agent"),
                (agent_is_human,":cur_agent"),
                (assign,":var005",0),
                (try_begin),
                    (agent_is_alive,":cur_agent"),
                    (assign,":var005",1),
                (else_try),
                    (agent_get_time_elapsed_since_removed, ":agent_time_since_removed_006", ":cur_agent"),
                    (try_begin),
                        (le,":agent_time_since_removed_006","$g_multiplayer_respawn_period"),
                        (assign,":var005",1),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var005",1),
        (agent_get_team, ":agent_team_no_007", ":cur_agent"),
        (try_begin),
            (eq,":agent_team_no_007",0),
            (val_add, ":var002", 1),
        (else_try),
            (eq,":agent_team_no_007",1),
            (val_add, ":var003", 1),
        (try_end),
    (try_end),
(try_end),
(store_sub, "$g_multiplayer_num_bots_required_team_1", "$g_multiplayer_num_bots_team_1", ":var002"),
(store_sub, "$g_multiplayer_num_bots_required_team_2", "$g_multiplayer_num_bots_team_2", ":var003"),
(val_max,"$g_multiplayer_num_bots_required_team_1",0),
(val_max,"$g_multiplayer_num_bots_required_team_2",0),
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (eq,"$g_multiplayer_ready_for_spawning_agent",1),
    (store_add, ":var001", "$g_multiplayer_num_bots_required_team_1", "$g_multiplayer_num_bots_required_team_2"),
    (try_begin),
        (gt,":var001",0),
        (try_begin),
            (this_or_next|eq,"$g_multiplayer_game_type",6),
            (this_or_next|eq,"$g_multiplayer_game_type",3),
            (eq,"$g_multiplayer_game_type",2),
            (team_get_score, ":team_score_002", 0),
            (team_get_score, ":team_score_003", 1),
            (store_add, ":var004", ":team_score_002", ":team_score_003"),
            (try_begin),
                (eq,":var004",0),
                (store_mission_timer_a,":m_timer_a_005"),
                (val_sub, ":m_timer_a_005", "$g_round_start_time"),
                (try_begin),
                    (lt,":m_timer_a_005",20),
                    (assign,":var006",0),
                (else_try),
                    (assign,":var006",1),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var006",1),
        (store_random_in_range,":random_x_007",0,":var001"),
        (val_sub, ":random_x_007", "$g_multiplayer_num_bots_required_team_1"),
        (try_begin),
            (lt,":random_x_007",0),
            (assign,":team_id_008",0),
        (else_try),
            (assign,":team_id_008",1),
        (try_end),
    (try_end),
    (try_begin),
        (this_or_next|eq,"$g_multiplayer_game_type",6),
        (this_or_next|eq,"$g_multiplayer_game_type",3),
        (eq,"$g_multiplayer_game_type",2),
        (store_mission_timer_a,":m_timer_a_005"),
        (val_sub, ":m_timer_a_005", "$g_round_start_time"),
        (try_begin),
            (le,":m_timer_a_005",20),
            (assign,":var009",0),
        (else_try),
            (assign,":var009",1),
        (try_end),
    (else_try),
        (assign,":var009",1),
    (try_end),
    (call_script, "script_multiplayer_find_bot_troop_and_group_for_spawn", ":team_id_008", ":var009"),
    (assign,":troop_id_010",reg0),
    (assign,":group_no_011",reg1),
    (team_get_faction, ":team_faction_012", ":team_id_008"),
    (assign,":var013",0),
    (try_for_range, ":trp_014", "trp_swadian_crossbowman_multiplayer_ai", "trp_swadian_crossbowman_multiplayer"),
        (store_troop_faction,":troop_faction_015",":trp_014"),
        (try_begin),
            (eq,":troop_faction_015",":team_faction_012"),
            (val_add, ":var013", 1),
        (try_end),
    (try_end),
    (assign,":var016",0),
    (get_max_players, ":max_players"),
    (try_for_range, ":player_id_018", 0, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_018"),
            (player_get_team_no,  ":team_no_019", ":player_id_018"),
            (try_begin),
                (eq,":team_id_008",":team_no_019"),
                (assign,":var020",0),
                (store_add, ":var021", 35, ":var013"),
                (try_for_range, ":var022", 35, ":var021"),
                    (try_begin),
                        (player_slot_ge,":player_id_018",":var022",1),
                        (assign,":var020",1),
                        (assign,":var021",0),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (ge,":var020",1),
            (val_add, ":var016", 1),
        (try_end),
    (try_end),
    (try_begin),
        (this_or_next|ge,":group_no_011",0),
        (eq,":var016",0),
        (troop_get_inventory_slot,":troop_inv_slot_023",":troop_id_010",8),
        (try_begin),
            (ge,":troop_inv_slot_023",0),
            (assign,":var024",1),
        (else_try),
            (assign,":var024",0),
        (try_end),
        (try_begin),
            (eq,"$g_multiplayer_game_type",6),
            (store_mission_timer_a,":m_timer_a_005"),
            (val_sub, ":m_timer_a_005", "$g_round_start_time"),
            (try_begin),
                (lt,":m_timer_a_005",20),
                (try_begin),
                    (eq,":team_id_008",0),
                    (call_script, "script_multiplayer_find_spawn_point", ":team_id_008", 1, ":var024"),
                (else_try),
                    (assign,reg0,32),
                (try_end),
            (else_try),
                (call_script, "script_multiplayer_find_spawn_point", ":team_id_008", 0, ":var024"),
            (try_end),
        (else_try),
            (this_or_next|eq,"$g_multiplayer_game_type",3),
            (eq,"$g_multiplayer_game_type",2),
            (try_begin),
                (eq,":team_id_008",0),
                (assign,reg0,0),
            (else_try),
                (assign,reg0,32),
            (try_end),
        (else_try),
            (call_script, "script_multiplayer_find_spawn_point", ":team_id_008", 0, ":var024"),
        (try_end),
        (store_current_scene,":cur_scene_025"),
        (modify_visitors_at_site,":cur_scene_025"),
        (add_visitors_to_current_scene,reg0,":troop_id_010",1, ":team_id_008", ":group_no_011"),
        (assign,"$g_multiplayer_ready_for_spawning_agent",0),
        (try_begin),
            (eq,":team_id_008",0),
            (val_sub, "$g_multiplayer_num_bots_required_team_1", 1),
        (else_try),
            (eq,":team_id_008",1),
            (val_sub, "$g_multiplayer_num_bots_required_team_2", 1),
        (try_end),
    (try_end),
(try_end),
]),

(3.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (try_for_agents, ":cur_agent"),
        (try_begin),
            (agent_is_non_player, ":cur_agent"),
            (agent_is_human,":cur_agent"),
            (agent_is_alive,":cur_agent"),
            (agent_get_group, ":agent_group_002", ":cur_agent"),
            (try_begin),
                (neg|player_is_active, ":agent_group_002"),
                (call_script, "script_multiplayer_change_leader_of_bot", ":cur_agent"),
            (else_try),
                (player_get_team_no,  ":team_no_003", ":agent_group_002"),
                (agent_get_team, ":agent_team_no_004", ":cur_agent"),
                (try_begin),
                    (neq,":team_no_003",":agent_team_no_004"),
                    (call_script, "script_multiplayer_change_leader_of_bot", ":cur_agent"),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(20.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (call_script, "script_check_team_balance"),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (assign,":var001",0),
    (try_begin),
        (eq,"$g_multiplayer_game_type",8),
        (try_begin),
            (eq,"$g_round_ended",1),
            (assign,":var001",1),
        (try_end),
    (try_end),
(else_try),
    (this_or_next|eq,"$g_multiplayer_game_type",6),
    (this_or_next|eq,"$g_multiplayer_game_type",3),
    (eq,"$g_multiplayer_game_type",2),
    (try_begin),
        (eq,"$g_round_ended",1),
        (store_mission_timer_a,":m_timer_a_002"),
        (val_sub, ":m_timer_a_002", "$g_round_finish_time"),
        (store_sub, ":var003", "$g_multiplayer_respawn_period", 1),
        (try_begin),
            (ge,":m_timer_a_002",":var003"),
            (store_mission_timer_a,":m_timer_a_004"),
            (try_begin),
                (this_or_next|eq,"$g_multiplayer_game_type",3),
                (eq,"$g_multiplayer_game_type",2),
                (assign,":var005",90),
            (else_try),
                (assign,":var005",120),
            (try_end),
        (try_end),
        (store_mul, ":var006", "$g_multiplayer_game_max_minutes", 60),
        (store_sub, ":var007", ":var006", ":var005"),
        (try_begin),
            (gt,":m_timer_a_004",":var007"),
            (assign,":var001",1),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var001",1),
    (else_try),
        (neq,"$g_multiplayer_game_type",2),
        (neq,"$g_multiplayer_game_type",3),
        (neq,"$g_multiplayer_game_type",6),
        (neq,"$g_multiplayer_game_type",5),
        (store_mission_timer_a,":m_timer_a_004"),
        (store_mul, ":var006", "$g_multiplayer_game_max_minutes", 60),
        (try_begin),
            (gt,":m_timer_a_004",":var006"),
            (assign,":var001",1),
        (else_try),
            (team_get_score, ":team_score_008", 0),
            (team_get_score, ":team_score_009", 1),
            (try_begin),
                (neq,"$g_multiplayer_game_type",5),
                (try_begin),
                    (this_or_next|ge,":team_score_008","$g_multiplayer_game_max_points"),
                    (ge,":team_score_009","$g_multiplayer_game_max_points"),
                    (assign,":var001",1),
                (try_end),
            (try_end),
        (try_end),
    (else_try),
        (assign,":var010",0),
        (get_max_players, ":max_players"),
        (try_for_range, ":player_id_012", 0, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_012"),
                (player_get_agent_id, ":agent_id_013", ":player_id_012"),
                (try_begin),
                    (ge,":agent_id_013",0),
                    (neg|agent_is_non_player, ":agent_id_013"),
                    (assign,":var010",1),
                    (assign,":max_players",0),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (eq,":var010",1),
            (this_or_next|gt,":team_score_008",0),
            (le,":team_score_009",0),
            (assign,":var001",1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,":var001",1),
    (call_script, "script_game_multiplayer_get_game_type_mission_template", "$g_multiplayer_game_type"),
    (start_multiplayer_mission, reg0, "$g_multiplayer_selected_map", 0),
    (call_script, "script_game_set_multiplayer_mission_end"),
(try_end),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_multiplayer_mission_end_screen",0),
    (assign,"$g_multiplayer_stats_chart_opened_manually",1),
    (start_presentation, "prsnt_multiplayer_stats_chart"),
(try_end),
]),

(0.0, 0.0, ti_once, [
], [
(start_presentation, "prsnt_multiplayer_welcome_message"),
]),

(ti_battle_window_opened, 0.0, 0.0, [
], [
(start_presentation, "prsnt_multiplayer_team_score_display"),
]),

(ti_escape_pressed, 0.0, 0.0, [
], [
(try_begin),
    (neg|is_presentation_active, "prsnt_multiplayer_escape_menu"),
    (neg|is_presentation_active, "prsnt_multiplayer_stats_chart"),
    (eq,"$g_waiting_for_confirmation_to_terminate",0),
    (start_presentation, "prsnt_multiplayer_escape_menu"),
(try_end),
]),

]),
("multiplayer_cf", mtf_battle_mode, -1,
"You lead your men to battle.",
[(0, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(1, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(2, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(3, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(4, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(5, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(6, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(7, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(8, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(9, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(10, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(11, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(12, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(13, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(14, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(15, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(16, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(17, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(18, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(19, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(20, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(21, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(22, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(23, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(24, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(25, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(26, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(27, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(28, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(29, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(30, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(31, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(32, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(33, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(34, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(35, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(36, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(37, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(38, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(39, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(40, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(41, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(42, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(43, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(44, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(45, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(46, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(47, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(48, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(49, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(50, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(51, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(52, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(53, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(54, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(55, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(56, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(57, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(58, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(59, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(60, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(61, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(62, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(63, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(64, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(65, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
],
[
(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(1.0, 5.0, 0.0, [
(multiplayer_is_server),
(eq,"$g_multiplayer_poll_running",1),
(eq,"$g_multiplayer_poll_ended",0),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (this_or_next|eq,":var002","$g_multiplayer_poll_num_sent"),
    (gt,":m_timer_a_001","$g_multiplayer_poll_end_time"),
    (call_script, "script_cf_multiplayer_evaluate_poll"),
    (store_add, ":var002", "$g_multiplayer_poll_no_count", "$g_multiplayer_poll_yes_count"),
(try_end),
], [
(assign,"$g_multiplayer_poll_running",0),
(try_begin),
    (this_or_next|eq,"$g_multiplayer_poll_to_show",3),
    (eq,"$g_multiplayer_poll_to_show",0),
    (call_script, "script_game_multiplayer_get_game_type_mission_template", "$g_multiplayer_game_type"),
    (start_multiplayer_mission, reg0, "$g_multiplayer_poll_value_to_show", 1),
    (call_script, "script_game_set_multiplayer_mission_end"),
(try_end),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_on_agent_spawn_common", ":var001"),
]),

(ti_server_player_joined, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_player_joined_common", ":var001"),
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (store_current_scene,":cur_scene_001"),
    (try_begin),
        (this_or_next|eq,":cur_scene_001","scn_random_multi_steppe_large"),
        (this_or_next|eq,":cur_scene_001","scn_random_multi_steppe_medium"),
        (this_or_next|eq,":cur_scene_001","scn_random_multi_plain_large"),
        (eq,":cur_scene_001","scn_random_multi_plain_medium"),
        (entry_point_get_position, pos0, 0),
        (entry_point_set_position, 64, 0),
        (entry_point_get_position, pos1, 32),
        (entry_point_set_position, 65, 1),
    (try_end),
(try_end),
(assign,"$g_multiplayer_game_type",4),
(call_script, "script_multiplayer_server_before_mission_start_common"),
(assign,"$flag_1_at_ground_timer",0),
(assign,"$flag_2_at_ground_timer",0),
(call_script, "script_multiplayer_init_mission_variables"),
(call_script, "script_multiplayer_remove_destroy_mod_targets"),
(call_script, "script_multiplayer_remove_headquarters_flags"),
]),

(ti_after_mission_start, 0.0, 0.0, [
], [
(call_script, "script_determine_team_flags", 0),
(call_script, "script_determine_team_flags", 1),
(set_spawn_effector_scene_prop_kind, 0, -1),
(set_spawn_effector_scene_prop_kind, 1, -1),
(try_begin),
    (multiplayer_is_server),
    (assign,"$g_multiplayer_ready_for_spawning_agent",1),
    (entry_point_get_position, pos0, 64),
    (set_spawn_position, 0),
    (spawn_scene_prop, "$team_1_flag_scene_prop"),
    (entry_point_get_position, pos0, 65),
    (set_spawn_position, 0),
    (spawn_scene_prop, "$team_2_flag_scene_prop"),
(try_end),
(call_script, "script_initialize_all_scene_prop_slots"),
(call_script, "script_multiplayer_move_moveable_objects_initial_positions"),
]),

(ti_on_multiplayer_mission_end, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_event_mission_end"),
(assign,"$g_multiplayer_stats_chart_opened_manually",0),
(start_presentation, "prsnt_multiplayer_stats_chart"),
]),

(ti_on_agent_killed_or_wounded, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_on_agent_killed_or_wounded_common", ":var001", ":var002"),
(try_begin),
    (agent_is_human,":var001"),
    (agent_get_attached_scene_prop, ":agent_attached_scene_prop_003", ":var001"),
    (try_begin),
        (eq,1,1),
        (try_begin),
            (multiplayer_is_server),
            (ge,":agent_attached_scene_prop_003",0),
            (multiplayer_get_my_player, ":my_player"),
            (get_max_players, ":max_players"),
            (call_script, "script_set_attached_scene_prop", ":var001", -1),
            (agent_set_horse_speed_factor, ":var001", 100),
            (try_for_range, ":player_id_006", 1, ":max_players"),
                (try_begin),
                    (player_is_active, ":player_id_006"),
                    (neq,":my_player",":player_id_006"),
                    (multiplayer_send_2_int_to_player, ":player_id_006", 70, ":var001", -1),
                (try_end),
            (try_end),
            (prop_instance_get_position, pos0, ":agent_attached_scene_prop_003"),
            (position_set_z_to_ground_level, 0),
            (prop_instance_set_position, ":agent_attached_scene_prop_003", 0),
            (agent_get_team, ":agent_team_no_007", ":var001"),
            (try_begin),
                (eq,":agent_team_no_007",0),
                (assign,":team_id_008",1),
            (else_try),
                (assign,":team_id_008",0),
            (try_end),
            (team_set_slot,":team_id_008",0,2),
            (multiplayer_get_my_player, ":my_player"),
            (get_max_players, ":max_players"),
            (call_script, "script_set_team_flag_situation", ":team_id_008", 2),
            (try_for_range, ":player_id_006", 1, ":max_players"),
                (try_begin),
                    (player_is_active, ":player_id_006"),
                    (neq,":my_player",":player_id_006"),
                    (multiplayer_send_2_int_to_player, ":player_id_006", 71, ":team_id_008", 2),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (try_for_range, ":var001", 0, 2),
        (try_begin),
            (team_slot_eq,":var001",0,2),
            (assign,":team_id_002",-1),
            (try_begin),
                (eq,":var001",0),
                (val_add, "$flag_1_at_ground_timer", 1),
                (try_begin),
                    (ge,"$flag_1_at_ground_timer",60),
                    (assign,":team_id_002",0),
                (else_try),
                    (val_add, "$flag_2_at_ground_timer", 1),
                    (try_begin),
                        (ge,"$flag_2_at_ground_timer",60),
                        (assign,":team_id_002",1),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (ge,":team_id_002",0),
            (try_begin),
                (eq,":team_id_002",0),
                (assign,"$flag_1_at_ground_timer",0),
            (else_try),
                (eq,":team_id_002",1),
                (assign,"$flag_2_at_ground_timer",0),
            (try_end),
            (team_set_slot,":team_id_002",0,0),
            (call_script, "script_set_team_flag_situation", ":team_id_002", 0),
            (multiplayer_get_my_player, ":my_player"),
            (get_max_players, ":max_players"),
            (try_for_range, ":player_id_005", 1, ":max_players"),
                (try_begin),
                    (player_is_active, ":player_id_005"),
                    (neq,":my_player",":player_id_005"),
                    (multiplayer_send_2_int_to_player, ":player_id_005", 71, ":team_id_002", 0),
                (try_end),
            (try_end),
            (scene_prop_get_instance, ":scp_instance_006", "$team_1_flag_scene_prop", 0),
            (scene_prop_get_instance, ":scp_instance_007", "$team_2_flag_scene_prop", 0),
            (assign,":var008",":scp_instance_006"),
            (assign,":var009",64),
            (assign,":var010",":scp_instance_007"),
            (assign,":var011",65),
            (try_begin),
                (eq,":team_id_002",0),
                (entry_point_get_position, pos5, ":var009"),
                (prop_instance_set_position, ":var008", 5),
            (else_try),
                (entry_point_get_position, pos5, ":var011"),
                (prop_instance_set_position, ":var010", 5),
            (try_end),
            (store_mul, ":var012", ":team_id_002", -1),
            (val_sub, ":var012", 1),
            (call_script, "script_show_multiplayer_message", 5, ":var012"),
            (try_for_range, ":player_id_005", 0, ":max_players"),
                (try_begin),
                    (player_is_active, ":player_id_005"),
                    (neq,":my_player",":player_id_005"),
                    (multiplayer_send_2_int_to_player, ":player_id_005", 68, 5, ":var012"),
                (try_end),
            (try_end),
        (try_end),
    (else_try),
        (try_begin),
            (eq,":var001",0),
            (assign,"$flag_1_at_ground_timer",0),
        (else_try),
            (assign,"$flag_2_at_ground_timer",0),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (get_max_players, ":max_players"),
    (try_for_range, ":player_id_002", 0, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_002"),
            (neg|player_is_busy_with_menus, ":player_id_002"),
            (player_get_team_no,  ":team_no_003", ":player_id_002"),
            (try_begin),
                (lt,":team_no_003",2),
                (player_get_troop_id, ":troop_id_004", ":player_id_002"),
                (try_begin),
                    (ge,":troop_id_004",0),
                    (player_get_agent_id, ":agent_id_005", ":player_id_002"),
                    (assign,":var006",0),
                    (try_begin),
                        (eq,1,1),
                        (player_get_slot,":player_slot_007",":player_id_002",24),
                        (try_begin),
                            (eq,":player_slot_007",1),
                            (assign,":var006",1),
                            (player_set_slot,":player_id_002",24,0),
                        (else_try),
                            (try_begin),
                                (lt,":agent_id_005",0),
                                (assign,":var006",1),
                            (else_try),
                                (neg|agent_is_alive,":agent_id_005"),
                                (agent_get_time_elapsed_since_removed, ":agent_time_since_removed_008", ":agent_id_005"),
                                (try_begin),
                                    (gt,":agent_time_since_removed_008","$g_multiplayer_respawn_period"),
                                    (assign,":var006",1),
                                (try_end),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var006",1),
        (call_script, "script_multiplayer_buy_agent_equipment", ":player_id_002"),
        (troop_get_inventory_slot,":troop_inv_slot_009",":troop_id_004",8),
        (try_begin),
            (ge,":troop_inv_slot_009",0),
            (assign,":var010",1),
        (else_try),
            (assign,":var010",0),
        (try_end),
    (try_end),
    (call_script, "script_multiplayer_find_spawn_point", ":team_no_003", 0, ":var010"),
    (player_spawn_new_agent, ":player_id_002", reg0),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (store_mission_timer_a,":m_timer_a_001"),
    (try_begin),
        (ge,":m_timer_a_001",2),
        (assign,":var002",0),
        (assign,":var003",0),
        (try_for_agents, ":cur_agent"),
            (try_begin),
                (agent_is_non_player, ":cur_agent"),
                (agent_is_human,":cur_agent"),
                (assign,":var005",0),
                (try_begin),
                    (agent_is_alive,":cur_agent"),
                    (assign,":var005",1),
                (else_try),
                    (agent_get_time_elapsed_since_removed, ":agent_time_since_removed_006", ":cur_agent"),
                    (try_begin),
                        (le,":agent_time_since_removed_006","$g_multiplayer_respawn_period"),
                        (assign,":var005",1),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var005",1),
        (agent_get_team, ":agent_team_no_007", ":cur_agent"),
        (try_begin),
            (eq,":agent_team_no_007",0),
            (val_add, ":var002", 1),
        (else_try),
            (eq,":agent_team_no_007",1),
            (val_add, ":var003", 1),
        (try_end),
    (try_end),
(try_end),
(store_sub, "$g_multiplayer_num_bots_required_team_1", "$g_multiplayer_num_bots_team_1", ":var002"),
(store_sub, "$g_multiplayer_num_bots_required_team_2", "$g_multiplayer_num_bots_team_2", ":var003"),
(val_max,"$g_multiplayer_num_bots_required_team_1",0),
(val_max,"$g_multiplayer_num_bots_required_team_2",0),
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (eq,"$g_multiplayer_ready_for_spawning_agent",1),
    (store_add, ":var001", "$g_multiplayer_num_bots_required_team_1", "$g_multiplayer_num_bots_required_team_2"),
    (try_begin),
        (gt,":var001",0),
        (try_begin),
            (this_or_next|eq,"$g_multiplayer_game_type",6),
            (this_or_next|eq,"$g_multiplayer_game_type",3),
            (eq,"$g_multiplayer_game_type",2),
            (team_get_score, ":team_score_002", 0),
            (team_get_score, ":team_score_003", 1),
            (store_add, ":var004", ":team_score_002", ":team_score_003"),
            (try_begin),
                (eq,":var004",0),
                (store_mission_timer_a,":m_timer_a_005"),
                (val_sub, ":m_timer_a_005", "$g_round_start_time"),
                (try_begin),
                    (lt,":m_timer_a_005",20),
                    (assign,":var006",0),
                (else_try),
                    (assign,":var006",1),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var006",1),
        (store_random_in_range,":random_x_007",0,":var001"),
        (val_sub, ":random_x_007", "$g_multiplayer_num_bots_required_team_1"),
        (try_begin),
            (lt,":random_x_007",0),
            (assign,":team_id_008",0),
        (else_try),
            (assign,":team_id_008",1),
        (try_end),
    (try_end),
    (try_begin),
        (this_or_next|eq,"$g_multiplayer_game_type",6),
        (this_or_next|eq,"$g_multiplayer_game_type",3),
        (eq,"$g_multiplayer_game_type",2),
        (store_mission_timer_a,":m_timer_a_005"),
        (val_sub, ":m_timer_a_005", "$g_round_start_time"),
        (try_begin),
            (le,":m_timer_a_005",20),
            (assign,":var009",0),
        (else_try),
            (assign,":var009",1),
        (try_end),
    (else_try),
        (assign,":var009",1),
    (try_end),
    (call_script, "script_multiplayer_find_bot_troop_and_group_for_spawn", ":team_id_008", ":var009"),
    (assign,":troop_id_010",reg0),
    (assign,":group_no_011",reg1),
    (team_get_faction, ":team_faction_012", ":team_id_008"),
    (assign,":var013",0),
    (try_for_range, ":trp_014", "trp_swadian_crossbowman_multiplayer_ai", "trp_swadian_crossbowman_multiplayer"),
        (store_troop_faction,":troop_faction_015",":trp_014"),
        (try_begin),
            (eq,":troop_faction_015",":team_faction_012"),
            (val_add, ":var013", 1),
        (try_end),
    (try_end),
    (assign,":var016",0),
    (get_max_players, ":max_players"),
    (try_for_range, ":player_id_018", 0, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_018"),
            (player_get_team_no,  ":team_no_019", ":player_id_018"),
            (try_begin),
                (eq,":team_id_008",":team_no_019"),
                (assign,":var020",0),
                (store_add, ":var021", 35, ":var013"),
                (try_for_range, ":var022", 35, ":var021"),
                    (try_begin),
                        (player_slot_ge,":player_id_018",":var022",1),
                        (assign,":var020",1),
                        (assign,":var021",0),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (ge,":var020",1),
            (val_add, ":var016", 1),
        (try_end),
    (try_end),
    (try_begin),
        (this_or_next|ge,":group_no_011",0),
        (eq,":var016",0),
        (troop_get_inventory_slot,":troop_inv_slot_023",":troop_id_010",8),
        (try_begin),
            (ge,":troop_inv_slot_023",0),
            (assign,":var024",1),
        (else_try),
            (assign,":var024",0),
        (try_end),
        (try_begin),
            (eq,"$g_multiplayer_game_type",6),
            (store_mission_timer_a,":m_timer_a_005"),
            (val_sub, ":m_timer_a_005", "$g_round_start_time"),
            (try_begin),
                (lt,":m_timer_a_005",20),
                (try_begin),
                    (eq,":team_id_008",0),
                    (call_script, "script_multiplayer_find_spawn_point", ":team_id_008", 1, ":var024"),
                (else_try),
                    (assign,reg0,32),
                (try_end),
            (else_try),
                (call_script, "script_multiplayer_find_spawn_point", ":team_id_008", 0, ":var024"),
            (try_end),
        (else_try),
            (this_or_next|eq,"$g_multiplayer_game_type",3),
            (eq,"$g_multiplayer_game_type",2),
            (try_begin),
                (eq,":team_id_008",0),
                (assign,reg0,0),
            (else_try),
                (assign,reg0,32),
            (try_end),
        (else_try),
            (call_script, "script_multiplayer_find_spawn_point", ":team_id_008", 0, ":var024"),
        (try_end),
        (store_current_scene,":cur_scene_025"),
        (modify_visitors_at_site,":cur_scene_025"),
        (add_visitors_to_current_scene,reg0,":troop_id_010",1, ":team_id_008", ":group_no_011"),
        (assign,"$g_multiplayer_ready_for_spawning_agent",0),
        (try_begin),
            (eq,":team_id_008",0),
            (val_sub, "$g_multiplayer_num_bots_required_team_1", 1),
        (else_try),
            (eq,":team_id_008",1),
            (val_sub, "$g_multiplayer_num_bots_required_team_2", 1),
        (try_end),
    (try_end),
(try_end),
]),

(3.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (try_for_agents, ":cur_agent"),
        (try_begin),
            (agent_is_non_player, ":cur_agent"),
            (agent_is_human,":cur_agent"),
            (agent_is_alive,":cur_agent"),
            (agent_get_group, ":agent_group_002", ":cur_agent"),
            (try_begin),
                (neg|player_is_active, ":agent_group_002"),
                (call_script, "script_multiplayer_change_leader_of_bot", ":cur_agent"),
            (else_try),
                (player_get_team_no,  ":team_no_003", ":agent_group_002"),
                (agent_get_team, ":agent_team_no_004", ":cur_agent"),
                (try_begin),
                    (neq,":team_no_003",":agent_team_no_004"),
                    (call_script, "script_multiplayer_change_leader_of_bot", ":cur_agent"),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (scene_prop_get_instance, ":scp_instance_001", "$team_1_flag_scene_prop", 0),
    (prop_instance_get_position, pos1, ":scp_instance_001"),
    (scene_prop_get_instance, ":scp_instance_002", "$team_2_flag_scene_prop", 0),
    (prop_instance_get_position, pos2, ":scp_instance_002"),
    (multiplayer_get_my_player, ":my_player"),
    (get_max_players, ":max_players"),
    (try_for_agents, ":cur_agent"),
        (try_begin),
            (agent_is_human,":cur_agent"),
            (agent_is_alive,":cur_agent"),
            (neg|agent_is_non_player, ":cur_agent"),
            (agent_get_horse,":agent_horse_006",":cur_agent"),
            (try_begin),
                (eq,":agent_horse_006",-1),
                (agent_get_attached_scene_prop, ":agent_attached_scene_prop_007", ":cur_agent"),
                (agent_get_team, ":agent_team_no_008", ":cur_agent"),
                (try_begin),
                    (eq,":agent_team_no_008",0),
                    (assign,":team_id_009",1),
                (else_try),
                    (assign,":team_id_009",0),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":agent_team_no_008",0),
        (assign,":var010",":scp_instance_001"),
        (assign,":var011",64),
    (else_try),
        (assign,":var010",":scp_instance_002"),
        (assign,":var011",65),
    (try_end),
    (agent_get_position,pos3,":cur_agent"),
    (prop_instance_get_position, pos4, ":var010"),
    (get_distance_between_positions,":distance_012",3,4),
    (team_get_slot,":team_slot_013",":agent_team_no_008",0),
    (try_begin),
        (eq,":team_slot_013",2),
        (lt,":distance_012",100),
        (team_set_slot,":agent_team_no_008",0,0),
        (call_script, "script_set_team_flag_situation", ":agent_team_no_008", 0),
        (try_for_range, ":player_id_014", 1, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_014"),
                (neq,":my_player",":player_id_014"),
                (multiplayer_send_2_int_to_player, ":player_id_014", 71, ":agent_team_no_008", 0),
            (try_end),
        (try_end),
        (entry_point_get_position, pos5, ":var011"),
        (prop_instance_set_position, ":var010", 5),
        (try_begin),
            (multiplayer_is_server),
            (neg|agent_is_non_player, ":cur_agent"),
            (agent_get_player_id,":agent_player_id_015",":cur_agent"),
            (player_get_score, ":score_016", ":agent_player_id_015"),
            (val_add, ":score_016", 1),
            (call_script, "script_player_set_score", ":agent_player_id_015", ":score_016"),
        (try_end),
        (call_script, "script_show_multiplayer_message", 5, ":cur_agent"),
        (try_for_range, ":player_id_014", 0, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_014"),
                (neq,":my_player",":player_id_014"),
                (multiplayer_send_2_int_to_player, ":player_id_014", 68, 5, ":cur_agent"),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (neq,":agent_attached_scene_prop_007",-1),
        (try_begin),
            (eq,":agent_team_no_008",0),
            (assign,":var017",":scp_instance_002"),
            (assign,":var018",65),
        (else_try),
            (assign,":var017",":scp_instance_001"),
            (assign,":var018",64),
        (try_end),
        (try_begin),
            (eq,":agent_attached_scene_prop_007",":var017"),
            (eq,":team_slot_013",0),
            (lt,":distance_012",100),
            (team_get_score, ":team_score_019", ":agent_team_no_008"),
            (val_add, ":team_score_019", 1),
            (call_script, "script_team_set_score", ":agent_team_no_008", ":team_score_019"),
            (try_begin),
                (multiplayer_is_server),
                (neg|agent_is_non_player, ":cur_agent"),
                (agent_get_player_id,":agent_player_id_015",":cur_agent"),
                (player_get_score, ":score_016", ":agent_player_id_015"),
                (val_add, ":score_016", "$g_multiplayer_point_gained_from_capturing_flag"),
                (call_script, "script_player_set_score", ":agent_player_id_015", ":score_016"),
            (try_end),
        (try_end),
        (call_script, "script_team_set_score", ":agent_team_no_008", ":team_score_019"),
        (try_for_range, ":player_id_014", 1, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_014"),
                (neq,":my_player",":player_id_014"),
                (multiplayer_send_2_int_to_player, ":player_id_014", 72, ":agent_team_no_008", ":team_score_019"),
            (try_end),
        (try_end),
        (agent_set_attached_scene_prop, ":cur_agent", -1),
        (team_set_slot,":team_id_009",0,0),
        (call_script, "script_set_attached_scene_prop", ":cur_agent", -1),
        (agent_set_horse_speed_factor, ":cur_agent", 100),
        (try_for_range, ":player_id_014", 1, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_014"),
                (neq,":my_player",":player_id_014"),
                (multiplayer_send_2_int_to_player, ":player_id_014", 70, ":cur_agent", -1),
            (try_end),
        (try_end),
        (call_script, "script_set_team_flag_situation", ":team_id_009", 0),
        (try_for_range, ":player_id_014", 1, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_014"),
                (neq,":my_player",":player_id_014"),
                (multiplayer_send_2_int_to_player, ":player_id_014", 71, ":team_id_009", 0),
            (try_end),
        (try_end),
        (entry_point_get_position, pos5, ":var018"),
        (prop_instance_set_position, ":var017", 5),
        (call_script, "script_show_multiplayer_message", 4, ":cur_agent"),
        (try_for_range, ":player_id_014", 0, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_014"),
                (neq,":my_player",":player_id_014"),
                (multiplayer_send_2_int_to_player, ":player_id_014", 68, 4, ":cur_agent"),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":agent_attached_scene_prop_007",-1),
        (agent_get_position,pos3,":cur_agent"),
        (agent_get_team, ":agent_team_no_008", ":cur_agent"),
        (try_begin),
            (eq,":agent_team_no_008",0),
            (get_distance_between_positions,":distance_012",2,3),
            (assign,":var017",":scp_instance_002"),
        (else_try),
            (get_distance_between_positions,":distance_012",1,3),
            (assign,":var017",":scp_instance_001"),
        (try_end),
    (try_end),
    (try_begin),
        (le,":distance_012",100),
        (neg|team_slot_eq,":team_id_009",0,1),
        (agent_set_attached_scene_prop, ":cur_agent", ":var017"),
        (agent_set_attached_scene_prop_x, ":cur_agent", 20),
        (agent_set_attached_scene_prop_z, ":cur_agent", 50),
        (try_begin),
            (eq,":agent_team_no_008",0),
            (assign,"$flag_1_at_ground_timer",0),
        (else_try),
            (eq,":agent_team_no_008",1),
            (assign,"$flag_2_at_ground_timer",0),
        (try_end),
        (team_set_slot,":team_id_009",0,1),
        (call_script, "script_set_attached_scene_prop", ":cur_agent", ":var017"),
        (agent_set_horse_speed_factor, ":cur_agent", 75),
        (try_for_range, ":player_id_014", 1, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_014"),
                (neq,":my_player",":player_id_014"),
                (multiplayer_send_2_int_to_player, ":player_id_014", 70, ":cur_agent", ":var017"),
            (try_end),
        (try_end),
        (call_script, "script_set_team_flag_situation", ":team_id_009", 1),
        (try_for_range, ":player_id_014", 1, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_014"),
                (neq,":my_player",":player_id_014"),
                (multiplayer_send_2_int_to_player, ":player_id_014", 71, ":team_id_009", 1),
            (try_end),
        (try_end),
        (call_script, "script_show_multiplayer_message", 6, ":cur_agent"),
        (try_for_range, ":player_id_014", 0, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_014"),
                (neq,":my_player",":player_id_014"),
                (multiplayer_send_2_int_to_player, ":player_id_014", 68, 6, ":cur_agent"),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(20.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (call_script, "script_check_team_balance"),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (assign,":var001",0),
    (try_begin),
        (eq,"$g_multiplayer_game_type",8),
        (try_begin),
            (eq,"$g_round_ended",1),
            (assign,":var001",1),
        (try_end),
    (try_end),
(else_try),
    (this_or_next|eq,"$g_multiplayer_game_type",6),
    (this_or_next|eq,"$g_multiplayer_game_type",3),
    (eq,"$g_multiplayer_game_type",2),
    (try_begin),
        (eq,"$g_round_ended",1),
        (store_mission_timer_a,":m_timer_a_002"),
        (val_sub, ":m_timer_a_002", "$g_round_finish_time"),
        (store_sub, ":var003", "$g_multiplayer_respawn_period", 1),
        (try_begin),
            (ge,":m_timer_a_002",":var003"),
            (store_mission_timer_a,":m_timer_a_004"),
            (try_begin),
                (this_or_next|eq,"$g_multiplayer_game_type",3),
                (eq,"$g_multiplayer_game_type",2),
                (assign,":var005",90),
            (else_try),
                (assign,":var005",120),
            (try_end),
        (try_end),
        (store_mul, ":var006", "$g_multiplayer_game_max_minutes", 60),
        (store_sub, ":var007", ":var006", ":var005"),
        (try_begin),
            (gt,":m_timer_a_004",":var007"),
            (assign,":var001",1),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var001",1),
    (else_try),
        (neq,"$g_multiplayer_game_type",2),
        (neq,"$g_multiplayer_game_type",3),
        (neq,"$g_multiplayer_game_type",6),
        (neq,"$g_multiplayer_game_type",5),
        (store_mission_timer_a,":m_timer_a_004"),
        (store_mul, ":var006", "$g_multiplayer_game_max_minutes", 60),
        (try_begin),
            (gt,":m_timer_a_004",":var006"),
            (assign,":var001",1),
        (else_try),
            (team_get_score, ":team_score_008", 0),
            (team_get_score, ":team_score_009", 1),
            (try_begin),
                (neq,"$g_multiplayer_game_type",5),
                (try_begin),
                    (this_or_next|ge,":team_score_008","$g_multiplayer_game_max_points"),
                    (ge,":team_score_009","$g_multiplayer_game_max_points"),
                    (assign,":var001",1),
                (try_end),
            (try_end),
        (try_end),
    (else_try),
        (assign,":var010",0),
        (get_max_players, ":max_players"),
        (try_for_range, ":player_id_012", 0, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_012"),
                (player_get_agent_id, ":agent_id_013", ":player_id_012"),
                (try_begin),
                    (ge,":agent_id_013",0),
                    (neg|agent_is_non_player, ":agent_id_013"),
                    (assign,":var010",1),
                    (assign,":max_players",0),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (eq,":var010",1),
            (this_or_next|gt,":team_score_008",0),
            (le,":team_score_009",0),
            (assign,":var001",1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,":var001",1),
    (call_script, "script_game_multiplayer_get_game_type_mission_template", "$g_multiplayer_game_type"),
    (start_multiplayer_mission, reg0, "$g_multiplayer_selected_map", 0),
    (call_script, "script_game_set_multiplayer_mission_end"),
(try_end),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_multiplayer_mission_end_screen",0),
    (assign,"$g_multiplayer_stats_chart_opened_manually",1),
    (start_presentation, "prsnt_multiplayer_stats_chart"),
(try_end),
]),

(0.0, 0.0, ti_once, [
], [
(start_presentation, "prsnt_multiplayer_welcome_message"),
]),

(ti_battle_window_opened, 0.0, 0.0, [
], [
(start_presentation, "prsnt_multiplayer_team_score_display"),
(start_presentation, "prsnt_multiplayer_flag_projection_display"),
]),

(ti_escape_pressed, 0.0, 0.0, [
], [
(try_begin),
    (neg|is_presentation_active, "prsnt_multiplayer_escape_menu"),
    (neg|is_presentation_active, "prsnt_multiplayer_stats_chart"),
    (eq,"$g_waiting_for_confirmation_to_terminate",0),
    (start_presentation, "prsnt_multiplayer_escape_menu"),
(try_end),
]),

]),
("multiplayer_sg", mtf_battle_mode, -1,
"You lead your men to battle.",
[(0, mtef_visitor_source|mtef_team_0|mtef_no_auto_reset, 0, aif_start_alarmed, 1, []),
(1, mtef_visitor_source|mtef_team_0|mtef_no_auto_reset, 0, aif_start_alarmed, 1, []),
(2, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(3, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(4, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(5, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(6, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(7, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(8, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(9, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(10, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(11, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(12, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(13, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(14, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(15, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(16, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(17, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(18, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(19, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(20, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(21, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(22, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(23, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(24, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(25, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(26, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(27, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(28, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(29, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(30, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(31, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(32, mtef_visitor_source|mtef_team_1|mtef_no_auto_reset, 0, aif_start_alarmed, 1, []),
(33, mtef_visitor_source|mtef_team_1|mtef_no_auto_reset, 0, aif_start_alarmed, 1, []),
(34, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(35, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(36, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(37, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(38, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(39, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(40, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(41, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(42, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(43, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(44, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(45, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(46, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(47, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(48, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(49, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(50, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(51, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(52, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(53, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(54, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(55, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(56, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(57, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(58, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(59, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(60, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(61, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(62, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
(63, mtef_visitor_source, 0, aif_start_alarmed, 1, []),
],
[
(0.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (set_fixed_point_multiplier, 100),
    (try_for_range, ":var001", 0, 2),
        (try_begin),
            (eq,":var001",0),
            (assign,":var002","spr_belfry_a"),
        (else_try),
            (assign,":var002","spr_belfry_b"),
        (try_end),
    (try_end),
    (scene_prop_get_num_instances, ":scp_num_instances_003", ":var002"),
    (try_for_range, ":var004", 0, ":scp_num_instances_003"),
        (scene_prop_get_instance, ":scp_instance_005", ":var002", ":var004"),
        (prop_instance_get_position, pos1, ":scp_instance_005"),
        (prop_instance_get_starting_position, pos11, ":scp_instance_005"),
        (store_add, ":var006", 11, ":var004"),
        (try_begin),
            (eq,":var001",1),
            (scene_prop_get_num_instances, ":scp_num_instances_007", "spr_belfry_a"),
            (val_add, ":var006", ":scp_num_instances_007"),
        (try_end),
        (val_mul, ":var006", 10),
        (store_add, ":var008", ":var006", 10),
        (try_for_range, ":var009", ":var006", ":var008"),
            (try_begin),
                (entry_point_is_auto_generated, ":var009"),
                (assign,":var008",":var009"),
            (try_end),
        (try_end),
        (assign,":var010",":var008"),
        (val_sub, ":var008", 1),
        (assign,reg0,":var008"),
        (try_begin),
            (neg|entry_point_is_auto_generated, ":var008"),
            (try_begin),
                (eq,1,1),
                (get_sq_distance_between_positions,":sq_distance_011",1,11),
                (try_begin),
                    (ge,":sq_distance_011",4),
                    (assign,":var012",-1),
                    (assign,":var013",-1),
                    (try_for_range, ":var009", ":var006", ":var010"),
                        (entry_point_get_position, pos4, ":var009"),
                        (get_sq_distance_between_positions,":sq_distance_014",11,4),
                        (try_begin),
                            (lt,":sq_distance_014",":sq_distance_011"),
                            (gt,":sq_distance_014",":var012"),
                            (assign,":var012",":sq_distance_014"),
                            (assign,":var013",":var009"),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
            (try_begin),
                (ge,":var013",0),
                (entry_point_get_position, pos5, ":var013"),
            (else_try),
                (copy_position,5,11),
            (try_end),
            (get_distance_between_positions,":distance_015",1,5),
            (try_begin),
                (eq,":var001",0),
                (scene_prop_get_instance, ":scp_instance_016", "spr_belfry_platform_a", ":var004"),
                (scene_prop_get_instance, ":scp_instance_017", "spr_belfry_platform_b", ":var004"),
            (else_try),
                (scene_prop_get_instance, ":scp_instance_016", "spr_belfry_b_platform_a", ":var004"),
            (try_end),
            (store_mul, ":var018", ":var004", 3),
            (try_begin),
                (eq,":var002","spr_belfry_b"),
                (scene_prop_get_num_instances, ":scp_num_instances_007", "spr_belfry_a"),
                (store_mul, ":var019", ":scp_num_instances_007", 3),
                (val_add, ":var018", ":var019"),
            (try_end),
            (scene_prop_get_instance, ":scp_instance_020", "spr_belfry_wheel", ":var018"),
            (val_add, ":var018", 1),
            (scene_prop_get_instance, ":scp_instance_021", "spr_belfry_wheel", ":var018"),
            (val_add, ":var018", 1),
            (scene_prop_get_instance, ":scp_instance_022", "spr_belfry_wheel", ":var018"),
            (init_position,17),
            (position_move_y,17,-225),
            (position_transform_position_to_parent,18,1,17),
            (position_move_y,17,-225),
            (position_transform_position_to_parent,19,1,17),
            (assign,":var023",0),
            (get_max_players, ":max_players"),
            (try_for_range, ":player_id_025", 0, ":max_players"),
                (try_begin),
                    (player_is_active, ":player_id_025"),
                    (player_get_agent_id, ":agent_id_026", ":player_id_025"),
                    (try_begin),
                        (ge,":agent_id_026",0),
                        (agent_get_team, ":agent_team_no_027", ":agent_id_026"),
                        (try_begin),
                            (eq,":agent_team_no_027",1),
                            (agent_get_horse,":agent_horse_028",":agent_id_026"),
                            (try_begin),
                                (eq,":agent_horse_028",-1),
                                (agent_get_position,pos2,":agent_id_026"),
                                (get_sq_distance_between_positions_in_meters,":sq_distance_029",18,2),
                                (try_begin),
                                    (lt,":sq_distance_029",36),
                                    (neg|scene_prop_has_agent_on_it, ":scp_instance_005", ":agent_id_026"),
                                    (neg|scene_prop_has_agent_on_it, ":scp_instance_016", ":agent_id_026"),
                                    (this_or_next|eq,":var001",1),
                                    (neg|scene_prop_has_agent_on_it, ":scp_instance_017", ":agent_id_026"),
                                    (neg|scene_prop_has_agent_on_it, ":scp_instance_020", ":agent_id_026"),
                                    (neg|scene_prop_has_agent_on_it, ":scp_instance_021", ":agent_id_026"),
                                    (neg|scene_prop_has_agent_on_it, ":scp_instance_022", ":agent_id_026"),
                                    (neg|position_is_behind_position,2,19),
                                    (position_is_behind_position,2,1),
                                    (val_add, ":var023", 1),
                                (try_end),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
            (val_min,":var023",16),
            (try_begin),
                (eq,1,1),
                (scene_prop_get_slot,":scene_prop_slot_030",":scp_instance_005",3),
                (scene_prop_get_slot,":scene_prop_slot_031",":scp_instance_005",4),
                (try_begin),
                    (this_or_next|eq,":scene_prop_slot_030",":var023"),
                    (neq,":scene_prop_slot_031",":var013"),
                    (try_begin),
                        (eq,":scene_prop_slot_031",":var013"),
                        (prop_instance_is_animating, ":var032", ":scp_instance_005"),
                        (try_begin),
                            (eq,":var032",1),
                            (store_mul, ":var033", "$g_last_number_of_agents_around_belfry", 100),
                            (store_sqrt, ":var033", ":var033"),
                            (val_min,":var033",300),
                            (assign,":var034",":distance_015"),
                            (val_mul, ":var034", ":var033"),
                            (val_div, ":var034", 100),
                            (val_mul, ":var034", 4),
                        (try_end),
                    (try_end),
                (try_end),
                (try_begin),
                    (ge,":var013",0),
                    (init_position,9),
                    (position_set_y,9,-500),
                    (position_set_x,9,-300),
                    (position_transform_position_to_parent,10,5,9),
                    (position_get_distance_to_terrain, ":distance_to_terrain_035", 10),
                    (init_position,9),
                    (position_set_y,9,-500),
                    (position_set_x,9,300),
                    (position_transform_position_to_parent,10,5,9),
                    (position_get_distance_to_terrain, ":distance_to_terrain_036", 10),
                    (store_add, ":var037", ":distance_to_terrain_035", ":distance_to_terrain_036"),
                    (val_mul, ":var037", 100),
                    (store_div, ":var___x1", ":var037", 24),
                    (assign,":var038",":var___x1"),
                    (init_position,20),
                    (position_rotate_x_floating,20,":var038"),
                    (position_transform_position_to_parent,23,5,20),
                    (init_position,9),
                    (position_set_x,9,-300),
                    (position_transform_position_to_parent,10,5,9),
                    (position_get_distance_to_terrain, ":distance_to_terrain_039", 10),
                    (init_position,9),
                    (position_set_x,9,300),
                    (position_transform_position_to_parent,10,5,9),
                    (position_get_distance_to_terrain, ":distance_to_terrain_040", 10),
                    (store_sub, ":distance_to_terrain_035", ":distance_to_terrain_039", ":distance_to_terrain_040"),
                    (init_position,9),
                    (position_set_x,9,-300),
                    (position_set_y,9,-500),
                    (position_transform_position_to_parent,10,5,9),
                    (position_get_distance_to_terrain, ":distance_to_terrain_039", 10),
                    (init_position,9),
                    (position_set_x,9,300),
                    (position_set_y,9,-500),
                    (position_transform_position_to_parent,10,5,9),
                    (position_get_distance_to_terrain, ":distance_to_terrain_040", 10),
                    (store_sub, ":distance_to_terrain_036", ":distance_to_terrain_039", ":distance_to_terrain_040"),
                    (store_add, ":var037", ":distance_to_terrain_035", ":distance_to_terrain_036"),
                    (val_mul, ":var037", 100),
                    (store_div, ":var___x1", ":var037", 24),
                    (assign,":var038",":var___x1"),
                    (val_mul, ":var038", -1),
                    (init_position,20),
                    (position_rotate_y_floating,20,":var038"),
                    (position_transform_position_to_parent,22,23,20),
                (else_try),
                    (copy_position,22,5),
                (try_end),
                (try_begin),
                    (ge,":var023",1),
                    (store_mul, ":var033", ":var023", 100),
                    (store_sqrt, ":var033", ":var033"),
                    (val_min,":var033",300),
                    (val_mul, ":distance_015", 100),
                    (val_mul, ":distance_015", 3),
                    (val_div, ":distance_015", ":var033"),
                    (prop_instance_get_position, pos6, ":scp_instance_016"),
                    (position_transform_position_to_local, 7,1,6),
                    (position_transform_position_to_parent,8,22,7),
                    (prop_instance_animate_to_position, ":scp_instance_016", 8, ":distance_015"),
                    (try_begin),
                        (eq,":var001",0),
                        (prop_instance_get_position, pos6, ":scp_instance_017"),
                        (position_transform_position_to_local, 7,1,6),
                        (position_transform_position_to_parent,8,22,7),
                        (prop_instance_animate_to_position, ":scp_instance_017", 8, ":distance_015"),
                    (try_end),
                    (store_mul, ":var041", ":distance_015", -25),
                    (assign,"$g_last_number_of_agents_around_belfry",":var023"),
                    (prop_instance_get_position, pos13, ":scp_instance_020"),
                    (prop_instance_get_position, pos20, ":scp_instance_005"),
                    (position_transform_position_to_local, 7,20,13),
                    (position_transform_position_to_parent,21,22,7),
                    (prop_instance_rotate_to_position, ":scp_instance_020", 21, ":distance_015", ":var041"),
                    (prop_instance_get_position, pos13, ":scp_instance_021"),
                    (prop_instance_get_position, pos20, ":scp_instance_005"),
                    (position_transform_position_to_local, 7,20,13),
                    (position_transform_position_to_parent,21,22,7),
                    (prop_instance_rotate_to_position, ":scp_instance_021", 21, ":distance_015", ":var041"),
                    (prop_instance_get_position, pos13, ":scp_instance_022"),
                    (prop_instance_get_position, pos20, ":scp_instance_005"),
                    (position_transform_position_to_local, 7,20,13),
                    (position_transform_position_to_parent,21,22,7),
                    (prop_instance_rotate_to_position, ":scp_instance_022", 21, ":distance_015", ":var041"),
                    (prop_instance_animate_to_position, ":scp_instance_005", 22, ":distance_015"),
                (else_try),
                    (prop_instance_is_animating, ":var032", ":scp_instance_005"),
                    (try_begin),
                        (eq,":var032",1),
                        (prop_instance_stop_animating, ":scp_instance_016"),
                        (try_begin),
                            (eq,":var001",0),
                            (prop_instance_stop_animating, ":scp_instance_017"),
                        (try_end),
                    (try_end),
                    (prop_instance_stop_animating, ":scp_instance_020"),
                    (prop_instance_stop_animating, ":scp_instance_021"),
                    (prop_instance_stop_animating, ":scp_instance_022"),
                    (prop_instance_stop_animating, ":scp_instance_005"),
                (try_end),
                (scene_prop_set_slot,":scp_instance_005",3,":var023"),
                (scene_prop_set_slot,":scp_instance_005",4,":var013"),
            (try_end),
        (else_try),
            (le,":sq_distance_011",4),
            (scene_prop_slot_eq,":scp_instance_005",5,0),
            (scene_prop_set_slot,":scp_instance_005",5,1),
            (try_begin),
                (eq,":var001",0),
                (scene_prop_get_instance, ":scp_instance_016", "spr_belfry_platform_a", ":var004"),
            (else_try),
                (scene_prop_get_instance, ":scp_instance_016", "spr_belfry_b_platform_a", ":var004"),
            (try_end),
            (prop_instance_get_starting_position, pos0, ":scp_instance_016"),
            (prop_instance_animate_to_position, ":scp_instance_016", 0, 400),
        (try_end),
    (try_end),
(try_end),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(1.0, 5.0, 0.0, [
(multiplayer_is_server),
(eq,"$g_multiplayer_poll_running",1),
(eq,"$g_multiplayer_poll_ended",0),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (this_or_next|eq,":var002","$g_multiplayer_poll_num_sent"),
    (gt,":m_timer_a_001","$g_multiplayer_poll_end_time"),
    (call_script, "script_cf_multiplayer_evaluate_poll"),
    (store_add, ":var002", "$g_multiplayer_poll_no_count", "$g_multiplayer_poll_yes_count"),
(try_end),
], [
(assign,"$g_multiplayer_poll_running",0),
(try_begin),
    (this_or_next|eq,"$g_multiplayer_poll_to_show",3),
    (eq,"$g_multiplayer_poll_to_show",0),
    (call_script, "script_game_multiplayer_get_game_type_mission_template", "$g_multiplayer_game_type"),
    (start_multiplayer_mission, reg0, "$g_multiplayer_poll_value_to_show", 1),
    (call_script, "script_game_set_multiplayer_mission_end"),
(try_end),
]),

(ti_server_player_joined, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_player_joined_common", ":player_id_001"),
(try_begin),
    (multiplayer_is_server),
    (this_or_next|player_is_active, ":player_id_001"),
    (eq,":player_id_001",0),
    (store_mission_timer_a,":m_timer_a_002"),
    (val_sub, ":m_timer_a_002", "$g_round_start_time"),
    (try_begin),
        (lt,":m_timer_a_002",25),
        (assign,":var003",0),
    (else_try),
        (lt,":m_timer_a_002",60),
        (assign,":var003",1),
    (else_try),
        (lt,":m_timer_a_002",105),
        (assign,":var003",2),
    (else_try),
        (lt,":m_timer_a_002",160),
        (assign,":var003",3),
    (else_try),
        (assign,":var003","$g_multiplayer_number_of_respawn_count"),
    (try_end),
    (player_set_slot,":player_id_001",39,":var003"),
    (multiplayer_send_int_to_player, ":player_id_001", 89, ":var003"),
(try_end),
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(assign,"$g_multiplayer_game_type",6),
(call_script, "script_multiplayer_server_before_mission_start_common"),
(try_begin),
    (multiplayer_is_server),
    (try_for_range, ":slot_no_001", 176, 186),
        (troop_set_slot,"trp_multiplayer_data",":slot_no_001",-1),
    (try_end),
    (assign,"$g_my_spawn_count",0),
(else_try),
    (assign,"$g_my_spawn_count",0),
(try_end),
(assign,"$g_waiting_for_confirmation_to_terminate",0),
(assign,"$g_round_ended",0),
(try_begin),
    (multiplayer_is_server),
    (assign,"$g_round_start_time",0),
(try_end),
(assign,"$my_team_at_start_of_round",-1),
(assign,"$g_flag_is_not_ready",0),
(call_script, "script_multiplayer_initialize_belfry_wheel_rotations"),
(call_script, "script_multiplayer_init_mission_variables"),
(call_script, "script_multiplayer_remove_destroy_mod_targets"),
(call_script, "script_multiplayer_remove_headquarters_flags"),
]),

(ti_after_mission_start, 0.0, 0.0, [
], [
(call_script, "script_determine_team_flags", 0),
(set_spawn_effector_scene_prop_kind, 0, -1),
(set_spawn_effector_scene_prop_kind, 1, -1),
(call_script, "script_initialize_all_scene_prop_slots"),
(call_script, "script_multiplayer_move_moveable_objects_initial_positions"),
(assign,"$g_number_of_flags",0),
(try_begin),
    (multiplayer_is_server),
    (assign,"$g_multiplayer_ready_for_spawning_agent",1),
    (entry_point_get_position, pos1, 66),
    (set_spawn_position, 1),
    (spawn_scene_prop, "spr_headquarters_pole_code_only"),
    (position_move_z,1,900),
    (set_spawn_position, 1),
    (spawn_scene_prop, "$team_1_flag_scene_prop"),
    (store_add, ":slot_no_001", 146, "$g_number_of_flags"),
    (troop_set_slot,"trp_multiplayer_data",":slot_no_001",1),
(try_end),
(val_add, "$g_number_of_flags", 1),
(try_begin),
    (multiplayer_is_server),
    (scene_prop_get_num_instances, ":scp_num_instances_002", "spr_belfry_a"),
    (try_for_range, ":var003", 0, ":scp_num_instances_002"),
        (scene_prop_get_instance, ":scp_instance_004", "spr_belfry_a", ":var003"),
        (scene_prop_set_slot,":scp_instance_004",5,1),
    (try_end),
    (scene_prop_get_num_instances, ":scp_num_instances_002", "spr_belfry_b"),
    (try_for_range, ":var003", 0, ":scp_num_instances_002"),
        (scene_prop_get_instance, ":scp_instance_004", "spr_belfry_b", ":var003"),
        (scene_prop_set_slot,":scp_instance_004",5,1),
    (try_end),
    (call_script, "script_move_belfries_to_their_first_entry_point", "spr_belfry_a"),
    (call_script, "script_move_belfries_to_their_first_entry_point", "spr_belfry_b"),
    (scene_prop_get_num_instances, ":scp_num_instances_002", "spr_belfry_a"),
    (try_for_range, ":var003", 0, ":scp_num_instances_002"),
        (scene_prop_get_instance, ":scp_instance_004", "spr_belfry_a", ":var003"),
        (scene_prop_set_slot,":scp_instance_004",3,0),
        (scene_prop_set_slot,":scp_instance_004",4,0),
    (try_end),
    (scene_prop_get_num_instances, ":scp_num_instances_002", "spr_belfry_b"),
    (try_for_range, ":var003", 0, ":scp_num_instances_002"),
        (scene_prop_get_instance, ":scp_instance_004", "spr_belfry_b", ":var003"),
        (scene_prop_set_slot,":scp_instance_004",3,0),
        (scene_prop_set_slot,":scp_instance_004",4,0),
    (try_end),
    (scene_prop_get_num_instances, ":scp_num_instances_002", "spr_belfry_a"),
    (try_for_range, ":var003", 0, ":scp_num_instances_002"),
        (scene_prop_get_instance, ":scp_instance_004", "spr_belfry_a", ":var003"),
        (scene_prop_set_slot,":scp_instance_004",5,0),
    (try_end),
    (scene_prop_get_num_instances, ":scp_num_instances_002", "spr_belfry_b"),
    (try_for_range, ":var003", 0, ":scp_num_instances_002"),
        (scene_prop_get_instance, ":scp_instance_004", "spr_belfry_b", ":var003"),
        (scene_prop_set_slot,":scp_instance_004",5,0),
    (try_end),
(try_end),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_on_agent_spawn_common", ":var001"),
(try_begin),
    (lt,"$my_team_at_start_of_round",0),
    (multiplayer_get_my_player, ":my_player"),
    (try_begin),
        (ge,":my_player",0),
        (player_get_agent_id, ":agent_id_003", ":my_player"),
        (try_begin),
            (eq,":agent_id_003",":var001"),
            (ge,":agent_id_003",0),
            (agent_get_team, "$my_team_at_start_of_round", ":agent_id_003"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (neg|multiplayer_is_server),
    (try_begin),
        (eq,"$g_round_ended",1),
        (assign,"$g_round_ended",0),
        (assign,"$g_my_spawn_count",0),
        (call_script, "script_initialize_all_scene_prop_slots"),
        (call_script, "script_multiplayer_initialize_belfry_wheel_rotations"),
        (call_script, "script_initialize_objects_clients"),
    (try_end),
(try_end),
(try_begin),
    (eq,1,1),
    (multiplayer_get_my_player, ":my_player"),
    (try_begin),
        (ge,":my_player",0),
        (player_get_agent_id, ":agent_id_003", ":my_player"),
        (try_begin),
            (eq,":agent_id_003",":var001"),
            (val_add, "$g_my_spawn_count", 1),
            (try_begin),
                (ge,"$g_my_spawn_count","$g_multiplayer_number_of_respawn_count"),
                (gt,"$g_multiplayer_number_of_respawn_count",0),
                (multiplayer_get_my_player, ":my_player"),
                (player_get_team_no,  ":team_no_004", ":my_player"),
                (try_begin),
                    (eq,":team_no_004",0),
                    (assign,"$g_my_spawn_count",999),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(ti_on_agent_killed_or_wounded, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_on_agent_killed_or_wounded_common", ":var001", ":var002"),
(try_begin),
    (lt,"$my_team_at_start_of_round",0),
    (multiplayer_get_my_player, ":my_player"),
    (try_begin),
        (ge,":my_player",0),
        (player_get_agent_id, ":agent_id_004", ":my_player"),
        (try_begin),
            (ge,":agent_id_004",0),
            (agent_get_team, "$my_team_at_start_of_round", ":agent_id_004"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (multiplayer_is_server),
    (agent_is_human,":var001"),
    (neg|agent_is_non_player, ":var001"),
    (agent_get_player_id,":agent_player_id_005",":var001"),
    (player_set_slot,":agent_player_id_005",0,0),
(try_end),
]),

(ti_on_multiplayer_mission_end, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_event_mission_end"),
(assign,"$g_multiplayer_stats_chart_opened_manually",0),
(start_presentation, "prsnt_multiplayer_stats_chart"),
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (eq,"$g_round_ended",0),
    (try_for_range, ":var001", 0, "$g_number_of_flags"),
        (store_add, ":slot_no_002", 156, ":var001"),
        (troop_get_slot,":troop_slot_003","trp_multiplayer_data",":slot_no_002"),
        (store_div, ":var___x1", ":troop_slot_003", 100),
        (assign,":var004",":var___x1"),
        (store_mod,":var005",":troop_slot_003",100),
        (assign,":var006",0),
        (assign,":var007",0),
        (scene_prop_get_instance, ":scp_instance_008", "spr_headquarters_pole_code_only", ":var001"),
        (prop_instance_get_position, pos0, ":scp_instance_008"),
        (get_max_players, ":max_players"),
        (try_for_range, ":player_id_010", 0, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_010"),
                (player_get_agent_id, ":agent_id_011", ":player_id_010"),
                (try_begin),
                    (ge,":agent_id_011",0),
                    (agent_is_alive,":agent_id_011"),
                    (agent_get_team, ":agent_team_no_012", ":agent_id_011"),
                    (agent_get_position,pos1,":agent_id_011"),
                    (get_sq_distance_between_positions,":sq_distance_013",0,1),
                    (get_sq_distance_between_position_heights,":sq_distance_014",0,1),
                    (val_add, ":sq_distance_013", ":sq_distance_014"),
                    (try_begin),
                        (lt,":sq_distance_013",1600),
                        (try_begin),
                            (eq,":agent_team_no_012",0),
                            (val_add, ":var006", 1),
                        (else_try),
                            (eq,":agent_team_no_012",1),
                            (val_add, ":var007", 1),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (this_or_next|eq,":var004",":var006"),
        (neq,":var005",":var007"),
        (store_add, ":slot_no_015", 176, ":var001"),
        (troop_get_slot,":troop_slot_016","trp_multiplayer_data",":slot_no_015"),
        (store_mod,":var017",":troop_slot_016",100),
        (store_div, ":var___x1", ":troop_slot_016", 100),
        (assign,":var018",":var___x1"),
        (try_begin),
            (eq,":var005",0),
            (gt,":var007",0),
            (eq,":var006",0),
            (assign,":var019",2),
            (store_mul, ":var020", ":var019", 100),
            (troop_set_slot,"trp_multiplayer_data",":slot_no_015",":var020"),
            (try_begin),
                (this_or_next|eq,":var018",":var019"),
                (ge,":var017",25),
                (store_mul, ":var021", ":var019", 100),
                (val_add, ":var021", ":var001"),
            (try_end),
        (try_end),
        (try_begin),
            (eq,1,1),
            (store_mul, ":troop_slot_003", ":var006", 100),
            (val_add, ":troop_slot_003", ":var007"),
            (troop_set_slot,"trp_multiplayer_data",":slot_no_002",":troop_slot_003"),
            (get_max_players, ":max_players"),
            (call_script, "script_set_num_agents_around_flag", ":var001", ":troop_slot_003"),
            (try_for_range, ":player_id_010", 1, ":max_players"),
                (try_begin),
                    (player_is_active, ":player_id_010"),
                    (multiplayer_send_2_int_to_player, ":player_id_010", 73, ":var001", ":troop_slot_003"),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_for_range, ":var001", 0, "$g_number_of_flags"),
    (try_begin),
        (eq,"$g_round_ended",0),
        (neg|eq,"$g_flag_is_not_ready",0),
        (scene_prop_get_instance, ":scp_instance_008", "spr_headquarters_pole_code_only", ":var001"),
        (prop_instance_get_position, pos0, ":scp_instance_008"),
        (try_begin),
            (eq,1,1),
            (scene_prop_get_instance, ":scp_instance_022", "$team_1_flag_scene_prop", ":var001"),
            (prop_instance_get_position, pos1, ":scp_instance_022"),
            (try_begin),
                (eq,1,1),
                (get_sq_distance_between_positions,":sq_distance_013",0,1),
                (try_begin),
                    (lt,":sq_distance_013",400),
                    (prop_instance_is_animating, ":var023", ":scp_instance_022"),
                    (try_begin),
                        (eq,":var023",1),
                        (assign,"$g_winner_team",1),
                        (prop_instance_stop_animating, ":scp_instance_022"),
                        (get_max_players, ":max_players"),
                        (call_script, "script_draw_this_round", "$g_winner_team"),
                        (try_for_range, ":player_id_010", 1, ":max_players"),
                            (try_begin),
                                (player_is_active, ":player_id_010"),
                                (multiplayer_send_int_to_player, ":player_id_010", 69, "$g_winner_team"),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
            (assign,"$g_flag_is_not_ready",1),
        (try_end),
    (try_end),
(try_end),
]),

(0.0, 0.0, 0.0, [
], [
(assign,":var001","$g_multiplayer_num_bots_team_1"),
(assign,":var002","$g_multiplayer_num_bots_team_2"),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_004", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_004"),
        (player_get_team_no,  ":team_no_005", ":player_id_004"),
        (try_begin),
            (eq,":team_no_005",0),
            (val_add, ":var001", 1),
        (else_try),
            (eq,":team_no_005",1),
            (val_add, ":var002", 1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (this_or_next|eq,":var001",0),
    (eq,":var002",0),
    (store_mission_timer_a,":m_timer_a_006"),
    (val_sub, ":m_timer_a_006", "$g_round_start_time"),
    (try_begin),
        (le,":m_timer_a_006",2),
        (store_mission_timer_a,"$g_round_start_time"),
    (try_end),
(try_end),
]),

(1.0, 0.0, 0.0, [
(multiplayer_is_server),
(eq,"$g_round_ended",0),
(neg|eq,"$g_flag_is_not_ready",0),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (ge,":var002","$g_multiplayer_round_max_seconds"),
    (store_sub, ":var002", ":m_timer_a_001", "$g_round_start_time"),
(try_end),
], [
(assign,":m_timer_a_001",0),
(store_add, ":slot_no_002", 156, ":m_timer_a_001"),
(troop_get_slot,":troop_slot_003","trp_multiplayer_data",":slot_no_002"),
(store_mod,":var004",":troop_slot_003",100),
(try_begin),
    (eq,":var004",0),
    (store_mission_timer_a,"$g_round_finish_time"),
    (assign,"$g_round_ended",1),
    (assign,"$g_flag_is_not_ready",1),
    (assign,"$g_winner_team",0),
    (get_max_players, ":max_players"),
    (call_script, "script_draw_this_round", "$g_winner_team"),
    (try_for_range, ":player_id_006", 1, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_006"),
            (multiplayer_send_int_to_player, ":player_id_006", 69, "$g_winner_team"),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (try_for_range, ":var001", 0, "$g_number_of_flags"),
        (store_add, ":slot_no_002", 176, ":var001"),
        (troop_get_slot,":troop_slot_003","trp_multiplayer_data",":slot_no_002"),
        (store_mod,":var004",":troop_slot_003",100),
        (try_begin),
            (ge,":troop_slot_003",100),
            (lt,":var004",25),
            (val_add, ":troop_slot_003", 1),
            (troop_set_slot,"trp_multiplayer_data",":slot_no_002",":troop_slot_003"),
        (try_end),
    (try_end),
(try_end),
]),

(10.0, 0.0, 0.0, [
(multiplayer_is_server),
], [
(assign,":var001",0),
(assign,":var002",0),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_004", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_004"),
        (player_get_team_no,  ":team_no_005", ":player_id_004"),
        (try_begin),
            (eq,":team_no_005",0),
            (val_add, ":var001", 1),
        (else_try),
            (eq,":team_no_005",1),
            (val_add, ":var002", 1),
        (try_end),
    (try_end),
(try_end),
(store_sub, ":var006", ":var001", ":var002"),
(assign,":var007",0),
(try_begin),
    (eq,1,1),
    (try_begin),
        (eq,1,1),
        (store_mul, ":var008", "$g_multiplayer_auto_team_balance_limit", -1),
        (try_begin),
            (le,":var006",":var008"),
            (store_div, ":var___x1", ":var006", -2),
            (assign,":var007",":var___x1"),
        (else_try),
            (ge,":var006","$g_multiplayer_auto_team_balance_limit"),
            (store_div, ":var___x1", ":var006", 2),
            (assign,":var007",":var___x1"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (gt,":var007",0),
    (try_begin),
        (eq,"$g_team_balance_next_round",0),
        (assign,"$g_team_balance_next_round",1),
        (call_script, "script_show_multiplayer_message", 3, 0),
        (get_max_players, ":max_players"),
        (try_for_range, ":player_id_009", 1, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_009"),
                (multiplayer_send_int_to_player, ":player_id_009", 68, 3),
            (try_end),
        (try_end),
        (call_script, "script_warn_player_about_auto_team_balance"),
    (try_end),
(try_end),
]),

(1.0, 0.0, 3.0, [
(multiplayer_is_server),
(eq,"$g_round_ended",1),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (ge,":m_timer_a_001","$g_multiplayer_respawn_period"),
    (val_sub, ":m_timer_a_001", "$g_round_finish_time"),
(try_end),
], [
(assign,":m_timer_a_001",0),
(assign,":var002",0),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_004", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_004"),
        (player_get_team_no,  ":team_no_005", ":player_id_004"),
        (try_begin),
            (eq,":team_no_005",0),
            (val_add, ":m_timer_a_001", 1),
        (else_try),
            (eq,":team_no_005",1),
            (val_add, ":var002", 1),
        (try_end),
    (try_end),
(try_end),
(store_sub, ":var006", ":m_timer_a_001", ":var002"),
(assign,":var007",0),
(try_begin),
    (eq,1,1),
    (try_begin),
        (eq,1,1),
        (store_mul, ":var008", "$g_multiplayer_auto_team_balance_limit", -1),
        (try_begin),
            (le,":var006",":var008"),
            (store_div, ":var___x1", ":var006", -2),
            (assign,":var007",":var___x1"),
            (assign,":var009",1),
            (assign,":team_no_010",0),
        (else_try),
            (ge,":var006","$g_multiplayer_auto_team_balance_limit"),
            (store_div, ":var___x1", ":var006", 2),
            (assign,":var007",":var___x1"),
            (assign,":var009",0),
            (assign,":team_no_010",1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (gt,":var007",0),
    (try_begin),
        (eq,1,1),
        (try_for_range, ":var011", 0, ":var007"),
            (assign,":var012",0),
            (assign,":player_id_013",-1),
            (get_max_players, ":max_players"),
            (try_for_range, ":player_id_014", 0, ":max_players"),
                (try_begin),
                    (player_is_active, ":player_id_014"),
                    (player_get_team_no,  ":team_no_005", ":player_id_014"),
                    (try_begin),
                        (eq,":team_no_005",":var009"),
                        (player_get_slot,":player_slot_015",":player_id_014",21),
                        (try_begin),
                            (gt,":player_slot_015",":var012"),
                            (assign,":var012",":player_slot_015"),
                            (assign,":player_id_013",":player_id_014"),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
            (try_begin),
                (ge,":player_id_013",0),
                (try_begin),
                    (eq,1,1),
                    (player_get_agent_id, ":agent_id_016", ":player_id_013"),
                    (try_begin),
                        (ge,":agent_id_016",0),
                        (agent_is_alive,":agent_id_016"),
                        (player_get_kill_count, ":kill_count_017", ":player_id_013"),
                        (val_add, ":kill_count_017", 1),
                        (call_script, "script_player_set_kill_count", ":player_id_013", ":kill_count_017"),
                        (player_get_death_count, ":death_count_018", ":player_id_013"),
                        (val_sub, ":death_count_018", 1),
                        (call_script, "script_player_set_death_count", ":player_id_013", ":death_count_018"),
                        (player_get_score, ":score_019", ":player_id_013"),
                        (val_add, ":score_019", 1),
                        (call_script, "script_player_set_score", ":player_id_013", ":score_019"),
                        (try_for_range, ":player_id_014", 1, ":max_players"),
                            (try_begin),
                                (player_is_active, ":player_id_014"),
                                (multiplayer_send_4_int_to_player, ":player_id_014", 86, ":player_id_013", ":score_019", ":kill_count_017", ":death_count_018"),
                            (try_end),
                        (try_end),
                    (try_end),
                    (player_get_value_of_original_items, ":player_id_013"),
                    (player_get_gold, ":gold_021", ":player_id_013"),
                    (val_add, ":gold_021", ":player_slot_020"),
                    (player_set_gold, ":player_id_013", ":gold_021", 15000),
                (try_end),
                (player_set_troop_id, ":player_id_013", -1),
                (player_get_team_no,  ":player_id_013", ":team_no_010"),
                (multiplayer_send_message_to_player, ":player_id_013", 79),
            (try_end),
        (try_end),
        (call_script, "script_show_multiplayer_message", 2, 0),
        (multiplayer_get_my_player, ":my_player"),
        (get_max_players, ":max_players"),
        (try_for_range, ":player_id_014", 0, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_014"),
                (neq,":my_player",":player_id_014"),
                (multiplayer_send_int_to_player, ":player_id_014", 68, 2),
            (try_end),
        (try_end),
        (assign,"$g_team_balance_next_round",0),
    (try_end),
(try_end),
(assign,"$g_team_balance_next_round",0),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_014", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_014"),
        (player_set_slot,":player_id_014",0,0),
        (player_set_slot,":player_id_014",25,0),
        (player_get_agent_id, ":agent_id_023", ":player_id_014"),
        (try_begin),
            (ge,":agent_id_023",0),
            (agent_is_alive,":agent_id_023"),
            (player_save_picked_up_items_for_next_spawn, ":player_id_014"),
            (player_get_value_of_original_items, ":player_id_014"),
            (player_set_slot,":player_id_014",1,":player_slot_020"),
        (try_end),
    (try_end),
(try_end),
(assign,":var024",500),
(val_mul, ":var024", "$g_multiplayer_round_earnings_multiplier"),
(val_div, ":var024", 100),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_014", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_014"),
        (player_get_gold, ":gold_021", ":player_id_014"),
        (player_get_team_no,  ":team_no_005", ":player_id_014"),
        (try_begin),
            (this_or_next|eq,":team_no_005",1),
            (eq,":team_no_005",0),
            (val_add, ":gold_021", ":var024"),
        (try_end),
    (try_end),
    (try_begin),
        (eq,1,1),
        (player_get_slot,":player_slot_020",":player_id_014",1),
        (store_add, ":var025", ":gold_021", ":player_slot_020"),
        (store_mul, ":var026", "$g_multiplayer_initial_gold_multiplier", 10),
        (try_begin),
            (lt,":var025",":var026"),
            (store_sub, ":var027", ":var026", ":var025"),
            (val_add, ":gold_021", ":var027"),
        (try_end),
    (try_end),
    (player_set_gold, ":player_id_014", ":gold_021", 15000),
(try_end),
(assign,"$my_team_at_start_of_round",-1),
(multiplayer_clear_scene),
(assign,"$g_my_spawn_count",0),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_014", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_014"),
        (player_set_slot,":player_id_014",39,0),
    (try_end),
(try_end),
(call_script, "script_initialize_objects"),
(call_script, "script_multiplayer_initialize_belfry_wheel_rotations"),
(call_script, "script_multiplayer_close_gate_if_it_is_open"),
(call_script, "script_multiplayer_move_moveable_objects_initial_positions"),
(call_script, "script_move_belfries_to_their_first_entry_point", "spr_belfry_a"),
(call_script, "script_move_belfries_to_their_first_entry_point", "spr_belfry_b"),
(scene_prop_get_num_instances, ":scp_num_instances_028", "spr_belfry_a"),
(try_for_range, ":var029", 0, ":scp_num_instances_028"),
    (scene_prop_get_instance, ":scp_instance_030", "spr_belfry_a", ":var029"),
    (scene_prop_set_slot,":scp_instance_030",3,0),
    (scene_prop_set_slot,":scp_instance_030",4,0),
(try_end),
(scene_prop_get_num_instances, ":scp_num_instances_028", "spr_belfry_a"),
(try_for_range, ":var029", 0, ":scp_num_instances_028"),
    (scene_prop_get_instance, ":scp_instance_030", "spr_belfry_a", ":var029"),
    (scene_prop_set_slot,":scp_instance_030",5,0),
(try_end),
(scene_prop_get_num_instances, ":scp_num_instances_028", "spr_belfry_b"),
(try_for_range, ":var029", 0, ":scp_num_instances_028"),
    (scene_prop_get_instance, ":scp_instance_030", "spr_belfry_b", ":var029"),
    (scene_prop_set_slot,":scp_instance_030",3,0),
    (scene_prop_set_slot,":scp_instance_030",4,0),
(try_end),
(scene_prop_get_num_instances, ":scp_num_instances_028", "spr_belfry_b"),
(try_for_range, ":var029", 0, ":scp_num_instances_028"),
    (scene_prop_get_instance, ":scp_instance_030", "spr_belfry_b", ":var029"),
    (scene_prop_set_slot,":scp_instance_030",5,0),
(try_end),
(try_for_range, ":var031", 0, "$g_number_of_flags"),
    (scene_prop_get_instance, ":scp_instance_032", "spr_headquarters_pole_code_only", ":var031"),
    (prop_instance_get_position, pos1, ":scp_instance_032"),
    (position_move_z,1,900),
    (scene_prop_get_instance, ":scp_instance_033", "$team_1_flag_scene_prop", ":var031"),
    (prop_instance_stop_animating, ":scp_instance_033"),
    (prop_instance_set_position, ":scp_instance_033", 1),
(try_end),
(assign,"$g_round_ended",0),
(store_mission_timer_a,"$g_round_start_time"),
(call_script, "script_initialize_all_scene_prop_slots"),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_014", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_014"),
        (multiplayer_send_int_to_player, ":player_id_014", 78, -9999),
    (try_end),
(try_end),
(assign,"$g_flag_is_not_ready",0),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (get_max_players, ":max_players"),
    (try_for_range, ":player_id_002", 0, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_002"),
            (neg|player_is_busy_with_menus, ":player_id_002"),
            (player_slot_eq,":player_id_002",0,0),
            (player_get_team_no,  ":team_no_003", ":player_id_002"),
            (try_begin),
                (lt,":team_no_003",2),
                (player_get_troop_id, ":troop_id_004", ":player_id_002"),
                (try_begin),
                    (ge,":troop_id_004",0),
                    (player_get_agent_id, ":agent_id_005", ":player_id_002"),
                    (assign,":var006",0),
                    (assign,":var007",0),
                    (assign,":var008",0),
                    (try_begin),
                        (eq,1,1),
                        (assign,":var009",0),
                        (get_max_players, ":max_players"),
                        (try_for_range, ":player_id_010", 0, ":max_players"),
                            (try_begin),
                                (player_is_active, ":player_id_010"),
                                (player_get_team_no,  ":team_no_011", ":player_id_010"),
                                (try_begin),
                                    (eq,":team_no_011",0),
                                    (val_add, ":var007", 1),
                                (else_try),
                                    (eq,":team_no_011",1),
                                    (val_add, ":var008", 1),
                                (try_end),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
            (val_add, ":var009", 1),
        (try_end),
        (store_mission_timer_a,":m_timer_a_012"),
        (val_sub, ":m_timer_a_012", "$g_round_start_time"),
        (try_begin),
            (eq,"$g_round_ended",0),
            (try_begin),
                (lt,":agent_id_005",0),
                (try_begin),
                    (eq,":team_no_003",0),
                    (player_get_slot,":player_slot_013",":player_id_002",28),
                    (store_mission_timer_a,":m_timer_a_014"),
                    (store_sub, ":agent_time_since_removed_015", ":m_timer_a_014", ":player_slot_013"),
                    (assign,":var016","$g_multiplayer_respawn_period"),
                    (val_add, ":var016", 27),
                    (try_begin),
                        (lt,":agent_time_since_removed_015",":var016"),
                        (store_sub, ":m_timer_a_012", ":m_timer_a_014", "$g_round_start_time"),
                        (try_begin),
                            (ge,":m_timer_a_012",30),
                            (gt,":var009",2),
                            (store_mul, ":var017", ":var007", ":var008"),
                            (try_begin),
                                (neq,":var017",0),
                                (assign,":var006",0),
                            (else_try),
                                (assign,":var006",1),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (else_try),
            (agent_get_time_elapsed_since_removed, ":agent_time_since_removed_015", ":agent_id_005"),
            (assign,":var016","$g_multiplayer_respawn_period"),
            (try_begin),
                (eq,":team_no_003",0),
                (val_add, ":var016", 27),
            (try_end),
            (try_begin),
                (this_or_next|gt,":agent_time_since_removed_015",":var016"),
                (player_slot_eq,":player_id_002",25,0),
                (assign,":var006",1),
            (try_end),
        (try_end),
    (try_end),
    (player_get_slot,":player_slot_018",":player_id_002",39),
    (try_begin),
        (gt,"$g_multiplayer_number_of_respawn_count",0),
        (try_begin),
            (eq,":var006",1),
            (eq,":team_no_003",0),
            (ge,":player_slot_018","$g_multiplayer_number_of_respawn_count"),
            (assign,":var006",0),
        (else_try),
            (eq,":var006",1),
            (eq,":team_no_003",1),
            (ge,":player_slot_018",999),
            (assign,":var006",0),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var006",1),
        (call_script, "script_multiplayer_buy_agent_equipment", ":player_id_002"),
        (player_get_slot,":player_slot_018",":player_id_002",39),
        (val_add, ":player_slot_018", 1),
        (player_set_slot,":player_id_002",39,":player_slot_018"),
        (try_begin),
            (ge,":player_slot_018","$g_multiplayer_number_of_respawn_count"),
            (gt,"$g_multiplayer_number_of_respawn_count",0),
            (eq,":team_no_003",0),
            (assign,":player_slot_018",999),
            (player_set_slot,":player_id_002",39,":player_slot_018"),
        (try_end),
    (try_end),
    (assign,":var019",0),
    (player_get_item_id, ":item_id_020", ":player_id_002", 8),
    (try_begin),
        (this_or_next|is_between,":item_id_020","itm_sumpter_horse","itm_arrows"),
        (this_or_next|eq,":item_id_020","itm_warhorse_sarranid"),
        (eq,":item_id_020","itm_warhorse_steppe"),
        (assign,":var019",1),
    (try_end),
    (try_begin),
        (lt,":m_timer_a_012",20),
        (try_begin),
            (eq,":team_no_003",0),
            (call_script, "script_multiplayer_find_spawn_point", ":team_no_003", 1, ":var019"),
            (assign,":entry_point_021",reg0),
        (else_try),
            (eq,":team_no_003",1),
            (assign,":entry_point_021",32),
        (try_end),
    (else_try),
        (call_script, "script_multiplayer_find_spawn_point", ":team_no_003", 0, ":var019"),
        (assign,":entry_point_021",reg0),
    (try_end),
    (player_spawn_new_agent, ":player_id_002", ":entry_point_021"),
    (player_set_slot,":player_id_002",0,1),
    (player_set_slot,":player_id_002",25,1),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (store_mission_timer_a,":m_timer_a_001"),
    (try_begin),
        (ge,":m_timer_a_001",2),
        (assign,":var002",0),
        (assign,":var003",0),
        (try_for_agents, ":cur_agent"),
            (try_begin),
                (agent_is_non_player, ":cur_agent"),
                (agent_is_human,":cur_agent"),
                (assign,":var005",0),
                (try_begin),
                    (agent_is_alive,":cur_agent"),
                    (assign,":var005",1),
                (else_try),
                    (agent_get_time_elapsed_since_removed, ":agent_time_since_removed_006", ":cur_agent"),
                    (try_begin),
                        (le,":agent_time_since_removed_006","$g_multiplayer_respawn_period"),
                        (assign,":var005",1),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var005",1),
        (agent_get_team, ":agent_team_no_007", ":cur_agent"),
        (try_begin),
            (eq,":agent_team_no_007",0),
            (val_add, ":var002", 1),
        (else_try),
            (eq,":agent_team_no_007",1),
            (val_add, ":var003", 1),
        (try_end),
    (try_end),
(try_end),
(store_sub, "$g_multiplayer_num_bots_required_team_1", "$g_multiplayer_num_bots_team_1", ":var002"),
(store_sub, "$g_multiplayer_num_bots_required_team_2", "$g_multiplayer_num_bots_team_2", ":var003"),
(val_max,"$g_multiplayer_num_bots_required_team_1",0),
(val_max,"$g_multiplayer_num_bots_required_team_2",0),
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (eq,"$g_multiplayer_ready_for_spawning_agent",1),
    (store_add, ":var001", "$g_multiplayer_num_bots_required_team_1", "$g_multiplayer_num_bots_required_team_2"),
    (try_begin),
        (gt,":var001",0),
        (try_begin),
            (this_or_next|eq,"$g_multiplayer_game_type",6),
            (this_or_next|eq,"$g_multiplayer_game_type",3),
            (eq,"$g_multiplayer_game_type",2),
            (team_get_score, ":team_score_002", 0),
            (team_get_score, ":team_score_003", 1),
            (store_add, ":var004", ":team_score_002", ":team_score_003"),
            (try_begin),
                (eq,":var004",0),
                (store_mission_timer_a,":m_timer_a_005"),
                (val_sub, ":m_timer_a_005", "$g_round_start_time"),
                (try_begin),
                    (lt,":m_timer_a_005",20),
                    (assign,":var006",0),
                (else_try),
                    (assign,":var006",1),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var006",1),
        (store_random_in_range,":random_x_007",0,":var001"),
        (val_sub, ":random_x_007", "$g_multiplayer_num_bots_required_team_1"),
        (try_begin),
            (lt,":random_x_007",0),
            (assign,":team_id_008",0),
        (else_try),
            (assign,":team_id_008",1),
        (try_end),
    (try_end),
    (try_begin),
        (this_or_next|eq,"$g_multiplayer_game_type",6),
        (this_or_next|eq,"$g_multiplayer_game_type",3),
        (eq,"$g_multiplayer_game_type",2),
        (store_mission_timer_a,":m_timer_a_005"),
        (val_sub, ":m_timer_a_005", "$g_round_start_time"),
        (try_begin),
            (le,":m_timer_a_005",20),
            (assign,":var009",0),
        (else_try),
            (assign,":var009",1),
        (try_end),
    (else_try),
        (assign,":var009",1),
    (try_end),
    (call_script, "script_multiplayer_find_bot_troop_and_group_for_spawn", ":team_id_008", ":var009"),
    (assign,":troop_id_010",reg0),
    (assign,":group_no_011",reg1),
    (team_get_faction, ":team_faction_012", ":team_id_008"),
    (assign,":var013",0),
    (try_for_range, ":trp_014", "trp_swadian_crossbowman_multiplayer_ai", "trp_swadian_crossbowman_multiplayer"),
        (store_troop_faction,":troop_faction_015",":trp_014"),
        (try_begin),
            (eq,":troop_faction_015",":team_faction_012"),
            (val_add, ":var013", 1),
        (try_end),
    (try_end),
    (assign,":var016",0),
    (get_max_players, ":max_players"),
    (try_for_range, ":player_id_018", 0, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_018"),
            (player_get_team_no,  ":team_no_019", ":player_id_018"),
            (try_begin),
                (eq,":team_id_008",":team_no_019"),
                (assign,":var020",0),
                (store_add, ":var021", 35, ":var013"),
                (try_for_range, ":var022", 35, ":var021"),
                    (try_begin),
                        (player_slot_ge,":player_id_018",":var022",1),
                        (assign,":var020",1),
                        (assign,":var021",0),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (ge,":var020",1),
            (val_add, ":var016", 1),
        (try_end),
    (try_end),
    (try_begin),
        (this_or_next|ge,":group_no_011",0),
        (eq,":var016",0),
        (troop_get_inventory_slot,":troop_inv_slot_023",":troop_id_010",8),
        (try_begin),
            (ge,":troop_inv_slot_023",0),
            (assign,":var024",1),
        (else_try),
            (assign,":var024",0),
        (try_end),
        (try_begin),
            (eq,"$g_multiplayer_game_type",6),
            (store_mission_timer_a,":m_timer_a_005"),
            (val_sub, ":m_timer_a_005", "$g_round_start_time"),
            (try_begin),
                (lt,":m_timer_a_005",20),
                (try_begin),
                    (eq,":team_id_008",0),
                    (call_script, "script_multiplayer_find_spawn_point", ":team_id_008", 1, ":var024"),
                (else_try),
                    (assign,reg0,32),
                (try_end),
            (else_try),
                (call_script, "script_multiplayer_find_spawn_point", ":team_id_008", 0, ":var024"),
            (try_end),
        (else_try),
            (this_or_next|eq,"$g_multiplayer_game_type",3),
            (eq,"$g_multiplayer_game_type",2),
            (try_begin),
                (eq,":team_id_008",0),
                (assign,reg0,0),
            (else_try),
                (assign,reg0,32),
            (try_end),
        (else_try),
            (call_script, "script_multiplayer_find_spawn_point", ":team_id_008", 0, ":var024"),
        (try_end),
        (store_current_scene,":cur_scene_025"),
        (modify_visitors_at_site,":cur_scene_025"),
        (add_visitors_to_current_scene,reg0,":troop_id_010",1, ":team_id_008", ":group_no_011"),
        (assign,"$g_multiplayer_ready_for_spawning_agent",0),
        (try_begin),
            (eq,":team_id_008",0),
            (val_sub, "$g_multiplayer_num_bots_required_team_1", 1),
        (else_try),
            (eq,":team_id_008",1),
            (val_sub, "$g_multiplayer_num_bots_required_team_2", 1),
        (try_end),
    (try_end),
(try_end),
]),

(3.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (try_for_agents, ":cur_agent"),
        (try_begin),
            (agent_is_non_player, ":cur_agent"),
            (agent_is_human,":cur_agent"),
            (agent_is_alive,":cur_agent"),
            (agent_get_group, ":agent_group_002", ":cur_agent"),
            (try_begin),
                (neg|player_is_active, ":agent_group_002"),
                (call_script, "script_multiplayer_change_leader_of_bot", ":cur_agent"),
            (else_try),
                (player_get_team_no,  ":team_no_003", ":agent_group_002"),
                (agent_get_team, ":agent_team_no_004", ":cur_agent"),
                (try_begin),
                    (neq,":team_no_003",":agent_team_no_004"),
                    (call_script, "script_multiplayer_change_leader_of_bot", ":cur_agent"),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (assign,":var001",0),
    (try_begin),
        (eq,"$g_multiplayer_game_type",8),
        (try_begin),
            (eq,"$g_round_ended",1),
            (assign,":var001",1),
        (try_end),
    (try_end),
(else_try),
    (this_or_next|eq,"$g_multiplayer_game_type",6),
    (this_or_next|eq,"$g_multiplayer_game_type",3),
    (eq,"$g_multiplayer_game_type",2),
    (try_begin),
        (eq,"$g_round_ended",1),
        (store_mission_timer_a,":m_timer_a_002"),
        (val_sub, ":m_timer_a_002", "$g_round_finish_time"),
        (store_sub, ":var003", "$g_multiplayer_respawn_period", 1),
        (try_begin),
            (ge,":m_timer_a_002",":var003"),
            (store_mission_timer_a,":m_timer_a_004"),
            (try_begin),
                (this_or_next|eq,"$g_multiplayer_game_type",3),
                (eq,"$g_multiplayer_game_type",2),
                (assign,":var005",90),
            (else_try),
                (assign,":var005",120),
            (try_end),
        (try_end),
        (store_mul, ":var006", "$g_multiplayer_game_max_minutes", 60),
        (store_sub, ":var007", ":var006", ":var005"),
        (try_begin),
            (gt,":m_timer_a_004",":var007"),
            (assign,":var001",1),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var001",1),
    (else_try),
        (neq,"$g_multiplayer_game_type",2),
        (neq,"$g_multiplayer_game_type",3),
        (neq,"$g_multiplayer_game_type",6),
        (neq,"$g_multiplayer_game_type",5),
        (store_mission_timer_a,":m_timer_a_004"),
        (store_mul, ":var006", "$g_multiplayer_game_max_minutes", 60),
        (try_begin),
            (gt,":m_timer_a_004",":var006"),
            (assign,":var001",1),
        (else_try),
            (team_get_score, ":team_score_008", 0),
            (team_get_score, ":team_score_009", 1),
            (try_begin),
                (neq,"$g_multiplayer_game_type",5),
                (try_begin),
                    (this_or_next|ge,":team_score_008","$g_multiplayer_game_max_points"),
                    (ge,":team_score_009","$g_multiplayer_game_max_points"),
                    (assign,":var001",1),
                (try_end),
            (try_end),
        (try_end),
    (else_try),
        (assign,":var010",0),
        (get_max_players, ":max_players"),
        (try_for_range, ":player_id_012", 0, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_012"),
                (player_get_agent_id, ":agent_id_013", ":player_id_012"),
                (try_begin),
                    (ge,":agent_id_013",0),
                    (neg|agent_is_non_player, ":agent_id_013"),
                    (assign,":var010",1),
                    (assign,":max_players",0),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (eq,":var010",1),
            (this_or_next|gt,":team_score_008",0),
            (le,":team_score_009",0),
            (assign,":var001",1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,":var001",1),
    (call_script, "script_game_multiplayer_get_game_type_mission_template", "$g_multiplayer_game_type"),
    (start_multiplayer_mission, reg0, "$g_multiplayer_selected_map", 0),
    (call_script, "script_game_set_multiplayer_mission_end"),
(try_end),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_multiplayer_mission_end_screen",0),
    (assign,"$g_multiplayer_stats_chart_opened_manually",1),
    (start_presentation, "prsnt_multiplayer_stats_chart"),
(try_end),
]),

(0.0, 0.0, ti_once, [
], [
(start_presentation, "prsnt_multiplayer_welcome_message"),
]),

(ti_battle_window_opened, 0.0, 0.0, [
], [
(start_presentation, "prsnt_multiplayer_round_time_counter"),
(start_presentation, "prsnt_multiplayer_team_score_display"),
]),

(ti_escape_pressed, 0.0, 0.0, [
], [
(try_begin),
    (neg|is_presentation_active, "prsnt_multiplayer_escape_menu"),
    (neg|is_presentation_active, "prsnt_multiplayer_stats_chart"),
    (eq,"$g_waiting_for_confirmation_to_terminate",0),
    (start_presentation, "prsnt_multiplayer_escape_menu"),
(try_end),
]),

]),
("multiplayer_bt", mtf_battle_mode, -1,
"You lead your men to battle.",
[(0, mtef_visitor_source|mtef_team_0|mtef_no_auto_reset, 0, aif_start_alarmed, 1, []),
(1, mtef_visitor_source|mtef_team_0|mtef_no_auto_reset, 0, aif_start_alarmed, 1, []),
(2, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(3, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(4, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(5, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(6, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(7, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(8, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(9, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(10, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(11, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(12, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(13, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(14, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(15, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(16, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(17, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(18, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(19, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(20, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(21, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(22, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(23, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(24, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(25, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(26, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(27, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(28, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(29, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(30, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(31, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(32, mtef_visitor_source|mtef_team_0|mtef_no_auto_reset, 0, aif_start_alarmed, 1, []),
(33, mtef_visitor_source|mtef_team_0|mtef_no_auto_reset, 0, aif_start_alarmed, 1, []),
(34, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(35, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(36, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(37, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(38, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(39, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(40, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(41, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(42, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(43, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(44, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(45, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(46, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(47, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(48, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(49, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(50, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(51, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(52, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(53, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(54, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(55, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(56, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(57, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(58, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(59, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(60, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(61, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(62, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(63, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
],
[
(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(1.0, 5.0, 0.0, [
(multiplayer_is_server),
(eq,"$g_multiplayer_poll_running",1),
(eq,"$g_multiplayer_poll_ended",0),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (this_or_next|eq,":var002","$g_multiplayer_poll_num_sent"),
    (gt,":m_timer_a_001","$g_multiplayer_poll_end_time"),
    (call_script, "script_cf_multiplayer_evaluate_poll"),
    (store_add, ":var002", "$g_multiplayer_poll_no_count", "$g_multiplayer_poll_yes_count"),
(try_end),
], [
(assign,"$g_multiplayer_poll_running",0),
(try_begin),
    (this_or_next|eq,"$g_multiplayer_poll_to_show",3),
    (eq,"$g_multiplayer_poll_to_show",0),
    (call_script, "script_game_multiplayer_get_game_type_mission_template", "$g_multiplayer_game_type"),
    (start_multiplayer_mission, reg0, "$g_multiplayer_poll_value_to_show", 1),
    (call_script, "script_game_set_multiplayer_mission_end"),
(try_end),
]),

(ti_server_player_joined, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_player_joined_common", ":var001"),
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(assign,"$g_multiplayer_game_type",2),
(call_script, "script_multiplayer_server_before_mission_start_common"),
(assign,"$g_waiting_for_confirmation_to_terminate",0),
(assign,"$g_round_ended",0),
(assign,"$g_battle_death_mode_started",0),
(assign,"$g_reduced_waiting_seconds",0),
(try_begin),
    (multiplayer_is_server),
    (assign,"$server_mission_timer_while_player_joined",0),
    (assign,"$g_round_start_time",0),
(try_end),
(assign,"$my_team_at_start_of_round",-1),
(call_script, "script_multiplayer_init_mission_variables"),
(call_script, "script_multiplayer_remove_destroy_mod_targets"),
(call_script, "script_multiplayer_remove_headquarters_flags"),
]),

(ti_after_mission_start, 0.0, 0.0, [
], [
(call_script, "script_determine_team_flags", 0),
(call_script, "script_determine_team_flags", 1),
(set_spawn_effector_scene_prop_kind, 0, -1),
(set_spawn_effector_scene_prop_kind, 1, -1),
(try_begin),
    (multiplayer_is_server),
    (assign,"$g_multiplayer_ready_for_spawning_agent",1),
    (entry_point_get_position, pos0, 67),
    (position_set_z_to_ground_level, 0),
    (position_move_z,0,-2000),
    (position_move_x,0,100),
    (set_spawn_position, 0),
    (spawn_scene_prop, "spr_headquarters_pole_code_only"),
    (position_move_x,0,-200),
    (set_spawn_position, 0),
    (spawn_scene_prop, "spr_headquarters_pole_code_only"),
    (scene_prop_get_instance, ":scp_instance_001", "spr_headquarters_pole_code_only", 0),
    (prop_instance_get_position, pos0, ":scp_instance_001"),
    (spawn_scene_prop, "$team_1_flag_scene_prop"),
    (position_move_z,0,100),
    (prop_instance_set_position, reg0, 0),
    (scene_prop_get_instance, ":scp_instance_002", "spr_headquarters_pole_code_only", 1),
    (prop_instance_get_position, pos0, ":scp_instance_002"),
    (spawn_scene_prop, "$team_2_flag_scene_prop"),
    (position_move_z,0,100),
    (prop_instance_set_position, reg0, 0),
    (assign,"$g_multiplayer_num_bots_required_team_1","$g_multiplayer_num_bots_team_1"),
    (assign,"$g_multiplayer_num_bots_required_team_2","$g_multiplayer_num_bots_team_2"),
(try_end),
(call_script, "script_initialize_all_scene_prop_slots"),
(call_script, "script_multiplayer_initialize_belfry_wheel_rotations"),
(call_script, "script_multiplayer_move_moveable_objects_initial_positions"),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_on_agent_spawn_common", ":agent_id_001"),
(try_begin),
    (lt,"$my_team_at_start_of_round",0),
    (multiplayer_get_my_player, ":my_player"),
    (try_begin),
        (ge,":my_player",0),
        (player_get_agent_id, ":agent_id_003", ":my_player"),
        (try_begin),
            (eq,":agent_id_003",":agent_id_001"),
            (ge,":agent_id_003",0),
            (agent_get_team, "$my_team_at_start_of_round", ":agent_id_003"),
        (try_end),
    (try_end),
(try_end),
(agent_set_slot,":agent_id_001",26,-1),
(try_begin),
    (multiplayer_is_server),
    (neg|agent_is_human,":agent_id_001"),
    (agent_get_rider,":agent_rider_004",":agent_id_001"),
    (try_begin),
        (agent_is_active,":agent_rider_004"),
        (neg|agent_is_non_player, ":agent_rider_004"),
        (agent_get_player_id,":agent_player_id_005",":agent_rider_004"),
        (try_begin),
            (neg|player_item_slot_is_picked_up, ":agent_player_id_005", 8),
            (agent_set_slot,":agent_rider_004",26,":agent_id_001"),
        (try_end),
    (try_end),
(try_end),
(call_script, "script_calculate_new_death_waiting_time_at_death_mod"),
(try_begin),
    (neg|multiplayer_is_server),
    (try_begin),
        (eq,"$g_round_ended",1),
        (assign,"$g_round_ended",0),
        (call_script, "script_initialize_all_scene_prop_slots"),
        (call_script, "script_multiplayer_initialize_belfry_wheel_rotations"),
        (call_script, "script_initialize_objects_clients"),
        (try_begin),
            (eq,"$g_team_balance_next_round",1),
            (assign,"$g_team_balance_next_round",0),
        (try_end),
    (try_end),
(try_end),
]),

(ti_on_agent_killed_or_wounded, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_on_agent_killed_or_wounded_common", ":var001", ":var002"),
(try_begin),
    (lt,"$my_team_at_start_of_round",0),
    (multiplayer_get_my_player, ":my_player"),
    (try_begin),
        (ge,":my_player",0),
        (player_get_agent_id, ":agent_id_004", ":my_player"),
        (try_begin),
            (ge,":agent_id_004",0),
            (agent_get_team, "$my_team_at_start_of_round", ":agent_id_004"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (agent_is_human,":var001"),
    (assign,":var005",0),
    (assign,":var006",0),
    (try_for_agents, ":cur_agent"),
        (try_begin),
            (agent_is_human,":cur_agent"),
            (try_begin),
                (agent_is_alive,":cur_agent"),
                (agent_get_team, ":agent_team_no_008", ":cur_agent"),
                (try_begin),
                    (eq,":agent_team_no_008",0),
                    (val_add, ":var005", 1),
                (else_try),
                    (eq,":agent_team_no_008",1),
                    (val_add, ":var006", 1),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,"$g_round_ended",0),
        (try_begin),
            (this_or_next|eq,":var005",0),
            (eq,":var006",0),
            (assign,"$g_winner_team",-1),
            (assign,reg0,"$g_multiplayer_respawn_period"),
            (try_begin),
                (eq,":var005",0),
                (try_begin),
                    (neq,":var006",0),
                    (team_get_score, ":team_score_009", 1),
                    (val_add, ":team_score_009", 1),
                    (call_script, "script_team_set_score", 1, ":team_score_009"),
                    (assign,"$g_winner_team",1),
                (try_end),
                (call_script, "script_show_multiplayer_message", 12, "$g_winner_team"),
                (call_script, "script_check_achievement_last_man_standing", "$g_winner_team"),
            (else_try),
                (try_begin),
                    (neq,":var005",0),
                    (team_get_score, ":team_score_010", 0),
                    (val_add, ":team_score_010", 1),
                    (call_script, "script_team_set_score", 0, ":team_score_010"),
                    (assign,"$g_winner_team",0),
                (try_end),
                (call_script, "script_show_multiplayer_message", 12, "$g_winner_team"),
                (call_script, "script_check_achievement_last_man_standing", "$g_winner_team"),
            (try_end),
            (store_mission_timer_a,"$g_round_finish_time"),
            (assign,"$g_round_ended",1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (multiplayer_is_server),
    (agent_is_human,":var001"),
    (neg|agent_is_non_player, ":var001"),
    (ge,":var001",0),
    (agent_get_player_id,":agent_player_id_011",":var001"),
    (try_begin),
        (ge,":agent_player_id_011",0),
        (set_fixed_point_multiplier, 100),
        (agent_get_player_id,":agent_player_id_011",":var001"),
        (agent_get_position,pos0,":var001"),
        (position_get_x,":pos_x_012",0),
        (position_get_y,":pos_y_013",0),
        (position_get_z,":pos_z_014",0),
        (player_set_slot,":agent_player_id_011",29,":pos_x_012"),
        (player_set_slot,":agent_player_id_011",30,":pos_y_013"),
        (player_set_slot,":agent_player_id_011",31,":pos_z_014"),
    (try_end),
(try_end),
]),

(ti_on_multiplayer_mission_end, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_event_mission_end"),
(assign,"$g_multiplayer_stats_chart_opened_manually",0),
(start_presentation, "prsnt_multiplayer_stats_chart"),
]),

(1.0, 0.0, 0.0, [
(multiplayer_is_server),
(eq,"$g_round_ended",0),
(store_mission_timer_a,":m_timer_a_001"),
(store_sub, ":var002", ":m_timer_a_001", "$g_round_start_time"),
(try_begin),
    (ge,":var002","$g_multiplayer_round_max_seconds"),
    (assign,":var003",0),
    (try_begin),
        (eq,"$g_battle_death_mode_started",2),
        (scene_prop_get_instance, ":scp_instance_004", "spr_headquarters_pole_code_only", 0),
        (scene_prop_get_instance, ":scp_instance_005", "spr_headquarters_pole_code_only", 1),
        (scene_prop_get_instance, ":scp_instance_006", "$team_1_flag_scene_prop", 0),
        (scene_prop_get_instance, ":scp_instance_007", "$team_2_flag_scene_prop", 0),
        (prop_instance_get_position, pos1, ":scp_instance_004"),
        (prop_instance_get_position, pos2, ":scp_instance_005"),
        (prop_instance_get_position, pos3, ":scp_instance_006"),
        (prop_instance_get_position, pos4, ":scp_instance_007"),
        (get_distance_between_positions,":distance_008",1,3),
        (get_distance_between_positions,":distance_009",2,4),
        (store_add, ":var010", ":distance_008", 50),
        (store_add, ":var011", ":distance_009", 50),
        (try_begin),
            (le,":distance_008",":var011"),
            (prop_instance_is_animating, ":var012", ":scp_instance_006"),
            (try_begin),
                (eq,":var012",1),
                (prop_instance_get_animation_target_position, pos5, ":scp_instance_006"),
                (position_get_z,":pos_z_013",5),
                (position_get_z,":pos_z_014",3),
                (try_begin),
                    (ge,":pos_z_013",":pos_z_014"),
                    (assign,":var003",1),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (le,":distance_009",":var010"),
    (prop_instance_is_animating, ":var012", ":scp_instance_007"),
    (try_begin),
        (eq,":var012",1),
        (prop_instance_get_animation_target_position, pos5, ":scp_instance_007"),
        (position_get_z,":pos_z_013",5),
        (position_get_z,":pos_z_015",4),
        (try_begin),
            (ge,":pos_z_013",":pos_z_015"),
            (assign,":var003",1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,":var003",0),
(try_end),
], [
(store_mission_timer_a,"$g_round_finish_time"),
(assign,"$g_round_ended",1),
(assign,"$g_winner_team",-1),
(try_begin),
    (eq,"$g_battle_death_mode_started",2),
    (scene_prop_get_instance, ":m_timer_a_001", "spr_headquarters_pole_code_only", 0),
    (scene_prop_get_instance, ":scp_instance_002", "spr_headquarters_pole_code_only", 1),
    (scene_prop_get_instance, ":scp_instance_003", "$team_1_flag_scene_prop", 0),
    (scene_prop_get_instance, ":scp_instance_004", "$team_2_flag_scene_prop", 0),
    (prop_instance_get_position, pos1, ":m_timer_a_001"),
    (prop_instance_get_position, pos2, ":scp_instance_002"),
    (prop_instance_get_position, pos3, ":scp_instance_003"),
    (prop_instance_get_position, pos4, ":scp_instance_004"),
    (get_distance_between_positions,":scp_instance_005",1,3),
    (get_distance_between_positions,":scp_instance_006",2,4),
    (try_begin),
        (ge,":scp_instance_005",":scp_instance_006"),
        (store_sub, ":scp_instance_007", ":scp_instance_005", ":scp_instance_006"),
        (try_begin),
            (ge,":scp_instance_007",50),
            (assign,"$g_winner_team",0),
        (else_try),
            (store_sub, ":scp_instance_007", ":scp_instance_006", ":scp_instance_005"),
            (try_begin),
                (ge,":scp_instance_007",50),
                (assign,"$g_winner_team",1),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(multiplayer_get_my_player, ":distance_008"),
(call_script, "script_draw_this_round", "$g_winner_team"),
(get_max_players, ":distance_009"),
(try_for_range, ":player_id_010", 1, ":distance_009"),
    (try_begin),
        (player_is_active, ":player_id_010"),
        (neq,":player_id_010",":distance_008"),
        (multiplayer_send_int_to_player, ":player_id_010", 69, "$g_winner_team"),
    (try_end),
(try_end),
]),

(10.0, 0.0, 0.0, [
(multiplayer_is_server),
], [
(assign,":var001",0),
(assign,":var002",0),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_004", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_004"),
        (player_get_team_no,  ":team_no_005", ":player_id_004"),
        (try_begin),
            (eq,":team_no_005",0),
            (val_add, ":var001", 1),
        (else_try),
            (eq,":team_no_005",1),
            (val_add, ":var002", 1),
        (try_end),
    (try_end),
(try_end),
(store_sub, ":var006", ":var001", ":var002"),
(assign,":var007",0),
(try_begin),
    (eq,1,1),
    (try_begin),
        (eq,1,1),
        (store_mul, ":var008", "$g_multiplayer_auto_team_balance_limit", -1),
        (try_begin),
            (le,":var006",":var008"),
            (store_div, ":var___x1", ":var006", -2),
            (assign,":var007",":var___x1"),
        (else_try),
            (ge,":var006","$g_multiplayer_auto_team_balance_limit"),
            (store_div, ":var___x1", ":var006", 2),
            (assign,":var007",":var___x1"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (gt,":var007",0),
    (try_begin),
        (eq,"$g_team_balance_next_round",0),
        (assign,"$g_team_balance_next_round",1),
        (call_script, "script_show_multiplayer_message", 3, 0),
        (get_max_players, ":max_players"),
        (try_for_range, ":player_id_009", 1, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_009"),
                (multiplayer_send_int_to_player, ":player_id_009", 68, 3),
            (try_end),
        (try_end),
        (call_script, "script_warn_player_about_auto_team_balance"),
    (try_end),
(try_end),
]),

(1.0, 0.0, 0.0, [
(multiplayer_is_server),
(eq,"$g_round_ended",0),
(eq,"$g_battle_death_mode_started",0),
(store_mission_timer_a,":m_timer_a_001"),
(val_sub, ":m_timer_a_001", "$g_round_start_time"),
(try_begin),
    (ge,":m_timer_a_001","$g_multiplayer_round_max_seconds_div_2"),
    (store_div, ":var___x1", "$g_multiplayer_round_max_seconds", 2),
    (assign,"$g_multiplayer_round_max_seconds_div_2",":var___x1"),
(try_end),
], [
(call_script, "script_calculate_new_death_waiting_time_at_death_mod"),
(assign,"$g_battle_death_mode_started",1),
]),

(1.0, 0.0, 0.0, [
(multiplayer_is_server),
(eq,"$g_round_ended",0),
(eq,"$g_battle_death_mode_started",1),
(store_mission_timer_a,":m_timer_a_001"),
(val_sub, ":m_timer_a_001", "$g_death_mode_part_1_start_time"),
(store_add, ":var002", "$g_battle_waiting_seconds", "$g_reduced_waiting_seconds"),
(try_begin),
    (ge,":m_timer_a_001",":var002"),
    (store_mission_timer_a,":m_timer_a_003"),
    (store_sub, ":var004", ":m_timer_a_003", "$g_round_start_time"),
    (try_begin),
        (lt,":var004",":var005"),
        (store_sub, ":var005", "$g_multiplayer_round_max_seconds", 15),
    (try_end),
(try_end),
], [
(assign,"$g_battle_death_mode_started",2),
(call_script, "script_start_death_mode"),
(get_max_players, ":m_timer_a_001"),
(try_for_range, ":player_id_002", 1, ":m_timer_a_001"),
    (try_begin),
        (player_is_active, ":player_id_002"),
        (multiplayer_send_int_to_player, ":player_id_002", 80, 0),
    (try_end),
(try_end),
(scene_prop_get_instance, ":m_timer_a_003", "spr_headquarters_pole_code_only", 0),
(scene_prop_get_instance, ":scp_instance_004", "spr_headquarters_pole_code_only", 1),
(scene_prop_get_instance, ":scp_instance_005", "$team_1_flag_scene_prop", 0),
(scene_prop_get_instance, ":scp_instance_006", "$team_2_flag_scene_prop", 0),
(store_random_in_range,"$g_random_entry_point",0,3),
(val_add, "$g_random_entry_point", 67),
(entry_point_get_position, pos0, "$g_random_entry_point"),
(position_set_z_to_ground_level, 0),
(position_move_x,0,100),
(prop_instance_set_position, ":m_timer_a_003", 0),
(position_move_x,0,-200),
(prop_instance_set_position, ":scp_instance_004", 0),
(prop_instance_get_position, pos0, ":m_timer_a_003"),
(position_move_z,0,100),
(prop_instance_set_position, ":scp_instance_005", 0),
(prop_instance_get_position, pos0, ":scp_instance_004"),
(position_move_z,0,100),
(prop_instance_set_position, ":scp_instance_006", 0),
(start_presentation, "prsnt_multiplayer_flag_projection_display_bt"),
]),

(3.0, 0.0, 0.0, [
(multiplayer_is_server),
(eq,"$g_round_ended",0),
(eq,"$g_battle_death_mode_started",1),
(store_mission_timer_a,":m_timer_a_001"),
(val_sub, ":m_timer_a_001", "$g_death_mode_part_1_start_time"),
(store_add, ":var002", "$g_battle_waiting_seconds", "$g_reduced_waiting_seconds"),
(try_begin),
    (ge,":m_timer_a_001",":var002"),
    (val_sub, ":var002", 20),
(try_end),
], [
(assign,":m_timer_a_001",0),
(try_for_agents, ":cur_agent"),
    (try_begin),
        (eq,":m_timer_a_001",0),
        (agent_is_human,":cur_agent"),
        (try_for_agents, ":cur_agent"),
            (try_begin),
                (agent_is_human,":cur_agent"),
                (eq,1,0),
                (agent_get_team, ":agent_team_no_004", ":cur_agent"),
                (agent_get_team, ":agent_team_no_005", ":cur_agent"),
                (try_begin),
                    (neq,":agent_team_no_004",":agent_team_no_005"),
                    (agent_get_position,pos1,":cur_agent"),
                    (agent_get_position,pos2,":cur_agent"),
                    (get_sq_distance_between_positions_in_meters,":sq_distance_006",1,2),
                    (try_begin),
                        (le,":sq_distance_006",49),
                        (assign,":m_timer_a_001",1),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,":m_timer_a_001",1),
    (val_add, "$g_reduced_waiting_seconds", 3),
(try_end),
]),

(3.0, 0.0, 0.0, [
(multiplayer_is_server),
(eq,"$g_round_ended",0),
(eq,"$g_battle_death_mode_started",1),
(store_mission_timer_a,":m_timer_a_001"),
(store_sub, ":var002", ":m_timer_a_001", "$g_round_start_time"),
(store_sub, ":var003", "$g_multiplayer_round_max_seconds", 66),
(try_begin),
    (ge,":var002",":var003"),
    (store_mission_timer_a,":m_timer_a_001"),
    (store_sub, ":var002", ":m_timer_a_001", "$g_round_start_time"),
    (try_begin),
        (le,":var002",":var004"),
        (store_sub, ":var004", "$g_multiplayer_round_max_seconds", 24),
    (try_end),
(try_end),
], [
(val_add, "$g_reduced_waiting_seconds", 1),
]),

(0.0, 0.0, 0.0, [
(multiplayer_is_server),
(eq,"$g_round_ended",0),
(eq,"$g_battle_death_mode_started",2),
], [
(set_fixed_point_multiplier, 100),
(scene_prop_get_instance, ":scp_instance_001", "spr_headquarters_pole_code_only", 0),
(scene_prop_get_instance, ":scp_instance_002", "spr_headquarters_pole_code_only", 1),
(scene_prop_get_instance, ":scp_instance_003", "$team_1_flag_scene_prop", 0),
(scene_prop_get_instance, ":scp_instance_004", "$team_2_flag_scene_prop", 0),
(prop_instance_get_position, pos1, ":scp_instance_001"),
(prop_instance_get_position, pos2, ":scp_instance_002"),
(prop_instance_get_position, pos3, ":scp_instance_003"),
(prop_instance_get_position, pos4, ":scp_instance_004"),
(copy_position,7,1),
(position_move_z,7,100),
(copy_position,8,2),
(position_move_z,8,100),
(get_distance_between_positions,":distance_005",1,3),
(get_distance_between_positions,":distance_006",2,4),
(assign,":var007",0),
(assign,":var008",0),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_010", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_010"),
        (player_get_agent_id, ":agent_id_011", ":player_id_010"),
        (try_begin),
            (ge,":agent_id_011",0),
            (agent_is_human,":agent_id_011"),
            (agent_is_alive,":agent_id_011"),
            (agent_get_team, ":agent_team_no_012", ":agent_id_011"),
            (agent_get_position,pos0,":agent_id_011"),
            (agent_get_horse,":agent_horse_013",":agent_id_011"),
            (try_begin),
                (eq,":agent_horse_013",-1),
                (try_begin),
                    (eq,":agent_team_no_012",0),
                    (try_begin),
                        (eq,1,1),
                        (get_sq_distance_between_positions,":sq_distance_014",0,1),
                        (try_begin),
                            (lt,":sq_distance_014",1600),
                            (try_begin),
                                (this_or_next|eq,":var007",1),
                                (eq,":var007",0),
                                (assign,":var007",1),
                            (else_try),
                                (assign,":var007",-2),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (eq,1,1),
            (get_sq_distance_between_positions,":sq_distance_014",0,2),
            (try_begin),
                (lt,":sq_distance_014",1600),
                (try_begin),
                    (eq,":var008",0),
                    (assign,":var008",-1),
                (else_try),
                    (eq,":var008",1),
                    (assign,":var008",-2),
                (try_end),
            (try_end),
        (try_end),
    (else_try),
        (eq,":agent_team_no_012",1),
        (try_begin),
            (eq,1,1),
            (get_sq_distance_between_positions,":sq_distance_014",0,2),
            (try_begin),
                (lt,":sq_distance_014",1600),
                (try_begin),
                    (this_or_next|eq,":var008",1),
                    (eq,":var008",0),
                    (assign,":var008",1),
                (else_try),
                    (assign,":var008",-2),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (eq,1,1),
            (get_sq_distance_between_positions,":sq_distance_014",0,1),
            (try_begin),
                (lt,":sq_distance_014",1600),
                (try_begin),
                    (eq,":var007",0),
                    (assign,":var007",-1),
                (else_try),
                    (eq,":var007",1),
                    (assign,":var007",-2),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (ge,":distance_005",800),
    (assign,"$g_winner_team",0),
    (get_max_players, ":max_players"),
    (call_script, "script_draw_this_round", "$g_winner_team"),
    (try_for_range, ":player_id_010", 1, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_010"),
            (multiplayer_send_int_to_player, ":player_id_010", 69, "$g_winner_team"),
        (try_end),
    (try_end),
    (team_get_score, ":team_score_015", 0),
    (call_script, "script_team_set_score", 0, ":team_score_015"),
    (try_for_range, ":player_id_010", 1, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_010"),
            (multiplayer_send_2_int_to_player, ":player_id_010", 72, 0, ":team_score_015"),
        (try_end),
    (try_end),
    (store_mission_timer_a,"$g_round_finish_time"),
    (assign,"$g_round_ended",1),
(else_try),
    (ge,":distance_006",800),
    (assign,"$g_winner_team",1),
    (get_max_players, ":max_players"),
    (call_script, "script_draw_this_round", "$g_winner_team"),
    (try_for_range, ":player_id_010", 1, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_010"),
            (multiplayer_send_int_to_player, ":player_id_010", 69, "$g_winner_team"),
        (try_end),
    (try_end),
    (team_get_score, ":team_score_016", 1),
    (call_script, "script_team_set_score", 1, ":team_score_016"),
    (try_for_range, ":player_id_010", 1, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_010"),
            (multiplayer_send_2_int_to_player, ":player_id_010", 72, 1, ":team_score_016"),
        (try_end),
    (try_end),
    (call_script, "script_show_multiplayer_message", 12, 0),
    (call_script, "script_check_achievement_last_man_standing", "$g_winner_team"),
    (store_mission_timer_a,"$g_round_finish_time"),
    (assign,"$g_round_ended",1),
(try_end),
(try_begin),
    (eq,"$g_round_ended",0),
    (position_get_z,":pos_z_017",3),
    (prop_instance_is_animating, ":var018", ":scp_instance_003"),
    (try_begin),
        (eq,":var007",-2),
        (eq,":var018",1),
        (prop_instance_stop_animating, ":scp_instance_003"),
    (else_try),
        (this_or_next|eq,":var007",-1),
        (eq,":var007",0),
        (prop_instance_get_animation_target_position, pos9, ":scp_instance_003"),
        (position_get_z,":pos_z_019",9),
        (try_begin),
            (this_or_next|eq,":var018",0),
            (gt,":pos_z_019",":pos_z_017"),
            (get_distance_between_positions,":distance_020",3,7),
            (try_begin),
                (gt,":distance_020",0),
                (val_mul, ":distance_020", 16),
                (prop_instance_animate_to_position, ":scp_instance_003", 7, ":distance_020"),
            (else_try),
                (eq,":var007",1),
                (prop_instance_get_animation_target_position, pos9, ":scp_instance_003"),
                (position_get_z,":pos_z_019",9),
                (try_begin),
                    (this_or_next|eq,":var018",0),
                    (lt,":pos_z_019",":pos_z_017"),
                    (copy_position,5,1),
                    (position_move_z,5,800),
                    (get_distance_between_positions,":distance_020",3,5),
                    (try_begin),
                        (gt,":distance_020",0),
                        (val_mul, ":distance_020", 8),
                        (prop_instance_animate_to_position, ":scp_instance_003", 5, ":distance_020"),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (position_get_z,":pos_z_021",4),
    (prop_instance_is_animating, ":var018", ":scp_instance_004"),
    (try_begin),
        (eq,":var008",-2),
        (eq,":var018",1),
        (prop_instance_stop_animating, ":scp_instance_004"),
    (else_try),
        (this_or_next|eq,":var008",-1),
        (eq,":var008",0),
        (prop_instance_get_animation_target_position, pos9, ":scp_instance_004"),
        (position_get_z,":pos_z_022",9),
        (try_begin),
            (this_or_next|eq,":var018",0),
            (gt,":pos_z_022",":pos_z_021"),
            (get_distance_between_positions,":distance_023",4,8),
            (try_begin),
                (gt,":distance_023",0),
                (val_mul, ":distance_023", 16),
                (prop_instance_animate_to_position, ":scp_instance_004", 8, ":distance_023"),
            (else_try),
                (eq,":var008",1),
                (prop_instance_get_animation_target_position, pos9, ":scp_instance_004"),
                (position_get_z,":pos_z_022",9),
                (try_begin),
                    (this_or_next|eq,":var018",0),
                    (lt,":pos_z_022",":pos_z_021"),
                    (copy_position,6,2),
                    (position_move_z,6,800),
                    (get_distance_between_positions,":distance_023",4,6),
                    (try_begin),
                        (gt,":distance_023",0),
                        (val_mul, ":distance_023", 8),
                        (prop_instance_animate_to_position, ":scp_instance_004", 6, ":distance_023"),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, 0.0, 3.0, [
(multiplayer_is_server),
(eq,"$g_round_ended",1),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (ge,":m_timer_a_001","$g_multiplayer_respawn_period"),
    (val_sub, ":m_timer_a_001", "$g_round_finish_time"),
(try_end),
], [
(assign,":m_timer_a_001",0),
(assign,":var002",0),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_004", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_004"),
        (player_get_team_no,  ":team_no_005", ":player_id_004"),
        (try_begin),
            (eq,":team_no_005",0),
            (val_add, ":m_timer_a_001", 1),
        (else_try),
            (eq,":team_no_005",1),
            (val_add, ":var002", 1),
        (try_end),
    (try_end),
(try_end),
(store_sub, ":var006", ":m_timer_a_001", ":var002"),
(assign,":var007",0),
(try_begin),
    (eq,1,1),
    (try_begin),
        (eq,1,1),
        (store_mul, ":var008", "$g_multiplayer_auto_team_balance_limit", -1),
        (try_begin),
            (le,":var006",":var008"),
            (store_div, ":var___x1", ":var006", -2),
            (assign,":var007",":var___x1"),
            (assign,":var009",1),
            (assign,":team_no_010",0),
        (else_try),
            (ge,":var006","$g_multiplayer_auto_team_balance_limit"),
            (store_div, ":var___x1", ":var006", 2),
            (assign,":var007",":var___x1"),
            (assign,":var009",0),
            (assign,":team_no_010",1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (gt,":var007",0),
    (try_begin),
        (eq,1,1),
        (try_for_range, ":var011", 0, ":var007"),
            (assign,":var012",0),
            (assign,":player_id_013",-1),
            (get_max_players, ":max_players"),
            (try_for_range, ":player_id_014", 0, ":max_players"),
                (try_begin),
                    (player_is_active, ":player_id_014"),
                    (player_get_team_no,  ":team_no_005", ":player_id_014"),
                    (try_begin),
                        (eq,":team_no_005",":var009"),
                        (player_get_slot,":player_slot_015",":player_id_014",21),
                        (try_begin),
                            (gt,":player_slot_015",":var012"),
                            (assign,":var012",":player_slot_015"),
                            (assign,":player_id_013",":player_id_014"),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
            (try_begin),
                (ge,":player_id_013",0),
                (try_begin),
                    (eq,1,1),
                    (player_get_agent_id, ":agent_id_016", ":player_id_013"),
                    (try_begin),
                        (ge,":agent_id_016",0),
                        (agent_is_alive,":agent_id_016"),
                        (player_get_kill_count, ":kill_count_017", ":player_id_013"),
                        (val_add, ":kill_count_017", 1),
                        (call_script, "script_player_set_kill_count", ":player_id_013", ":kill_count_017"),
                        (player_get_death_count, ":death_count_018", ":player_id_013"),
                        (val_sub, ":death_count_018", 1),
                        (call_script, "script_player_set_death_count", ":player_id_013", ":death_count_018"),
                        (player_get_score, ":score_019", ":player_id_013"),
                        (val_add, ":score_019", 1),
                        (call_script, "script_player_set_score", ":player_id_013", ":score_019"),
                        (try_for_range, ":player_id_014", 1, ":max_players"),
                            (try_begin),
                                (player_is_active, ":player_id_014"),
                                (multiplayer_send_4_int_to_player, ":player_id_014", 86, ":player_id_013", ":score_019", ":kill_count_017", ":death_count_018"),
                            (try_end),
                        (try_end),
                    (try_end),
                    (player_get_value_of_original_items, ":player_id_013"),
                    (player_get_gold, ":gold_021", ":player_id_013"),
                    (val_add, ":gold_021", ":player_slot_020"),
                    (player_set_gold, ":player_id_013", ":gold_021", 15000),
                (try_end),
                (player_set_troop_id, ":player_id_013", -1),
                (player_get_team_no,  ":player_id_013", ":team_no_010"),
                (multiplayer_send_message_to_player, ":player_id_013", 79),
            (try_end),
        (try_end),
        (call_script, "script_show_multiplayer_message", 2, 0),
        (multiplayer_get_my_player, ":my_player"),
        (get_max_players, ":max_players"),
        (try_for_range, ":player_id_014", 0, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_014"),
                (neq,":my_player",":player_id_014"),
                (multiplayer_send_int_to_player, ":player_id_014", 68, 2),
            (try_end),
        (try_end),
        (assign,"$g_team_balance_next_round",0),
    (try_end),
(try_end),
(assign,"$g_team_balance_next_round",0),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_014", 0, ":max_players"),
    (try_begin),
        (neq,":player_id_014",-1),
        (player_is_active, ":player_id_014"),
        (player_get_agent_id, ":agent_id_023", ":player_id_014"),
        (try_begin),
            (ge,":agent_id_023",0),
            (agent_is_alive,":agent_id_023"),
            (player_save_picked_up_items_for_next_spawn, ":player_id_014"),
            (assign,reg0,0),
            (player_get_troop_id, ":troop_id_024", ":player_id_014"),
            (call_script, "script_player_get_value_of_original_items", ":player_id_014", ":agent_id_023", ":troop_id_024"),
            (assign,":player_slot_020",reg0),
            (player_set_slot,":player_id_014",1,":player_slot_020"),
        (try_end),
    (try_end),
(try_end),
(assign,":var025",500),
(val_mul, ":var025", "$g_multiplayer_round_earnings_multiplier"),
(val_div, ":var025", 100),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_014", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_014"),
        (player_slot_eq,":player_id_014",0,1),
        (player_get_gold, ":gold_021", ":player_id_014"),
        (player_get_team_no,  ":team_no_005", ":player_id_014"),
        (try_begin),
            (this_or_next|eq,":team_no_005",1),
            (eq,":team_no_005",0),
            (val_add, ":gold_021", ":var025"),
        (try_end),
    (try_end),
    (try_begin),
        (eq,1,1),
        (player_get_slot,":player_slot_020",":player_id_014",1),
        (store_add, ":var026", ":gold_021", ":player_slot_020"),
        (store_mul, ":var027", "$g_multiplayer_initial_gold_multiplier", 10),
        (try_begin),
            (lt,":var026",":var027"),
            (store_sub, ":var028", ":var027", ":var026"),
            (val_add, ":gold_021", ":var028"),
        (try_end),
    (try_end),
    (player_set_gold, ":player_id_014", ":gold_021", 15000),
(try_end),
(try_for_range, ":player_id_014", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_014"),
        (player_set_slot,":player_id_014",0,0),
    (try_end),
(try_end),
(assign,"$my_team_at_start_of_round",-1),
(multiplayer_clear_scene),
(call_script, "script_multiplayer_initialize_belfry_wheel_rotations"),
(try_begin),
    (eq,"$g_battle_death_mode_started",2),
    (call_script, "script_move_death_mode_flags_down"),
(try_end),
(assign,"$g_battle_death_mode_started",0),
(assign,"$g_reduced_waiting_seconds",0),
(call_script, "script_multiplayer_close_gate_if_it_is_open"),
(call_script, "script_multiplayer_move_moveable_objects_initial_positions"),
(assign,"$g_round_ended",0),
(assign,"$g_multiplayer_num_bots_required_team_1","$g_multiplayer_num_bots_team_1"),
(assign,"$g_multiplayer_num_bots_required_team_2","$g_multiplayer_num_bots_team_2"),
(store_mission_timer_a,"$g_round_start_time"),
(call_script, "script_initialize_all_scene_prop_slots"),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_014", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_014"),
        (multiplayer_send_int_to_player, ":player_id_014", 78, -9999),
    (try_end),
(try_end),
]),

(0.0, 0.0, 0.0, [
], [
(assign,":var001","$g_multiplayer_num_bots_team_1"),
(assign,":var002","$g_multiplayer_num_bots_team_2"),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_004", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_004"),
        (player_get_team_no,  ":team_no_005", ":player_id_004"),
        (try_begin),
            (eq,":team_no_005",0),
            (val_add, ":var001", 1),
        (else_try),
            (eq,":team_no_005",1),
            (val_add, ":var002", 1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (this_or_next|eq,":var001",0),
    (eq,":var002",0),
    (store_mission_timer_a,":m_timer_a_006"),
    (val_sub, ":m_timer_a_006", "$g_round_start_time"),
    (try_begin),
        (le,":m_timer_a_006",2),
        (store_mission_timer_a,"$g_round_start_time"),
    (try_end),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (get_max_players, ":max_players"),
    (try_for_range, ":player_id_002", 0, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_002"),
            (neg|player_is_busy_with_menus, ":player_id_002"),
            (try_begin),
                (player_slot_eq,":player_id_002",0,0),
                (player_get_team_no,  ":team_no_003", ":player_id_002"),
                (try_begin),
                    (lt,":team_no_003",2),
                    (player_get_troop_id, ":troop_id_004", ":player_id_002"),
                    (try_begin),
                        (ge,":troop_id_004",0),
                        (assign,":var005",0),
                        (assign,":var006",0),
                        (assign,":var007",0),
                        (try_begin),
                            (eq,1,1),
                            (assign,":var008",0),
                            (get_max_players, ":max_players"),
                            (try_for_range, ":player_id_009", 0, ":max_players"),
                                (try_begin),
                                    (player_is_active, ":player_id_009"),
                                    (val_add, ":var008", 1),
                                    (player_get_team_no,  ":team_no_010", ":player_id_009"),
                                    (try_begin),
                                        (eq,":team_no_010",0),
                                        (val_add, ":var006", 1),
                                    (else_try),
                                        (eq,":team_no_010",1),
                                        (val_add, ":var007", 1),
                                    (try_end),
                                (try_end),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
                (store_mul, ":var011", ":var006", ":var007"),
                (store_mission_timer_a,":m_timer_a_012"),
                (val_sub, ":m_timer_a_012", "$g_round_start_time"),
                (try_begin),
                    (this_or_next|ge,":m_timer_a_012",30),
                    (this_or_next|gt,":var008",2),
                    (eq,":var011",0),
                    (eq,"$g_round_ended",0),
                    (assign,":var005",1),
                (try_end),
            (try_end),
            (try_begin),
                (eq,":var005",1),
                (try_begin),
                    (eq,":team_no_003",0),
                    (assign,":entry_point_013",0),
                (else_try),
                    (eq,":team_no_003",1),
                    (assign,":entry_point_013",32),
                (try_end),
            (try_end),
            (call_script, "script_multiplayer_buy_agent_equipment", ":player_id_002"),
            (player_spawn_new_agent, ":player_id_002", ":entry_point_013"),
            (player_set_slot,":player_id_002",0,1),
        (else_try),
            (eq,"$g_multiplayer_player_respawn_as_bot",1),
            (player_get_agent_id, ":agent_id_014", ":player_id_002"),
            (try_begin),
                (ge,":agent_id_014",0),
                (neg|agent_is_alive,":agent_id_014"),
                (agent_get_time_elapsed_since_removed, ":agent_time_since_removed_015", ":agent_id_014"),
                (try_begin),
                    (gt,":agent_time_since_removed_015","$g_multiplayer_respawn_period"),
                    (player_get_team_no,  ":team_no_003", ":player_id_002"),
                    (assign,":var016",0),
                    (try_for_agents, ":cur_agent"),
                        (try_begin),
                            (eq,":var016",0),
                            (agent_is_alive,":cur_agent"),
                            (agent_is_human,":cur_agent"),
                            (agent_is_non_player, ":cur_agent"),
                            (agent_get_team, ":agent_team_no_018", ":cur_agent"),
                            (try_begin),
                                (eq,":agent_team_no_018",":team_no_003"),
                                (assign,":var016",1),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
            (try_begin),
                (eq,":var016",1),
                (call_script, "script_find_most_suitable_bot_to_control", ":player_id_002"),
                (player_control_agent, ":player_id_002", reg0),
                (player_get_slot,":player_slot_019",":player_id_002",0),
                (val_add, ":player_slot_019", 1),
                (player_set_slot,":player_id_002",0,":player_slot_019"),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (eq,"$g_multiplayer_ready_for_spawning_agent",1),
    (store_add, ":var001", "$g_multiplayer_num_bots_required_team_1", "$g_multiplayer_num_bots_required_team_2"),
    (try_begin),
        (gt,":var001",0),
        (try_begin),
            (this_or_next|eq,"$g_multiplayer_game_type",6),
            (this_or_next|eq,"$g_multiplayer_game_type",3),
            (eq,"$g_multiplayer_game_type",2),
            (team_get_score, ":team_score_002", 0),
            (team_get_score, ":team_score_003", 1),
            (store_add, ":var004", ":team_score_002", ":team_score_003"),
            (try_begin),
                (eq,":var004",0),
                (store_mission_timer_a,":m_timer_a_005"),
                (val_sub, ":m_timer_a_005", "$g_round_start_time"),
                (try_begin),
                    (lt,":m_timer_a_005",20),
                    (assign,":var006",0),
                (else_try),
                    (assign,":var006",1),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var006",1),
        (store_random_in_range,":random_x_007",0,":var001"),
        (val_sub, ":random_x_007", "$g_multiplayer_num_bots_required_team_1"),
        (try_begin),
            (lt,":random_x_007",0),
            (assign,":team_id_008",0),
        (else_try),
            (assign,":team_id_008",1),
        (try_end),
    (try_end),
    (try_begin),
        (this_or_next|eq,"$g_multiplayer_game_type",6),
        (this_or_next|eq,"$g_multiplayer_game_type",3),
        (eq,"$g_multiplayer_game_type",2),
        (store_mission_timer_a,":m_timer_a_005"),
        (val_sub, ":m_timer_a_005", "$g_round_start_time"),
        (try_begin),
            (le,":m_timer_a_005",20),
            (assign,":var009",0),
        (else_try),
            (assign,":var009",1),
        (try_end),
    (else_try),
        (assign,":var009",1),
    (try_end),
    (call_script, "script_multiplayer_find_bot_troop_and_group_for_spawn", ":team_id_008", ":var009"),
    (assign,":troop_id_010",reg0),
    (assign,":group_no_011",reg1),
    (team_get_faction, ":team_faction_012", ":team_id_008"),
    (assign,":var013",0),
    (try_for_range, ":trp_014", "trp_swadian_crossbowman_multiplayer_ai", "trp_swadian_crossbowman_multiplayer"),
        (store_troop_faction,":troop_faction_015",":trp_014"),
        (try_begin),
            (eq,":troop_faction_015",":team_faction_012"),
            (val_add, ":var013", 1),
        (try_end),
    (try_end),
    (assign,":var016",0),
    (get_max_players, ":max_players"),
    (try_for_range, ":player_id_018", 0, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_018"),
            (player_get_team_no,  ":team_no_019", ":player_id_018"),
            (try_begin),
                (eq,":team_id_008",":team_no_019"),
                (assign,":var020",0),
                (store_add, ":var021", 35, ":var013"),
                (try_for_range, ":var022", 35, ":var021"),
                    (try_begin),
                        (player_slot_ge,":player_id_018",":var022",1),
                        (assign,":var020",1),
                        (assign,":var021",0),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (ge,":var020",1),
            (val_add, ":var016", 1),
        (try_end),
    (try_end),
    (try_begin),
        (this_or_next|ge,":group_no_011",0),
        (eq,":var016",0),
        (troop_get_inventory_slot,":troop_inv_slot_023",":troop_id_010",8),
        (try_begin),
            (ge,":troop_inv_slot_023",0),
            (assign,":var024",1),
        (else_try),
            (assign,":var024",0),
        (try_end),
        (try_begin),
            (eq,"$g_multiplayer_game_type",6),
            (store_mission_timer_a,":m_timer_a_005"),
            (val_sub, ":m_timer_a_005", "$g_round_start_time"),
            (try_begin),
                (lt,":m_timer_a_005",20),
                (try_begin),
                    (eq,":team_id_008",0),
                    (call_script, "script_multiplayer_find_spawn_point", ":team_id_008", 1, ":var024"),
                (else_try),
                    (assign,reg0,32),
                (try_end),
            (else_try),
                (call_script, "script_multiplayer_find_spawn_point", ":team_id_008", 0, ":var024"),
            (try_end),
        (else_try),
            (this_or_next|eq,"$g_multiplayer_game_type",3),
            (eq,"$g_multiplayer_game_type",2),
            (try_begin),
                (eq,":team_id_008",0),
                (assign,reg0,0),
            (else_try),
                (assign,reg0,32),
            (try_end),
        (else_try),
            (call_script, "script_multiplayer_find_spawn_point", ":team_id_008", 0, ":var024"),
        (try_end),
        (store_current_scene,":cur_scene_025"),
        (modify_visitors_at_site,":cur_scene_025"),
        (add_visitors_to_current_scene,reg0,":troop_id_010",1, ":team_id_008", ":group_no_011"),
        (assign,"$g_multiplayer_ready_for_spawning_agent",0),
        (try_begin),
            (eq,":team_id_008",0),
            (val_sub, "$g_multiplayer_num_bots_required_team_1", 1),
        (else_try),
            (eq,":team_id_008",1),
            (val_sub, "$g_multiplayer_num_bots_required_team_2", 1),
        (try_end),
    (try_end),
(try_end),
]),

(3.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (try_for_agents, ":cur_agent"),
        (try_begin),
            (agent_is_non_player, ":cur_agent"),
            (agent_is_human,":cur_agent"),
            (agent_is_alive,":cur_agent"),
            (agent_get_group, ":agent_group_002", ":cur_agent"),
            (try_begin),
                (neg|player_is_active, ":agent_group_002"),
                (call_script, "script_multiplayer_change_leader_of_bot", ":cur_agent"),
            (else_try),
                (player_get_team_no,  ":team_no_003", ":agent_group_002"),
                (agent_get_team, ":agent_team_no_004", ":cur_agent"),
                (try_begin),
                    (neq,":team_no_003",":agent_team_no_004"),
                    (call_script, "script_multiplayer_change_leader_of_bot", ":cur_agent"),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (assign,":var001",0),
    (try_begin),
        (eq,"$g_multiplayer_game_type",8),
        (try_begin),
            (eq,"$g_round_ended",1),
            (assign,":var001",1),
        (try_end),
    (try_end),
(else_try),
    (this_or_next|eq,"$g_multiplayer_game_type",6),
    (this_or_next|eq,"$g_multiplayer_game_type",3),
    (eq,"$g_multiplayer_game_type",2),
    (try_begin),
        (eq,"$g_round_ended",1),
        (store_mission_timer_a,":m_timer_a_002"),
        (val_sub, ":m_timer_a_002", "$g_round_finish_time"),
        (store_sub, ":var003", "$g_multiplayer_respawn_period", 1),
        (try_begin),
            (ge,":m_timer_a_002",":var003"),
            (store_mission_timer_a,":m_timer_a_004"),
            (try_begin),
                (this_or_next|eq,"$g_multiplayer_game_type",3),
                (eq,"$g_multiplayer_game_type",2),
                (assign,":var005",90),
            (else_try),
                (assign,":var005",120),
            (try_end),
        (try_end),
        (store_mul, ":var006", "$g_multiplayer_game_max_minutes", 60),
        (store_sub, ":var007", ":var006", ":var005"),
        (try_begin),
            (gt,":m_timer_a_004",":var007"),
            (assign,":var001",1),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var001",1),
    (else_try),
        (neq,"$g_multiplayer_game_type",2),
        (neq,"$g_multiplayer_game_type",3),
        (neq,"$g_multiplayer_game_type",6),
        (neq,"$g_multiplayer_game_type",5),
        (store_mission_timer_a,":m_timer_a_004"),
        (store_mul, ":var006", "$g_multiplayer_game_max_minutes", 60),
        (try_begin),
            (gt,":m_timer_a_004",":var006"),
            (assign,":var001",1),
        (else_try),
            (team_get_score, ":team_score_008", 0),
            (team_get_score, ":team_score_009", 1),
            (try_begin),
                (neq,"$g_multiplayer_game_type",5),
                (try_begin),
                    (this_or_next|ge,":team_score_008","$g_multiplayer_game_max_points"),
                    (ge,":team_score_009","$g_multiplayer_game_max_points"),
                    (assign,":var001",1),
                (try_end),
            (try_end),
        (try_end),
    (else_try),
        (assign,":var010",0),
        (get_max_players, ":max_players"),
        (try_for_range, ":player_id_012", 0, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_012"),
                (player_get_agent_id, ":agent_id_013", ":player_id_012"),
                (try_begin),
                    (ge,":agent_id_013",0),
                    (neg|agent_is_non_player, ":agent_id_013"),
                    (assign,":var010",1),
                    (assign,":max_players",0),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (eq,":var010",1),
            (this_or_next|gt,":team_score_008",0),
            (le,":team_score_009",0),
            (assign,":var001",1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,":var001",1),
    (call_script, "script_game_multiplayer_get_game_type_mission_template", "$g_multiplayer_game_type"),
    (start_multiplayer_mission, reg0, "$g_multiplayer_selected_map", 0),
    (call_script, "script_game_set_multiplayer_mission_end"),
(try_end),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_multiplayer_mission_end_screen",0),
    (assign,"$g_multiplayer_stats_chart_opened_manually",1),
    (start_presentation, "prsnt_multiplayer_stats_chart"),
(try_end),
]),

(0.0, 0.0, ti_once, [
], [
(start_presentation, "prsnt_multiplayer_welcome_message"),
]),

(ti_battle_window_opened, 0.0, 0.0, [
], [
(start_presentation, "prsnt_multiplayer_round_time_counter"),
(start_presentation, "prsnt_multiplayer_team_score_display"),
(try_begin),
    (eq,"$g_battle_death_mode_started",2),
    (start_presentation, "prsnt_multiplayer_flag_projection_display_bt"),
(try_end),
]),

(ti_escape_pressed, 0.0, 0.0, [
], [
(try_begin),
    (neg|is_presentation_active, "prsnt_multiplayer_escape_menu"),
    (neg|is_presentation_active, "prsnt_multiplayer_stats_chart"),
    (eq,"$g_waiting_for_confirmation_to_terminate",0),
    (start_presentation, "prsnt_multiplayer_escape_menu"),
(try_end),
]),

]),
("multiplayer_fd", mtf_battle_mode, -1,
"You lead your men to battle.",
[(0, mtef_visitor_source|mtef_team_0|mtef_no_auto_reset, 0, aif_start_alarmed, 1, []),
(1, mtef_visitor_source|mtef_team_0|mtef_no_auto_reset, 0, aif_start_alarmed, 1, []),
(2, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(3, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(4, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(5, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(6, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(7, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(8, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(9, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(10, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(11, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(12, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(13, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(14, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(15, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(16, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(17, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(18, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(19, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(20, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(21, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(22, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(23, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(24, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(25, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(26, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(27, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(28, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(29, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(30, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(31, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(32, mtef_visitor_source|mtef_team_0|mtef_no_auto_reset, 0, aif_start_alarmed, 1, []),
(33, mtef_visitor_source|mtef_team_0|mtef_no_auto_reset, 0, aif_start_alarmed, 1, []),
(34, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(35, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(36, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(37, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(38, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(39, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(40, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(41, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(42, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(43, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(44, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(45, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(46, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(47, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(48, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(49, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(50, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(51, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(52, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(53, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(54, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(55, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(56, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(57, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(58, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(59, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(60, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(61, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(62, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(63, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
],
[
(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(1.0, 5.0, 0.0, [
(multiplayer_is_server),
(eq,"$g_multiplayer_poll_running",1),
(eq,"$g_multiplayer_poll_ended",0),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (this_or_next|eq,":var002","$g_multiplayer_poll_num_sent"),
    (gt,":m_timer_a_001","$g_multiplayer_poll_end_time"),
    (call_script, "script_cf_multiplayer_evaluate_poll"),
    (store_add, ":var002", "$g_multiplayer_poll_no_count", "$g_multiplayer_poll_yes_count"),
(try_end),
], [
(assign,"$g_multiplayer_poll_running",0),
(try_begin),
    (this_or_next|eq,"$g_multiplayer_poll_to_show",3),
    (eq,"$g_multiplayer_poll_to_show",0),
    (call_script, "script_game_multiplayer_get_game_type_mission_template", "$g_multiplayer_game_type"),
    (start_multiplayer_mission, reg0, "$g_multiplayer_poll_value_to_show", 1),
    (call_script, "script_game_set_multiplayer_mission_end"),
(try_end),
]),

(ti_server_player_joined, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_player_joined_common", ":var001"),
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(assign,"$g_multiplayer_game_type",3),
(call_script, "script_multiplayer_server_before_mission_start_common"),
(assign,"$g_waiting_for_confirmation_to_terminate",0),
(assign,"$g_round_ended",0),
(assign,"$g_reduced_waiting_seconds",0),
(try_begin),
    (multiplayer_is_server),
    (assign,"$g_round_start_time",0),
(try_end),
(assign,"$my_team_at_start_of_round",-1),
(call_script, "script_multiplayer_init_mission_variables"),
(call_script, "script_multiplayer_remove_headquarters_flags"),
]),

(ti_after_mission_start, 0.0, 0.0, [
], [
(call_script, "script_determine_team_flags", 0),
(call_script, "script_determine_team_flags", 1),
(set_spawn_effector_scene_prop_kind, 0, -1),
(set_spawn_effector_scene_prop_kind, 1, -1),
(call_script, "script_initialize_all_scene_prop_slots"),
(call_script, "script_multiplayer_initialize_belfry_wheel_rotations"),
(call_script, "script_multiplayer_move_moveable_objects_initial_positions"),
(assign,"$g_destructible_target_1","spr_catapult_destructible"),
(assign,"$g_destructible_target_2","spr_trebuchet_destructible"),
(scene_prop_get_num_instances, ":scp_num_instances_001", "$g_destructible_target_1"),
(try_for_range, ":var002", 0, ":scp_num_instances_001"),
    (scene_prop_get_instance, ":scp_instance_003", "$g_destructible_target_1", ":var002"),
    (try_begin),
        (ge,":scp_instance_003",0),
        (scene_prop_set_team, ":scp_instance_003", 0),
    (try_end),
(try_end),
(scene_prop_get_num_instances, ":scp_num_instances_004", "$g_destructible_target_2"),
(try_for_range, ":var005", 0, ":scp_num_instances_004"),
    (scene_prop_get_instance, ":scp_instance_006", "$g_destructible_target_2", ":var005"),
    (try_begin),
        (ge,":scp_instance_006",0),
        (scene_prop_set_team, ":scp_instance_006", 0),
    (try_end),
(try_end),
(try_begin),
    (eq,1,1),
    (scene_prop_get_num_instances, ":scp_num_instances_007", "spr_catapult_destructible"),
    (try_begin),
        (ge,":scp_num_instances_007",1),
        (scene_prop_get_instance, ":scp_instance_008", "spr_catapult_destructible", 0),
        (scene_prop_get_team, "$g_defender_team", ":scp_instance_008"),
    (else_try),
        (scene_prop_get_num_instances, ":scp_num_instances_009", "spr_trebuchet_destructible"),
        (try_begin),
            (ge,":scp_num_instances_009",1),
            (scene_prop_get_instance, ":scp_instance_010", "spr_trebuchet_destructible", 0),
            (scene_prop_get_team, "$g_defender_team", ":scp_instance_010"),
        (try_end),
    (try_end),
(try_end),
(assign,"$g_number_of_targets_destroyed",0),
(try_begin),
    (eq,1,1),
    (assign,"$g_multiplayer_num_bots_required_team_1","$g_multiplayer_num_bots_team_1"),
    (assign,"$g_multiplayer_num_bots_required_team_2","$g_multiplayer_num_bots_team_2"),
(try_end),
(start_presentation, "prsnt_multiplayer_destructible_targets_display"),
(assign,"$g_multiplayer_ready_for_spawning_agent",1),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_on_agent_spawn_common", ":var001"),
(try_begin),
    (lt,"$my_team_at_start_of_round",0),
    (multiplayer_get_my_player, ":my_player"),
    (try_begin),
        (ge,":my_player",0),
        (player_get_agent_id, ":agent_id_003", ":my_player"),
        (try_begin),
            (eq,":agent_id_003",":var001"),
            (ge,":agent_id_003",0),
            (agent_get_team, "$my_team_at_start_of_round", ":agent_id_003"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (neg|multiplayer_is_server),
    (try_begin),
        (eq,"$g_round_ended",1),
        (assign,"$g_round_ended",0),
        (call_script, "script_initialize_all_scene_prop_slots"),
        (call_script, "script_multiplayer_initialize_belfry_wheel_rotations"),
        (call_script, "script_initialize_objects_clients"),
        (start_presentation, "prsnt_multiplayer_destructible_targets_display"),
        (try_begin),
            (eq,"$g_team_balance_next_round",1),
            (assign,"$g_team_balance_next_round",0),
        (try_end),
    (try_end),
(try_end),
]),

(ti_on_agent_killed_or_wounded, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_on_agent_killed_or_wounded_common", ":var001", ":var002"),
(try_begin),
    (lt,"$my_team_at_start_of_round",0),
    (multiplayer_get_my_player, ":my_player"),
    (try_begin),
        (ge,":my_player",0),
        (player_get_agent_id, ":agent_id_004", ":my_player"),
        (try_begin),
            (ge,":agent_id_004",0),
            (agent_get_team, "$my_team_at_start_of_round", ":agent_id_004"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (agent_is_human,":var001"),
    (assign,":var005",0),
    (assign,":var006",0),
    (try_for_agents, ":cur_agent"),
        (try_begin),
            (agent_is_human,":cur_agent"),
            (try_begin),
                (agent_is_alive,":cur_agent"),
                (agent_get_team, ":agent_team_no_008", ":cur_agent"),
                (try_begin),
                    (eq,":agent_team_no_008",0),
                    (val_add, ":var005", 1),
                (else_try),
                    (eq,":agent_team_no_008",1),
                    (val_add, ":var006", 1),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,"$g_round_ended",0),
        (try_begin),
            (this_or_next|eq,":var005",0),
            (eq,":var006",0),
            (assign,"$g_winner_team",-1),
            (assign,reg0,"$g_multiplayer_respawn_period"),
            (try_begin),
                (eq,":var005",0),
                (try_begin),
                    (neq,":var006",0),
                    (assign,"$g_winner_team",1),
                (try_end),
                (try_begin),
                    (eq,"$g_winner_team",-1),
                (else_try),
                    (eq,"$g_defender_team",1),
                    (try_begin),
                        (neg|multiplayer_is_server),
                        (call_script, "script_calculate_number_of_targets_destroyed"),
                    (try_end),
                    (store_sub, ":var009", 2, "$g_number_of_targets_destroyed"),
                    (call_script, "script_show_multiplayer_message", 16, ":var009"),
                (else_try),
                    (call_script, "script_show_multiplayer_message", 17, 0),
                (try_end),
            (else_try),
                (try_begin),
                    (neq,":var005",0),
                    (assign,"$g_winner_team",0),
                (try_end),
                (try_begin),
                    (eq,"$g_winner_team",-1),
                (else_try),
                    (eq,"$g_defender_team",0),
                    (try_begin),
                        (neg|multiplayer_is_server),
                        (call_script, "script_calculate_number_of_targets_destroyed"),
                    (try_end),
                    (store_sub, ":var009", 2, "$g_number_of_targets_destroyed"),
                    (call_script, "script_show_multiplayer_message", 16, ":var009"),
                (else_try),
                    (call_script, "script_show_multiplayer_message", 17, 0),
                (try_end),
            (try_end),
            (store_mission_timer_a,"$g_round_finish_time"),
            (assign,"$g_round_ended",1),
            (try_begin),
                (multiplayer_is_server),
                (ge,"$g_winner_team",0),
                (lt,"$g_winner_team",2),
                (neq,"$g_winner_team",-1),
                (team_get_score, ":team_score_010", "$g_winner_team"),
                (store_sub, ":var011", 2, "$g_number_of_targets_destroyed"),
                (val_add, ":team_score_010", ":var011"),
                (call_script, "script_team_set_score", "$g_winner_team", ":team_score_010"),
                (get_max_players, ":max_players"),
                (try_for_range, ":player_id_013", 1, ":max_players"),
                    (try_begin),
                        (player_is_active, ":player_id_013"),
                        (multiplayer_send_2_int_to_player, ":player_id_013", 72, "$g_winner_team", ":team_score_010"),
                    (try_end),
                (try_end),
            (try_end),
            (try_begin),
                (neq,"$g_defender_team","$g_winner_team"),
                (neq,"$g_winner_team",-1),
                (assign,"$g_number_of_targets_destroyed",2),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (multiplayer_is_server),
    (agent_is_human,":var001"),
    (neg|agent_is_non_player, ":var001"),
    (ge,":var001",0),
    (agent_get_player_id,":agent_player_id_014",":var001"),
    (try_begin),
        (ge,":agent_player_id_014",0),
        (set_fixed_point_multiplier, 100),
        (agent_get_player_id,":agent_player_id_014",":var001"),
        (agent_get_position,pos0,":var001"),
        (position_get_x,":pos_x_015",0),
        (position_get_y,":pos_y_016",0),
        (position_get_z,":pos_z_017",0),
        (player_set_slot,":agent_player_id_014",29,":pos_x_015"),
        (player_set_slot,":agent_player_id_014",30,":pos_y_016"),
        (player_set_slot,":agent_player_id_014",31,":pos_z_017"),
    (try_end),
(try_end),
]),

(ti_on_multiplayer_mission_end, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_event_mission_end"),
(assign,"$g_multiplayer_stats_chart_opened_manually",0),
(start_presentation, "prsnt_multiplayer_stats_chart"),
]),

(1.0, 0.0, 0.0, [
(multiplayer_is_server),
(eq,"$g_round_ended",0),
(eq,"$g_number_of_targets_destroyed",2),
], [
(store_mission_timer_a,"$g_round_finish_time"),
(assign,"$g_round_ended",1),
(multiplayer_get_my_player, ":my_player"),
(call_script, "script_draw_this_round", -9),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_003", 1, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_003"),
        (neq,":player_id_003",":my_player"),
        (multiplayer_send_int_to_player, ":player_id_003", 69, -9),
    (try_end),
(try_end),
]),

(1.0, 0.0, 0.0, [
(multiplayer_is_server),
(eq,"$g_round_ended",0),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (ge,":var002","$g_multiplayer_round_max_seconds"),
    (store_sub, ":var002", ":m_timer_a_001", "$g_round_start_time"),
(try_end),
], [
(store_mission_timer_a,"$g_round_finish_time"),
(assign,"$g_round_ended",1),
(assign,"$g_winner_team",-9),
(multiplayer_get_my_player, ":m_timer_a_001"),
(store_sub, ":var002", 2, "$g_number_of_targets_destroyed"),
(call_script, "script_show_multiplayer_message", 16, ":var002"),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_004", 1, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_004"),
        (multiplayer_send_2_int_to_player, ":player_id_004", 68, 16, ":var002"),
    (try_end),
(try_end),
(call_script, "script_draw_this_round", "$g_winner_team"),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_004", 1, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_004"),
        (neq,":player_id_004",":m_timer_a_001"),
        (multiplayer_send_int_to_player, ":player_id_004", 69, "$g_winner_team"),
    (try_end),
(try_end),
(try_begin),
    (multiplayer_is_server),
    (assign,"$g_winner_team","$g_defender_team"),
    (team_get_score, ":team_score_005", "$g_winner_team"),
    (store_sub, ":var006", 2, "$g_number_of_targets_destroyed"),
    (val_add, ":team_score_005", ":var006"),
    (call_script, "script_team_set_score", "$g_winner_team", ":team_score_005"),
    (try_for_range, ":player_id_004", 1, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_004"),
            (multiplayer_send_2_int_to_player, ":player_id_004", 72, "$g_winner_team", ":team_score_005"),
        (try_end),
    (try_end),
(try_end),
]),

(10.0, 0.0, 0.0, [
(multiplayer_is_server),
], [
(assign,":var001",0),
(assign,":var002",0),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_004", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_004"),
        (player_get_team_no,  ":team_no_005", ":player_id_004"),
        (try_begin),
            (eq,":team_no_005",0),
            (val_add, ":var001", 1),
        (else_try),
            (eq,":team_no_005",1),
            (val_add, ":var002", 1),
        (try_end),
    (try_end),
(try_end),
(store_sub, ":var006", ":var001", ":var002"),
(assign,":var007",0),
(try_begin),
    (eq,1,1),
    (try_begin),
        (eq,1,1),
        (store_mul, ":var008", "$g_multiplayer_auto_team_balance_limit", -1),
        (try_begin),
            (le,":var006",":var008"),
            (store_div, ":var___x1", ":var006", -2),
            (assign,":var007",":var___x1"),
        (else_try),
            (ge,":var006","$g_multiplayer_auto_team_balance_limit"),
            (store_div, ":var___x1", ":var006", 2),
            (assign,":var007",":var___x1"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (gt,":var007",0),
    (try_begin),
        (eq,"$g_team_balance_next_round",0),
        (assign,"$g_team_balance_next_round",1),
        (call_script, "script_show_multiplayer_message", 3, 0),
        (get_max_players, ":max_players"),
        (try_for_range, ":player_id_009", 1, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_009"),
                (multiplayer_send_int_to_player, ":player_id_009", 68, 3),
            (try_end),
        (try_end),
        (call_script, "script_warn_player_about_auto_team_balance"),
    (try_end),
(try_end),
]),

(0.0, 0.0, 0.0, [
(multiplayer_is_server),
(eq,"$g_round_ended",0),
(eq,"$g_battle_death_mode_started",2),
], [
(set_fixed_point_multiplier, 100),
(scene_prop_get_instance, ":scp_instance_001", "spr_headquarters_pole_code_only", 0),
(scene_prop_get_instance, ":scp_instance_002", "spr_headquarters_pole_code_only", 1),
(scene_prop_get_instance, ":scp_instance_003", "$team_1_flag_scene_prop", 0),
(scene_prop_get_instance, ":scp_instance_004", "$team_2_flag_scene_prop", 0),
(prop_instance_get_position, pos1, ":scp_instance_001"),
(prop_instance_get_position, pos2, ":scp_instance_002"),
(prop_instance_get_position, pos3, ":scp_instance_003"),
(prop_instance_get_position, pos4, ":scp_instance_004"),
(copy_position,7,1),
(position_move_z,7,100),
(copy_position,8,2),
(position_move_z,8,100),
(get_distance_between_positions,":distance_005",1,3),
(get_distance_between_positions,":distance_006",2,4),
(assign,":var007",0),
(assign,":var008",0),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_010", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_010"),
        (player_get_agent_id, ":agent_id_011", ":player_id_010"),
        (try_begin),
            (ge,":agent_id_011",0),
            (agent_is_human,":agent_id_011"),
            (agent_is_alive,":agent_id_011"),
            (agent_get_team, ":agent_team_no_012", ":agent_id_011"),
            (agent_get_position,pos0,":agent_id_011"),
            (agent_get_horse,":agent_horse_013",":agent_id_011"),
            (try_begin),
                (eq,":agent_horse_013",-1),
                (try_begin),
                    (eq,":agent_team_no_012",0),
                    (try_begin),
                        (eq,1,1),
                        (get_sq_distance_between_positions,":sq_distance_014",0,1),
                        (try_begin),
                            (lt,":sq_distance_014",1600),
                            (try_begin),
                                (eq,":var007",0),
                                (assign,":var007",1),
                            (else_try),
                                (eq,":var007",-1),
                                (assign,":var007",-2),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (eq,1,1),
            (get_sq_distance_between_positions,":sq_distance_014",0,2),
            (try_begin),
                (lt,":sq_distance_014",1600),
                (try_begin),
                    (eq,":var008",0),
                    (assign,":var008",-1),
                (else_try),
                    (eq,":var008",1),
                    (assign,":var008",-2),
                (try_end),
            (try_end),
        (try_end),
    (else_try),
        (eq,":agent_team_no_012",1),
        (try_begin),
            (eq,1,1),
            (get_sq_distance_between_positions,":sq_distance_014",0,2),
            (try_begin),
                (lt,":sq_distance_014",1600),
                (try_begin),
                    (eq,":var008",0),
                    (assign,":var008",1),
                (else_try),
                    (assign,":var008",-2),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (eq,1,1),
            (get_sq_distance_between_positions,":sq_distance_014",0,1),
            (try_begin),
                (lt,":sq_distance_014",1600),
                (try_begin),
                    (eq,":var007",0),
                    (assign,":var007",-1),
                (else_try),
                    (eq,":var007",1),
                    (assign,":var007",-2),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (ge,":distance_005",800),
    (assign,"$g_winner_team",0),
    (get_max_players, ":max_players"),
    (call_script, "script_draw_this_round", "$g_winner_team"),
    (try_for_range, ":player_id_010", 1, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_010"),
            (multiplayer_send_int_to_player, ":player_id_010", 69, "$g_winner_team"),
        (try_end),
    (try_end),
    (team_get_score, ":team_score_015", 0),
    (call_script, "script_team_set_score", 0, ":team_score_015"),
    (try_for_range, ":player_id_010", 1, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_010"),
            (multiplayer_send_2_int_to_player, ":player_id_010", 72, 0, ":team_score_015"),
        (try_end),
    (try_end),
    (store_mission_timer_a,"$g_round_finish_time"),
    (assign,"$g_round_ended",1),
(else_try),
    (ge,":distance_006",800),
    (assign,"$g_winner_team",1),
    (get_max_players, ":max_players"),
    (call_script, "script_draw_this_round", "$g_winner_team"),
    (try_for_range, ":player_id_010", 1, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_010"),
            (multiplayer_send_int_to_player, ":player_id_010", 69, "$g_winner_team"),
        (try_end),
    (try_end),
    (team_get_score, ":team_score_016", 1),
    (call_script, "script_team_set_score", 1, ":team_score_016"),
    (try_for_range, ":player_id_010", 1, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_010"),
            (multiplayer_send_2_int_to_player, ":player_id_010", 72, 1, ":team_score_016"),
        (try_end),
    (try_end),
    (call_script, "script_show_multiplayer_message", 12, 0),
    (call_script, "script_check_achievement_last_man_standing", "$g_winner_team"),
    (store_mission_timer_a,"$g_round_finish_time"),
    (assign,"$g_round_ended",1),
(try_end),
(try_begin),
    (eq,"$g_round_ended",0),
    (position_get_z,":pos_z_017",3),
    (prop_instance_is_animating, ":var018", ":scp_instance_003"),
    (try_begin),
        (eq,":var007",-2),
        (eq,":var018",1),
        (prop_instance_stop_animating, ":scp_instance_003"),
    (else_try),
        (this_or_next|eq,":var007",-1),
        (eq,":var007",0),
        (prop_instance_get_animation_target_position, pos9, ":scp_instance_003"),
        (position_get_z,":pos_z_019",9),
        (try_begin),
            (this_or_next|eq,":var018",0),
            (gt,":pos_z_019",":pos_z_017"),
            (get_distance_between_positions,":distance_020",3,7),
            (try_begin),
                (gt,":distance_020",0),
                (val_mul, ":distance_020", 16),
                (prop_instance_animate_to_position, ":scp_instance_003", 7, ":distance_020"),
            (else_try),
                (eq,":var007",1),
                (prop_instance_get_animation_target_position, pos9, ":scp_instance_003"),
                (position_get_z,":pos_z_019",9),
                (try_begin),
                    (this_or_next|eq,":var018",0),
                    (lt,":pos_z_019",":pos_z_017"),
                    (copy_position,5,1),
                    (position_move_z,5,800),
                    (get_distance_between_positions,":distance_020",3,5),
                    (try_begin),
                        (gt,":distance_020",0),
                        (val_mul, ":distance_020", 8),
                        (prop_instance_animate_to_position, ":scp_instance_003", 5, ":distance_020"),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (position_get_z,":pos_z_021",4),
    (prop_instance_is_animating, ":var018", ":scp_instance_004"),
    (try_begin),
        (eq,":var008",-2),
        (eq,":var018",1),
        (prop_instance_stop_animating, ":scp_instance_004"),
    (else_try),
        (this_or_next|eq,":var008",-1),
        (eq,":var008",0),
        (prop_instance_get_animation_target_position, pos9, ":scp_instance_004"),
        (position_get_z,":pos_z_022",9),
        (try_begin),
            (this_or_next|eq,":var018",0),
            (gt,":pos_z_022",":pos_z_021"),
            (get_distance_between_positions,":distance_023",4,8),
            (try_begin),
                (gt,":distance_023",0),
                (val_mul, ":distance_023", 16),
                (prop_instance_animate_to_position, ":scp_instance_004", 8, ":distance_023"),
            (else_try),
                (eq,":var008",1),
                (prop_instance_get_animation_target_position, pos9, ":scp_instance_004"),
                (position_get_z,":pos_z_022",9),
                (try_begin),
                    (this_or_next|eq,":var018",0),
                    (lt,":pos_z_022",":pos_z_021"),
                    (copy_position,6,2),
                    (position_move_z,6,800),
                    (get_distance_between_positions,":distance_023",4,6),
                    (try_begin),
                        (gt,":distance_023",0),
                        (val_mul, ":distance_023", 8),
                        (prop_instance_animate_to_position, ":scp_instance_004", 6, ":distance_023"),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, 0.0, 3.0, [
(multiplayer_is_server),
(eq,"$g_round_ended",1),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (ge,":m_timer_a_001","$g_multiplayer_respawn_period"),
    (val_sub, ":m_timer_a_001", "$g_round_finish_time"),
(try_end),
], [
(assign,":m_timer_a_001",0),
(assign,":var002",0),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_004", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_004"),
        (player_get_team_no,  ":team_no_005", ":player_id_004"),
        (try_begin),
            (eq,":team_no_005",0),
            (val_add, ":m_timer_a_001", 1),
        (else_try),
            (eq,":team_no_005",1),
            (val_add, ":var002", 1),
        (try_end),
    (try_end),
(try_end),
(store_sub, ":var006", ":m_timer_a_001", ":var002"),
(assign,":var007",0),
(try_begin),
    (eq,1,1),
    (try_begin),
        (eq,1,1),
        (store_mul, ":var008", "$g_multiplayer_auto_team_balance_limit", -1),
        (try_begin),
            (le,":var006",":var008"),
            (store_div, ":var___x1", ":var006", -2),
            (assign,":var007",":var___x1"),
            (assign,":var009",1),
            (assign,":team_no_010",0),
        (else_try),
            (ge,":var006","$g_multiplayer_auto_team_balance_limit"),
            (store_div, ":var___x1", ":var006", 2),
            (assign,":var007",":var___x1"),
            (assign,":var009",0),
            (assign,":team_no_010",1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (gt,":var007",0),
    (try_begin),
        (eq,1,1),
        (try_for_range, ":var011", 0, ":var007"),
            (assign,":var012",0),
            (assign,":player_id_013",-1),
            (get_max_players, ":max_players"),
            (try_for_range, ":player_id_014", 0, ":max_players"),
                (try_begin),
                    (player_is_active, ":player_id_014"),
                    (player_get_team_no,  ":team_no_005", ":player_id_014"),
                    (try_begin),
                        (eq,":team_no_005",":var009"),
                        (player_get_slot,":player_slot_015",":player_id_014",21),
                        (try_begin),
                            (gt,":player_slot_015",":var012"),
                            (assign,":var012",":player_slot_015"),
                            (assign,":player_id_013",":player_id_014"),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
            (try_begin),
                (ge,":player_id_013",0),
                (try_begin),
                    (eq,1,1),
                    (player_get_agent_id, ":agent_id_016", ":player_id_013"),
                    (try_begin),
                        (ge,":agent_id_016",0),
                        (agent_is_alive,":agent_id_016"),
                        (player_get_kill_count, ":kill_count_017", ":player_id_013"),
                        (val_add, ":kill_count_017", 1),
                        (call_script, "script_player_set_kill_count", ":player_id_013", ":kill_count_017"),
                        (player_get_death_count, ":death_count_018", ":player_id_013"),
                        (val_sub, ":death_count_018", 1),
                        (call_script, "script_player_set_death_count", ":player_id_013", ":death_count_018"),
                        (player_get_score, ":score_019", ":player_id_013"),
                        (val_add, ":score_019", 1),
                        (call_script, "script_player_set_score", ":player_id_013", ":score_019"),
                        (try_for_range, ":player_id_014", 1, ":max_players"),
                            (try_begin),
                                (player_is_active, ":player_id_014"),
                                (multiplayer_send_4_int_to_player, ":player_id_014", 86, ":player_id_013", ":score_019", ":kill_count_017", ":death_count_018"),
                            (try_end),
                        (try_end),
                    (try_end),
                    (player_get_value_of_original_items, ":player_id_013"),
                    (player_get_gold, ":gold_021", ":player_id_013"),
                    (val_add, ":gold_021", ":player_slot_020"),
                    (player_set_gold, ":player_id_013", ":gold_021", 15000),
                (try_end),
                (player_set_troop_id, ":player_id_013", -1),
                (player_get_team_no,  ":player_id_013", ":team_no_010"),
                (multiplayer_send_message_to_player, ":player_id_013", 79),
            (try_end),
        (try_end),
        (call_script, "script_show_multiplayer_message", 2, 0),
        (multiplayer_get_my_player, ":my_player"),
        (get_max_players, ":max_players"),
        (try_for_range, ":player_id_014", 0, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_014"),
                (neq,":my_player",":player_id_014"),
                (multiplayer_send_int_to_player, ":player_id_014", 68, 2),
            (try_end),
        (try_end),
        (assign,"$g_team_balance_next_round",0),
    (try_end),
(try_end),
(assign,"$g_team_balance_next_round",0),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_014", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_014"),
        (player_get_agent_id, ":agent_id_023", ":player_id_014"),
        (try_begin),
            (ge,":agent_id_023",0),
            (agent_is_alive,":agent_id_023"),
            (player_save_picked_up_items_for_next_spawn, ":player_id_014"),
            (player_get_value_of_original_items, ":player_id_014"),
            (player_set_slot,":player_id_014",1,":player_slot_020"),
        (try_end),
    (try_end),
(try_end),
(assign,":var024",500),
(val_mul, ":var024", "$g_multiplayer_round_earnings_multiplier"),
(val_div, ":var024", 100),
(store_sub, ":var025", 2, "$g_number_of_targets_destroyed"),
(store_mul, ":var026", ":var025", 100),
(store_mul, ":var027", "$g_number_of_targets_destroyed", 100),
(val_add, ":var026", 100),
(val_sub, ":var027", 100),
(get_max_players, ":max_players"),
(val_mul, ":var026", "$g_multiplayer_round_earnings_multiplier"),
(val_div, ":var026", 100),
(val_mul, ":var027", "$g_multiplayer_round_earnings_multiplier"),
(val_div, ":var027", 100),
(try_for_range, ":player_id_014", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_014"),
        (player_slot_eq,":player_id_014",0,1),
        (player_get_gold, ":gold_021", ":player_id_014"),
        (player_get_team_no,  ":team_no_005", ":player_id_014"),
        (val_add, ":gold_021", ":var024"),
        (try_begin),
            (eq,":team_no_005","$g_defender_team"),
            (val_add, ":gold_021", ":var026"),
        (else_try),
            (val_add, ":gold_021", ":var027"),
        (try_end),
    (try_end),
    (try_begin),
        (eq,1,1),
        (player_get_slot,":player_slot_020",":player_id_014",1),
        (store_add, ":var028", ":gold_021", ":player_slot_020"),
        (store_mul, ":var029", "$g_multiplayer_initial_gold_multiplier", 10),
        (try_begin),
            (lt,":var028",":var029"),
            (store_sub, ":var030", ":var029", ":var028"),
            (val_add, ":gold_021", ":var030"),
        (try_end),
    (try_end),
    (player_set_gold, ":player_id_014", ":gold_021", 15000),
(try_end),
(try_for_range, ":player_id_014", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_014"),
        (player_set_slot,":player_id_014",0,0),
    (try_end),
(try_end),
(assign,"$my_team_at_start_of_round",-1),
(multiplayer_clear_scene),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_014", 1, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_014"),
        (player_set_slot,":player_id_014",32,0),
        (player_set_slot,":player_id_014",33,0),
    (try_end),
(try_end),
(call_script, "script_multiplayer_initialize_belfry_wheel_rotations"),
(call_script, "script_multiplayer_close_gate_if_it_is_open"),
(call_script, "script_multiplayer_move_moveable_objects_initial_positions"),
(assign,"$g_round_ended",0),
(assign,"$g_multiplayer_num_bots_required_team_1","$g_multiplayer_num_bots_team_1"),
(assign,"$g_multiplayer_num_bots_required_team_2","$g_multiplayer_num_bots_team_2"),
(start_presentation, "prsnt_multiplayer_destructible_targets_display"),
(call_script, "script_initialize_objects"),
(store_mission_timer_a,"$g_round_start_time"),
(call_script, "script_initialize_all_scene_prop_slots"),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_014", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_014"),
        (multiplayer_send_int_to_player, ":player_id_014", 78, -9999),
    (try_end),
(try_end),
]),

(0.0, 0.0, 0.0, [
], [
(assign,":var001","$g_multiplayer_num_bots_team_1"),
(assign,":var002","$g_multiplayer_num_bots_team_2"),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_004", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_004"),
        (player_get_team_no,  ":team_no_005", ":player_id_004"),
        (try_begin),
            (eq,":team_no_005",0),
            (val_add, ":var001", 1),
        (else_try),
            (eq,":team_no_005",1),
            (val_add, ":var002", 1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (this_or_next|eq,":var001",0),
    (eq,":var002",0),
    (store_mission_timer_a,":m_timer_a_006"),
    (val_sub, ":m_timer_a_006", "$g_round_start_time"),
    (try_begin),
        (le,":m_timer_a_006",2),
        (store_mission_timer_a,"$g_round_start_time"),
    (try_end),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (get_max_players, ":max_players"),
    (try_for_range, ":player_id_002", 0, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_002"),
            (neg|player_is_busy_with_menus, ":player_id_002"),
            (try_begin),
                (player_slot_eq,":player_id_002",0,0),
                (player_get_team_no,  ":team_no_003", ":player_id_002"),
                (try_begin),
                    (lt,":team_no_003",2),
                    (player_get_troop_id, ":troop_id_004", ":player_id_002"),
                    (try_begin),
                        (ge,":troop_id_004",0),
                        (assign,":var005",0),
                        (assign,":var006",0),
                        (assign,":var007",0),
                        (try_begin),
                            (eq,1,1),
                            (assign,":var008",0),
                            (get_max_players, ":max_players"),
                            (try_for_range, ":player_id_009", 0, ":max_players"),
                                (try_begin),
                                    (player_is_active, ":player_id_009"),
                                    (val_add, ":var008", 1),
                                    (player_get_team_no,  ":team_no_010", ":player_id_009"),
                                    (try_begin),
                                        (eq,":team_no_010",0),
                                        (val_add, ":var006", 1),
                                    (else_try),
                                        (eq,":team_no_010",1),
                                        (val_add, ":var007", 1),
                                    (try_end),
                                (try_end),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
                (store_mul, ":var011", ":var006", ":var007"),
                (store_mission_timer_a,":m_timer_a_012"),
                (val_sub, ":m_timer_a_012", "$g_round_start_time"),
                (try_begin),
                    (this_or_next|ge,":m_timer_a_012",30),
                    (this_or_next|gt,":var008",2),
                    (eq,":var011",0),
                    (eq,"$g_round_ended",0),
                    (assign,":var005",1),
                (try_end),
            (try_end),
            (try_begin),
                (eq,":var005",1),
                (try_begin),
                    (eq,":team_no_003",0),
                    (assign,":entry_point_013",0),
                (else_try),
                    (eq,":team_no_003",1),
                    (assign,":entry_point_013",32),
                (try_end),
            (try_end),
            (call_script, "script_multiplayer_buy_agent_equipment", ":player_id_002"),
            (player_spawn_new_agent, ":player_id_002", ":entry_point_013"),
            (player_set_slot,":player_id_002",0,1),
        (else_try),
            (eq,"$g_multiplayer_player_respawn_as_bot",1),
            (player_get_agent_id, ":agent_id_014", ":player_id_002"),
            (try_begin),
                (ge,":agent_id_014",0),
                (neg|agent_is_alive,":agent_id_014"),
                (agent_get_time_elapsed_since_removed, ":agent_time_since_removed_015", ":agent_id_014"),
                (try_begin),
                    (gt,":agent_time_since_removed_015","$g_multiplayer_respawn_period"),
                    (player_get_team_no,  ":team_no_003", ":player_id_002"),
                    (assign,":var016",0),
                    (try_for_agents, ":cur_agent"),
                        (try_begin),
                            (eq,":var016",0),
                            (agent_is_alive,":cur_agent"),
                            (agent_is_human,":cur_agent"),
                            (agent_is_non_player, ":cur_agent"),
                            (agent_get_team, ":agent_team_no_018", ":cur_agent"),
                            (try_begin),
                                (eq,":agent_team_no_018",":team_no_003"),
                                (assign,":var016",1),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
            (try_begin),
                (eq,":var016",1),
                (call_script, "script_find_most_suitable_bot_to_control", ":player_id_002"),
                (player_control_agent, ":player_id_002", reg0),
                (player_get_slot,":player_slot_019",":player_id_002",0),
                (val_add, ":player_slot_019", 1),
                (player_set_slot,":player_id_002",0,":player_slot_019"),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (eq,"$g_multiplayer_ready_for_spawning_agent",1),
    (store_add, ":var001", "$g_multiplayer_num_bots_required_team_1", "$g_multiplayer_num_bots_required_team_2"),
    (try_begin),
        (gt,":var001",0),
        (try_begin),
            (this_or_next|eq,"$g_multiplayer_game_type",6),
            (this_or_next|eq,"$g_multiplayer_game_type",3),
            (eq,"$g_multiplayer_game_type",2),
            (team_get_score, ":team_score_002", 0),
            (team_get_score, ":team_score_003", 1),
            (store_add, ":var004", ":team_score_002", ":team_score_003"),
            (try_begin),
                (eq,":var004",0),
                (store_mission_timer_a,":m_timer_a_005"),
                (val_sub, ":m_timer_a_005", "$g_round_start_time"),
                (try_begin),
                    (lt,":m_timer_a_005",20),
                    (assign,":var006",0),
                (else_try),
                    (assign,":var006",1),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var006",1),
        (store_random_in_range,":random_x_007",0,":var001"),
        (val_sub, ":random_x_007", "$g_multiplayer_num_bots_required_team_1"),
        (try_begin),
            (lt,":random_x_007",0),
            (assign,":team_id_008",0),
        (else_try),
            (assign,":team_id_008",1),
        (try_end),
    (try_end),
    (try_begin),
        (this_or_next|eq,"$g_multiplayer_game_type",6),
        (this_or_next|eq,"$g_multiplayer_game_type",3),
        (eq,"$g_multiplayer_game_type",2),
        (store_mission_timer_a,":m_timer_a_005"),
        (val_sub, ":m_timer_a_005", "$g_round_start_time"),
        (try_begin),
            (le,":m_timer_a_005",20),
            (assign,":var009",0),
        (else_try),
            (assign,":var009",1),
        (try_end),
    (else_try),
        (assign,":var009",1),
    (try_end),
    (call_script, "script_multiplayer_find_bot_troop_and_group_for_spawn", ":team_id_008", ":var009"),
    (assign,":troop_id_010",reg0),
    (assign,":group_no_011",reg1),
    (team_get_faction, ":team_faction_012", ":team_id_008"),
    (assign,":var013",0),
    (try_for_range, ":trp_014", "trp_swadian_crossbowman_multiplayer_ai", "trp_swadian_crossbowman_multiplayer"),
        (store_troop_faction,":troop_faction_015",":trp_014"),
        (try_begin),
            (eq,":troop_faction_015",":team_faction_012"),
            (val_add, ":var013", 1),
        (try_end),
    (try_end),
    (assign,":var016",0),
    (get_max_players, ":max_players"),
    (try_for_range, ":player_id_018", 0, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_018"),
            (player_get_team_no,  ":team_no_019", ":player_id_018"),
            (try_begin),
                (eq,":team_id_008",":team_no_019"),
                (assign,":var020",0),
                (store_add, ":var021", 35, ":var013"),
                (try_for_range, ":var022", 35, ":var021"),
                    (try_begin),
                        (player_slot_ge,":player_id_018",":var022",1),
                        (assign,":var020",1),
                        (assign,":var021",0),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (ge,":var020",1),
            (val_add, ":var016", 1),
        (try_end),
    (try_end),
    (try_begin),
        (this_or_next|ge,":group_no_011",0),
        (eq,":var016",0),
        (troop_get_inventory_slot,":troop_inv_slot_023",":troop_id_010",8),
        (try_begin),
            (ge,":troop_inv_slot_023",0),
            (assign,":var024",1),
        (else_try),
            (assign,":var024",0),
        (try_end),
        (try_begin),
            (eq,"$g_multiplayer_game_type",6),
            (store_mission_timer_a,":m_timer_a_005"),
            (val_sub, ":m_timer_a_005", "$g_round_start_time"),
            (try_begin),
                (lt,":m_timer_a_005",20),
                (try_begin),
                    (eq,":team_id_008",0),
                    (call_script, "script_multiplayer_find_spawn_point", ":team_id_008", 1, ":var024"),
                (else_try),
                    (assign,reg0,32),
                (try_end),
            (else_try),
                (call_script, "script_multiplayer_find_spawn_point", ":team_id_008", 0, ":var024"),
            (try_end),
        (else_try),
            (this_or_next|eq,"$g_multiplayer_game_type",3),
            (eq,"$g_multiplayer_game_type",2),
            (try_begin),
                (eq,":team_id_008",0),
                (assign,reg0,0),
            (else_try),
                (assign,reg0,32),
            (try_end),
        (else_try),
            (call_script, "script_multiplayer_find_spawn_point", ":team_id_008", 0, ":var024"),
        (try_end),
        (store_current_scene,":cur_scene_025"),
        (modify_visitors_at_site,":cur_scene_025"),
        (add_visitors_to_current_scene,reg0,":troop_id_010",1, ":team_id_008", ":group_no_011"),
        (assign,"$g_multiplayer_ready_for_spawning_agent",0),
        (try_begin),
            (eq,":team_id_008",0),
            (val_sub, "$g_multiplayer_num_bots_required_team_1", 1),
        (else_try),
            (eq,":team_id_008",1),
            (val_sub, "$g_multiplayer_num_bots_required_team_2", 1),
        (try_end),
    (try_end),
(try_end),
]),

(3.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (try_for_agents, ":cur_agent"),
        (try_begin),
            (agent_is_non_player, ":cur_agent"),
            (agent_is_human,":cur_agent"),
            (agent_is_alive,":cur_agent"),
            (agent_get_group, ":agent_group_002", ":cur_agent"),
            (try_begin),
                (neg|player_is_active, ":agent_group_002"),
                (call_script, "script_multiplayer_change_leader_of_bot", ":cur_agent"),
            (else_try),
                (player_get_team_no,  ":team_no_003", ":agent_group_002"),
                (agent_get_team, ":agent_team_no_004", ":cur_agent"),
                (try_begin),
                    (neq,":team_no_003",":agent_team_no_004"),
                    (call_script, "script_multiplayer_change_leader_of_bot", ":cur_agent"),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (assign,":var001",0),
    (try_begin),
        (eq,"$g_multiplayer_game_type",8),
        (try_begin),
            (eq,"$g_round_ended",1),
            (assign,":var001",1),
        (try_end),
    (try_end),
(else_try),
    (this_or_next|eq,"$g_multiplayer_game_type",6),
    (this_or_next|eq,"$g_multiplayer_game_type",3),
    (eq,"$g_multiplayer_game_type",2),
    (try_begin),
        (eq,"$g_round_ended",1),
        (store_mission_timer_a,":m_timer_a_002"),
        (val_sub, ":m_timer_a_002", "$g_round_finish_time"),
        (store_sub, ":var003", "$g_multiplayer_respawn_period", 1),
        (try_begin),
            (ge,":m_timer_a_002",":var003"),
            (store_mission_timer_a,":m_timer_a_004"),
            (try_begin),
                (this_or_next|eq,"$g_multiplayer_game_type",3),
                (eq,"$g_multiplayer_game_type",2),
                (assign,":var005",90),
            (else_try),
                (assign,":var005",120),
            (try_end),
        (try_end),
        (store_mul, ":var006", "$g_multiplayer_game_max_minutes", 60),
        (store_sub, ":var007", ":var006", ":var005"),
        (try_begin),
            (gt,":m_timer_a_004",":var007"),
            (assign,":var001",1),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var001",1),
    (else_try),
        (neq,"$g_multiplayer_game_type",2),
        (neq,"$g_multiplayer_game_type",3),
        (neq,"$g_multiplayer_game_type",6),
        (neq,"$g_multiplayer_game_type",5),
        (store_mission_timer_a,":m_timer_a_004"),
        (store_mul, ":var006", "$g_multiplayer_game_max_minutes", 60),
        (try_begin),
            (gt,":m_timer_a_004",":var006"),
            (assign,":var001",1),
        (else_try),
            (team_get_score, ":team_score_008", 0),
            (team_get_score, ":team_score_009", 1),
            (try_begin),
                (neq,"$g_multiplayer_game_type",5),
                (try_begin),
                    (this_or_next|ge,":team_score_008","$g_multiplayer_game_max_points"),
                    (ge,":team_score_009","$g_multiplayer_game_max_points"),
                    (assign,":var001",1),
                (try_end),
            (try_end),
        (try_end),
    (else_try),
        (assign,":var010",0),
        (get_max_players, ":max_players"),
        (try_for_range, ":player_id_012", 0, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_012"),
                (player_get_agent_id, ":agent_id_013", ":player_id_012"),
                (try_begin),
                    (ge,":agent_id_013",0),
                    (neg|agent_is_non_player, ":agent_id_013"),
                    (assign,":var010",1),
                    (assign,":max_players",0),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (eq,":var010",1),
            (this_or_next|gt,":team_score_008",0),
            (le,":team_score_009",0),
            (assign,":var001",1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,":var001",1),
    (call_script, "script_game_multiplayer_get_game_type_mission_template", "$g_multiplayer_game_type"),
    (start_multiplayer_mission, reg0, "$g_multiplayer_selected_map", 0),
    (call_script, "script_game_set_multiplayer_mission_end"),
(try_end),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_multiplayer_mission_end_screen",0),
    (assign,"$g_multiplayer_stats_chart_opened_manually",1),
    (start_presentation, "prsnt_multiplayer_stats_chart"),
(try_end),
]),

(0.0, 0.0, ti_once, [
], [
(start_presentation, "prsnt_multiplayer_welcome_message"),
]),

(ti_battle_window_opened, 0.0, 0.0, [
], [
(start_presentation, "prsnt_multiplayer_round_time_counter"),
(start_presentation, "prsnt_multiplayer_team_score_display"),
]),

(ti_escape_pressed, 0.0, 0.0, [
], [
(try_begin),
    (neg|is_presentation_active, "prsnt_multiplayer_escape_menu"),
    (neg|is_presentation_active, "prsnt_multiplayer_stats_chart"),
    (eq,"$g_waiting_for_confirmation_to_terminate",0),
    (start_presentation, "prsnt_multiplayer_escape_menu"),
(try_end),
]),

]),
("multiplayer_ccoop", mtf_battle_mode, -1,
"You lead your men to battle.",
[(0, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(1, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(2, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(3, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(4, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(5, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(6, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(7, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(8, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(9, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(10, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(11, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(12, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(13, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(14, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(15, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(16, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(17, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(18, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(19, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(20, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(21, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(22, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(23, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(24, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(25, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(26, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(27, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(28, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(29, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(30, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(31, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(32, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(33, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(34, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(35, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(36, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(37, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(38, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(39, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(40, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(41, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(42, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(43, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(44, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(45, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(46, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(47, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(48, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(49, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(50, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(51, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(52, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(53, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(54, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(55, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(56, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(57, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(58, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(59, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(60, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(61, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(62, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(63, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(64, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(65, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(66, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(67, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(68, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(69, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(70, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(71, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(72, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(73, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(74, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(75, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(76, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(77, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(78, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(79, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(80, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(81, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(82, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(83, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(84, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(85, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(86, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(87, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
],
[
(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(1.0, 5.0, 0.0, [
(multiplayer_is_server),
(eq,"$g_multiplayer_poll_running",1),
(eq,"$g_multiplayer_poll_ended",0),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (this_or_next|eq,":var002","$g_multiplayer_poll_num_sent"),
    (gt,":m_timer_a_001","$g_multiplayer_poll_end_time"),
    (call_script, "script_cf_multiplayer_evaluate_poll"),
    (store_add, ":var002", "$g_multiplayer_poll_no_count", "$g_multiplayer_poll_yes_count"),
(try_end),
], [
(assign,"$g_multiplayer_poll_running",0),
(try_begin),
    (this_or_next|eq,"$g_multiplayer_poll_to_show",3),
    (eq,"$g_multiplayer_poll_to_show",0),
    (call_script, "script_game_multiplayer_get_game_type_mission_template", "$g_multiplayer_game_type"),
    (start_multiplayer_mission, reg0, "$g_multiplayer_poll_value_to_show", 1),
    (call_script, "script_game_set_multiplayer_mission_end"),
(try_end),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_on_agent_spawn_common", ":var001"),
(agent_get_team, ":agent_team_no_002", ":var001"),
(try_begin),
    (multiplayer_is_server),
    (eq,":agent_team_no_002",1),
    (try_begin),
        (eq,"$g_multiplayer_ccoop_difficulty",0),
        (assign,":var003",50),
        (assign,":var004",50),
        (agent_set_max_hit_points,":var001",":var003"),
        (agent_set_damage_modifier, ":var001", ":var004"),
    (else_try),
        (ge,"$g_mp_coop_king_waves",1),
        (store_mul, ":var003", "$g_mp_coop_king_waves", 35),
        (val_add, ":var003", 100),
        (store_mul, ":var004", "$g_mp_coop_king_waves", 25),
        (val_add, ":var004", 100),
        (agent_set_max_hit_points,":var001",":var003"),
        (agent_set_damage_modifier, ":var001", ":var004"),
    (try_end),
(try_end),
(try_begin),
    (multiplayer_is_server),
    (eq,":agent_team_no_002",0),
    (agent_is_active,":var001"),
    (agent_is_alive,":var001"),
    (agent_is_non_player, ":var001"),
    (agent_get_group, ":agent_group_005", ":var001"),
    (try_begin),
        (player_is_active, ":agent_group_005"),
        (agent_get_troop_id,":troop_id_006", ":var001"),
        (try_begin),
            (eq,1,1),
            (troop_get_slot,":troop_slot_007",":troop_id_006",155),
            (try_begin),
                (gt,":troop_slot_007",0),
                (troop_add_item,":troop_id_006",":troop_slot_007"),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (call_script, "script_cf_multiplayer_upgrade_companion_equipment", ":var001"),
        (troop_get_type,":troop_type_008",":troop_id_006"),
        (try_begin),
            (eq,":troop_type_008",0),
            (assign,":var009","snd_ccoop_nobleman_taunt"),
            (val_add, ":var009", 20),
            (store_random_in_range,":random_x_010","snd_ccoop_spawn_companion_0",":var009"),
            (try_begin),
                (lt,":random_x_010","snd_ccoop_nobleman_taunt"),
                (agent_get_position,pos60,":var001"),
                (call_script, "script_multiplayer_server_play_sound_at_position", ":random_x_010"),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (multiplayer_is_server),
    (eq,":agent_team_no_002",0),
    (agent_is_active,":var001"),
    (agent_is_alive,":var001"),
    (agent_is_human,":var001"),
    (neg|agent_is_non_player, ":var001"),
    (agent_get_player_id,":agent_player_id_011",":var001"),
    (player_set_slot,":agent_player_id_011",42,1),
    (multiplayer_send_2_int_to_player, ":agent_player_id_011", 48, 1, 1),
(try_end),
]),

(ti_server_player_joined, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_player_joined_common", ":player_id_001"),
(player_set_slot,":player_id_001",24,-1),
(player_set_slot,":player_id_001",42,0),
(multiplayer_send_2_int_to_player, ":player_id_001", 48, 1, 0),
(call_script, "script_multiplayer_ccoop_send_troop_data_to_client", ":player_id_001"),
(try_begin),
    (gt,"$g_multiplayer_ccoop_game_started",0),
    (try_begin),
        (le,"$g_multiplayer_ccoop_enemy_respawn_secs",45),
        (multiplayer_send_3_int_to_player, ":player_id_001", 48, 3, "$g_multiplayer_ccoop_enemy_respawn_secs", "$g_multiplayer_ccoop_wave_no"),
    (else_try),
        (multiplayer_send_3_int_to_player, ":player_id_001", 48, 4, "$g_multiplayer_ccoop_enemy_respawn_secs", "$g_multiplayer_ccoop_wave_no"),
    (try_end),
(try_end),
(try_begin),
    (multiplayer_is_server),
    (try_for_range, ":slot_no_002", 47, 49),
        (player_set_slot,":player_id_001",":slot_no_002",0),
    (try_end),
    (try_for_range, ":slot_no_002", 50, 60),
        (player_set_slot,":player_id_001",":slot_no_002",0),
    (try_end),
(try_end),
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(assign,"$g_multiplayer_game_type",8),
(store_current_scene,":cur_scene_001"),
(scene_get_slot,"$g_ccoop_disallow_horses",":cur_scene_001",1),
(try_begin),
    (eq,"$g_ccoop_disallow_horses",1),
    (try_for_range, ":var002", 0, 100),
        (mission_tpl_entry_set_override_flags, "mt_multiplayer_ccoop", ":var002", 256),
    (try_end),
(else_try),
    (try_for_range, ":var002", 0, 100),
        (mission_tpl_entry_set_override_flags, "mt_multiplayer_ccoop", ":var002", 0),
    (try_end),
(try_end),
(call_script, "script_multiplayer_server_before_mission_start_common"),
(call_script, "script_multiplayer_init_mission_variables"),
(call_script, "script_multiplayer_remove_destroy_mod_targets"),
(call_script, "script_multiplayer_remove_headquarters_flags"),
]),

(ti_after_mission_start, 0.0, 0.0, [
], [
(set_spawn_effector_scene_prop_kind, 0, -1),
(set_spawn_effector_scene_prop_kind, 1, -1),
(call_script, "script_initialize_all_scene_prop_slots"),
(call_script, "script_multiplayer_move_moveable_objects_initial_positions"),
(store_random_in_range,"$g_presentation_obj_coop_companion_0","trp_npc1_1","trp_npc1_2"),
(store_random_in_range,"$g_presentation_obj_coop_companion_1","trp_npc1_1","trp_npc1_2"),
(try_begin),
    (eq,"$g_presentation_obj_coop_companion_1","$g_presentation_obj_coop_companion_0"),
    (val_add, "$g_presentation_obj_coop_companion_1", 1),
(try_end),
(try_begin),
    (ge,"$g_presentation_obj_coop_companion_1","trp_npc1_2"),
    (assign,"$g_presentation_obj_coop_companion_1","trp_npc1_1"),
(try_end),
(store_sub, ":var001", "$g_presentation_obj_coop_companion_0", "trp_npc1_1"),
(assign,":var001 +","trp_npc1_1"),
(assign,"$g_presentation_obj_coop_companion_class_0",":var001"),
(store_sub, ":var001", "$g_presentation_obj_coop_companion_1", "trp_npc1_1"),
(assign,":var001 +","trp_npc1_1"),
(assign,"$g_presentation_obj_coop_companion_class_1",":var001"),
(try_for_range, ":trp_002", "trp_knight_1_1", "trp_kingdom_1_pretender"),
    (troop_set_slot,":trp_002",155,0),
(try_end),
(try_for_range, ":trp_002", "trp_quick_battle_troop_1", "trp_quick_battle_troops_end"),
    (troop_set_slot,":trp_002",155,0),
(try_end),
(assign,"$g_mp_coop_lord_waves",0),
(assign,"$g_mp_coop_king_waves",0),
(assign,"$g_mp_coop_last_king_wave",0),
(try_begin),
    (multiplayer_is_server),
    (get_max_players, ":max_players"),
    (try_for_range, ":player_id_004", 0, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_004"),
            (try_for_range, ":slot_no_005", 47, 49),
                (player_set_slot,":player_id_004",":slot_no_005",0),
                (multiplayer_send_3_int_to_player, ":player_id_004", 48, 13, ":slot_no_005", 0),
            (try_end),
        (try_end),
        (try_for_range, ":slot_no_005", 50, 60),
            (player_set_slot,":player_id_004",":slot_no_005",0),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (multiplayer_is_server),
    (assign,"$g_multiplayer_ccoop_spawn_prison_cart_counter",0),
    (assign,"$g_multiplayer_ccoop_spawn_player_and_squad_counter",0),
    (assign,"$g_multiplayer_ccoop_spawn_alive_player_squad_and_minus_one_first_spawn_slots_and_minus_one_first_spawn_slots",-1),
(try_end),
(assign,"$g_multiplayer_ccoop_wave_no",0),
(assign,"$g_multiplayer_ccoop_game_started",0),
(assign,"$g_multiplayer_ccoop_enable_count_down",0),
(assign,"$g_multiplayer_ccoop_change_map",0),
(assign,"$g_round_ended",0),
(call_script, "script_multiplayer_ccoop_destroy_prison_cart"),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_004", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_004"),
        (player_set_slot,":player_id_004",42,0),
        (multiplayer_send_2_int_to_player, ":player_id_004", 48, 1, 0),
    (try_end),
(try_end),
]),

(ti_on_multiplayer_mission_end, 0.0, 0.0, [
], [
(assign,"$g_multiplayer_ccoop_enable_count_down",0),
(assign,"$g_multiplayer_ccoop_enemy_respawn_secs",100000),
(assign,"$g_multiplayer_ccoop_game_started",0),
(assign,"$g_multiplayer_stats_chart_opened_manually",0),
(start_presentation, "prsnt_multiplayer_stats_chart_deathmatch"),
]),

(ti_on_player_exit, 0.0, 0.0, [
], [
(try_begin),
    (call_script, "script_cf_multiplayer_event_team_change", ":var001"),
(try_end),
]),

(ti_on_agent_killed_or_wounded, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_on_agent_killed_or_wounded_common", ":var001", ":var002"),
(agent_get_team, ":agent_team_no_003", ":var001"),
(try_begin),
    (multiplayer_is_server),
    (agent_is_non_player, ":var001"),
    (agent_get_group, ":agent_group_004", ":var001"),
    (try_begin),
        (player_is_active, ":agent_group_004"),
        (agent_get_troop_id,":troop_id_005", ":var001"),
        (try_for_range, ":slot_no_006", 43, 45),
            (player_get_slot,":player_slot_007",":agent_group_004",":slot_no_006"),
            (try_begin),
                (eq,":troop_id_005",":player_slot_007"),
                (val_sub, ":slot_no_006", 43),
                (val_add, ":slot_no_006", 47),
                (player_get_slot,":player_slot_008",":agent_group_004",":slot_no_006"),
                (val_sub, ":player_slot_008", 1),
                (val_max,":player_slot_008",0),
                (player_set_slot,":agent_group_004",":slot_no_006",":player_slot_008"),
                (multiplayer_send_3_int_to_player, ":agent_group_004", 48, 13, ":slot_no_006", ":player_slot_008"),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(agent_get_troop_id,":troop_id_009", ":var001"),
(try_begin),
    (neq,":troop_id_009",-1),
    (eq,":troop_id_009","$g_ccoop_king_troop"),
    (assign,"$g_mp_coop_last_king_wave","$g_multiplayer_ccoop_wave_no"),
    (val_add, "$g_mp_coop_king_waves", 1),
(try_end),
(try_begin),
    (multiplayer_is_server),
    (try_begin),
        (eq,1,1),
        (try_begin),
            (eq,":agent_team_no_003",1),
            (store_random_in_range,":random_x_010",0,15),
        (else_try),
            (assign,":random_x_010",0),
        (try_end),
        (try_begin),
            (this_or_next|eq,":random_x_010",14),
            (this_or_next|is_between,":troop_id_009","trp_knight_1_1","trp_kingdom_1_pretender"),
            (this_or_next|is_between,":troop_id_009","trp_kingdom_1_lord","trp_knight_1_1"),
            (is_between,":troop_id_009","trp_quick_battle_troop_1","trp_quick_battle_troops_end"),
            (agent_get_position,pos0,":var001"),
            (set_spawn_position, 0),
            (spawn_scene_prop, "spr_multiplayer_coop_item_drop"),
            (scene_prop_get_instance, ":scp_instance_011", "spr_prison_cart", 0),
            (assign,":var012",1),
            (try_for_range, ":slot_no_006", 7, 17),
                (try_begin),
                    (eq,":var012",1),
                    (scene_prop_get_slot,":scene_prop_slot_013",":scp_instance_011",":slot_no_006"),
                    (try_begin),
                        (eq,":scene_prop_slot_013",0),
                        (scene_prop_set_slot,":scp_instance_011",":slot_no_006",reg0),
                        (assign,":var012",0),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (eq,":var012",1),
            (scene_prop_get_slot,":scene_prop_slot_014",":scp_instance_011",7),
            (prop_instance_get_position, pos1, ":scene_prop_slot_014"),
            (position_move_z,1,-2000),
            (prop_instance_set_position, ":scene_prop_slot_014", 1),
            (try_for_range, ":slot_no_006", 7, 17),
                (store_add, ":slot_no_015", ":slot_no_006", 1),
                (try_begin),
                    (eq,":slot_no_015",17),
                    (assign,":scene_prop_slot_016",reg0),
                (else_try),
                    (scene_prop_get_slot,":scene_prop_slot_016",":scp_instance_011",":slot_no_015"),
                (try_end),
                (scene_prop_set_slot,":scp_instance_011",":slot_no_006",":scene_prop_slot_016"),
            (try_end),
            (get_max_players, ":max_players"),
            (try_for_range, ":player_id_018", 0, ":max_players"),
                (try_begin),
                    (player_is_active, ":player_id_018"),
                    (try_for_range, ":slot_no_006", 50, 60),
                        (try_begin),
                            (player_slot_eq,":player_id_018",":slot_no_006",":scene_prop_slot_014"),
                            (player_set_slot,":player_id_018",":slot_no_006",0),
                            (multiplayer_send_2_int_to_player, ":player_id_018", 121, ":slot_no_006", 0),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (ge,":var002",0),
    (agent_is_human,":var001"),
    (agent_is_human,":var002"),
    (agent_get_team, ":agent_team_no_019", ":var002"),
    (try_begin),
        (le,":agent_team_no_019",1),
        (team_get_score, ":team_score_020", ":agent_team_no_019"),
        (try_begin),
            (neq,":agent_team_no_019",":agent_team_no_003"),
            (val_add, ":team_score_020", 1),
            (call_script, "script_team_set_score", ":agent_team_no_019", ":team_score_020"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (multiplayer_is_server),
    (eq,":agent_team_no_003",1),
    (assign,":var021",0),
    (try_for_agents, ":cur_agent"),
        (try_begin),
            (agent_is_human,":cur_agent"),
            (agent_is_alive,":cur_agent"),
            (agent_get_team, ":agent_team_no_023", ":cur_agent"),
            (try_begin),
                (eq,":agent_team_no_023",1),
                (val_add, ":var021", 1),
            (try_end),
        (try_end),
        (try_begin),
            (gt,":var021",0),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var021",0),
        (try_begin),
            (agent_is_human,":var001"),
            (play_sound,"snd_team_scored_a_point"),
        (try_end),
    (try_end),
    (try_begin),
        (neq,"$g_multiplayer_ccoop_difficulty",2),
        (eq,"$g_multiplayer_ccoop_wave_no","$g_mp_coop_last_king_wave"),
        (assign,"$g_multiplayer_ccoop_change_map",10),
        (set_cheer_at_no_enemy, 1),
        (get_max_players, ":max_players"),
        (team_get_faction, ":team_faction_024", 1),
        (str_store_faction_name,s0,":team_faction_024"),
        (assign,":var025","str_ccoop_easy"),
        (val_add, ":var025", "$g_multiplayer_ccoop_difficulty"),
        (str_store_string,s1,":var025"),
        (try_begin),
            (is_between,":team_faction_024","fac_player_supporters_faction","fac_kingdoms_end"),
            (assign,reg1,0),
        (else_try),
            (assign,reg1,1),
        (try_end),
        (str_store_string,s2,"str_ccoop_s0_enemy_defeated_s1"),
        (try_for_range, ":player_id_018", 0, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_018"),
                (multiplayer_send_int_to_player, ":player_id_018", 123, ":var025"),
            (try_end),
        (try_end),
    (else_try),
        (assign,"$g_multiplayer_ccoop_enemy_respawn_secs",32),
        (try_for_agents, ":cur_agent"),
            (try_begin),
                (agent_is_alive,":cur_agent"),
                (agent_is_human,":cur_agent"),
                (agent_set_hit_points,":cur_agent",100),
                (agent_refill_wielded_shield_hit_points, ":cur_agent"),
                (agent_refill_ammo,":cur_agent"),
                (try_begin),
                    (agent_is_non_player, ":cur_agent"),
                    (agent_get_group, ":agent_group_026", ":cur_agent"),
                    (try_begin),
                        (gt,":agent_group_026",-1),
                        (player_is_active, ":agent_group_026"),
                        (agent_get_troop_id,":troop_id_027", ":cur_agent"),
                        (try_for_range, ":slot_no_006", 43, 45),
                            (player_get_slot,":player_slot_007",":agent_group_026",":slot_no_006"),
                            (try_begin),
                                (eq,":troop_id_027",":player_slot_007"),
                                (val_sub, ":slot_no_006", 43),
                                (val_add, ":slot_no_006", 47),
                                (player_get_slot,":player_slot_008",":agent_group_026",":slot_no_006"),
                                (val_add, ":player_slot_008", 1),
                                (val_min,":player_slot_008",3),
                                (player_set_slot,":agent_group_026",":slot_no_006",":player_slot_008"),
                                (multiplayer_send_3_int_to_player, ":agent_group_026", 48, 13, ":slot_no_006", ":player_slot_008"),
                                (try_begin),
                                    (call_script,"script_cf_multiplayer_upgrade_companion_equipment"),
                                (try_end),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
            (try_begin),
                (eq,1,1),
                (agent_get_horse,":agent_horse_028",":cur_agent"),
                (try_begin),
                    (gt,":agent_horse_028",-1),
                    (agent_is_alive,":agent_horse_028"),
                    (agent_set_hit_points,":agent_horse_028",100),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (eq,"$g_multiplayer_ccoop_difficulty",2),
            (eq,"$g_multiplayer_ccoop_wave_no","$g_mp_coop_last_king_wave"),
            (val_add, "$g_multiplayer_ccoop_enemy_respawn_secs", 10),
            (get_max_players, ":max_players"),
            (team_get_faction, ":team_faction_024", 1),
            (str_store_faction_name,s0,":team_faction_024"),
            (assign,reg0,"$g_mp_coop_king_waves"),
            (try_begin),
                (is_between,":team_faction_024","fac_player_supporters_faction","fac_kingdoms_end"),
                (assign,reg1,0),
            (else_try),
                (assign,reg1,1),
            (try_end),
            (str_store_string,s2,"str_ccoop_s0_enemy_defeated_endless_reg0"),
            (try_for_range, ":player_id_018", 0, ":max_players"),
                (try_begin),
                    (player_is_active, ":player_id_018"),
                    (multiplayer_send_string_to_player, ":player_id_018", 123, -1),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(else_try),
    (multiplayer_is_server),
    (eq,":agent_team_no_003",0),
    (assign,":var021",0),
    (try_for_agents, ":cur_agent"),
        (try_begin),
            (agent_is_human,":cur_agent"),
            (agent_is_alive,":cur_agent"),
            (agent_get_team, ":agent_team_no_023", ":cur_agent"),
            (try_begin),
                (eq,":agent_team_no_023",0),
                (val_add, ":var021", 1),
            (try_end),
        (try_end),
        (try_begin),
            (gt,":var021",0),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var021",0),
        (assign,"$g_multiplayer_ccoop_change_map",5),
        (set_cheer_at_no_enemy, 1),
    (else_try),
        (neg|multiplayer_is_server),
        (eq,":agent_team_no_003",1),
        (agent_is_human,":var001"),
        (assign,":var021",0),
        (try_for_agents, ":cur_agent"),
            (try_begin),
                (agent_is_human,":cur_agent"),
                (agent_is_alive,":cur_agent"),
                (agent_get_team, ":agent_team_no_023", ":cur_agent"),
                (try_begin),
                    (eq,":agent_team_no_023",1),
                    (val_add, ":var021", 1),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (gt,":var021",0),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var021",0),
        (play_sound,"snd_team_scored_a_point"),
    (try_end),
(try_end),
]),

(0.0, 0.0, ti_once, [
], [
(set_cheer_at_no_enemy, 0),
]),

(1.0, 0.0, 0.0, [
(gt,"$g_multiplayer_ccoop_enable_count_down",0),
], [
(try_begin),
    (gt,"$g_multiplayer_ccoop_change_map",0),
    (try_begin),
        (eq,"$g_multiplayer_ccoop_change_map",4),
        (call_script, "script_multiplayer_ccoop_destroy_prison_cart"),
    (try_end),
    (val_sub, "$g_multiplayer_ccoop_change_map", 1),
    (try_begin),
        (eq,"$g_multiplayer_ccoop_change_map",0),
        (assign,"$g_multiplayer_ccoop_enable_count_down",0),
        (assign,"$g_round_ended",1),
    (else_try),
        (gt,"$g_multiplayer_ccoop_enemy_respawn_secs",0),
        (val_sub, "$g_multiplayer_ccoop_enemy_respawn_secs", 1),
        (try_begin),
            (gt,"$g_multiplayer_ccoop_enemy_respawn_secs",59),
            (store_mod,":var001","$g_multiplayer_ccoop_enemy_respawn_secs",60),
            (try_begin),
                (eq,":var001",0),
                (store_div, ":var___x1", "$g_multiplayer_ccoop_enemy_respawn_secs", 60),
                (assign,reg0,":var___x1"),
                (try_begin),
                    (neg|multiplayer_is_dedicated_server),
                    (assign, reg1, 4292764416),
                    (display_message, "@str_next_wave_in_reg0_mins {reg1}"),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,"$g_multiplayer_ccoop_enemy_respawn_secs",30),
        (multiplayer_is_server),
        (call_script, "script_multiplayer_ccoop_give_round_bonus_gold"),
        (val_add, "$g_multiplayer_ccoop_wave_no", 1),
        (call_script, "script_multiplayer_ccoop_destroy_prison_cart"),
        (call_script, "script_multiplayer_ccoop_start_player_and_squad_respawn_period", 1),
        (get_max_players, ":max_players"),
        (store_sub, ":var003", "$g_multiplayer_ccoop_enemy_respawn_secs", 1),
        (try_for_range, ":player_id_004", 1, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_004"),
                (multiplayer_send_3_int_to_player, ":player_id_004", 48, 3, ":var003", "$g_multiplayer_ccoop_wave_no"),
            (try_end),
        (try_end),
        (call_script, "script_multiplayer_ccoop_prepare_spawn_wave"),
        (store_mission_timer_a,"$g_multiplayer_ccoop_next_wave_start_time"),
        (val_add, "$g_multiplayer_ccoop_next_wave_start_time", "$g_multiplayer_ccoop_enemy_respawn_secs"),
        (start_presentation, "prsnt_multiplayer_ccoop_next_wave_time_counter"),
        (start_presentation, "prsnt_multiplayer_flag_projection_display_ccoop_wave"),
    (else_try),
        (lt,"$g_multiplayer_ccoop_enemy_respawn_secs",1),
        (multiplayer_is_server),
        (call_script, "script_multiplayer_ccoop_calculate_round_duration"),
        (call_script, "script_multiplayer_ccoop_spawn_wave", 1000),
    (try_end),
(try_end),
]),

(1.0, 0.0, 0.0, [
(multiplayer_is_server),
], [
(get_max_players, ":max_players"),
(try_begin),
    (gt,"$g_multiplayer_ccoop_move_prison_cart",0),
    (store_mission_timer_a,":m_timer_a_002"),
    (store_sub, ":var003", "$g_multiplayer_ccoop_move_prison_cart", ":m_timer_a_002"),
    (try_begin),
        (le,":var003",0),
        (display_debug_message,"@{!}sending prisoner cart 6 feet underground!"),
        (set_fixed_point_multiplier, 100),
        (scene_prop_get_instance, ":scp_instance_004", "spr_prison_cart", 0),
        (scene_prop_get_instance, ":scp_instance_005", "spr_prison_cart_door_left", 0),
        (scene_prop_get_instance, ":scp_instance_006", "spr_prison_cart_door_right", 0),
        (prop_instance_get_position, pos1, ":scp_instance_004"),
        (position_set_z,1,-4000),
        (prop_instance_set_position, ":scp_instance_004", 1),
        (prop_instance_set_position, ":scp_instance_005", 1),
        (prop_instance_set_position, ":scp_instance_006", 1),
        (assign,"$g_multiplayer_ccoop_move_prison_cart",0),
    (try_end),
(else_try),
    (gt,"$g_prison_cart_point",0),
    (scene_prop_get_instance, ":scp_instance_005", "spr_prison_cart_door_left", 0),
    (scene_prop_get_hit_points, ":scp_hit_points_007", ":scp_instance_005"),
    (scene_prop_get_instance, ":scp_instance_006", "spr_prison_cart_door_right", 0),
    (scene_prop_get_hit_points, ":scp_hit_points_008", ":scp_instance_006"),
    (try_begin),
        (this_or_next|ge,":scp_hit_points_007",1),
        (lt,":scp_hit_points_008",1),
        (call_script, "script_multiplayer_ccoop_destroy_prison_cart"),
        (call_script, "script_multiplayer_ccoop_start_player_and_squad_respawn_period", 0),
    (try_end),
    (assign,":var009",0),
    (try_for_range, ":player_id_010", 0, ":max_players"),
        (try_begin),
            (eq,":var009",0),
            (player_is_active, ":player_id_010"),
            (player_get_team_no,  ":team_no_011", ":player_id_010"),
            (try_begin),
                (eq,":team_no_011",0),
                (player_get_agent_id, ":agent_id_012", ":player_id_010"),
                (try_begin),
                    (ge,":agent_id_012",0),
                    (try_begin),
                        (neg|agent_is_alive,":agent_id_012"),
                        (assign,":var009",1),
                    (try_end),
                (try_end),
            (try_end),
        (else_try),
            (assign,":var009",1),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var009",0),
        (call_script, "script_multiplayer_ccoop_destroy_prison_cart"),
    (try_end),
(else_try),
    (assign,":var009",0),
    (try_for_range, ":player_id_010", 0, ":max_players"),
        (try_begin),
            (eq,":var009",0),
            (player_is_active, ":player_id_010"),
            (player_get_team_no,  ":team_no_011", ":player_id_010"),
            (try_begin),
                (eq,":team_no_011",0),
                (player_get_agent_id, ":agent_id_012", ":player_id_010"),
                (try_begin),
                    (ge,":agent_id_012",0),
                    (neg|agent_is_alive,":agent_id_012"),
                    (assign,":var009",1),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var009",1),
        (eq,"$g_multiplayer_ccoop_spawn_alive_player_squad_and_minus_one_first_spawn_slots_and_minus_one_first_spawn_slots",1),
        (le,"$g_multiplayer_ccoop_spawn_player_and_squad_counter",0),
        (eq,"$g_multiplayer_ccoop_spawn_prison_cart_counter",0),
        (assign,"$g_multiplayer_ccoop_spawn_prison_cart_counter",5),
        (display_debug_message,"@{!}spawn prison cart 5 secs initiated!"),
    (try_end),
    (try_begin),
        (gt,"$g_multiplayer_ccoop_spawn_prison_cart_counter",0),
        (val_sub, "$g_multiplayer_ccoop_spawn_prison_cart_counter", 1),
        (display_debug_message,"@{!}spawn prison cart!"),
        (try_begin),
            (eq,"$g_multiplayer_ccoop_spawn_prison_cart_counter",0),
            (call_script, "script_multiplayer_ccoop_spawn_prison_cart"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (multiplayer_is_server),
    (gt,"$g_multiplayer_ccoop_spawn_player_and_squad_counter",0),
    (val_sub, "$g_multiplayer_ccoop_spawn_player_and_squad_counter", 1),
    (try_begin),
        (lt,"$g_multiplayer_ccoop_spawn_player_and_squad_counter",25),
        (get_max_players, ":max_players"),
        (try_for_range, ":player_id_010", 0, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_010"),
                (player_get_team_no,  ":team_no_011", ":player_id_010"),
                (try_begin),
                    (lt,":team_no_011",2),
                    (player_get_agent_id, ":agent_id_012", ":player_id_010"),
                    (try_begin),
                        (this_or_next|ge,":agent_id_012",0),
                        (neg|agent_is_alive,":agent_id_012"),
                        (try_begin),
                            (eq,1,1),
                            (player_get_slot,":player_slot_013",":player_id_010",24),
                            (try_begin),
                                (eq,":player_slot_013",1),
                                (call_script, "script_multiplayer_ccoop_spawn_player_and_bots", ":player_id_010"),
                                (try_begin),
                                    (eq,reg0,1),
                                    (player_set_slot,":player_id_010",24,0),
                                (try_end),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (else_try),
                (assign,reg0,"$g_multiplayer_ccoop_spawn_alive_player_squad_and_minus_one_first_spawn_slots_and_minus_one_first_spawn_slots"),
                (display_debug_message,"@{!}g multiplayer ccoop spawn alive player squad: {reg0}"),
                (try_begin),
                    (eq,"$g_multiplayer_ccoop_spawn_alive_player_squad_and_minus_one_first_spawn_slots_and_minus_one_first_spawn_slots",1),
                    (neg|player_is_busy_with_menus, ":player_id_010"),
                    (player_get_troop_id, ":troop_id_014", ":player_id_010"),
                    (try_begin),
                        (ge,":troop_id_014",0),
                        (call_script, "script_multiplayer_spawn_player_bot_squad_at_point", ":player_id_010", 0, reg0),
                        (call_script, "script_multiplayer_upgrade_player_equipment", ":player_id_010"),
                        (try_for_agents, ":cur_agent"),
                            (try_begin),
                                (agent_is_active,":cur_agent"),
                                (agent_is_alive,":cur_agent"),
                                (agent_is_non_player, ":cur_agent"),
                                (agent_get_group, ":agent_group_016", ":cur_agent"),
                                (try_begin),
                                    (eq,":agent_group_016",":player_id_010"),
                                    (call_script,"script_cf_multiplayer_upgrade_companion_equipment"),
                                (try_end),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
                (call_script, "script_multiplayer_get_spawn_point_close_to_player", ":player_id_010"),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, 0.0, 0.0, [
(eq,"$g_multiplayer_ccoop_game_started",0),
(multiplayer_is_server),
], [
(assign,":var001",0),
(get_max_players, ":max_players"),
(try_for_range, ":player_id_003", 0, ":max_players"),
    (try_begin),
        (player_is_active, ":player_id_003"),
        (call_script, "script_multiplayer_ccoop_spawn_player_and_bots", ":player_id_003"),
        (try_begin),
            (eq,":var001",0),
            (gt,reg0,0),
            (assign,":var001",1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (ge,":var001",1),
    (assign,"$g_multiplayer_ccoop_game_started",1),
    (assign,"$g_multiplayer_ccoop_enemy_respawn_secs",31),
    (assign,"$g_multiplayer_ccoop_enable_count_down",1),
    (call_script, "script_multiplayer_ccoop_start_player_and_squad_respawn_period", 1),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (assign,":var001",0),
    (try_begin),
        (eq,"$g_multiplayer_game_type",8),
        (try_begin),
            (eq,"$g_round_ended",1),
            (assign,":var001",1),
        (try_end),
    (try_end),
(else_try),
    (this_or_next|eq,"$g_multiplayer_game_type",6),
    (this_or_next|eq,"$g_multiplayer_game_type",3),
    (eq,"$g_multiplayer_game_type",2),
    (try_begin),
        (eq,"$g_round_ended",1),
        (store_mission_timer_a,":m_timer_a_002"),
        (val_sub, ":m_timer_a_002", "$g_round_finish_time"),
        (store_sub, ":var003", "$g_multiplayer_respawn_period", 1),
        (try_begin),
            (ge,":m_timer_a_002",":var003"),
            (store_mission_timer_a,":m_timer_a_004"),
            (try_begin),
                (this_or_next|eq,"$g_multiplayer_game_type",3),
                (eq,"$g_multiplayer_game_type",2),
                (assign,":var005",90),
            (else_try),
                (assign,":var005",120),
            (try_end),
        (try_end),
        (store_mul, ":var006", "$g_multiplayer_game_max_minutes", 60),
        (store_sub, ":var007", ":var006", ":var005"),
        (try_begin),
            (gt,":m_timer_a_004",":var007"),
            (assign,":var001",1),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var001",1),
    (else_try),
        (neq,"$g_multiplayer_game_type",2),
        (neq,"$g_multiplayer_game_type",3),
        (neq,"$g_multiplayer_game_type",6),
        (neq,"$g_multiplayer_game_type",5),
        (store_mission_timer_a,":m_timer_a_004"),
        (store_mul, ":var006", "$g_multiplayer_game_max_minutes", 60),
        (try_begin),
            (gt,":m_timer_a_004",":var006"),
            (assign,":var001",1),
        (else_try),
            (team_get_score, ":team_score_008", 0),
            (team_get_score, ":team_score_009", 1),
            (try_begin),
                (neq,"$g_multiplayer_game_type",5),
                (try_begin),
                    (this_or_next|ge,":team_score_008","$g_multiplayer_game_max_points"),
                    (ge,":team_score_009","$g_multiplayer_game_max_points"),
                    (assign,":var001",1),
                (try_end),
            (try_end),
        (try_end),
    (else_try),
        (assign,":var010",0),
        (get_max_players, ":max_players"),
        (try_for_range, ":player_id_012", 0, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_012"),
                (player_get_agent_id, ":agent_id_013", ":player_id_012"),
                (try_begin),
                    (ge,":agent_id_013",0),
                    (neg|agent_is_non_player, ":agent_id_013"),
                    (assign,":var010",1),
                    (assign,":max_players",0),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (eq,":var010",1),
            (this_or_next|gt,":team_score_008",0),
            (le,":team_score_009",0),
            (assign,":var001",1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,":var001",1),
    (call_script, "script_game_multiplayer_get_game_type_mission_template", "$g_multiplayer_game_type"),
    (start_multiplayer_mission, reg0, "$g_multiplayer_selected_map", 0),
    (call_script, "script_game_set_multiplayer_mission_end"),
(try_end),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_multiplayer_mission_end_screen",0),
    (assign,"$g_multiplayer_stats_chart_opened_manually",1),
    (start_presentation, "prsnt_multiplayer_stats_chart_deathmatch"),
(try_end),
]),

(0.0, 0.0, ti_once, [
], [
(start_presentation, "prsnt_multiplayer_welcome_message"),
]),

(ti_battle_window_opened, 0.0, 0.0, [
], [
(start_presentation, "prsnt_multiplayer_flag_projection_display_ccoop"),
(start_presentation, "prsnt_multiplayer_flag_projection_display_ccoop_wave"),
(start_presentation, "prsnt_multiplayer_ccoop_next_wave_time_counter"),
]),

(ti_escape_pressed, 0.0, 0.0, [
], [
(try_begin),
    (neg|is_presentation_active, "prsnt_multiplayer_escape_menu"),
    (neg|is_presentation_active, "prsnt_multiplayer_stats_chart_deathmatch"),
    (eq,"$g_waiting_for_confirmation_to_terminate",0),
    (start_presentation, "prsnt_multiplayer_escape_menu"),
(try_end),
]),

(ti_on_agent_hit, 0.0, 0.0, [
(multiplayer_is_server),
], [
(try_begin),
    (multiplayer_is_server),
    (agent_get_troop_id,":troop_id_004", ":agent_id_001"),
    (try_begin),
        (this_or_next|is_between,":troop_id_004","trp_knight_1_1","trp_kingdom_1_pretender"),
        (is_between,":troop_id_004","trp_kingdom_1_lord","trp_knight_1_1"),
        (store_random_in_range,":random_x_005",0,10),
        (try_begin),
            (eq,":random_x_005",0),
            (agent_get_position,pos60,":var002"),
            (call_script, "script_multiplayer_server_play_sound_at_position", "snd_ccoop_nobleman_taunt"),
        (try_end),
    (try_end),
(else_try),
    (is_between,":troop_id_004","trp_npc1_1","trp_npc1_2"),
    (store_random_in_range,":random_x_005",0,30),
    (try_begin),
        (eq,":random_x_005",0),
        (agent_get_position,pos60,":var002"),
        (store_random_in_range,":random_x_006","snd_ccoop_spawn_companion_0","snd_ccoop_nobleman_taunt"),
        (call_script, "script_multiplayer_server_play_sound_at_position", ":random_x_006"),
    (try_end),
(else_try),
    (this_or_next|eq,":troop_id_004","trp_sea_raider_leader"),
    (eq,":troop_id_004","trp_sea_raider"),
    (store_random_in_range,":random_x_005",0,30),
    (try_begin),
        (eq,":random_x_005",0),
        (agent_get_position,pos60,":var002"),
        (store_random_in_range,":random_x_006","snd_ccoop_sea_raider_taunt_0","snd_sounds_end"),
        (call_script, "script_multiplayer_server_play_sound_at_position", ":random_x_006"),
    (try_end),
(else_try),
    (eq,":troop_id_004","trp_looter"),
    (store_random_in_range,":random_x_005",0,20),
    (try_begin),
        (eq,":random_x_005",0),
        (agent_get_position,pos60,":var002"),
        (store_random_in_range,":random_x_006","snd_ccoop_looter_taunt_0","snd_ccoop_bandit_taunt_0"),
        (call_script, "script_multiplayer_server_play_sound_at_position", ":random_x_006"),
    (try_end),
(else_try),
    (is_between,":troop_id_004","trp_bandit","trp_black_khergit_horseman"),
    (store_random_in_range,":random_x_005",0,60),
    (try_begin),
        (eq,":random_x_005",0),
        (agent_get_position,pos60,":var002"),
        (store_random_in_range,":random_x_006","snd_ccoop_bandit_taunt_0","snd_ccoop_sea_raider_taunt_0"),
        (call_script, "script_multiplayer_server_play_sound_at_position", ":random_x_006"),
    (try_end),
(try_end),
(try_begin),
    (eq,reg0,"itm_knockdown_mace"),
    (agent_is_human,":agent_id_001"),
    (agent_get_horse,":agent_horse_007",":agent_id_001"),
    (try_begin),
        (le,":agent_horse_007",-1),
        (agent_set_animation, ":agent_id_001", "anim_strike_fall_back_rise"),
    (else_try),
        (eq,reg0,"itm_blood_drain_throwing_knives"),
        (store_agent_hit_points,":agent_hit_points_008",":var002",1),
        (val_add, ":agent_hit_points_008", ":var003"),
        (agent_set_hit_points,":var002",":agent_hit_points_008",1),
        (store_agent_hit_points,":agent_hit_points_008",":var002",0),
        (try_begin),
            (ge,":agent_hit_points_008",100),
            (agent_set_hit_points,":var002",":agent_hit_points_008",100),
        (else_try),
            (eq,reg0,"itm_instakill_knife"),
            (agent_set_hit_points,":agent_id_001",0),
        (else_try),
            (eq,reg0,"itm_backstabber"),
            (try_begin),
                (eq,1,1),
                (agent_get_action_dir, ":agent_action_direction_009", ":var002"),
                (try_begin),
                    (eq,":agent_action_direction_009",0),
                    (agent_get_position,pos0,":agent_id_001"),
                    (agent_get_position,pos1,":var002"),
                    (try_begin),
                        (position_is_behind_position,1,0),
                        (agent_set_hit_points,":agent_id_001",0),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
(else_try),
    (eq,reg0,"itm_disarming_throwing_axe"),
    (try_begin),
        (agent_is_human,":agent_id_001"),
        (try_for_range, ":var010", 0, 2),
            (agent_get_wielded_item,":agent_wieled_item_011",":agent_id_001",":var010"),
            (try_begin),
                (neq,":agent_wieled_item_011",-1),
                (agent_unequip_item, ":agent_id_001", ":agent_wieled_item_011"),
                (agent_get_position,pos0,":agent_id_001"),
                (set_spawn_position, 0),
                (spawn_item, ":agent_wieled_item_011"),
            (try_end),
        (try_end),
    (try_end),
(else_try),
    (eq,reg0,-1),
    (try_begin),
        (agent_is_human,":var002"),
        (agent_is_human,":agent_id_001"),
        (agent_get_item_slot, ":agent_item_slot_012", ":var002", 6),
        (try_begin),
            (eq,":agent_item_slot_012","itm_kicking_boots"),
            (store_agent_hit_points,":agent_hit_points_008",":agent_id_001",1),
            (assign,reg2,":agent_hit_points_008"),
            (val_max,":var003",2),
            (val_mul, ":var003", 6),
            (val_sub, ":agent_hit_points_008", ":var003"),
            (val_max,":agent_hit_points_008",0),
            (agent_set_hit_points,":agent_id_001",":agent_hit_points_008",1),
            (agent_get_item_id,":agent_horse_007", ":agent_id_001"),
            (try_begin),
                (eq,":agent_horse_007",-1),
                (agent_set_animation, ":agent_id_001", "anim_strike_fall_back_rise"),
            (try_end),
        (try_end),
    (try_end),
(else_try),
    (eq,reg0,"itm_doom_javelins"),
    (agent_get_slot,":agent_slot_013",":agent_id_001",27),
    (val_add, ":agent_slot_013", 1),
    (agent_set_slot,":agent_id_001",27,":agent_slot_013"),
(else_try),
    (eq,reg0,"itm_team_change_dart"),
    (try_begin),
        (agent_is_non_player, ":agent_id_001"),
        (agent_get_team, ":agent_team_no_014", ":agent_id_001"),
        (assign,":var015",0),
        (try_for_agents, ":cur_agent"),
            (try_begin),
                (neq,":cur_agent",":agent_id_001"),
                (agent_is_active,":cur_agent"),
                (agent_is_alive,":cur_agent"),
                (agent_is_human,":cur_agent"),
                (agent_get_team, ":agent_team_no_017", ":cur_agent"),
                (try_begin),
                    (eq,":agent_team_no_017",1),
                    (assign,":var015",1),
                (try_end),
            (try_end),
        (try_end),
        (try_begin),
            (eq,":var015",1),
            (try_begin),
                (eq,":agent_team_no_014",0),
                (agent_set_team, ":agent_id_001", 1),
            (else_try),
                (eq,":agent_team_no_014",1),
                (agent_set_team, ":agent_id_001", 0),
            (try_end),
        (try_end),
        (try_begin),
            (agent_is_non_player, ":var002"),
            (agent_get_group, ":agent_group_018", ":var002"),
        (else_try),
            (agent_get_player_id,":agent_group_018",":var002"),
        (try_end),
        (try_begin),
            (player_is_active, ":agent_group_018"),
            (agent_set_group, ":agent_id_001", ":agent_group_018"),
        (try_end),
        (agent_get_team, ":agent_team_no_019", ":agent_id_001"),
        (get_max_players, ":max_players"),
        (try_for_range, ":player_id_021", 1, ":max_players"),
            (try_begin),
                (player_is_active, ":player_id_021"),
                (multiplayer_send_4_int_to_player, ":player_id_021", 48, 18, ":agent_id_001", ":agent_team_no_019", ":var002"),
            (try_end),
        (try_end),
        (agent_force_rethink, ":agent_id_001"),
    (try_end),
(else_try),
    (eq,reg0,"itm_weak_beserker_dart"),
    (agent_ai_set_aggressiveness, ":agent_id_001", 1000),
    (agent_set_speed_modifier, ":agent_id_001", 150),
    (agent_set_damage_modifier, ":agent_id_001", 200),
    (agent_set_hit_points,":agent_id_001",10,0),
(try_end),
]),

(2.0, 0.0, 0.0, [
(multiplayer_is_server),
], [
(try_begin),
    (multiplayer_is_server),
    (try_for_agents, ":cur_agent"),
        (try_begin),
            (agent_is_active,":cur_agent"),
            (agent_is_alive,":cur_agent"),
            (agent_is_human,":cur_agent"),
            (agent_get_item_slot, ":agent_item_slot_002", ":cur_agent", 5),
            (try_begin),
                (eq,":agent_item_slot_002","itm_restore_health_armour"),
                (store_agent_hit_points,":agent_hit_points_003",":cur_agent",1),
                (val_add, ":agent_hit_points_003", 5),
                (agent_set_hit_points,":cur_agent",":agent_hit_points_003",1),
                (store_agent_hit_points,":agent_hit_points_003",":cur_agent",0),
                (val_min,":agent_hit_points_003",100),
                (agent_set_hit_points,":cur_agent",":agent_hit_points_003",0),
            (try_end),
        (try_end),
    (try_end),
    (agent_get_slot,":agent_slot_004",":cur_agent",27),
    (try_begin),
        (gt,":agent_slot_004",0),
        (assign,reg1,":agent_slot_004"),
        (store_mul, ":var005", ":agent_slot_004", 5),
        (store_agent_hit_points,":agent_hit_points_003",":cur_agent",1),
        (assign,reg2,":agent_hit_points_003"),
        (val_sub, ":agent_hit_points_003", ":var005"),
        (val_max,":agent_hit_points_003",0),
        (agent_set_hit_points,":cur_agent",":agent_hit_points_003",1),
        (try_begin),
            (eq,":agent_hit_points_003",0),
            (agent_deliver_damage_to_agent, ":cur_agent", ":cur_agent", 1),
        (try_end),
    (try_end),
(try_end),
]),

]),
("bandit_lair", mtf_battle_mode|mtf_synch_inventory, 8,
"Ambushing a bandit lair",
[(0, mtef_team_0|mtef_use_exact_number, af_override_horse, aif_start_alarmed, 7, []),
(1, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 20, []),
(2, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 20, []),
(3, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 20, []),
(4, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 20, []),
(5, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 20, []),
(6, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 20, []),
(7, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 20, []),
(8, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 20, []),
(9, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 20, []),
(10, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 20, []),
],
[
(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_now"),
], [
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(assign,"$relative_of_merchant_is_found",0),
(try_begin),
    (agent_is_human,":var001"),
    (agent_is_alive,":var001"),
    (agent_get_team, ":agent_team_no_002", ":var001"),
    (try_begin),
        (eq,":agent_team_no_002",1),
        (agent_get_position,pos4,":var001"),
        (agent_set_scripted_destination,":var001",4,1),
    (try_end),
(try_end),
(try_begin),
    (eq,1,1),
    (agent_get_troop_id,":troop_id_003", ":var001"),
    (try_begin),
        (is_between,":troop_id_003","trp_relative_of_merchant","trp_relative_of_merchants_end"),
        (agent_set_team, ":var001", 7),
        (team_set_relation, 0, 7, 0),
    (try_end),
(try_end),
]),

(0.0, 0.0, 0.0, [
(eq,":party_template_id_001","pt_looter_lair"),
(check_quest_active,"qst_save_relative_of_merchant"),
(eq,"$relative_of_merchant_is_found",0),
(party_get_template_id,":party_template_id_001","$g_encountered_party"),
], [
(get_player_agent_no,":party_template_id_001"),
(agent_get_position,pos0,":party_template_id_001"),
(try_for_agents, ":cur_agent"),
    (agent_get_troop_id,":troop_id_003", ":cur_agent"),
    (try_begin),
        (is_between,":troop_id_003","trp_relative_of_merchant","trp_relative_of_merchants_end"),
        (agent_set_scripted_destination,":cur_agent",0),
        (agent_get_position,pos1,":cur_agent"),
        (get_distance_between_positions,":distance_004",0,1),
        (try_begin),
            (le,":distance_004",200),
            (start_mission_conversation,"trp_relative_of_merchant"),
        (try_end),
    (try_end),
(try_end),
]),

(ti_tab_pressed, 0.0, 0.0, [
(display_message, "str_cannot_leave_now"),
], [
]),

(1.0, 0.0, ti_once, [
], [
(assign,"$defender_reinforcement_stage",0),
(assign,"$bandits_spawned_extra",0),
]),

(1.0, 0.0, 0.0, [
], [
(try_for_agents, ":cur_agent"),
    (try_begin),
        (agent_is_alive,":cur_agent"),
        (agent_get_team, ":agent_team_no_002", ":cur_agent"),
        (try_begin),
            (eq,":agent_team_no_002",1),
            (agent_is_in_special_mode,":cur_agent"),
            (agent_is_human,":cur_agent"),
            (agent_get_position,pos0,":cur_agent"),
            (try_for_agents, ":cur_agent"),
                (try_begin),
                    (agent_is_alive,":cur_agent"),
                    (agent_get_team, ":agent_team_no_004", ":cur_agent"),
                    (try_begin),
                        (eq,":agent_team_no_004",0),
                        (agent_is_human,":cur_agent"),
                        (store_agent_hit_points,":agent_hit_points_005",":cur_agent"),
                        (assign,":var006",0),
                        (try_begin),
                            (lt,":agent_hit_points_005",100),
                            (try_for_agents, ":cur_agent"),
                                (try_begin),
                                    (agent_is_alive,":cur_agent"),
                                    (agent_get_team, ":agent_team_no_008", ":cur_agent"),
                                    (try_begin),
                                        (eq,":agent_team_no_008",1),
                                        (eq,1,0),
                                        (agent_is_in_special_mode,":cur_agent"),
                                        (agent_is_human,":cur_agent"),
                                        (agent_get_position,pos1,":cur_agent"),
                                        (agent_get_position,pos2,":cur_agent"),
                                        (get_distance_between_positions,":distance_009",1,2),
                                        (try_begin),
                                            (le,":distance_009",1000),
                                            (agent_clear_scripted_mode,":cur_agent"),
                                        (try_end),
                                    (try_end),
                                (try_end),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
            (assign,":var006",1),
        (else_try),
            (agent_get_position,pos1,":cur_agent"),
            (agent_get_position,pos2,":cur_agent"),
            (get_distance_between_positions,":distance_009",1,2),
            (try_begin),
                (le,":distance_009",4000),
                (try_for_agents, ":cur_agent"),
                    (try_begin),
                        (agent_is_alive,":cur_agent"),
                        (agent_get_team, ":agent_team_no_008", ":cur_agent"),
                        (try_begin),
                            (eq,":agent_team_no_008",1),
                            (eq,1,0),
                            (agent_is_in_special_mode,":cur_agent"),
                            (agent_is_human,":cur_agent"),
                            (agent_get_position,pos1,":cur_agent"),
                            (agent_get_position,pos2,":cur_agent"),
                            (get_distance_between_positions,":distance_009",1,2),
                            (try_begin),
                                (le,":distance_009",1000),
                                (agent_clear_scripted_mode,":cur_agent"),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
            (assign,":var006",1),
        (try_end),
        (try_begin),
            (eq,":var006",1),
            (agent_clear_scripted_mode,":cur_agent"),
        (try_end),
    (try_end),
(try_end),
]),

(30.0, 0.0, 0.0, [
(le,"$defender_reinforcement_stage",1),
], [
(store_character_level,":character_lvl_001","trp_player"),
(store_add, ":var002", 5, ":character_lvl_001"),
(val_div, ":var002", 3),
(try_begin),
    (lt,"$bandits_spawned_extra",":var002"),
    (val_add, "$bandits_spawned_extra", 1),
    (party_get_template_id,":party_template_id_003","$g_encountered_party"),
    (store_random_in_range,":random_x_004",0,2),
    (try_begin),
        (eq,":party_template_id_003","pt_sea_raider_lair"),
        (eq,":random_x_004",0),
        (assign,":troop_id_005","trp_sea_raider"),
    (else_try),
        (eq,":party_template_id_003","pt_forest_bandit_lair"),
        (eq,":random_x_004",0),
        (assign,":troop_id_005","trp_forest_bandit"),
    (else_try),
        (eq,":party_template_id_003","pt_desert_bandit_lair"),
        (eq,":random_x_004",0),
        (assign,":troop_id_005","trp_desert_bandit"),
    (else_try),
        (eq,":party_template_id_003","pt_mountain_bandit_lair"),
        (eq,":random_x_004",0),
        (assign,":troop_id_005","trp_mountain_bandit"),
    (else_try),
        (eq,":party_template_id_003","pt_taiga_bandit_lair"),
        (eq,":random_x_004",0),
        (assign,":troop_id_005","trp_taiga_bandit"),
    (else_try),
        (eq,":party_template_id_003","pt_steppe_bandit_lair"),
        (eq,":random_x_004",0),
        (assign,":troop_id_005","trp_steppe_bandit"),
    (else_try),
        (this_or_next|eq,":party_template_id_003","pt_looter_lair"),
        (neq,":random_x_004",0),
        (assign,":troop_id_005","trp_looter"),
    (try_end),
(try_end),
(store_current_scene,":cur_scene_006"),
(modify_visitors_at_site,":cur_scene_006"),
(store_random_in_range,":random_x_007",2,11),
(add_visitors_to_current_scene,":random_x_007",":troop_id_005",1),
]),

(ti_on_agent_killed_or_wounded, 0.0, 0.0, [
], [
(try_begin),
    (ge,":var001",0),
    (agent_is_human,":var001"),
    (agent_get_troop_id,":troop_id_003", ":var001"),
    (str_store_troop_name,s6,":troop_id_003"),
    (try_begin),
        (neg|agent_is_ally,":var001"),
        (party_add_members,"p_total_enemy_casualties",":troop_id_003",1),
        (try_begin),
            (eq,":var002",1),
            (party_wound_members,"p_total_enemy_casualties",":troop_id_003",1),
        (try_end),
    (try_end),
    (party_add_members,"p_temp_casualties",":troop_id_003",1),
    (try_begin),
        (eq,":var002",1),
        (party_wound_members,"p_temp_casualties",":troop_id_003",1),
    (try_end),
(try_end),
(assign,":var004",0),
(try_for_agents, ":cur_agent"),
    (try_begin),
        (agent_is_non_player, ":cur_agent"),
        (agent_is_human,":cur_agent"),
        (agent_is_alive,":cur_agent"),
        (neg|agent_is_ally,":cur_agent"),
        (val_add, ":var004", 1),
    (try_end),
(try_end),
(try_begin),
    (le,":var004",2),
    (le,"$defender_reinforcement_stage",1),
    (val_add, "$defender_reinforcement_stage", 1),
    (store_character_level,":character_lvl_006","trp_player"),
    (store_add, ":var007", 5, ":character_lvl_006"),
    (val_div, ":var007", 3),
    (try_begin),
        (ge,"$defender_reinforcement_stage",2),
        (val_sub, ":var007", "$bandits_spawned_extra"),
    (try_end),
    (party_get_template_id,":party_template_id_008","$g_encountered_party"),
    (store_random_in_range,":random_x_009",0,2),
    (try_begin),
        (eq,":party_template_id_008","pt_sea_raider_lair"),
        (eq,":random_x_009",0),
        (assign,":troop_id_010","trp_sea_raider"),
    (else_try),
        (eq,":party_template_id_008","pt_forest_bandit_lair"),
        (eq,":random_x_009",0),
        (assign,":troop_id_010","trp_forest_bandit"),
    (else_try),
        (eq,":party_template_id_008","pt_desert_bandit_lair"),
        (eq,":random_x_009",0),
        (assign,":troop_id_010","trp_desert_bandit"),
    (else_try),
        (eq,":party_template_id_008","pt_mountain_bandit_lair"),
        (eq,":random_x_009",0),
        (assign,":troop_id_010","trp_mountain_bandit"),
    (else_try),
        (eq,":party_template_id_008","pt_taiga_bandit_lair"),
        (eq,":random_x_009",0),
        (assign,":troop_id_010","trp_taiga_bandit"),
    (else_try),
        (eq,":party_template_id_008","pt_steppe_bandit_lair"),
        (eq,":random_x_009",0),
        (assign,":troop_id_010","trp_steppe_bandit"),
    (else_try),
        (this_or_next|eq,":party_template_id_008","pt_looter_lair"),
        (neq,":random_x_009",0),
        (assign,":troop_id_010","trp_looter"),
    (try_end),
    (store_current_scene,":cur_scene_011"),
    (modify_visitors_at_site,":cur_scene_011"),
    (try_for_range, ":var012", 0, ":var007"),
        (store_random_in_range,":random_x_013",2,11),
        (add_visitors_to_current_scene,":random_x_013",":troop_id_010",1),
    (try_end),
(try_end),
]),

(0.0, 0.0, ti_once, [
], [
(call_script, "script_music_set_situation_with_culture", 4096),
(set_party_battle_mode),
]),

(2.0, 0.0, ti_once, [
(neg|main_hero_fallen),
(num_active_teams_le,1),
], [
(party_get_template_id,":party_template_id_001","$g_encountered_party"),
(try_begin),
    (eq,":party_template_id_001","pt_looter_lair"),
    (check_quest_active,"qst_save_relative_of_merchant"),
    (store_faction_of_party, ":party_faction_002", "$g_starting_town"),
    (try_begin),
        (eq,":party_faction_002","fac_kingdom_1"),
        (assign,":troop_id_003","trp_relative_of_merchant"),
    (else_try),
        (eq,":party_faction_002","fac_kingdom_2"),
        (assign,":troop_id_003","trp_relative_of_merchant"),
    (else_try),
        (eq,":party_faction_002","fac_kingdom_3"),
        (assign,":troop_id_003","trp_relative_of_merchant"),
    (else_try),
        (eq,":party_faction_002","fac_kingdom_4"),
        (assign,":troop_id_003","trp_relative_of_merchant"),
    (else_try),
        (eq,":party_faction_002","fac_kingdom_5"),
        (assign,":troop_id_003","trp_relative_of_merchant"),
    (else_try),
        (eq,":party_faction_002","fac_kingdom_6"),
        (assign,":troop_id_003","trp_relative_of_merchant"),
    (try_end),
    (get_player_agent_no,":agent_no_004"),
    (agent_get_position,pos0,":agent_no_004"),
    (assign,":var005",100000),
    (try_for_range, ":var006", 1, 10),
        (entry_point_get_position, pos1, ":var006"),
        (get_distance_between_positions,":distance_007",0,1),
        (try_begin),
            (le,":distance_007",":var005"),
            (ge,":distance_007",1000),
            (assign,":entry_no_008",":var006"),
            (assign,":var005",":distance_007"),
        (try_end),
    (try_end),
    (add_visitors_to_current_scene,":entry_no_008",":troop_id_003",1, 0),
(try_end),
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (game_key_clicked, 22),
    (neg|is_presentation_active, "prsnt_battle"),
    (start_presentation, "prsnt_battle"),
(try_end),
]),

(0.1, 0.0, 0.0, [
], [
(try_begin),
    (is_presentation_active, "prsnt_battle"),
    (call_script, "script_update_order_panel_statistics_and_map"),
(try_end),
]),

(1.0, 4.0, ti_once, [
(party_get_template_id,":party_template_id_002","$g_encountered_party"),
(try_begin),
    (eq,":party_template_id_002","pt_looter_lair"),
    (check_quest_active,"qst_save_relative_of_merchant"),
    (this_or_next|main_hero_fallen),
    (eq,"$relative_of_merchant_is_found",1),
    (assign,":var001",1),
(else_try),
    (this_or_next|eq,":party_template_id_002","pt_looter_lair"),
    (neg|check_quest_active,"qst_save_relative_of_merchant"),
    (store_mission_timer_a,":m_timer_a_003"),
    (try_begin),
        (ge,":m_timer_a_003",5),
        (this_or_next|main_hero_fallen),
        (num_active_teams_le,1),
        (assign,":var001",1),
        (try_begin),
            (eq,":var001",1),
        (try_end),
    (try_end),
], [
(try_begin),
    (main_hero_fallen),
(else_try),
    (party_set_slot,"$g_encountered_party",8,2),
(try_end),
(finish_mission, ":"),
]),

]),
("alley_fight", mtf_battle_mode, 8,
"Alley fight",
[(0, mtef_team_0|mtef_use_exact_number, af_override_horse, aif_start_alarmed, 7, []),
(1, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 20, []),
(2, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 20, []),
(3, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 20, []),
],
[
(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(display_message, "str_cant_use_inventory_now"),
], [
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(get_player_agent_no,":agent_no_002"),
(try_begin),
    (neq,":var001",":agent_no_002"),
    (assign,"$g_main_attacker_agent",":var001"),
    (agent_ai_set_aggressiveness, ":var001", 199),
    (try_begin),
        (eq,1,1),
        (agent_get_troop_id,":troop_id_003", ":var001"),
        (try_begin),
            (is_between,":troop_id_003","trp_swadian_merchant","trp_startup_merchants_end"),
            (agent_set_team, ":var001", 7),
            (team_set_relation, 0, 7, 0),
        (try_end),
    (try_end),
(try_end),
]),

(0.0, 0.0, 0.0, [
(eq,"$talked_with_merchant",0),
], [
(get_player_agent_no,":agent_no_001"),
(agent_get_position,pos0,":agent_no_001"),
(try_for_agents, ":cur_agent"),
    (agent_get_troop_id,":troop_id_003", ":cur_agent"),
    (try_begin),
        (is_between,":troop_id_003","trp_swadian_merchant","trp_startup_merchants_end"),
        (agent_set_scripted_destination,":cur_agent",0),
        (agent_get_position,pos1,":cur_agent"),
        (get_distance_between_positions,":distance_004",0,1),
        (try_begin),
            (le,":distance_004",200),
            (assign,"$talk_context",11),
            (start_mission_conversation,":troop_id_003"),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(get_player_agent_no,":agent_no_001"),
(try_begin),
    (ge,"$g_main_attacker_agent",0),
    (ge,":agent_no_001",0),
    (agent_is_active,"$g_main_attacker_agent"),
    (agent_is_active,":agent_no_001"),
    (agent_get_position,pos0,":agent_no_001"),
    (agent_get_position,pos1,"$g_main_attacker_agent"),
    (get_distance_between_positions,":distance_002",0,1),
    (try_begin),
        (ge,":distance_002",5),
        (agent_set_scripted_destination,"$g_main_attacker_agent",0),
    (try_end),
(try_end),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(display_message, "str_cannot_leave_now"),
]),

(0.0, 0.0, ti_once, [
], [
(call_script, "script_music_set_situation_with_culture", 4096),
(set_party_battle_mode),
]),

(0.0, 0.0, ti_once, [
(neg|main_hero_fallen),
(num_active_teams_le,1),
], [
(store_faction_of_party, ":party_faction_001", "$g_starting_town"),
(try_begin),
    (eq,":party_faction_001","fac_kingdom_1"),
    (assign,":troop_id_002","trp_swadian_merchant"),
(else_try),
    (eq,":party_faction_001","fac_kingdom_2"),
    (assign,":troop_id_002","trp_vaegir_merchant"),
(else_try),
    (eq,":party_faction_001","fac_kingdom_3"),
    (assign,":troop_id_002","trp_khergit_merchant"),
(else_try),
    (eq,":party_faction_001","fac_kingdom_4"),
    (assign,":troop_id_002","trp_nord_merchant"),
(else_try),
    (eq,":party_faction_001","fac_kingdom_5"),
    (assign,":troop_id_002","trp_rhodok_merchant"),
(else_try),
    (eq,":party_faction_001","fac_kingdom_6"),
    (assign,":troop_id_002","trp_sarranid_merchant"),
(try_end),
(add_visitors_to_current_scene,3,":troop_id_002",1, 0),
]),

(1.0, 0.0, ti_once, [
(eq,"$talked_with_merchant",1),
], [
(try_begin),
    (main_hero_fallen),
    (assign,"$g_killed_first_bandit",0),
(else_try),
    (assign,"$g_killed_first_bandit",1),
(try_end),
(finish_mission, ":"),
(assign,"$g_main_attacker_agent",0),
(assign,"$talked_with_merchant",1),
(assign,"$current_startup_quest_phase",1),
(change_screen_return),
(set_trigger_result, 1),
(get_player_agent_no,":agent_no_001"),
(store_agent_hit_points,":agent_hit_points_002",":agent_no_001"),
(try_begin),
    (lt,":agent_hit_points_002",90),
    (agent_set_hit_points,":agent_no_001",90),
(try_end),
]),

(1.0, 3.0, ti_once, [
(main_hero_fallen),
], [
(try_begin),
    (main_hero_fallen),
    (assign,"$g_killed_first_bandit",0),
(else_try),
    (assign,"$g_killed_first_bandit",1),
(try_end),
(finish_mission, ":"),
(assign,"$g_main_attacker_agent",0),
(assign,"$talked_with_merchant",1),
(assign,"$current_startup_quest_phase",1),
(change_screen_return),
(set_trigger_result, 1),
(get_player_agent_no,":agent_no_001"),
(store_agent_hit_points,":agent_hit_points_002",":agent_no_001"),
(try_begin),
    (lt,":agent_hit_points_002",90),
    (agent_set_hit_points,":agent_no_001",90),
(try_end),
]),

]),
("meeting_merchant", 0, -1,
"Meeting with the merchant",
[(0, mtef_team_0, af_override_horse, 0, 1, []),
(1, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(2, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(3, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(4, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(5, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(6, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(7, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(8, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(9, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
],
[
(ti_on_agent_spawn, 0.0, 0.0, [
], [
(try_begin),
    (eq,1,1),
    (agent_get_troop_id,":troop_id_002", ":var001"),
    (try_begin),
        (is_between,":troop_id_002","trp_swadian_merchant","trp_startup_merchants_end"),
        (agent_set_team, ":var001", 7),
        (team_set_relation, 0, 7, 0),
    (try_end),
(try_end),
]),

(1.0, 0.0, ti_once, [
], [
(assign,"$dialog_with_merchant_ended",0),
(store_current_scene,":cur_scene_001"),
(scene_set_slot,":cur_scene_001",0,1),
(try_begin),
    (eq,"$sneaked_into_town",1),
    (call_script, "script_music_set_situation_with_culture", 16384),
(else_try),
    (eq,"$talk_context",14),
    (call_script, "script_music_set_situation_with_culture", 512),
(else_try),
    (call_script, "script_music_set_situation_with_culture", 8192),
(try_end),
]),

(1.0, 0.0, 0.0, [
(try_begin),
    (ge,"$dialog_with_merchant_ended",6),
    (assign,":var001",1),
(else_try),
    (ge,"$dialog_with_merchant_ended",1),
    (neg|conversation_screen_is_active),
    (try_begin),
        (eq,"$dialog_with_merchant_ended",1),
        (check_quest_active,"qst_collect_men"),
        (dialog_box,"str_start_up_first_quest","@Tutorial"),
    (try_end),
    (val_add, "$dialog_with_merchant_ended", 1),
    (assign,":var001",0),
(try_end),
(try_begin),
    (conversation_screen_is_active),
    (tutorial_message, -1),
    (assign,":var001",0),
(try_end),
(try_begin),
    (eq,":var001",1),
], [
(tutorial_message_set_size, 17, 17),
(tutorial_message_set_position, 500, 650),
(tutorial_message_set_center_justify, 0),
(tutorial_message_set_background, 1),
(tutorial_message,"str_press_tab_to_exit_from_town"),
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(set_trigger_result, 1),
], [
]),

(ti_tab_pressed, 0.0, 0.0, [
(this_or_next|gt,"$dialog_with_merchant_ended",0),
(eq,1,1),
(assign,":var001",0),
(party_get_position,pos1,"$current_town"),
(try_for_range, ":var002", 0, 10),
    (map_get_random_position_around_position,pos0,1,2),
    (get_distance_between_positions,":distance_003",0,1),
    (try_begin),
        (ge,":distance_003",":var001"),
        (assign,":var001",":distance_003"),
        (copy_position,2,0),
    (try_end),
(try_end),
(party_set_position,"p_main_party",2),
(finish_mission, ":"),
(assign,"$current_startup_quest_phase",2),
(tutorial_message, -1),
(tutorial_message_set_background, 0),
(change_screen_map),
(try_begin),
    (check_quest_finished,"qst_save_town_from_bandits"),
    (assign,"$g_do_one_more_meeting_with_merchant",1),
(else_try),
    (set_spawn_radius,50),
    (try_for_range, ":var002", 0, 20),
        (spawn_around_party,"p_main_party","pt_looters"),
    (try_end),
(try_end),
(set_trigger_result, 1),
(else_try),
(display_message, "str_cannot_leave_now"),
], [
]),

]),
("town_fight", 0, -1,
"Town Fight",
[(0, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(1, mtef_scene_source|mtef_team_0, af_override_horse, 0, 1, []),
(2, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(3, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(4, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(5, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(6, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(7, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(8, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(9, mtef_visitor_source, af_override_horse, 0, 1, []),
(10, mtef_visitor_source, af_override_horse, 0, 1, []),
(11, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 1, []),
(12, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 1, []),
(13, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 1, []),
(14, mtef_visitor_source, af_override_horse, 0, 1, []),
(15, mtef_visitor_source, af_override_horse, 0, 1, []),
(16, mtef_visitor_source, af_override_horse, 0, 1, []),
(17, mtef_visitor_source, af_override_horse, 0, 1, []),
(18, mtef_visitor_source, af_override_horse, 0, 1, []),
(19, mtef_visitor_source, af_override_horse, 0, 1, []),
(20, mtef_visitor_source, af_override_horse, 0, 1, []),
(21, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 1, []),
(22, mtef_visitor_source|mtef_team_1, af_override_horse, 0, 1, []),
(23, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(24, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(25, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(26, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(27, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(28, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(29, mtef_visitor_source, af_override_horse, 0, 1, []),
(30, mtef_visitor_source, af_override_horse, 0, 1, []),
(31, mtef_visitor_source, af_override_horse, 0, 1, []),
(32, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(33, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(34, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(35, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(36, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(37, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(38, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(39, mtef_visitor_source|mtef_team_0, af_override_horse, 0, 1, []),
(40, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(41, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(42, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(43, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(44, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(45, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(46, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
(47, mtef_visitor_source|mtef_team_1, af_override_horse, aif_start_alarmed, 1, []),
],
[
(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_get_troop_id,":troop_id_002", ":var001"),
(call_script, "script_troop_agent_set_banner", "tableau_game_troop_label_banner", ":var001", ":troop_id_002"),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(agent_set_team, ":var001", 0),
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(mission_disable_talk),
(assign,"$g_main_attacker_agent",0),
(set_party_battle_mode),
(assign,"$number_of_bandits_killed_by_player",0),
(assign,"$number_of_civilian_loses",0),
(set_fixed_point_multiplier, 100),
]),

(1.0, 0.0, ti_once, [
(call_script, "script_init_town_walker_agents"),
], [
]),

(ti_on_agent_killed_or_wounded, 0.0, 0.0, [
], [
(try_begin),
    (eq,1,1),
    (agent_get_team, ":agent_team_no_003", ":var001"),
    (try_begin),
        (eq,":agent_team_no_003",1),
        (get_player_agent_no,":agent_no_004"),
        (try_begin),
            (eq,":agent_no_004",":var002"),
            (val_add, "$number_of_bandits_killed_by_player", 1),
        (else_try),
            (eq,":agent_team_no_003",0),
            (val_add, "$number_of_civilian_loses", 1),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, 0.0, 0.0, [
(lt,"$merchant_sign_count",8),
(val_add, "$merchant_sign_count", 1),
(try_begin),
    (eq,"$merchant_sign_count",2),
    (get_player_agent_no,":agent_no_001"),
    (try_for_agents, ":cur_agent"),
        (agent_get_troop_id,":troop_id_003", ":cur_agent"),
        (try_begin),
            (ge,":troop_id_003","trp_swadian_merchant"),
            (lt,":troop_id_003","trp_startup_merchants_end"),
            (assign,"$g_city_merchant_troop_id",":troop_id_003"),
            (assign,"$g_city_merchant_agent_id",":cur_agent"),
            (agent_get_position,pos0,":agent_no_001"),
            (agent_get_position,pos1,":cur_agent"),
            (assign,":var004",-1000),
            (try_for_range, ":var005", 0, 64),
                (entry_point_get_position, pos6, ":var005"),
                (get_distance_between_positions,":distance_006",0,6),
                (get_distance_between_positions,":distance_007",1,6),
                (store_sub, ":var008", ":distance_007", ":distance_006"),
                (try_begin),
                    (ge,":distance_007",15),
                    (ge,":var008",":var004"),
                    (copy_position,2,6),
                    (assign,":var004",":var008"),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (agent_set_scripted_destination,":cur_agent",2,0),
    (agent_set_speed_limit,":cur_agent",10),
(try_end),
(else_try),
(eq,"$merchant_sign_count",5),
(get_player_agent_no,":agent_no_001"),
(agent_get_position,pos0,":agent_no_001"),
(agent_set_scripted_destination,"$g_city_merchant_agent_id",0,0),
(agent_set_speed_limit,"$g_city_merchant_agent_id",10),
(else_try),
(eq,"$merchant_sign_count",7),
(agent_clear_scripted_mode,"$g_city_merchant_agent_id"),
(assign,"$talk_context",0),
(start_mission_conversation,"$g_city_merchant_troop_id"),
], [
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (ge,"$merchant_sign_count",8),
    (get_player_agent_no,":agent_no_001"),
    (try_for_agents, ":cur_agent"),
        (try_begin),
            (neq,":cur_agent",":agent_no_001"),
            (agent_is_alive,":cur_agent"),
            (agent_get_team, ":agent_team_no_003", ":cur_agent"),
            (try_begin),
                (eq,":agent_team_no_003",0),
                (agent_get_position,pos0,":cur_agent"),
                (assign,":var004",10000),
                (try_for_agents, ":cur_agent"),
                    (try_begin),
                        (agent_is_alive,":cur_agent"),
                        (agent_get_team, ":agent_team_no_006", ":cur_agent"),
                        (try_begin),
                            (eq,":agent_team_no_006",1),
                            (agent_get_position,pos1,":cur_agent"),
                            (get_distance_between_positions,":distance_007",0,1),
                            (try_begin),
                                (le,":distance_007",":var004"),
                                (assign,":var004",":distance_007"),
                                (copy_position,2,1),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (assign,reg1,":distance_007"),
    (try_begin),
        (le,":var004",500),
        (agent_clear_scripted_mode,":cur_agent"),
    (else_try),
        (lt,":var004",10000),
        (agent_set_scripted_destination,":cur_agent",2,0),
    (try_end),
(try_end),
]),

(3.0, 0.0, 0.0, [
(lt,"$merchant_sign_count",8),
(call_script, "script_tick_town_walkers"),
], [
]),

(2.0, 0.0, 0.0, [
(call_script, "script_center_ambiance_sounds"),
], [
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(call_script, "script_change_banners_and_chest"),
]),

(1.0, 4.0, ti_once, [
(this_or_next|main_hero_fallen),
(num_active_teams_le,1),
(ge,"$merchant_sign_count",8),
], [
(try_begin),
    (main_hero_fallen),
    (assign,"$g_killed_first_bandit",0),
(else_try),
    (assign,"$g_killed_first_bandit",1),
(try_end),
(assign,"$current_startup_quest_phase",4),
(mission_enable_talk),
(finish_mission, ":"),
(unlock_achievement, 6),
(change_screen_return),
(set_trigger_result, 1),
]),

(ti_inventory_key_pressed, 0.0, 0.0, [
(eq,"$g_mt_mode",0),
(set_trigger_result, 1),
(else_try),
(eq,"$g_mt_mode",1),
(display_message, "str_cant_use_inventory_disguised"),
(else_try),
(display_message, "str_cant_use_inventory_now"),
], [
]),

(ti_tab_pressed, 0.0, 0.0, [
(display_message, "str_cannot_leave_now"),
], [
]),

]),
("multiplayer_duel", mtf_battle_mode, -1,
"You lead your men to battle.",
[(0, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(1, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(2, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(3, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(4, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(5, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(6, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(7, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(8, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(9, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(10, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(11, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(12, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(13, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(14, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(15, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(16, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(17, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(18, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(19, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(20, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(21, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(22, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(23, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(24, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(25, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(26, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(27, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(28, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(29, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(30, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(31, mtef_visitor_source|mtef_team_0, 0, aif_start_alarmed, 1, []),
(32, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(33, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(34, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(35, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(36, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(37, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(38, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(39, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(40, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(41, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(42, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(43, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(44, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(45, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(46, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(47, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(48, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(49, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(50, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(51, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(52, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(53, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(54, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(55, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(56, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(57, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(58, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(59, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(60, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(61, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(62, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
(63, mtef_visitor_source|mtef_team_1, 0, aif_start_alarmed, 1, []),
],
[
(1.0, 5.0, 0.0, [
(multiplayer_is_server),
(eq,"$g_multiplayer_poll_running",1),
(eq,"$g_multiplayer_poll_ended",0),
(store_mission_timer_a,":m_timer_a_001"),
(try_begin),
    (this_or_next|eq,":var002","$g_multiplayer_poll_num_sent"),
    (gt,":m_timer_a_001","$g_multiplayer_poll_end_time"),
    (call_script, "script_cf_multiplayer_evaluate_poll"),
    (store_add, ":var002", "$g_multiplayer_poll_no_count", "$g_multiplayer_poll_yes_count"),
(try_end),
], [
(assign,"$g_multiplayer_poll_running",0),
(try_begin),
    (this_or_next|eq,"$g_multiplayer_poll_to_show",3),
    (eq,"$g_multiplayer_poll_to_show",0),
    (call_script, "script_game_multiplayer_get_game_type_mission_template", "$g_multiplayer_game_type"),
    (start_multiplayer_mission, reg0, "$g_multiplayer_poll_value_to_show", 1),
    (call_script, "script_game_set_multiplayer_mission_end"),
(try_end),
]),

(ti_on_agent_spawn, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_on_agent_spawn_common", ":var001"),
]),

(ti_server_player_joined, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_player_joined_common", ":var001"),
]),

(ti_before_mission_start, 0.0, 0.0, [
], [
(assign,"$g_multiplayer_game_type",7),
(call_script, "script_multiplayer_server_before_mission_start_common"),
(team_set_relation, 0, 0, 1),
(team_set_relation, 0, 1, 1),
(team_set_relation, 1, 1, 1),
(mission_set_duel_mode, 1),
(call_script, "script_multiplayer_init_mission_variables"),
(call_script, "script_multiplayer_remove_destroy_mod_targets"),
(call_script, "script_multiplayer_remove_headquarters_flags"),
]),

(ti_after_mission_start, 0.0, 0.0, [
], [
(set_spawn_effector_scene_prop_kind, 0, -1),
(set_spawn_effector_scene_prop_kind, 1, -1),
(call_script, "script_initialize_all_scene_prop_slots"),
(call_script, "script_multiplayer_move_moveable_objects_initial_positions"),
(assign,"$g_multiplayer_ready_for_spawning_agent",1),
]),

(ti_on_multiplayer_mission_end, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_event_mission_end"),
(assign,"$g_multiplayer_stats_chart_opened_manually",0),
(start_presentation, "prsnt_multiplayer_stats_chart_deathmatch"),
]),

(ti_on_agent_killed_or_wounded, 0.0, 0.0, [
], [
(call_script, "script_multiplayer_server_on_agent_killed_or_wounded_common", ":agent_id_001", ":var002"),
(try_begin),
    (eq,1,1),
    (get_player_agent_no,":agent_no_003"),
    (try_begin),
        (agent_is_active,":agent_no_003"),
        (agent_slot_ge,":agent_no_003",21,0),
        (try_begin),
            (eq,":agent_id_001",":agent_no_003"),
            (display_message, "str_you_have_lost_a_duel"),
        (else_try),
            (agent_slot_eq,":agent_no_003",21,":agent_id_001"),
            (display_message, "str_you_have_won_a_duel"),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (agent_slot_ge,":agent_id_001",21,0),
    (agent_get_slot,":agent_slot_004",":agent_id_001",21),
    (agent_set_slot,":agent_id_001",21,-1),
    (try_begin),
        (agent_is_active,":agent_slot_004"),
        (agent_set_slot,":agent_slot_004",21,-1),
        (agent_clear_relations_with_agents, ":agent_slot_004"),
        (try_begin),
            (eq,1,1),
            (agent_get_player_id,":agent_player_id_005",":agent_slot_004"),
            (try_begin),
                (neg|player_is_active, ":agent_player_id_005"),
                (agent_force_rethink, ":agent_slot_004"),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (get_max_players, ":max_players"),
    (try_for_range, ":player_id_002", 0, ":max_players"),
        (try_begin),
            (player_is_active, ":player_id_002"),
            (neg|player_is_busy_with_menus, ":player_id_002"),
            (player_get_team_no,  ":team_no_003", ":player_id_002"),
            (try_begin),
                (lt,":team_no_003",2),
                (player_get_troop_id, ":troop_id_004", ":player_id_002"),
                (try_begin),
                    (ge,":troop_id_004",0),
                    (player_get_agent_id, ":agent_id_005", ":player_id_002"),
                    (assign,":var006",0),
                    (try_begin),
                        (eq,1,1),
                        (player_get_slot,":player_slot_007",":player_id_002",24),
                        (try_begin),
                            (eq,":player_slot_007",1),
                            (assign,":var006",1),
                            (player_set_slot,":player_id_002",24,0),
                        (else_try),
                            (try_begin),
                                (lt,":agent_id_005",0),
                                (assign,":var006",1),
                            (else_try),
                                (neg|agent_is_alive,":agent_id_005"),
                                (agent_get_time_elapsed_since_removed, ":agent_time_since_removed_008", ":agent_id_005"),
                                (try_begin),
                                    (gt,":agent_time_since_removed_008","$g_multiplayer_respawn_period"),
                                    (assign,":var006",1),
                                (try_end),
                            (try_end),
                        (try_end),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var006",1),
        (call_script, "script_multiplayer_buy_agent_equipment", ":player_id_002"),
        (troop_get_inventory_slot,":troop_inv_slot_009",":troop_id_004",8),
        (try_begin),
            (ge,":troop_inv_slot_009",0),
            (assign,":var010",1),
        (else_try),
            (assign,":var010",0),
        (try_end),
    (try_end),
    (call_script, "script_multiplayer_find_spawn_point", ":team_no_003", 0, ":var010"),
    (player_spawn_new_agent, ":player_id_002", reg0),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (store_mission_timer_a,":m_timer_a_001"),
    (try_begin),
        (ge,":m_timer_a_001",2),
        (assign,":var002",0),
        (assign,":var003",0),
        (try_for_agents, ":cur_agent"),
            (try_begin),
                (agent_is_non_player, ":cur_agent"),
                (agent_is_human,":cur_agent"),
                (assign,":var005",0),
                (try_begin),
                    (agent_is_alive,":cur_agent"),
                    (assign,":var005",1),
                (else_try),
                    (agent_get_time_elapsed_since_removed, ":agent_time_since_removed_006", ":cur_agent"),
                    (try_begin),
                        (le,":agent_time_since_removed_006","$g_multiplayer_respawn_period"),
                        (assign,":var005",1),
                    (try_end),
                (try_end),
            (try_end),
        (try_end),
    (try_end),
    (try_begin),
        (eq,":var005",1),
        (agent_get_team, ":agent_team_no_007", ":cur_agent"),
        (try_begin),
            (eq,":agent_team_no_007",0),
            (val_add, ":var002", 1),
        (else_try),
            (eq,":agent_team_no_007",1),
            (val_add, ":var003", 1),
        (try_end),
    (try_end),
(try_end),
(store_sub, "$g_multiplayer_num_bots_required_team_1", "$g_multiplayer_num_bots_team_1", ":var002"),
(store_sub, "$g_multiplayer_num_bots_required_team_2", "$g_multiplayer_num_bots_team_2", ":var003"),
(val_max,"$g_multiplayer_num_bots_required_team_1",0),
(val_max,"$g_multiplayer_num_bots_required_team_2",0),
]),

(0.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (eq,"$g_multiplayer_ready_for_spawning_agent",1),
    (store_add, ":var001", "$g_multiplayer_num_bots_required_team_1", "$g_multiplayer_num_bots_required_team_2"),
    (try_begin),
        (gt,":var001",0),
        (store_random_in_range,":random_x_002",0,":var001"),
        (val_sub, ":random_x_002", "$g_multiplayer_num_bots_required_team_1"),
        (try_begin),
            (lt,":random_x_002",0),
            (assign,":team_id_003",0),
            (val_sub, "$g_multiplayer_num_bots_required_team_1", 1),
        (else_try),
            (assign,":team_id_003",1),
            (val_sub, "$g_multiplayer_num_bots_required_team_2", 1),
        (try_end),
    (try_end),
    (team_get_faction, ":team_faction_004", ":team_id_003"),
    (assign,":var005",0),
    (try_for_range, ":trp_006", "trp_swadian_crossbowman_multiplayer_ai", "trp_swadian_crossbowman_multiplayer"),
        (store_troop_faction,":troop_faction_007",":trp_006"),
        (try_begin),
            (eq,":troop_faction_007",":team_faction_004"),
            (val_add, ":var005", 1),
        (try_end),
    (try_end),
    (store_random_in_range,":random_x_008",0,":var005"),
    (assign,":var009","trp_swadian_crossbowman_multiplayer"),
    (try_for_range, ":trp_006", "trp_swadian_crossbowman_multiplayer_ai", ":var009"),
        (store_troop_faction,":troop_faction_007",":trp_006"),
        (try_begin),
            (eq,":troop_faction_007",":team_faction_004"),
            (val_sub, ":random_x_008", 1),
            (try_begin),
                (lt,":random_x_008",0),
                (assign,":var009",0),
                (assign,":troop_id_010",":trp_006"),
            (try_end),
        (try_end),
    (try_end),
    (troop_get_inventory_slot,":troop_inv_slot_011",":troop_id_010",8),
    (try_begin),
        (ge,":troop_inv_slot_011",0),
        (assign,":var012",1),
    (else_try),
        (assign,":var012",0),
    (try_end),
    (call_script, "script_multiplayer_find_spawn_point", ":team_id_003", 0, ":var012"),
    (store_current_scene,":cur_scene_013"),
    (modify_visitors_at_site,":cur_scene_013"),
    (add_visitors_to_current_scene,reg0,":troop_id_010",1, ":team_id_003", -1),
    (assign,"$g_multiplayer_ready_for_spawning_agent",0),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(try_begin),
    (multiplayer_is_server),
    (assign,":var001",0),
    (try_begin),
        (eq,1,1),
        (store_mission_timer_a,":m_timer_a_002"),
        (store_mul, ":var003", "$g_multiplayer_game_max_minutes", 60),
        (try_begin),
            (gt,":m_timer_a_002",":var003"),
            (assign,":var001",1),
        (try_end),
    (try_end),
(try_end),
(try_begin),
    (eq,":var001",1),
    (call_script, "script_game_multiplayer_get_game_type_mission_template", "$g_multiplayer_game_type"),
    (start_multiplayer_mission, reg0, "$g_multiplayer_selected_map", 0),
    (call_script, "script_game_set_multiplayer_mission_end"),
(try_end),
]),

(ti_tab_pressed, 0.0, 0.0, [
], [
(try_begin),
    (eq,"$g_multiplayer_mission_end_screen",0),
    (assign,"$g_multiplayer_stats_chart_opened_manually",1),
    (start_presentation, "prsnt_multiplayer_stats_chart_deathmatch"),
(try_end),
]),

(0.0, 0.0, ti_once, [
], [
(start_presentation, "prsnt_multiplayer_welcome_message"),
]),

(ti_escape_pressed, 0.0, 0.0, [
], [
(try_begin),
    (neg|is_presentation_active, "prsnt_multiplayer_escape_menu"),
    (neg|is_presentation_active, "prsnt_multiplayer_stats_chart_deathmatch"),
    (eq,"$g_waiting_for_confirmation_to_terminate",0),
    (start_presentation, "prsnt_multiplayer_escape_menu"),
(try_end),
]),

(1.0, 0.0, 0.0, [
], [
(store_mission_timer_a,":m_timer_a_001"),
(store_sub, ":var002", ":m_timer_a_001", 3),
(try_for_agents, ":cur_agent"),
    (try_begin),
        (agent_slot_ge,":cur_agent",21,0),
        (agent_get_slot,":agent_slot_004",":cur_agent",22),
        (try_begin),
            (ge,":agent_slot_004",0),
            (le,":agent_slot_004",":var002"),
            (agent_set_slot,":cur_agent",22,-1),
            (agent_get_slot,":agent_slot_005",":cur_agent",21),
            (try_begin),
                (agent_is_active,":agent_slot_005"),
                (agent_add_relation_with_agent, ":cur_agent", ":cur_agent", -1),
                (agent_force_rethink, ":cur_agent"),
            (try_end),
        (try_end),
    (try_end),
(try_end),
]),

]),

] # MISSION TEMPLATES END
